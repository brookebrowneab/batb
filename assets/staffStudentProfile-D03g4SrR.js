import{e as E,g as x}from"./index-CvLlIQq8.js";import{e as s}from"./escapeHtml-lW1fV86Q.js";import{f as b,a as p}from"./scheduling-DSZ8OVmG.js";import{b as N}from"./students-BdMRccDH.js";import{a as I}from"./storage-da3M60H6.js";import{f as S,c as $,u as P,d as B}from"./evaluations-CGyI4sJV.js";import{f as z}from"./vocalBookings-DdAfK_Ri.js";const y=["dance","vocal","callbacks","general"];function C(a,t,n,e){if(!a)return{student:null,dance:null,vocal:null,callbackInvited:!1,evaluations:[],missingFields:["Student not found"]};const o=[];return a.first_name||o.push("first_name"),a.last_name||o.push("last_name"),a.grade||o.push("grade"),a.photo_storage_path||o.push("photo"),a.parent_first_name||o.push("parent_first_name"),a.parent_last_name||o.push("parent_last_name"),a.parent_email||o.push("parent_email"),a.parent_phone||o.push("parent_phone"),{student:a,dance:t||null,vocal:n||null,callbackInvited:a.callback_invited===!0,evaluations:e||[],missingFields:o}}function D(a,t){const n=[];return(!a||!a.trim())&&n.push("Notes cannot be empty."),(!t||!y.includes(t))&&n.push(`Track must be one of: ${y.join(", ")}.`),{valid:n.length===0,errors:n}}let l=null,v=null,i=null,d=null;function q(){const a=document.createElement("div");return a.className="page",a.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Student Profile</h1>
      <button class="btn-ghost" onclick="history.back()" style="min-height:auto;width:auto">‚Üê Back</button>
    </div>
    <div class="form-message" id="profile-msg" aria-live="polite"></div>
    <div id="profile-content"><p>Loading‚Ä¶</p></div>
  `,setTimeout(()=>T(),0),a}async function T(){var c;const t=E().id;if(!t){_("No student ID provided. Use a link from a roster page.");return}const[n,e,o,r]=await Promise.all([N(t),S(),z(t),$(t)]);if(n.error||!n.data){_(((c=n.error)==null?void 0:c.message)||"Student not found.");return}if(l=C(n.data,{dance_windows:e.data||[]},o.data,r.data||[]),v=null,l.student.photo_storage_path){const{url:m}=await I(l.student.photo_storage_path);v=m}i=null,d=null,u()}function _(a){const t=document.getElementById("profile-content");t&&(t.innerHTML=`<div class="placeholder-notice">${s(a)}</div>`)}function u(){const a=document.getElementById("profile-content");if(!a||!l||!l.student)return;const t=l.student,n=t.registration_complete?'<span class="status-badge--complete">‚úì Complete</span>':'<span class="status-badge--pending">‚è≥ Incomplete</span>';let e="";e+='<div class="card" style="margin-bottom:var(--space-lg)">',e+='<div style="display:flex;gap:var(--space-lg);align-items:flex-start;flex-wrap:wrap">',v?e+=`<img src="${s(v)}" alt="Student photo" style="width:120px;height:120px;object-fit:cover;border-radius:var(--radius-md);border:2px solid var(--color-border-light)" />`:e+=`<div class="avatar avatar--lg" style="width:120px;height:120px;font-size:2rem">${(t.first_name||"?")[0]}${(t.last_name||"?")[0]}</div>`,e+='<div style="flex:1">',e+=`<h2 style="margin:0 0 var(--space-xs)">${s(t.first_name||"")} ${s(t.last_name||"")}</h2>`,e+=`<p style="margin:0 0 var(--space-xs);font-size:var(--text-small)">Grade ${s(t.grade||"‚Äî")}</p>`,t.student_email&&(e+=`<p style="margin:0 0 var(--space-xs);font-size:var(--text-small)"><strong>Student Email:</strong> ${s(t.student_email)}</p>`),e+=`<div style="display:flex;flex-wrap:wrap;gap:var(--space-xs);margin-bottom:var(--space-xs)">${n}`,e+=l.callbackInvited?' <span class="status-badge--complete">‚≠ê Callback Invited</span>':"",e+="</div>",e+="</div></div>",e+='<div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">',e+='<h3 style="font-size:var(--text-small);font-family:var(--font-body);text-transform:uppercase;letter-spacing:0.05em;color:var(--color-text-muted);margin-bottom:var(--space-sm)">Parent / Guardian</h3>',e+=`<p style="font-size:var(--text-small)">${s(t.parent_first_name||"")} ${s(t.parent_last_name||"")}</p>`,e+=`<p style="font-size:var(--text-small)"><strong>Email:</strong> ${s(t.parent_email||"‚Äî")}</p>`,e+=`<p style="font-size:var(--text-small)"><strong>Phone:</strong> ${s(t.parent_phone||"‚Äî")}</p>`,e+="</div>",(t.parent2_first_name||t.parent2_last_name||t.parent2_email||t.parent2_phone)&&(e+='<div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">',e+='<h3 style="font-size:var(--text-small);font-family:var(--font-body);text-transform:uppercase;letter-spacing:0.05em;color:var(--color-text-muted);margin-bottom:var(--space-sm)">Parent / Guardian 2</h3>',e+=`<p style="font-size:var(--text-small)">${s(t.parent2_first_name||"")} ${s(t.parent2_last_name||"")}</p>`,e+=`<p style="font-size:var(--text-small)"><strong>Email:</strong> ${s(t.parent2_email||"‚Äî")}</p>`,e+=`<p style="font-size:var(--text-small)"><strong>Phone:</strong> ${s(t.parent2_phone||"‚Äî")}</p>`,e+="</div>"),t.sings_own_disney_song&&(e+='<div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">',e+=`<span class="status-badge--complete">Own Disney Song: ${s(t.song_name||"‚Äî")}</span>`,e+="</div>"),e+="</div>",e+='<div class="card" style="margin-bottom:var(--space-lg)">',e+='<h3 style="margin-bottom:var(--space-md)">Participation</h3>',e+=A(),e+="</div>",e+='<div class="card">',e+='<h3 style="margin-bottom:var(--space-md)">Evaluation Notes</h3>',e+=L(),e+=U(),e+="</div>",a.innerHTML=e,j(a)}function A(){var t,n;let a='<table class="data-table"><thead><tr><th>Track</th><th>Status</th><th>Details</th></tr></thead><tbody>';if((n=(t=l.dance)==null?void 0:t.dance_windows)!=null&&n.length){const e=l.dance.dance_windows.map(o=>`${b(o.audition_date)} ${p(o.start_time)} ‚Äì ${p(o.end_time)}`).join("; ");a+=`<tr><td>üéµ Dance</td><td style="color:var(--color-success)">Assigned</td><td>${s(e)}</td></tr>`}else a+='<tr><td>üéµ Dance</td><td style="color:var(--color-text-muted)">Not configured</td><td>‚Äî</td></tr>';if(l.vocal&&l.vocal.audition_slots){const e=l.vocal.audition_slots;a+=`<tr><td>üé§ Vocal</td><td style="color:var(--color-success)">Booked</td><td>${b(e.audition_date)} ${p(e.start_time)} ‚Äì ${p(e.end_time)}</td></tr>`}else a+='<tr><td>üé§ Vocal</td><td style="color:var(--color-text-muted)">Not booked</td><td>‚Äî</td></tr>';return a+=`<tr><td>‚≠ê Callbacks</td><td>${l.callbackInvited?'<span style="color:var(--color-success)">Invited</span>':'<span style="color:var(--color-text-muted)">Not invited</span>'}</td><td>‚Äî</td></tr>`,a+="</tbody></table>",a}function L(){if(l.evaluations.length===0)return'<p style="font-size:var(--text-small);color:var(--color-text-muted);margin-bottom:var(--space-md)">No evaluation notes yet.</p>';const{user:a}=x();let t='<table class="data-table"><thead><tr><th>Track</th><th>Notes</th><th>By</th><th>Date</th><th>Actions</th></tr></thead><tbody>';return l.evaluations.forEach(n=>{var c;const e=((c=n.staff_profiles)==null?void 0:c.display_name)||"Unknown",o=new Date(n.created_at).toLocaleString(),r=n.staff_user_id===(a==null?void 0:a.id);t+=`<tr>
      <td>${s(n.track)}</td>
      <td>${s(n.notes)}</td>
      <td>${s(e)}</td>
      <td style="font-size:var(--text-xs)">${s(o)}</td>
      <td>${r?`<button class="btn-small edit-eval-btn" data-id="${n.id}" data-notes="${s(n.notes)}" data-track="${s(n.track)}">Edit</button>`:""}</td>
    </tr>`}),t+="</tbody></table>",t}function U(){const a=i!==null,t=a?l.evaluations.find(n=>n.id===i):null;return`
    <div style="margin-top:var(--space-lg);max-width:500px">
      <h4>${a?"Edit Note":"Add Note"}</h4>
      <div class="login-form" style="max-width:100%">
        <label for="eval-track">Track</label>
        <select id="eval-track" ${a?"disabled":""}>
          <option value="general" ${!t||t.track==="general"?"selected":""}>General</option>
          <option value="dance" ${(t==null?void 0:t.track)==="dance"?"selected":""}>Dance</option>
          <option value="vocal" ${(t==null?void 0:t.track)==="vocal"?"selected":""}>Vocal</option>
          <option value="callbacks" ${(t==null?void 0:t.track)==="callbacks"?"selected":""}>Callbacks</option>
        </select>
        <label for="eval-notes">Notes</label>
        <textarea id="eval-notes" rows="3">${t?s(t.notes):""}</textarea>
        <div style="display:flex;gap:var(--space-sm)">
          <button id="eval-submit-btn" class="btn-accent">${a?"Update Note":"Add Note"}</button>
          ${a?'<button id="eval-cancel-btn" class="btn-ghost">Cancel</button>':""}
        </div>
        <div class="form-message${d!=null&&d.type?` ${d.type}`:""}" id="eval-msg" aria-live="polite">${(d==null?void 0:d.text)||""}</div>
      </div>
    </div>
  `}function j(a){a.querySelectorAll(".edit-eval-btn").forEach(e=>{e.addEventListener("click",()=>{i=e.dataset.id,u()})});const t=document.getElementById("eval-cancel-btn");t&&t.addEventListener("click",()=>{i=null,u()});const n=document.getElementById("eval-submit-btn");n&&n.addEventListener("click",async()=>{var f,g,h;const e=(f=document.getElementById("eval-track"))==null?void 0:f.value,o=(h=(g=document.getElementById("eval-notes"))==null?void 0:g.value)==null?void 0:h.trim(),r=document.getElementById("eval-msg"),c=D(o,e);if(!c.valid){r&&(r.className="form-message error",r.textContent=c.errors.join(" "));return}n.disabled=!0,n.textContent=i?"Updating‚Ä¶":"Adding‚Ä¶",d=null,r&&(r.className="form-message",r.textContent="");let m;if(i)({error:m}=await P(i,o));else{const{user:w}=x();({error:m}=await B(l.student.id,w.id,e,o))}if(m){n.disabled=!1,n.textContent=i?"Update Note":"Add Note",r&&(r.className="form-message error",r.textContent=m.message||"Failed to save note.");return}d={type:"success",text:i?"Note updated.":"Note added."},i=null;const{data:k}=await $(l.student.id);l.evaluations=k||[],u()})}export{q as renderStaffStudentProfile};
