var Wy=Object.defineProperty;var Vy=(n,e,t)=>e in n?Wy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Re=(n,e,t)=>Vy(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const cv=[];let uv=()=>"<p>Page not found.</p>",yf=null;function Xn(n,e){cv.push({path:n,render:e})}function Gy(n){uv=n}function Ky(n){yf=n}function xp(n){window.location.hash=n}function dv(){return window.location.hash.slice(1)||"/"}function Yy(){const n=window.location.hash.slice(1)||"/",e=n.indexOf("?");if(e===-1)return{};const t={},r=n.slice(e+1).split("&");for(const i of r){const[s,a]=i.split("=");if(s)try{t[decodeURIComponent(s)]=decodeURIComponent(a||"")}catch{}}return t}function Jy(n){const e=document.querySelector(n);if(!e)throw new Error(`Router container "${n}" not found`);function t(){const r=document.querySelector(n)||e,s=dv().split("?")[0];if(yf){const l=yf(s);if(!l.allowed&&l.redirect){xp(l.redirect);return}}const a=cv.find(l=>l.path===s),o=a?a.render():uv();typeof o=="string"?r.innerHTML=o:o instanceof HTMLElement&&(r.innerHTML="",r.appendChild(o)),Xy(s)}return window.addEventListener("hashchange",t),t(),{rerender:t}}function Xy(n){document.querySelectorAll("nav a[data-route]").forEach(e=>{const t=e.getAttribute("data-route");e.classList.toggle("active",t===n)})}function qd(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Zy(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(d){try{c(r.next(d))}catch(m){a(m)}}function l(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?s(d.value):i(d.value).then(o,l)}c((r=r.apply(n,e||[])).next())})}const Qy=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);class Ap extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class e5 extends Ap{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ag extends Ap{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class og extends Ap{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var wf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(wf||(wf={}));class t5{constructor(e,{headers:t={},customFetch:r,region:i=wf.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Qy(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Zy(this,arguments,void 0,function*(t,r={}){var i;let s,a;try{const{headers:o,method:l,body:c,signal:d,timeout:m}=r;let p={},{region:h}=r;h||(h=this.region);const b=new URL(`${this.url}/${t}`);h&&h!=="any"&&(p["x-region"]=h,b.searchParams.set("forceFunctionRegion",h));let w;c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",w=c):typeof c=="string"?(p["Content-Type"]="text/plain",w=c):typeof FormData<"u"&&c instanceof FormData?w=c:(p["Content-Type"]="application/json",w=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?w=JSON.stringify(c):w=c;let S=d;m&&(a=new AbortController,s=setTimeout(()=>a.abort(),m),d?(S=a.signal,d.addEventListener("abort",()=>a.abort())):S=a.signal);const A=yield this.fetch(b.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),o),body:w,signal:S}).catch(K=>{throw new e5(K)}),I=A.headers.get("x-relay-error");if(I&&I==="true")throw new ag(A);if(!A.ok)throw new og(A);let O=((i=A.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),P;return O==="application/json"?P=yield A.json():O==="application/octet-stream"||O==="application/pdf"?P=yield A.blob():O==="text/event-stream"?P=A:O==="multipart/form-data"?P=yield A.formData():P=yield A.text(),{data:P,error:null,response:A}}catch(o){return{data:null,error:o,response:o instanceof og||o instanceof ag?o.context:void 0}}finally{s&&clearTimeout(s)}})}}var n5=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},r5=class{constructor(n){var e,t,r;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(e=n.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=n.signal,this.isMaybeSingle=(t=n.isMaybeSingle)!==null&&t!==void 0?t:!1,this.urlLengthLimit=(r=n.urlLengthLimit)!==null&&r!==void 0?r:8e3,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=new Headers(this.headers),this.headers.set(n,e),this}then(n,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{let a=null,o=null,l=null,c=s.status,d=s.statusText;if(s.ok){var m,p;if(t.method!=="HEAD"){var h;const A=await s.text();A===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((h=t.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text"))?o=A:o=JSON.parse(A))}const w=(m=t.headers.get("Prefer"))===null||m===void 0?void 0:m.match(/count=(exact|planned|estimated)/),S=(p=s.headers.get("content-range"))===null||p===void 0?void 0:p.split("/");w&&S&&S.length>1&&(l=parseInt(S[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(o)&&(o.length>1?(a={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,d="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var b;const w=await s.text();try{a=JSON.parse(w),Array.isArray(a)&&s.status===404&&(o=[],a=null,c=200,d="OK")}catch{s.status===404&&w===""?(c=204,d="No Content"):a={message:w}}if(a&&t.isMaybeSingle&&(!(a==null||(b=a.details)===null||b===void 0)&&b.includes("0 rows"))&&(a=null,c=200,d="OK"),a&&t.shouldThrowOnError)throw new n5(a)}return{error:a,data:o,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(i=i.catch(s=>{var a;let o="",l="",c="";const d=s==null?void 0:s.cause;if(d){var m,p,h,b;const A=(m=d==null?void 0:d.message)!==null&&m!==void 0?m:"",I=(p=d==null?void 0:d.code)!==null&&p!==void 0?p:"";o=`${(h=s==null?void 0:s.name)!==null&&h!==void 0?h:"FetchError"}: ${s==null?void 0:s.message}`,o+=`

Caused by: ${(b=d==null?void 0:d.name)!==null&&b!==void 0?b:"Error"}: ${A}`,I&&(o+=` (${I})`),d!=null&&d.stack&&(o+=`
${d.stack}`)}else{var w;o=(w=s==null?void 0:s.stack)!==null&&w!==void 0?w:""}const S=this.url.toString().length;return(s==null?void 0:s.name)==="AbortError"||(s==null?void 0:s.code)==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",S>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${S} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((d==null?void 0:d.name)==="HeadersOverflowError"||(d==null?void 0:d.code)==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",S>this.urlLengthLimit&&(l+=`. Your request URL is ${S} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(a=s==null?void 0:s.name)!==null&&a!==void 0?a:"FetchError"}: ${s==null?void 0:s.message}`,details:o,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),i.then(n,e)}returns(){return this}overrideTypes(){return this}},i5=class extends r5{select(n){let e=!1;const t=(n??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:e=!0,nullsFirst:t,foreignTable:r,referencedTable:i=r}={}){const s=i?`${i}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:t=e}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${n}`),this}range(n,e,{foreignTable:t,referencedTable:r=t}={}){const i=typeof r>"u"?"offset":`${r}.offset`,s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(s,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:e=!1,settings:t=!1,buffers:r=!1,wal:i=!1,format:s="text"}={}){var a;const o=[n?"analyze":null,e?"verbose":null,t?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${l}"; options=${o};`),s==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const lg=new RegExp("[,()]");var nl=class extends i5{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}regexMatch(n,e){return this.url.searchParams.append(n,`match.${e}`),this}regexIMatch(n,e){return this.url.searchParams.append(n,`imatch.${e}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}isDistinct(n,e){return this.url.searchParams.append(n,`isdistinct.${e}`),this}in(n,e){const t=Array.from(new Set(e)).map(r=>typeof r=="string"&&lg.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(n,`in.(${t})`),this}notIn(n,e){const t=Array.from(new Set(e)).map(r=>typeof r=="string"&&lg.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(n,`not.in.(${t})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:t,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const s=t===void 0?"":`(${t})`;return this.url.searchParams.append(n,`${i}fts${s}.${e}`),this}match(n){return Object.entries(n).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(n,e,t){return this.url.searchParams.append(n,`not.${e}.${t}`),this}or(n,{foreignTable:e,referencedTable:t=e}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${n})`),this}filter(n,e,t){return this.url.searchParams.append(n,`${e}.${t}`),this}},s5=class{constructor(n,{headers:e={},schema:t,fetch:r,urlLengthLimit:i=8e3}){this.url=n,this.headers=new Headers(e),this.schema=t,this.fetch=r,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,e){const{head:t=!1,count:r}=e??{},i=t?"HEAD":"GET";let s=!1;const a=(n??"*").split("").map(c=>/\s/.test(c)&&!s?"":(c==='"'&&(s=!s),c)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",a),r&&l.append("Prefer",`count=${r}`),new nl({method:i,url:o,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(n,{count:e,defaultToNull:t=!0}={}){var r;const i="POST",{url:s,headers:a}=this.cloneRequestState();if(e&&a.append("Prefer",`count=${e}`),t||a.append("Prefer","missing=default"),Array.isArray(n)){const o=n.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);s.searchParams.set("columns",l.join(","))}}return new nl({method:i,url:s,headers:a,schema:this.schema,body:n,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(n,{onConflict:e,ignoreDuplicates:t=!1,count:r,defaultToNull:i=!0}={}){var s;const a="POST",{url:o,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&o.searchParams.set("on_conflict",e),r&&l.append("Prefer",`count=${r}`),i||l.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((d,m)=>d.concat(Object.keys(m)),[]);if(c.length>0){const d=[...new Set(c)].map(m=>`"${m}"`);o.searchParams.set("columns",d.join(","))}}return new nl({method:a,url:o,headers:l,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}update(n,{count:e}={}){var t;const r="PATCH",{url:i,headers:s}=this.cloneRequestState();return e&&s.append("Prefer",`count=${e}`),new nl({method:r,url:i,headers:s,schema:this.schema,body:n,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:n}={}){var e;const t="DELETE",{url:r,headers:i}=this.cloneRequestState();return n&&i.append("Prefer",`count=${n}`),new nl({method:t,url:r,headers:i,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function Pc(n){"@babel/helpers - typeof";return Pc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pc(n)}function a5(n,e){if(Pc(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(Pc(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function o5(n){var e=a5(n,"string");return Pc(e)=="symbol"?e:e+""}function l5(n,e,t){return(e=o5(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function cg(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ou(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cg(Object(t),!0).forEach(function(r){l5(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):cg(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var c5=class hv{constructor(e,{headers:t={},schema:r,fetch:i,timeout:s,urlLengthLimit:a=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.urlLengthLimit=a;const o=i??globalThis.fetch;s!==void 0&&s>0?this.fetch=(l,c)=>{const d=new AbortController,m=setTimeout(()=>d.abort(),s),p=c==null?void 0:c.signal;if(p){if(p.aborted)return clearTimeout(m),o(l,c);const h=()=>{clearTimeout(m),d.abort()};return p.addEventListener("abort",h,{once:!0}),o(l,Ou(Ou({},c),{},{signal:d.signal})).finally(()=>{clearTimeout(m),p.removeEventListener("abort",h)})}return o(l,Ou(Ou({},c),{},{signal:d.signal})).finally(()=>clearTimeout(m))}:this.fetch=o}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new s5(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new hv(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:r=!1,get:i=!1,count:s}={}){var a;let o;const l=new URL(`${this.url}/rpc/${e}`);let c;const d=h=>h!==null&&typeof h=="object"&&(!Array.isArray(h)||h.some(d)),m=r&&Object.values(t).some(d);m?(o="POST",c=t):r||i?(o=r?"HEAD":"GET",Object.entries(t).filter(([h,b])=>b!==void 0).map(([h,b])=>[h,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([h,b])=>{l.searchParams.append(h,b)})):(o="POST",c=t);const p=new Headers(this.headers);return m?p.set("Prefer",s?`count=${s},return=minimal`:"return=minimal"):s&&p.set("Prefer",`count=${s}`),new nl({method:o,url:l,headers:p,schema:this.schemaName,body:c,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}};class u5{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const r=t.versions;if(r&&r.node){const i=r.node,s=parseInt(i.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const d5="2.98.0",h5=`realtime-js/${d5}`,f5="1.0.0",fv="2.0.0",ug=fv,_f=1e4,p5=1e3,m5=100;var Ba;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ba||(Ba={}));var lr;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(lr||(lr={}));var ns;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(ns||(ns={}));var xf;(function(n){n.websocket="websocket"})(xf||(xf={}));var vo;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(vo||(vo={}));class g5{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const i=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var t,r;const i=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:{},a=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,t,r){var i,s;const a=e.topic,o=(i=e.ref)!==null&&i!==void 0?i:"",l=(s=e.join_ref)!==null&&s!==void 0?s:"",c=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},m=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`metadata length ${m.length} exceeds maximum of 255`);const p=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+o.length+a.length+c.length+m.length,h=new ArrayBuffer(this.HEADER_LENGTH+p);let b=new DataView(h),w=0;b.setUint8(w++,this.KINDS.userBroadcastPush),b.setUint8(w++,l.length),b.setUint8(w++,o.length),b.setUint8(w++,a.length),b.setUint8(w++,c.length),b.setUint8(w++,m.length),b.setUint8(w++,t),Array.from(l,A=>b.setUint8(w++,A.charCodeAt(0))),Array.from(o,A=>b.setUint8(w++,A.charCodeAt(0))),Array.from(a,A=>b.setUint8(w++,A.charCodeAt(0))),Array.from(c,A=>b.setUint8(w++,A.charCodeAt(0))),Array.from(m,A=>b.setUint8(w++,A.charCodeAt(0)));var S=new Uint8Array(h.byteLength+r.byteLength);return S.set(new Uint8Array(h),0),S.set(new Uint8Array(r),h.byteLength),S.buffer}decode(e,t){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return t(r)}if(typeof e=="string"){const r=JSON.parse(e),[i,s,a,o,l]=r;return t({join_ref:i,ref:s,topic:a,event:o,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),i=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,i)}}_decodeUserBroadcast(e,t,r){const i=t.getUint8(1),s=t.getUint8(2),a=t.getUint8(3),o=t.getUint8(4);let l=this.HEADER_LENGTH+4;const c=r.decode(e.slice(l,l+i));l=l+i;const d=r.decode(e.slice(l,l+s));l=l+s;const m=r.decode(e.slice(l,l+a));l=l+a;const p=e.slice(l,e.byteLength),h=o===this.JSON_ENCODING?JSON.parse(r.decode(p)):p,b={type:this.BROADCAST_EVENT,event:d,payload:h};return a>0&&(b.meta=JSON.parse(m)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:b}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>t.includes(r)))}}class pv{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var xn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(xn||(xn={}));const dg=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((s,a)=>(s[a]=v5(a,n,e,i),s),{}):{}},v5=(n,e,t,r)=>{const i=e.find(o=>o.name===n),s=i==null?void 0:i.type,a=t[n];return s&&!r.includes(s)?mv(s,a):Af(a)},mv=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _5(e,t)}switch(n){case xn.bool:return b5(e);case xn.float4:case xn.float8:case xn.int2:case xn.int4:case xn.int8:case xn.numeric:case xn.oid:return y5(e);case xn.json:case xn.jsonb:return w5(e);case xn.timestamp:return x5(e);case xn.abstime:case xn.date:case xn.daterange:case xn.int4range:case xn.int8range:case xn.money:case xn.reltime:case xn.text:case xn.time:case xn.timestamptz:case xn.timetz:case xn.tsrange:case xn.tstzrange:return Af(e);default:return Af(e)}},Af=n=>n,b5=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},y5=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},w5=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},_5=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let s;const a=n.slice(1,t);try{s=JSON.parse("["+a+"]")}catch{s=a?a.split(","):[]}return s.map(o=>mv(e,o))}return n},x5=n=>typeof n=="string"?n.replace(" ","T"):n,gv=n=>{const e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class wh{constructor(e,t,r={},i=_f){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var hg;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(hg||(hg={}));class xc{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:s,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xc.syncState(this.state,i,s,a),this.pendingDiffs.forEach(l=>{this.state=xc.syncDiff(this.state,l,s,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},i=>{const{onJoin:s,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=xc.syncDiff(this.state,i,s,a),o())}),this.onJoin((i,s,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:a})}),this.onLeave((i,s,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const s=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(s,(c,d)=>{a[c]||(l[c]=d)}),this.map(a,(c,d)=>{const m=s[c];if(m){const p=d.map(S=>S.presence_ref),h=m.map(S=>S.presence_ref),b=d.filter(S=>h.indexOf(S.presence_ref)<0),w=m.filter(S=>p.indexOf(S.presence_ref)<0);b.length>0&&(o[c]=b),w.length>0&&(l[c]=w)}else o[c]=d}),this.syncDiff(s,{joins:o,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:s,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(s,(o,l)=>{var c;const d=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),d.length>0){const m=e[o].map(h=>h.presence_ref),p=d.filter(h=>m.indexOf(h.presence_ref)<0);e[o].unshift(...p)}r(o,d,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const d=l.map(m=>m.presence_ref);c=c.filter(m=>d.indexOf(m.presence_ref)<0),e[o]=c,i(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fg;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(fg||(fg={}));var Ac;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ac||(Ac={}));var ea;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ea||(ea={}));class fl{constructor(e,t={config:{}},r){var i,s;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=lr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new wh(this,ns.join,this.params,this.timeout),this.rejoinTimer=new pv(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=lr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=lr.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=lr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=lr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=lr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ns.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new xc(this),this.broadcastEndpointURL=gv(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((s=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||s===void 0)&&s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==lr.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,c=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[Ac.PRESENCE]&&this.bindings[Ac.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,m={},p={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(h=>e==null?void 0:e(ea.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(ea.CLOSED)),this.updateJoinPayload(Object.assign({config:p},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var b;if(this.socket._isManualToken()||this.socket.setAuth(),h===void 0){e==null||e(ea.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,S=(b=w==null?void 0:w.length)!==null&&b!==void 0?b:0,A=[];for(let I=0;I<S;I++){const O=w[I],{filter:{event:P,schema:K,table:le,filter:he}}=O,ne=h&&h[I];if(ne&&ne.event===P&&fl.isFilterValueEqual(ne.schema,K)&&fl.isFilterValueEqual(ne.table,le)&&fl.isFilterValueEqual(ne.filter,he))A.push(Object.assign(Object.assign({},O),{id:ne.id}));else{this.unsubscribe(),this.state=lr.errored,e==null||e(ea.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=A,e&&e(ea.SUBSCRIBED);return}}).receive("error",h=>{this.state=lr.errored,e==null||e(ea.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ea.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===lr.joined&&e===Ac.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var i;if(t==null)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{const c=await o.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:a}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=lr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ns.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new wh(this,ns.leave,{},e),r.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=lr.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const i=new AbortController,s=setTimeout(()=>i.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(s),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new wh(this,e,t,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>m5){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,s;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:d}=ns;if(r&&[o,l,c,d].indexOf(a)>=0&&r!==this._joinRef())return;let p=this._onMessage(a,t,r);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(h=>{var b,w,S;return((b=h.filter)===null||b===void 0?void 0:b.event)==="*"||((S=(w=h.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===a}).map(h=>h.callback(p,r)):(s=this.bindings[a])===null||s===void 0||s.filter(h=>{var b,w,S,A,I,O;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in h){const P=h.id,K=(b=h.filter)===null||b===void 0?void 0:b.event;return P&&((w=t.ids)===null||w===void 0?void 0:w.includes(P))&&(K==="*"||(K==null?void 0:K.toLocaleLowerCase())===((S=t.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const P=(I=(A=h==null?void 0:h.filter)===null||A===void 0?void 0:A.event)===null||I===void 0?void 0:I.toLocaleLowerCase();return P==="*"||P===((O=t==null?void 0:t.event)===null||O===void 0?void 0:O.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===a}).map(h=>{if(typeof p=="object"&&"ids"in p){const b=p.data,{schema:w,table:S,commit_timestamp:A,type:I,errors:O}=b;p=Object.assign(Object.assign({},{schema:w,table:S,commit_timestamp:A,eventType:I,new:{},old:{},errors:O}),this._getPayloadRecords(b))}h.callback(p,r)})}_isClosed(){return this.state===lr.closed}_isJoined(){return this.state===lr.joined}_isJoining(){return this.state===lr.joining}_isLeaving(){return this.state===lr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&fl.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ns.close,{},e)}_onError(e){this._on(ns.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=lr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=dg(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=dg(e.columns,e.old_record)),t}}const _h=()=>{},Ru={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},A5=[1e3,2e3,5e3,1e4],S5=1e4,E5=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class N5{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_f,this.transport=null,this.heartbeatIntervalMs=Ru.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=_h,this.ref=0,this.reconnectTimer=null,this.vsn=ug,this.logger=_h,this.conn=null,this.sendBuffer=[],this.serializer=new g5,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...s)=>i(...s):(...s)=>fetch(...s),!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${xf.websocket}`,this.httpEndpoint=gv(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=u5.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ba.connecting:return vo.Connecting;case Ba.open:return vo.Open;case Ba.closing:return vo.Closing;default:return vo.Closed}}isConnected(){return this.connectionState()===vo.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===r);if(i)return i;{const s=new fl(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:r,payload:i,ref:s}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${r} (${s})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(p5,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ru.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",c)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:r,event:i,payload:s,ref:a}=t,o=a?`(${a})`:"",l=s.status||"";this.log("receive",`${l} ${r} ${i} ${o}`.trim(),s),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(i,s,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Ba.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ba.open||this.conn.readyState===Ba.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.accessTokenValue&&(this.channels.forEach(t=>{t.updateJoinPayload({access_token:this.accessTokenValue})}),this.sendBuffer=[],this.channels.forEach(t=>{t._isJoining()&&(t.joinPush.sent=!1,t.joinPush.send())})),this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(t){this.log("error","error in heartbeat callback",t)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(ns.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([E5],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const s={access_token:t,version:h5};t&&i.updateJoinPayload(s),i.joinedOnce&&i._isJoined()&&i._push(ns.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new pv(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ru.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,i,s,a,o,l,c,d,m,p,h;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:_f,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:Ru.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:_h,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:ug,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:(b=>A5[b-1]||S5),this.vsn){case f5:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:((b,w)=>w(JSON.stringify(b))),this.decode=(m=e==null?void 0:e.decode)!==null&&m!==void 0?m:((b,w)=>w(JSON.parse(b)));break;case fv:this.encode=(p=e==null?void 0:e.encode)!==null&&p!==void 0?p:this.serializer.encode.bind(this.serializer),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Dc=class extends Error{constructor(n,e){var t;super(n),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function k5(n,e,t){const r=new URL(e,n);if(t)for(const[i,s]of Object.entries(t))s!==void 0&&r.searchParams.set(i,s);return r.toString()}async function L5(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function T5(n){const e=n.fetchImpl??globalThis.fetch;return{async request({method:t,path:r,query:i,body:s,headers:a}){const o=k5(n.baseUrl,r,i),l=await L5(n.auth),c=await e(o,{method:t,headers:{...s?{"Content-Type":"application/json"}:{},...l,...a},body:s?JSON.stringify(s):void 0}),d=await c.text(),m=(c.headers.get("content-type")||"").includes("application/json"),p=m&&d?JSON.parse(d):d;if(!c.ok){const h=m?p:void 0,b=h==null?void 0:h.error;throw new Dc((b==null?void 0:b.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:b==null?void 0:b.type,icebergCode:b==null?void 0:b.code,details:h})}return{status:c.status,headers:c.headers,data:p}}}}function Pu(n){return n.join("")}var C5=class{constructor(n,e=""){this.client=n,this.prefix=e}async listNamespaces(n){const e=n?{parent:Pu(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(n,e){const t={namespace:n.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Pu(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pu(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Pu(n.namespace)}`}),!0}catch(e){if(e instanceof Dc&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(n,e){try{return await this.createNamespace(n,e)}catch(t){if(t instanceof Dc&&t.status===409)return;throw t}}};function Ko(n){return n.join("")}var I5=class{constructor(n,e="",t){this.client=n,this.prefix=e,this.accessDelegation=t}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ko(n.namespace)}/tables`})).data.identifiers}async createTable(n,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ko(n.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(n,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ko(n.namespace)}/tables/${n.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(n,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ko(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(n){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ko(n.namespace)}/tables/${n.name}`,headers:e})).data.metadata}async tableExists(n){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ko(n.namespace)}/tables/${n.name}`,headers:e}),!0}catch(t){if(t instanceof Dc&&t.status===404)return!1;throw t}}async createTableIfNotExists(n,e){try{return await this.createTable(n,e)}catch(t){if(t instanceof Dc&&t.status===409)return await this.loadTable({namespace:n.namespace,name:e.name});throw t}}},O5=class{constructor(n){var r;let e="v1";n.catalogName&&(e+=`/${n.catalogName}`);const t=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=T5({baseUrl:t,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=(r=n.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new C5(this.client,e),this.tableOps=new I5(this.client,e,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,e){return this.namespaceOps.createNamespace(n,e)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,e){return this.tableOps.createTable(n,e)}async updateTable(n,e){return this.tableOps.updateTable(n,e)}async dropTable(n,e){await this.tableOps.dropTable(n,e)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,e){return this.namespaceOps.createNamespaceIfNotExists(n,e)}async createTableIfNotExists(n,e){return this.tableOps.createTableIfNotExists(n,e)}},jd=class extends Error{constructor(n,e="storage",t,r){super(n),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=t,this.statusCode=r}};function $d(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Du=class extends jd{constructor(n,e,t,r="storage"){super(n,r,e,t),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},vv=class extends jd{constructor(n,e,t="storage"){super(n,t),this.name=t==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const R5=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),P5=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Sf=n=>{if(Array.isArray(n))return n.map(t=>Sf(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=Sf(r)}),e},D5=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Bc(n){"@babel/helpers - typeof";return Bc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bc(n)}function B5(n,e){if(Bc(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(Bc(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function q5(n){var e=B5(n,"string");return Bc(e)=="symbol"?e:e+""}function j5(n,e,t){return(e=q5(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function pg(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function yt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pg(Object(t),!0).forEach(function(r){j5(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pg(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const mg=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},$5=async(n,e,t,r)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!(t!=null&&t.noResolveJson)){const i=n,s=i.status||500;if(typeof i.json=="function")i.json().then(a=>{const o=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||s+"";e(new Du(mg(a),s,o,r))}).catch(()=>{if(r==="vectors"){const a=s+"";e(new Du(i.statusText||`HTTP ${s} error`,s,a,r))}else{const a=s+"";e(new Du(i.statusText||`HTTP ${s} error`,s,a,r))}});else{const a=s+"";e(new Du(i.statusText||`HTTP ${s} error`,s,a,r))}}else e(new vv(mg(n),n,r))},M5=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||n==="HEAD"||!r?yt(yt({},i),t):(P5(r)?(i.headers=yt({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,e!=null&&e.duplex&&(i.duplex=e.duplex),yt(yt({},i),t))};async function nc(n,e,t,r,i,s,a){return new Promise((o,l)=>{n(t,M5(e,r,i,s)).then(c=>{if(!c.ok)throw c;if(r!=null&&r.noResolveJson)return c;if(a==="vectors"){const d=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!d||!d.includes("application/json"))return{}}return c.json()}).then(c=>o(c)).catch(c=>$5(c,l,r,a))})}function bv(n="storage"){return{get:async(e,t,r,i)=>nc(e,"GET",t,r,i,void 0,n),post:async(e,t,r,i,s)=>nc(e,"POST",t,i,s,r,n),put:async(e,t,r,i,s)=>nc(e,"PUT",t,i,s,r,n),head:async(e,t,r,i)=>nc(e,"HEAD",t,yt(yt({},r),{},{noResolveJson:!0}),i,void 0,n),remove:async(e,t,r,i,s)=>nc(e,"DELETE",t,i,s,r,n)}}const F5=bv("storage"),{get:qc,post:es,put:Ef,head:U5,remove:Sp}=F5,Ai=bv("vectors");var Il=class{constructor(n,e={},t,r="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=e,this.fetch=R5(t),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=yt(yt({},this.headers),{},{[n]:e}),this}async handleOperation(n){var e=this;try{return{data:await n(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if($d(t))return{data:null,error:t};throw t}}},z5=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e}then(n,e){return this.execute().then(n,e)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if($d(e))return{data:null,error:e};throw e}}};let yv;yv=Symbol.toStringTag;var H5=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e,this[yv]="BlobDownloadBuilder",this.promise=null}asStream(){return new z5(this.downloadFn,this.shouldThrowOnError)}then(n,e){return this.getPromise().then(n,e)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if($d(e))return{data:null,error:e};throw e}}};const W5={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},gg={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var V5=class extends Il{constructor(n,e={},t,r){super(n,e,r,"storage"),this.bucketId=t}async uploadOrUpdate(n,e,t,r){var i=this;return i.handleOperation(async()=>{let s;const a=yt(yt({},gg),r);let o=yt(yt({},i.headers),n==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&t instanceof Blob?(s=new FormData,s.append("cacheControl",a.cacheControl),l&&s.append("metadata",i.encodeMetadata(l)),s.append("",t)):typeof FormData<"u"&&t instanceof FormData?(s=t,s.has("cacheControl")||s.append("cacheControl",a.cacheControl),l&&!s.has("metadata")&&s.append("metadata",i.encodeMetadata(l))):(s=t,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=i.toBase64(i.encodeMetadata(l))),(typeof ReadableStream<"u"&&s instanceof ReadableStream||s&&typeof s=="object"&&"pipe"in s&&typeof s.pipe=="function")&&!a.duplex&&(a.duplex="half")),r!=null&&r.headers&&(o=yt(yt({},o),r.headers));const c=i._removeEmptyFolders(e),d=i._getFinalPath(c),m=await(n=="PUT"?Ef:es)(i.fetch,`${i.url}/object/${d}`,s,yt({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{path:c,id:m.Id,fullPath:m.Key}})}async upload(n,e,t){return this.uploadOrUpdate("POST",n,e,t)}async uploadToSignedUrl(n,e,t,r){var i=this;const s=i._removeEmptyFolders(n),a=i._getFinalPath(s),o=new URL(i.url+`/object/upload/sign/${a}`);return o.searchParams.set("token",e),i.handleOperation(async()=>{let l;const c=yt({upsert:gg.upsert},r),d=yt(yt({},i.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",c.cacheControl)):(l=t,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType),{path:s,fullPath:(await Ef(i.fetch,o.toString(),l,{headers:d})).Key}})}async createSignedUploadUrl(n,e){var t=this;return t.handleOperation(async()=>{let r=t._getFinalPath(n);const i=yt({},t.headers);e!=null&&e.upsert&&(i["x-upsert"]="true");const s=await es(t.fetch,`${t.url}/object/upload/sign/${r}`,{},{headers:i}),a=new URL(t.url+s.url),o=a.searchParams.get("token");if(!o)throw new jd("No token returned by API");return{signedUrl:a.toString(),path:n,token:o}})}async update(n,e,t){return this.uploadOrUpdate("PUT",n,e,t)}async move(n,e,t){var r=this;return r.handleOperation(async()=>await es(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:r.headers}))}async copy(n,e,t){var r=this;return r.handleOperation(async()=>({path:(await es(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(n,e,t){var r=this;return r.handleOperation(async()=>{let i=r._getFinalPath(n),s=await es(r.fetch,`${r.url}/object/sign/${i}`,yt({expiresIn:e},t!=null&&t.transform?{transform:t.transform}:{}),{headers:r.headers});const a=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return{signedUrl:encodeURI(`${r.url}${s.signedURL}${a}`)}})}async createSignedUrls(n,e,t){var r=this;return r.handleOperation(async()=>{const i=await es(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:n},{headers:r.headers}),s=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return i.map(a=>yt(yt({},a),{},{signedUrl:a.signedURL?encodeURI(`${r.url}${a.signedURL}${s}`):null}))})}download(n,e,t){const r=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=i?`?${i}`:"",a=this._getFinalPath(n),o=()=>qc(this.fetch,`${this.url}/${r}/${a}${s}`,{headers:this.headers,noResolveJson:!0},t);return new H5(o,this.shouldThrowOnError)}async info(n){var e=this;const t=e._getFinalPath(n);return e.handleOperation(async()=>Sf(await qc(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})))}async exists(n){var e=this;const t=e._getFinalPath(n);try{return await U5(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if($d(r)&&r instanceof vv){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}}getPublicUrl(n,e){const t=this._getFinalPath(n),r=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&r.push(i);const s=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});a!==""&&r.push(a);let o=r.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${t}${o}`)}}}async remove(n){var e=this;return e.handleOperation(async()=>await Sp(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:n},{headers:e.headers}))}async list(n,e,t){var r=this;return r.handleOperation(async()=>{const i=yt(yt(yt({},W5),e),{},{prefix:n||""});return await es(r.fetch,`${r.url}/object/list/${r.bucketId}`,i,{headers:r.headers},t)})}async listV2(n,e){var t=this;return t.handleOperation(async()=>{const r=yt({},n);return await es(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,r,{headers:t.headers},e)})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};const G5="2.98.0",iu={"X-Client-Info":`storage-js/${G5}`};var K5=class extends Il{constructor(n,e={},t,r){const i=new URL(n);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const s=i.href.replace(/\/$/,""),a=yt(yt({},iu),e);super(s,a,t,"storage")}async listBuckets(n){var e=this;return e.handleOperation(async()=>{const t=e.listBucketOptionsToQueryString(n);return await qc(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers})})}async getBucket(n){var e=this;return e.handleOperation(async()=>await qc(e.fetch,`${e.url}/bucket/${n}`,{headers:e.headers}))}async createBucket(n,e={public:!1}){var t=this;return t.handleOperation(async()=>await es(t.fetch,`${t.url}/bucket`,{id:n,name:n,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}))}async updateBucket(n,e){var t=this;return t.handleOperation(async()=>await Ef(t.fetch,`${t.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}))}async emptyBucket(n){var e=this;return e.handleOperation(async()=>await es(e.fetch,`${e.url}/bucket/${n}/empty`,{},{headers:e.headers}))}async deleteBucket(n){var e=this;return e.handleOperation(async()=>await Sp(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(n){const e={};return n&&("limit"in n&&(e.limit=String(n.limit)),"offset"in n&&(e.offset=String(n.offset)),n.search&&(e.search=n.search),n.sortColumn&&(e.sortColumn=n.sortColumn),n.sortOrder&&(e.sortOrder=n.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Y5=class extends Il{constructor(n,e={},t){const r=n.replace(/\/$/,""),i=yt(yt({},iu),e);super(r,i,t,"storage")}async createBucket(n){var e=this;return e.handleOperation(async()=>await es(e.fetch,`${e.url}/bucket`,{name:n},{headers:e.headers}))}async listBuckets(n){var e=this;return e.handleOperation(async()=>{const t=new URLSearchParams;(n==null?void 0:n.limit)!==void 0&&t.set("limit",n.limit.toString()),(n==null?void 0:n.offset)!==void 0&&t.set("offset",n.offset.toString()),n!=null&&n.sortColumn&&t.set("sortColumn",n.sortColumn),n!=null&&n.sortOrder&&t.set("sortOrder",n.sortOrder),n!=null&&n.search&&t.set("search",n.search);const r=t.toString(),i=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return await qc(e.fetch,i,{headers:e.headers})})}async deleteBucket(n){var e=this;return e.handleOperation(async()=>await Sp(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}))}from(n){var e=this;if(!D5(n))throw new jd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new O5({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(t,{get(i,s){const a=i[s];return typeof a!="function"?a:async(...o)=>{try{return{data:await a.apply(i,o),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}},J5=class extends Il{constructor(n,e={},t){const r=n.replace(/\/$/,""),i=yt(yt({},iu),{},{"Content-Type":"application/json"},e);super(r,i,t,"vectors")}async createIndex(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/CreateIndex`,n,{headers:e.headers})||{})}async getIndex(n,e){var t=this;return t.handleOperation(async()=>await Ai.post(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers}))}async listIndexes(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/ListIndexes`,n,{headers:e.headers}))}async deleteIndex(n,e){var t=this;return t.handleOperation(async()=>await Ai.post(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers})||{})}},X5=class extends Il{constructor(n,e={},t){const r=n.replace(/\/$/,""),i=yt(yt({},iu),{},{"Content-Type":"application/json"},e);super(r,i,t,"vectors")}async putVectors(n){var e=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/PutVectors`,n,{headers:e.headers})||{})}async getVectors(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/GetVectors`,n,{headers:e.headers}))}async listVectors(n){var e=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/ListVectors`,n,{headers:e.headers}))}async queryVectors(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/QueryVectors`,n,{headers:e.headers}))}async deleteVectors(n){var e=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/DeleteVectors`,n,{headers:e.headers})||{})}},Z5=class extends Il{constructor(n,e={},t){const r=n.replace(/\/$/,""),i=yt(yt({},iu),{},{"Content-Type":"application/json"},e);super(r,i,t,"vectors")}async createBucket(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{})}async getBucket(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:n},{headers:e.headers}))}async listBuckets(n={}){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/ListVectorBuckets`,n,{headers:e.headers}))}async deleteBucket(n){var e=this;return e.handleOperation(async()=>await Ai.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{})}},Q5=class extends Z5{constructor(n,e={}){super(n,e.headers||{},e.fetch)}from(n){return new ew(this.url,this.headers,n,this.fetch)}async createBucket(n){var e=()=>super.createBucket,t=this;return e().call(t,n)}async getBucket(n){var e=()=>super.getBucket,t=this;return e().call(t,n)}async listBuckets(n={}){var e=()=>super.listBuckets,t=this;return e().call(t,n)}async deleteBucket(n){var e=()=>super.deleteBucket,t=this;return e().call(t,n)}},ew=class extends J5{constructor(n,e,t,r){super(n,e,r),this.vectorBucketName=t}async createIndex(n){var e=()=>super.createIndex,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(n={}){var e=()=>super.listIndexes,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(n){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,n)}async deleteIndex(n){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,n)}index(n){return new tw(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},tw=class extends X5{constructor(n,e,t,r,i){super(n,e,i),this.vectorBucketName=t,this.indexName=r}async putVectors(n){var e=()=>super.putVectors,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(n){var e=()=>super.getVectors,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(n={}){var e=()=>super.listVectors,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(n){var e=()=>super.queryVectors,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(n){var e=()=>super.deleteVectors,t=this;return e().call(t,yt(yt({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},nw=class extends K5{constructor(n,e={},t,r){super(n,e,t,r)}from(n){return new V5(this.url,this.headers,n,this.fetch)}get vectors(){return new Q5(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Y5(this.url+"/iceberg",this.headers,this.fetch)}};const wv="2.98.0",rl=30*1e3,Nf=3,xh=Nf*rl,rw="http://localhost:9999",iw="supabase.auth.token",sw={"X-Client-Info":`gotrue-js/${wv}`},kf="X-Supabase-Api-Version",_v={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},aw=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ow=600*1e3;class jc extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ct(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class lw extends jc{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function cw(n){return ct(n)&&n.name==="AuthApiError"}class bo extends jc{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ca extends jc{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class _i extends ca{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ah(n){return ct(n)&&n.name==="AuthSessionMissingError"}class Yo extends ca{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bu extends ca{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qu extends ca{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function uw(n){return ct(n)&&n.name==="AuthImplicitGrantRedirectError"}class vg extends ca{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class dw extends ca{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Lf extends ca{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Sh(n){return ct(n)&&n.name==="AuthRetryableFetchError"}class bg extends ca{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Tf extends ca{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const xd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),yg=` 	
\r=`.split(""),hw=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<yg.length;e+=1)n[yg[e].charCodeAt(0)]=-2;for(let e=0;e<xd.length;e+=1)n[xd[e].charCodeAt(0)]=e;return n})();function wg(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(xd[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(xd[r]),e.queuedBits-=6}}function xv(n,e,t){const r=hw[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function _g(n){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=a=>{mw(a,r,t)};for(let a=0;a<n.length;a+=1)xv(n.charCodeAt(a),i,s);return e.join("")}function fw(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function pw(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}fw(r,e)}}function mw(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function gl(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)xv(n.charCodeAt(i),t,r);return new Uint8Array(e)}function gw(n){const e=[];return pw(n,t=>e.push(t)),new Uint8Array(e)}function wo(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};return n.forEach(i=>wg(i,t,r)),wg(null,t,r),e.join("")}function vw(n){return Math.round(Date.now()/1e3)+n}function bw(){return Symbol("auth-callback")}const Sr=()=>typeof window<"u"&&typeof document<"u",uo={tested:!1,writable:!1},Av=()=>{if(!Sr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(uo.tested)return uo.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),uo.tested=!0,uo.writable=!0}catch{uo.tested=!0,uo.writable=!1}return uo.writable};function yw(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const Sv=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),ww=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",il=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},ho=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ar=async(n,e)=>{await n.removeItem(e)};class Md{constructor(){this.promise=new Md.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Md.promiseConstructor=Promise;function ju(n){const e=n.split(".");if(e.length!==3)throw new Tf("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!aw.test(e[r]))throw new Tf("JWT not in base64url format");return{header:JSON.parse(_g(e[0])),payload:JSON.parse(_g(e[1])),signature:gl(e[2]),raw:{header:e[0],payload:e[1]}}}async function _w(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function xw(n,e){return new Promise((r,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const a=await n(s);if(!e(s,null,a)){r(a);return}}catch(a){if(!e(s,a)){i(a);return}}})()})}function Aw(n){return("0"+n.toString(16)).substr(-2)}function Sw(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,Aw).join("")}async function Ew(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function Nw(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Ew(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Jo(n,e,t=!1){const r=Sw();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await il(n,`${e}-code-verifier`,i);const s=await Nw(r);return[s,r===s?"plain":"s256"]}const kw=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Lw(n){const e=n.headers.get(kf);if(!e||!e.match(kw))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Tw(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Cw(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Iw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Xo(n){if(!Iw.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Eh(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ow(n,e){return new Proxy(n,{get:(t,r,i)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)"||s==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,r,i)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,r,i)}})}function xg(n){return JSON.parse(JSON.stringify(n))}const fo=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Rw=[502,503,504];async function Ag(n){var e;if(!ww(n))throw new Lf(fo(n),0);if(Rw.includes(n.status))throw new Lf(fo(n),n.status);let t;try{t=await n.json()}catch(s){throw new bo(fo(s),s)}let r;const i=Lw(n);if(i&&i.getTime()>=_v["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new bg(fo(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new _i}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0))throw new bg(fo(t),n.status,t.weak_password.reasons);throw new lw(fo(t),n.status||500,r)}const Pw=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function _t(n,e,t,r){var i;const s=Object.assign({},r==null?void 0:r.headers);s[kf]||(s[kf]=_v["2024-01-01"].name),r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const a=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await Dw(n,e,t+o,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Dw(n,e,t,r,i,s){const a=Pw(e,r,i,s);let o;try{o=await n(t,Object.assign({},a))}catch(l){throw console.error(l),new Lf(fo(l),0)}if(o.ok||await Ag(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(l){await Ag(l)}}function Xi(n){var e;let t=null;jw(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=vw(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Sg(n){const e=Xi(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function ja(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Bw(n){return{data:n,error:null}}function qw(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s}=n,a=qd(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function Eg(n){return n}function jw(n){return n.access_token&&n.refresh_token&&n.expires_in}const Nh=["global","local","others"];class $w{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Sv(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Nh[0]){if(Nh.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Nh.join(", ")}`);try{return await _t(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ct(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await _t(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ja})}catch(r){if(ct(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=qd(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await _t(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:qw,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(ct(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ja})}catch(t){if(ct(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,s,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await _t(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:Eg});if(d.error)throw d.error;const m=await d.json(),p=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(b=>{const w=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(b.split(";")[1].split("=")[1]);c[`${S}Page`]=w}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},m),c),error:null}}catch(c){if(ct(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Xo(e);try{return await _t(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ja})}catch(t){if(ct(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Xo(e);try{return await _t(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ja})}catch(r){if(ct(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Xo(e);try{return await _t(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ja})}catch(r){if(ct(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Xo(e.userId);try{const{data:t,error:r}=await _t(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(ct(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Xo(e.userId),Xo(e.id);try{return{data:await _t(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ct(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,r,i,s,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await _t(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:Eg});if(d.error)throw d.error;const m=await d.json(),p=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(b=>{const w=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(b.split(";")[1].split("=")[1]);c[`${S}Page`]=w}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},m),c),error:null}}catch(c){if(ct(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ct(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await _t(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ct(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await _t(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ct(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await _t(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(ct(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ct(t))return{data:null,error:t};throw t}}}function Ng(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const Js={debug:!!(globalThis&&Av()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ev extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Mw extends Ev{}async function Fw(n,e,t){Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;e>0&&setTimeout(()=>{r.abort(),Js.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Mw(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Js.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}catch(i){if((i==null?void 0:i.name)==="AbortError"&&e>0)return Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire timeout, recovering by stealing lock",n),console.warn(`@supabase/gotrue-js: Lock "${n}" was not released within ${e}ms. This may indicate an orphaned lock from a component unmount (e.g., React Strict Mode). Forcefully acquiring the lock to recover.`),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,{mode:"exclusive",steal:!0},async s=>{if(s){Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: recovered (stolen)",n,s.name);try{return await t()}finally{Js.debug&&console.log("@supabase/gotrue-js: navigatorLock: released (stolen)",n,s.name)}}else return console.warn("@supabase/gotrue-js: Navigator LockManager returned null lock even with steal: true"),await t()}));throw i}}function Uw(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Nv(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function zw(n){return parseInt(n,16)}function Hw(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function Ww(n){var e;const{chainId:t,domain:r,expirationTime:i,issuedAt:s=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:d,uri:m,version:p}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const h=Nv(n.address),b=d?`${d}://${r}`:r,w=n.statement?`${n.statement}
`:"",S=`${b} wants you to sign in with your Ethereum account:
${h}

${w}`;let A=`URI: ${m}
Version: ${p}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${s.toISOString()}`;if(i&&(A+=`
Expiration Time: ${i.toISOString()}`),o&&(A+=`
Not Before: ${o.toISOString()}`),l&&(A+=`
Request ID: ${l}`),c){let I=`
Resources:`;for(const O of c){if(!O||typeof O!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${O}`);I+=`
- ${O}`}A+=I}return`${S}
${A}`}class Zn extends Error{constructor({message:e,code:t,cause:r,name:i}){var s;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(s=i??(r instanceof Error?r.name:void 0))!==null&&s!==void 0?s:"Unknown Error",this.code=t}}class Ad extends Zn{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Vw({error:n,options:e}){var t,r,i;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Zn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=s.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Zn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((r=s.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Zn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((i=s.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Zn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Zn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Zn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return s.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Zn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Zn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(kv(a)){if(s.rp.id!==a)return new Zn({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Zn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new Zn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Zn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Zn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function Gw({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Zn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Zn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const r=window.location.hostname;if(kv(r)){if(t.rpId!==r)return new Zn({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Zn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Zn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Zn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class Kw{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Yw=new Kw;function Jw(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:r}=n,i=qd(n,["challenge","user","excludeCredentials"]),s=gl(e).buffer,a=Object.assign(Object.assign({},t),{id:gl(t.id).buffer}),o=Object.assign(Object.assign({},i),{challenge:s,user:a});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const c=r[l];o.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:gl(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function Xw(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,r=qd(n,["challenge","allowCredentials"]),i=gl(e).buffer,s=Object.assign(Object.assign({},r),{challenge:i});if(t&&t.length>0){s.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){const o=t[a];s.allowCredentials[a]=Object.assign(Object.assign({},o),{id:gl(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return s}function Zw(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:wo(new Uint8Array(n.response.attestationObject)),clientDataJSON:wo(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Qw(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,r=n.getClientExtensionResults(),i=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:wo(new Uint8Array(i.authenticatorData)),clientDataJSON:wo(new Uint8Array(i.clientDataJSON)),signature:wo(new Uint8Array(i.signature)),userHandle:i.userHandle?wo(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function kv(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function kg(){var n,e;return!!(Sr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function e_(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ad("Browser returned unexpected credential type",e)}:{data:null,error:new Ad("Empty credential response",e)}}catch(e){return{data:null,error:Vw({error:e,options:n})}}}async function t_(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ad("Browser returned unexpected credential type",e)}:{data:null,error:new Ad("Empty credential response",e)}}catch(e){return{data:null,error:Gw({error:e,options:n})}}}const n_={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},r_={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Sd(...n){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of n)if(i)for(const s in i){const a=i[s];if(a!==void 0)if(Array.isArray(a))r[s]=a;else if(t(a))r[s]=a;else if(e(a)){const o=r[s];e(o)?r[s]=Sd(o,a):r[s]=Sd(a)}else r[s]=a}return r}function i_(n,e){return Sd(n_,n,e||{})}function s_(n,e){return Sd(r_,n,e||{})}class a_{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:i},s){var a;try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:l};const c=i??Yw.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;if(!d.name){const m=r;if(m)d.name=`${d.id}:${m}`;else{const h=(await this.client.getUser()).data.user,b=((a=h==null?void 0:h.user_metadata)===null||a===void 0?void 0:a.name)||(h==null?void 0:h.email)||(h==null?void 0:h.id)||"User";d.name=`${d.id}:${b}`}}d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=i_(o.webauthn.credential_options.publicKey,s==null?void 0:s.create),{data:m,error:p}=await e_({publicKey:d,signal:c});return m?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:m}},error:null}:{data:null,error:p}}case"request":{const d=s_(o.webauthn.credential_options.publicKey,s==null?void 0:s.request),{data:m,error:p}=await t_(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:c}));return m?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:m}},error:null}:{data:null,error:p}}}}catch(o){return ct(o)?{data:null,error:o}:{data:null,error:new bo("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!t)return{data:null,error:new jc("rpId is required for WebAuthn authentication")};try{if(!kg())return{data:null,error:new bo("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:i},{request:s});if(!a)return{data:null,error:o};const{webauthn:l}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:r,credential_response:l.credential_response}})}catch(a){return ct(a)?{data:null,error:a}:{data:null,error:new bo("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!t)return{data:null,error:new jc("rpId is required for WebAuthn registration")};try{if(!kg())return{data:null,error:new bo("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(d=>{var m;return(m=d.data)===null||m===void 0?void 0:m.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===e&&p.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:o};const{data:l,error:c}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:i},{create:s});return l?this._verify({factorId:a.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(a){return ct(a)?{data:null,error:a}:{data:null,error:new bo("Unexpected error in register",a)}}}}Uw();const o_={url:rw,storageKey:iw,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:sw,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:5e3,skipAutoInitialize:!1};async function Lg(n,e,t){return await t()}const Zo={};class $c{get jwks(){var e,t;return(t=(e=Zo[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Zo[this.storageKey]=Object.assign(Object.assign({},Zo[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Zo[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Zo[this.storageKey]=Object.assign(Object.assign({},Zo[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},o_),e);if(this.storageKey=s.storageKey,this.instanceID=(t=$c.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,$c.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.instanceID>0&&Sr()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new $w({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Sv(s.fetch),this.lock=s.lock||Lg,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&Sr()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=Fw:this.lock=Lg,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new a_(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Av()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ng(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Ng(this.memoryStorage)),Sr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a);try{await this._notifyAllSubscribers(a.data.event,a.data.session,!1)}catch(o){this._debug("#broadcastChannel","error",o)}})}s.skipAutoInitialize||this.initialize().catch(a=>{this._debug("#initialize()","error",a)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${wv}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},r="none";if(Sr()&&(t=yw(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),Sr()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:s}=await this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),uw(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return{error:s}}const{session:a,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ct(t)?this._returnResult({error:t}):this._returnResult({error:new bo("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const s=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Xi}),{data:a,error:o}=s;if(o||!a)return this._returnResult({data:{user:null,session:null},error:o});const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(ct(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var t,r,i;try{let s;if("email"in e){const{email:d,password:m,options:p}=e;let h=null,b=null;this.flowType==="pkce"&&([h,b]=await Jo(this.storage,this.storageKey)),s=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:d,password:m,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:h,code_challenge_method:b},xform:Xi})}else if("phone"in e){const{phone:d,password:m,options:p}=e;s=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:m,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(i=p==null?void 0:p.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:Xi})}else throw new Bu("You must provide either an email or phone number and a password");const{data:a,error:o}=s;if(o||!a)return await Ar(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:a,options:o}=e;t=await _t(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Sg})}else if("phone"in e){const{phone:s,password:a,options:o}=e;t=await _t(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Sg})}else throw new Bu("You must provide either an email or phone number and a password");const{data:r,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const s=new Yo;return this._returnResult({data:{user:null,session:null},error:s})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(ct(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,r,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,i,s,a,o,l,c,d,m,p;let h,b;if("message"in e)h=e.message,b=e.signature;else{const{chain:w,wallet:S,statement:A,options:I}=e;let O;if(Sr())if(typeof S=="object")O=S;else{const V=window;if("ethereum"in V&&typeof V.ethereum=="object"&&"request"in V.ethereum&&typeof V.ethereum.request=="function")O=V.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(I!=null&&I.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=S}const P=new URL((t=I==null?void 0:I.url)!==null&&t!==void 0?t:window.location.href),K=await O.request({method:"eth_requestAccounts"}).then(V=>V).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!K||K.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const le=Nv(K[0]);let he=(r=I==null?void 0:I.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!he){const V=await O.request({method:"eth_chainId"});he=zw(V)}const ne={domain:P.host,address:le,statement:A,uri:P.href,version:"1",chainId:he,nonce:(i=I==null?void 0:I.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(a=(s=I==null?void 0:I.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=I==null?void 0:I.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=I==null?void 0:I.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=I==null?void 0:I.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=I==null?void 0:I.signInWithEthereum)===null||d===void 0?void 0:d.resources};h=Ww(ne),b=await O.request({method:"personal_sign",params:[Hw(h),le]})}try{const{data:w,error:S}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:b},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Xi});if(S)throw S;if(!w||!w.session||!w.user){const A=new Yo;return this._returnResult({data:{user:null,session:null},error:A})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:S})}catch(w){if(ct(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(e){var t,r,i,s,a,o,l,c,d,m,p,h;let b,w;if("message"in e)b=e.message,w=e.signature;else{const{chain:S,wallet:A,statement:I,options:O}=e;let P;if(Sr())if(typeof A=="object")P=A;else{const le=window;if("solana"in le&&typeof le.solana=="object"&&("signIn"in le.solana&&typeof le.solana.signIn=="function"||"signMessage"in le.solana&&typeof le.solana.signMessage=="function"))P=le.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof A!="object"||!(O!=null&&O.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=A}const K=new URL((t=O==null?void 0:O.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in P&&P.signIn){const le=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},O==null?void 0:O.signInWithSolana),{version:"1",domain:K.host,uri:K.href}),I?{statement:I}:null));let he;if(Array.isArray(le)&&le[0]&&typeof le[0]=="object")he=le[0];else if(le&&typeof le=="object"&&"signedMessage"in le&&"signature"in le)he=le;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in he&&"signature"in he&&(typeof he.signedMessage=="string"||he.signedMessage instanceof Uint8Array)&&he.signature instanceof Uint8Array)b=typeof he.signedMessage=="string"?he.signedMessage:new TextDecoder().decode(he.signedMessage),w=he.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${K.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...I?["",I,""]:[""],"Version: 1",`URI: ${K.href}`,`Issued At: ${(i=(r=O==null?void 0:O.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=O==null?void 0:O.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${O.signInWithSolana.notBefore}`]:[],...!((a=O==null?void 0:O.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${O.signInWithSolana.expirationTime}`]:[],...!((o=O==null?void 0:O.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${O.signInWithSolana.chainId}`]:[],...!((l=O==null?void 0:O.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${O.signInWithSolana.nonce}`]:[],...!((c=O==null?void 0:O.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${O.signInWithSolana.requestId}`]:[],...!((m=(d=O==null?void 0:O.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||m===void 0)&&m.length?["Resources",...O.signInWithSolana.resources.map(he=>`- ${he}`)]:[]].join(`
`);const le=await P.signMessage(new TextEncoder().encode(b),"utf8");if(!le||!(le instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=le}}try{const{data:S,error:A}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:wo(w)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Xi});if(A)throw A;if(!S||!S.session||!S.user){const I=new Yo;return this._returnResult({data:{user:null,session:null},error:I})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:A})}catch(S){if(ct(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(e){const t=await ho(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{if(!r&&this.flowType==="pkce")throw new dw;const{data:s,error:a}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Xi});if(await Ar(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!s||!s.session||!s.user){const o=new Yo;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:a})}catch(s){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:s,nonce:a}=e,o=await _t(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Xi}),{data:l,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new Yo;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(t){if(ct(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,r,i,s,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Jo(this.storage,this.storageKey));const{error:m}=await _t(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:d}=await _t(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new Bu("You must provide either an email or phone number.")}catch(o){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var t,r;try{let i,s;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await _t(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Xi});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(ct(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,r,i,s,a;try{let o=null,l=null;this.flowType==="pkce"&&([o,l]=await Jo(this.storage,this.storageKey));const c=await _t(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:l}),headers:this.headers,xform:Bw});return!((s=c.data)===null||s===void 0)&&s.url&&Sr()&&!(!((a=e.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(o){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new _i;const{error:i}=await _t(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(ct(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:s}=e,{error:a}=await _t(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:r,type:i,options:s}=e,{data:a,error:o}=await _t(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o})}throw new Bu("You must provide either an email or phone number and a type")}catch(t){if(ct(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ho(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<xh:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await ho(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Eh()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=Ow(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await _t(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ja}):await this._useSession(async t=>{var r,i,s;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new _i}:await _t(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:ja})})}catch(t){if(ct(t))return Ah(t)&&(await this._removeSession(),await Ar(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:s}=r;if(s)throw s;if(!i.session)throw new _i;const a=i.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Jo(this.storage,this.storageKey));const{data:c,error:d}=await _t(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:ja});if(d)throw d;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(r){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new _i;const t=Date.now()/1e3;let r=t,i=!0,s=null;const{payload:a}=ju(e.access_token);if(a.exp&&(r=a.exp,i=r<=t),i){const{data:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o)return{data:{user:null,session:null},error:null};s=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});s={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(t){if(ct(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new _i;const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(ct(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!Sr())throw new qu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new vg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qu("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new vg("No code detected.");const{data:I,error:O}=await this._exchangeCodeForSession(e.code);if(O)throw O;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:I.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!s||!o||!a||!c)throw new qu("No session defined in URL");const d=Math.round(Date.now()/1e3),m=parseInt(o);let p=d+m;l&&(p=parseInt(l));const h=p-d;h*1e3<=rl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${m}s`);const b=p-m;d-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,p,d):d-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,p,d);const{data:w,error:S}=await this._getUser(s);if(S)throw S;const A={provider_token:r,provider_refresh_token:i,access_token:s,expires_in:m,expires_at:p,refresh_token:a,token_type:c,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:A,redirectType:e.type},error:null})}catch(r){if(ct(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ho(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s&&!Ah(s))return this._returnResult({error:s});const a=(r=i.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(cw(o)&&(o.status===404||o.status===401||o.status===403)||Ah(o)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await Ar(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=bw(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:s},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await Jo(this.storage,this.storageKey,!0));try{return await _t(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:i}=await this._useSession(async s=>{var a,o,l,c,d;const{data:m,error:p}=s;if(p)throw p;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await _t(this.fetch,"GET",h,{headers:this.headers,jwt:(d=(c=m.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return Sr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(ct(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:i,data:{session:s}}=t;if(i)throw i;const{options:a,provider:o,token:l,access_token:c,nonce:d}=e,m=await _t(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=s==null?void 0:s.access_token)!==null&&r!==void 0?r:void 0,body:{provider:o,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Xi}),{data:p,error:h}=m;return h?this._returnResult({data:{user:null,session:null},error:h}):!p||!p.session||!p.user?this._returnResult({data:{user:null,session:null},error:new Yo}):(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),this._returnResult({data:p,error:h}))}catch(i){if(await Ar(this.storage,`${this.storageKey}-code-verifier`),ct(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:s,error:a}=t;if(a)throw a;return await _t(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await xw(async i=>(i>0&&await _w(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await _t(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Xi})),(i,s)=>{const a=200*Math.pow(2,i);return s&&Sh(s)&&Date.now()+a-r<rl})}catch(r){if(this._debug(t,"error",r),ct(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Sr()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await ho(this.storage,this.storageKey);if(i&&this.userStorage){let a=await ho(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:i.user},await il(this.userStorage,this.storageKey+"-user",a)),i.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Eh()}else if(i&&!i.user&&!i.user){const a=await ho(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(i.user=a.user,await Ar(this.storage,this.storageKey+"-user"),await il(this.storage,this.storageKey,i)):i.user=Eh()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const s=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<xh;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${xh}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:a}=await this._callRefreshToken(i.refresh_token);a&&(console.error(a),Sh(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(i.access_token);!o&&(a!=null&&a.user)?(i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new _i;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Md;const{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new _i;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const o={data:s.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(s){if(this._debug(i,"error",s),ct(s)){const a={data:null,error:s};return Sh(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){s.push(l)}});if(await Promise.all(a),s.length>0){for(let o=0;o<s.length;o+=1)console.error(s[o]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ar(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await il(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const s=xg(i);await il(this.storage,this.storageKey,s)}else{const i=xg(t);await il(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Ar(this.storage,this.storageKey),await Ar(this.storage,this.storageKey+"-code-verifier"),await Ar(this.storage,this.storageKey+"-user"),this.userStorage&&await Ar(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Sr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),rl);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/rl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${rl}ms, refresh threshold is ${Nf} ticks`),i<=Nf&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ev)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Sr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,a]=await Jo(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(r!=null&&r.queryParams){const s=new URLSearchParams(r.queryParams);i.push(s.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;return s?this._returnResult({data:null,error:s}):await _t(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:s,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await _t(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return this._returnResult({data:null,error:s});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Zw(e.webauthn.credential_response):Qw(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:l}=await _t(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:l}))})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return this._returnResult({data:null,error:s});const a=await _t(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;const{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Jw(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Xw(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const s of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])i.all.push(s),s.status==="verified"&&i[s.factor_type].push(s);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(e){var t,r,i,s;if(e)try{const{payload:h}=ju(e);let b=null;h.aal&&(b=h.aal);let w=b;const{data:{user:S},error:A}=await this.getUser(e);if(A)return this._returnResult({data:null,error:A});((r=(t=S==null?void 0:S.factors)===null||t===void 0?void 0:t.filter(P=>P.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(w="aal2");const O=h.amr||[];return{data:{currentLevel:b,nextLevel:w,currentAuthenticationMethods:O},error:null}}catch(h){if(ct(h))return this._returnResult({data:null,error:h});throw h}const{data:{session:a},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=ju(a.access_token);let c=null;l.aal&&(c=l.aal);let d=c;((s=(i=a.user.factors)===null||i===void 0?void 0:i.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(d="aal2");const p=l.amr||[];return{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:p},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:i}=t;return i?this._returnResult({data:null,error:i}):r?await _t(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new _i})})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:i},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new _i});const a=await _t(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&Sr()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(ct(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:i},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new _i});const a=await _t(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&Sr()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(ct(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await _t(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new _i})})}catch(e){if(ct(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:r},error:i}=t;return i?this._returnResult({data:null,error:i}):r?(await _t(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new _i})})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+ow>i)return r;const{data:s,error:a}=await _t(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,r=s.keys.find(o=>o.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:h,error:b}=await this.getSession();if(b||!h.session)return this._returnResult({data:null,error:b});r=h.session.access_token}const{header:i,payload:s,signature:a,raw:{header:o,payload:l}}=ju(r);t!=null&&t.allowExpired||Tw(s.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:h}=await this.getUser(r);if(h)throw h;return{data:{claims:s,header:i,signature:a},error:null}}const d=Cw(i.alg),m=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,m,a,gw(`${o}.${l}`)))throw new Tf("Invalid JWT signature");return{data:{claims:s,header:i,signature:a},error:null}}catch(r){if(ct(r))return this._returnResult({data:null,error:r});throw r}}}$c.nextInstanceID={};const l_=$c,c_="2.98.0";let fc="";typeof Deno<"u"?fc="deno":typeof document<"u"?fc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?fc="react-native":fc="node";const u_={"X-Client-Info":`supabase-js-${fc}/${c_}`},d_={headers:u_},h_={schema:"public"},f_={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},p_={};function Mc(n){"@babel/helpers - typeof";return Mc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mc(n)}function m_(n,e){if(Mc(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(Mc(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function g_(n){var e=m_(n,"string");return Mc(e)=="symbol"?e:e+""}function v_(n,e,t){return(e=g_(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Tg(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Mn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Tg(Object(t),!0).forEach(function(r){v_(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Tg(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const b_=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),y_=()=>Headers,w_=(n,e,t)=>{const r=b_(t),i=y_();return async(s,a)=>{var o;const l=(o=await e())!==null&&o!==void 0?o:n;let c=new i(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Mn(Mn({},a),{},{headers:c}))}};function __(n){return n.endsWith("/")?n:n+"/"}function x_(n,e){var t,r;const{db:i,auth:s,realtime:a,global:o}=n,{db:l,auth:c,realtime:d,global:m}=e,p={db:Mn(Mn({},l),i),auth:Mn(Mn({},c),s),realtime:Mn(Mn({},d),a),storage:{},global:Mn(Mn(Mn({},m),o),{},{headers:Mn(Mn({},(t=m==null?void 0:m.headers)!==null&&t!==void 0?t:{}),(r=o==null?void 0:o.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return n.accessToken?p.accessToken=n.accessToken:delete p.accessToken,p}function A_(n){const e=n==null?void 0:n.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(__(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var S_=class extends l_{constructor(n){super(n)}},E_=class{constructor(n,e,t){var r,i;this.supabaseUrl=n,this.supabaseKey=e;const s=A_(n);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",s),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",s),this.storageUrl=new URL("storage/v1",s),this.functionsUrl=new URL("functions/v1",s);const a=`sb-${s.hostname.split(".")[0]}-auth-token`,o={db:h_,realtime:p_,auth:Mn(Mn({},f_),{},{storageKey:a}),global:d_},l=x_(t??{},o);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=w_(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Mn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new c5(new URL("rest/v1",s).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new nw(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new t5(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,e,t)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,e,t;if(n.accessToken)return await n.accessToken();const{data:r}=await n.auth.getSession();return(e=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:r,userStorage:i,storageKey:s,flowType:a,lock:o,debug:l,throwOnError:c},d,m){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new S_({url:this.authUrl.href,headers:Mn(Mn({},p),d),storageKey:s,autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:r,userStorage:i,flowType:a,lock:o,debug:l,throwOnError:c,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(h=>h.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new N5(this.realtimeUrl.href,Mn(Mn({},n),{},{params:Mn(Mn({},{apikey:this.supabaseKey}),n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,e)=>{this._handleTokenChanged(n,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(n,e,t){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const N_=(n,e,t)=>new E_(n,e,t);function k_(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const e=n.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}k_()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");console.warn("Supabase environment variables not set. Copy .env.example to .env and fill in your values.");const Fe=N_("","");function Lv(){var n;if(typeof window<"u"&&((n=window.location)!=null&&n.origin))return`${window.location.origin}/#/family`}async function L_(n){const{error:e}=await Fe.auth.signInWithOtp({email:n,options:{emailRedirectTo:Lv()}});return{error:e}}async function Tv(n,e){const{data:t,error:r}=await Fe.auth.signInWithPassword({email:n,password:e});return{data:t,error:r}}async function T_(n,e){const{data:t,error:r}=await Fe.auth.signUp({email:n,password:e,options:{emailRedirectTo:Lv()}});return{data:t,error:r}}async function C_(){const{error:n}=await Fe.auth.signOut();return{error:n}}async function I_(){const{data:{session:n}}=await Fe.auth.getSession();return{session:n}}function O_(n){const{data:{subscription:e}}=Fe.auth.onAuthStateChange(n);return{unsubscribe:()=>e.unsubscribe()}}async function R_(n){const{data:e,error:t}=await Fe.from("staff_profiles").select("id, role, display_name, email").eq("id",n).maybeSingle();return{profile:e,error:t}}const is={FAMILY:"family",DIRECTOR:"director",ADMIN:"admin"};function P_(n){if(!n)return is.FAMILY;const e=n.role;return e===is.ADMIN?is.ADMIN:e===is.DIRECTOR?is.DIRECTOR:is.FAMILY}function Ep(n){return n===is.ADMIN||n===is.DIRECTOR}function Ro(n){return n===is.ADMIN}function D_(n,e,t){return n==="/family/login"||n==="/staff/login"?{allowed:!0,redirect:null}:n.startsWith("/family")?e?{allowed:!0,redirect:null}:{allowed:!1,redirect:"/family/login"}:n.startsWith("/staff")?e?Ep(t)?{allowed:!0,redirect:null}:{allowed:!1,redirect:"/"}:{allowed:!1,redirect:"/staff/login"}:n.startsWith("/admin")?e?Ro(t)?{allowed:!0,redirect:null}:{allowed:!1,redirect:"/"}:{allowed:!1,redirect:"/staff/login"}:{allowed:!0,redirect:null}}let pl=null,Cf=is.FAMILY,If=null;const Of=new Set;function Jt(){return{session:pl,role:Cf,staffProfile:If,user:(pl==null?void 0:pl.user)||null}}function B_(n){return Of.add(n),()=>Of.delete(n)}function Cg(){const n=Jt();Of.forEach(e=>e(n))}async function Ig(n){if(!n){Cf=is.FAMILY,If=null;return}const{profile:e}=await R_(n);If=e,Cf=P_(e)}async function q_(){var e;const{session:n}=await I_();pl=n,await Ig((e=n==null?void 0:n.user)==null?void 0:e.id),Cg(),O_(async(t,r)=>{var i;pl=r,await Ig((i=r==null?void 0:r.user)==null?void 0:i.id),Cg()})}function j_(){const{session:n,role:e}=Jt();let t;if(!n)t=`
      <div class="hero-actions">
        <a href="#/family/login" class="btn-accent">Family Login</a>
        <a href="#/staff/login" class="btn-primary">Staff Login</a>
      </div>
    `;else{const r=['<a href="#/family" class="btn-accent">Family Dashboard</a>'];Ep(e)&&r.push('<a href="#/staff" class="btn-primary">Staff Dashboard</a>'),Ro(e)&&r.push('<a href="#/admin" class="btn-ghost">Admin Dashboard</a>'),t=`
      <p style="margin-bottom:var(--space-md)">You are signed in.</p>
      <nav class="home-actions">${r.join("")}</nav>
    `}return n?`
    <div class="page">
      <h1>Beauty and the Beast Auditions </h1>
      <p>Welcome back! Manage your audition registration and schedule below.</p>
      ${t}
    </div>
  `:`
      <div class="page">
        <div class="hero-section">
          <h1>Beauty and the Beast</h1>
          <p>Register your student, sign up for audition slots, and track your schedule  all in one place.</p>
          <div class="tagline">Be our guest! </div>
          ${t}
        </div>
      </div>
    `}const $_=["students.k12.dc.us"];function Cv(n){if(!n||typeof n!="string")return!1;const e=n.split("@");if(e.length!==2)return!1;const t=e[1].toLowerCase();return $_.some(r=>t===r||t.endsWith("."+r))}function ad(n){if(!n||typeof n!="string"||!n.trim())return{valid:!1,error:"Email address is required."};const e=n.trim();return e.includes("@")?Cv(e)?{valid:!1,error:"Student email addresses cannot be used. Please use a parent or guardian email."}:{valid:!0,error:null}:{valid:!1,error:"Please enter a valid email address."}}function M_(){var p,h,b,w;const n=document.createElement("div");n.className="page",n.innerHTML=`
    <div class="login-card">
      <h2 id="family-login-heading">Welcome back! </h2>
      <p id="family-login-intro" style="text-align:center;color:var(--color-text-secondary);margin-bottom:var(--space-lg);font-size:var(--text-small)">
        Sign in to manage your student's audition registration.
      </p>

      <form id="family-password-form" class="login-form">
        <label for="family-pw-email">Email address</label>
        <input type="email" id="family-pw-email" name="email" required placeholder="parent@example.com" />
        <label for="family-pw-password">Password</label>
        <input type="password" id="family-pw-password" name="password" required />
        <button type="submit">Sign In</button>
        <div id="family-pw-msg" class="form-message" aria-live="polite"></div>
      </form>

      <div class="login-alt-links">
        <button type="button" class="link-btn" id="show-signup-toggle">Create an account</button>
        <button type="button" class="link-btn" id="show-magic-toggle">Use a magic link</button>
      </div>

      <div id="family-signup-section" class="login-alt-section" hidden>
        <h2>Create Account</h2>
        <form id="family-signup-form" class="login-form">
          <label for="family-signup-email">Email address</label>
          <input type="email" id="family-signup-email" name="email" required placeholder="parent@example.com" />
          <label for="family-signup-password">Password</label>
          <input type="password" id="family-signup-password" name="password" required minlength="6" />
          <label for="family-signup-confirm">Confirm Password</label>
          <input type="password" id="family-signup-confirm" name="confirm" required minlength="6" />
          <button type="submit">Create Account</button>
          <div id="family-signup-msg" class="form-message" aria-live="polite"></div>
        </form>
        <button type="button" class="link-btn" id="hide-signup-toggle">Back to sign in</button>
      </div>

      <div id="family-magic-section" class="login-alt-section" hidden>
        <h2>Magic Link</h2>
        <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-sm)">
          We'll email you a sign-in link  no password needed.
        </p>
        <form id="family-magic-form" class="login-form">
          <label for="family-magic-email">Email address</label>
          <input type="email" id="family-magic-email" name="email" required placeholder="parent@example.com" />
          <button type="submit">Send Magic Link</button>
          <div id="family-magic-msg" class="form-message" aria-live="polite"></div>
        </form>
        <button type="button" class="link-btn" id="hide-magic-toggle">Back to sign in</button>
      </div>
    </div>
  `;const e=n.querySelector("#family-password-form"),t=n.querySelector("#family-login-heading"),r=n.querySelector("#family-login-intro"),i=n.querySelector(".login-alt-links"),s=n.querySelector("#family-signup-section"),a=n.querySelector("#family-magic-section");function o(){t.hidden=!1,r.hidden=!1,e.hidden=!1,i.hidden=!1,s.hidden=!0,a.hidden=!0}function l(){t.hidden=!0,r.hidden=!0,e.hidden=!0,i.hidden=!0,s.hidden=!1,a.hidden=!0}function c(){t.hidden=!0,r.hidden=!0,e.hidden=!0,i.hidden=!0,s.hidden=!0,a.hidden=!1}(p=n.querySelector("#show-signup-toggle"))==null||p.addEventListener("click",l),(h=n.querySelector("#show-magic-toggle"))==null||h.addEventListener("click",c),(b=n.querySelector("#hide-signup-toggle"))==null||b.addEventListener("click",o),(w=n.querySelector("#hide-magic-toggle"))==null||w.addEventListener("click",o),e==null||e.addEventListener("submit",async S=>{S.preventDefault();const A=n.querySelector("#family-pw-email").value.trim(),I=n.querySelector("#family-pw-password").value,O=n.querySelector("#family-pw-msg"),P=e.querySelector('button[type="submit"]'),K=ad(A);if(!K.valid){O.textContent=K.error,O.className="form-message error";return}if(!I)return;P.disabled=!0,P.textContent="Signing in",O.textContent="",O.className="form-message";const{error:le}=await Tv(A,I);le?(O.textContent=le.message||"Login failed. Please try again.",O.className="form-message error",P.disabled=!1,P.textContent="Sign In"):(window.location.hash="#/family",window.location.reload())});const d=n.querySelector("#family-magic-form");d==null||d.addEventListener("submit",async S=>{S.preventDefault();const A=n.querySelector("#family-magic-email").value.trim(),I=n.querySelector("#family-magic-msg"),O=d.querySelector("button"),P=ad(A);if(!P.valid){I.textContent=P.error,I.className="form-message error";return}O.disabled=!0,O.textContent="Sending",I.textContent="",I.className="form-message";const{error:K}=await L_(A);K?(I.textContent="Failed to send link. Please try again.",I.className="form-message error"):(I.textContent="Check your email for a sign-in link!",I.className="form-message success"),O.disabled=!1,O.textContent="Send Magic Link"});const m=n.querySelector("#family-signup-form");return m==null||m.addEventListener("submit",async S=>{S.preventDefault();const A=n.querySelector("#family-signup-email").value.trim(),I=n.querySelector("#family-signup-password").value,O=n.querySelector("#family-signup-confirm").value,P=n.querySelector("#family-signup-msg"),K=m.querySelector("button"),le=ad(A);if(!le.valid){P.textContent=le.error,P.className="form-message error";return}if(!I||!O)return;if(I!==O){P.textContent="Passwords do not match.",P.className="form-message error";return}if(I.length<6){P.textContent="Password must be at least 6 characters.",P.className="form-message error";return}K.disabled=!0,K.textContent="Creating account",P.textContent="",P.className="form-message";const{error:he}=await T_(A,I);he?(P.textContent=he.message||"Sign-up failed. Please try again.",P.className="form-message error",K.disabled=!1,K.textContent="Create Account"):(P.textContent="Account created! Check your email for a confirmation link, then sign in.",P.className="form-message success",K.disabled=!1,K.textContent="Create Account")}),n}function F_(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <div class="login-card">
      <h2>Staff Login </h2>
      <p style="text-align:center;color:var(--color-text-secondary);margin-bottom:var(--space-lg);font-size:var(--text-small)">
        Sign in with your staff credentials.
      </p>
      <form id="staff-login-form" class="login-form">
        <label for="staff-email">Email</label>
        <input type="email" id="staff-email" name="email" required placeholder="staff@example.com" />
        <label for="staff-password">Password</label>
        <input type="password" id="staff-password" name="password" required />
        <button type="submit">Sign In</button>
        <div id="staff-login-message" class="form-message" aria-live="polite"></div>
      </form>
    </div>
  `,setTimeout(()=>{const e=document.getElementById("staff-login-form");e&&e.addEventListener("submit",async t=>{t.preventDefault();const r=document.getElementById("staff-email").value.trim(),i=document.getElementById("staff-password").value,s=document.getElementById("staff-login-message"),a=e.querySelector("button");if(!r||!i)return;const o=ad(r);if(!o.valid){s.textContent=o.error,s.className="form-message error";return}a.disabled=!0,a.textContent="Signing in",s.textContent="",s.className="form-message";const{error:l}=await Tv(r,i);if(l){s.textContent="Invalid credentials. Please try again.",s.className="form-message error",a.disabled=!1,a.textContent="Sign In";return}window.location.hash="#/staff",window.location.reload()})},0),n}async function Ol(n){const{data:e,error:t}=await Fe.from("students").select("*").eq("family_account_id",n).order("created_at",{ascending:!0});return{data:e||[],error:t}}async function U_({familyAccountId:n,firstName:e,lastName:t,grade:r,studentEmail:i,createdByUserId:s}){const a={family_account_id:n,first_name:e,last_name:t,grade:r,created_by_user_id:s,updated_by_user_id:s};i&&(a.student_email=i);const{data:o,error:l}=await Fe.from("students").insert(a).select().single();return{data:o,error:l}}async function Iv(n){const{data:e,error:t}=await Fe.from("students").select("*").eq("id",n).single();return{data:e,error:t}}async function pc(n,e,t){const{data:r,error:i}=await Fe.from("students").update({...e,updated_by_user_id:t,updated_at:new Date().toISOString()}).eq("id",n).select().single();return{data:r,error:i}}async function Ov(n){const{error:e}=await Fe.from("students").delete().eq("id",n);return{error:e}}async function z_(){const{data:n,error:e}=await Fe.from("students").select(`
      id, first_name, last_name, grade, registration_complete,
      parent_first_name, parent_last_name, parent_email,
      callback_invited, created_at, updated_at,
      student_role_preferences(id, audition_role_id, rank_order, audition_roles(id, name))
    `).order("last_name",{ascending:!0}).order("first_name",{ascending:!0});return{data:(n||[]).map(r=>({...r,role_preferences:r.student_role_preferences||[]})),error:e}}async function H_(){const{data:n,error:e}=await Fe.from("contracts").select("*").order("version_number",{ascending:!0});return{data:n||[],error:e}}async function Np(){const{data:n,error:e}=await Fe.from("contracts").select("*").eq("is_active",!0).maybeSingle();return{data:n,error:e}}async function W_(n,e,t){const{data:r,error:i}=await Fe.from("contracts").insert({version_number:n,text_snapshot:e,is_active:!1,created_by_staff_user_id:t}).select().single();return{data:r,error:i}}async function V_(n){const{error:e}=await Fe.rpc("activate_contract",{p_contract_id:n});return{error:e}}async function Fd(n){const{data:e,error:t}=await Fe.from("contract_acceptances").select("*, contracts(version_number, text_snapshot)").eq("student_id",n).order("created_at",{ascending:!0});return{data:e||[],error:t}}async function Rv({studentId:n,contractId:e,studentTypedSignature:t,parentTypedSignature:r,signedByUserId:i}){const{data:s,error:a}=await Fe.from("contract_acceptances").insert({student_id:n,contract_id:e,student_typed_signature:t,parent_typed_signature:r,signed_by_user_id:i}).select().single();return{data:s,error:a}}async function Po(){const{data:n,error:e}=await Fe.from("audition_window_config").select("*").order("audition_date",{ascending:!0});return{data:n||[],error:e}}async function G_(n,e){const{data:t,error:r}=await Fe.from("audition_window_config").insert({audition_date:n.audition_date,dance_start_time:n.dance_start_time||null,dance_end_time:n.dance_end_time||null,vocal_start_time:n.vocal_start_time||null,vocal_end_time:n.vocal_end_time||null,callback_start_time:n.callback_start_time||null,callback_end_time:n.callback_end_time||null,created_by_staff_user_id:e,updated_by_staff_user_id:e}).select().single();return{data:t,error:r}}async function K_(n,e,t){const{data:r,error:i}=await Fe.from("audition_window_config").update({...e,updated_by_staff_user_id:t,updated_at:new Date().toISOString()}).eq("id",n).select().single();return{data:r,error:i}}async function Y_(n){const{error:e}=await Fe.from("audition_window_config").delete().eq("id",n);return{error:e}}function kh(n,e,t){const r=[];return!n&&!e?r:n&&!e?(r.push(`${t}: end time is required when start time is set.`),r):!n&&e?(r.push(`${t}: start time is required when end time is set.`),r):(n>=e&&r.push(`${t}: start time must be before end time.`),r)}function J_(n){const e=[];return n.audition_date||e.push("Audition date is required."),e.push(...kh(n.dance_start_time,n.dance_end_time,"Dance")),e.push(...kh(n.vocal_start_time,n.vocal_end_time,"Vocal")),e.push(...kh(n.callback_start_time,n.callback_end_time,"Callback")),{valid:e.length===0,errors:e}}function bt(n){if(!n)return"";const[e,t]=n.split(":").map(Number),r=e>=12?"PM":"AM";return`${e%12||12}:${String(t).padStart(2,"0")} ${r}`}function rn(n){if(!n)return"";const[e,t,r]=n.split("-").map(Number),i=new Date(e,t-1,r),s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][i.getDay()],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][i.getMonth()];return`${s}, ${a} ${i.getDate()}`}const Pv="2:00 PM on audition day",X_=14,Fc=7,Z_=15;function Q_(n){return n?n.registration_complete?{eligible:!0,reason:null}:{eligible:!1,reason:"Registration must be complete before booking a vocal slot."}:{eligible:!1,reason:"Student not found."}}function Dv(n,e){if(!n)return!1;const t=new Date(`${n}T${String(X_).padStart(2,"0")}:00:00`);return e>=t}function ex(n,e=Fc){const t=Math.max(0,e-n);return{available:t>0,spotsLeft:t}}function tx(n,e,t=Z_){if(!n||!e)return[];if(t<=0)return[];const[r,i]=n.split(":").map(Number),[s,a]=e.split(":").map(Number),o=r*60+i,l=s*60+a;if(o>=l)return[];const c=[];let d=o;for(;d+t<=l;){const m=`${String(Math.floor(d/60)).padStart(2,"0")}:${String(d%60).padStart(2,"0")}`,p=`${String(Math.floor((d+t)/60)).padStart(2,"0")}:${String((d+t)%60).padStart(2,"0")}`;c.push({start:m,end:p}),d+=t}return c}async function kp(){const{data:n,error:e}=await Fe.from("audition_slots").select("*").order("audition_date",{ascending:!0}).order("start_time",{ascending:!0});return{data:n||[],error:e}}async function nx(n){const{data:e,error:t}=await Fe.from("audition_window_config").select("audition_date, vocal_start_time, vocal_end_time").not("vocal_start_time","is",null).not("vocal_end_time","is",null).order("audition_date",{ascending:!0});if(t)return{data:null,error:t};if(!e||e.length===0)return{data:[],error:null};const{data:r}=await Fe.from("audition_slots").select("audition_date, start_time"),i=new Set((r||[]).map(l=>`${l.audition_date}_${l.start_time}`)),s=[];for(const l of e){const c=tx(l.vocal_start_time,l.vocal_end_time);for(const d of c){const m=`${l.audition_date}_${d.start}`;i.has(m)||s.push({audition_date:l.audition_date,start_time:d.start,end_time:d.end,created_by_staff_user_id:n})}}if(s.length===0)return{data:[],error:null};const{data:a,error:o}=await Fe.from("audition_slots").insert(s).select();return{data:a||[],error:o}}async function Og(n){const{error:e}=await Fe.rpc("admin_delete_vocal_slot",{p_slot_id:n});return{error:e}}async function Ud(n){const{data:e,error:t}=await Fe.from("vocal_bookings").select("*, audition_slots(*)").eq("student_id",n).maybeSingle();return{data:e,error:t}}async function rx(n,e){const{data:t,error:r}=await Fe.rpc("book_vocal_slot",{p_student_id:n,p_slot_id:e});return{data:t,error:r}}async function ix(n,e){const{data:t,error:r}=await Fe.rpc("reschedule_vocal_slot",{p_student_id:n,p_new_slot_id:e});return{data:t,error:r}}async function sx(n){const{data:e,error:t}=await Fe.rpc("cancel_vocal_booking",{p_student_id:n});return{data:e,error:t}}async function ax(n,e){const{data:t,error:r}=await Fe.rpc("admin_override_vocal_booking",{p_student_id:n,p_slot_id:e});return{data:t,error:r}}async function zd(){const{data:n,error:e}=await Fe.from("vocal_bookings").select(`
      id,
      student_id,
      audition_slot_id,
      created_at,
      students(id, first_name, last_name, grade),
      audition_slots(id, audition_date, start_time, end_time)
    `).order("created_at",{ascending:!0});return{data:n||[],error:e}}async function Lp(){const{data:n,error:e}=await Fe.from("vocal_bookings").select("audition_slot_id");if(e)return{data:null,error:e};const t={};return(n||[]).forEach(r=>{t[r.audition_slot_id]=(t[r.audition_slot_id]||0)+1}),{data:t,error:null}}async function Rl(){const{data:n,error:e}=await Fe.from("audition_settings").select("*").limit(1).maybeSingle();return{data:n,error:e}}async function ox(n,e){const{data:t}=await Fe.from("audition_settings").select("id").limit(1).maybeSingle();if(!t){const{data:s,error:a}=await Fe.from("audition_settings").insert({...n,updated_by_staff_user_id:e}).select().single();return{data:s,error:a}}const{data:r,error:i}=await Fe.from("audition_settings").update({...n,updated_by_staff_user_id:e,updated_at:new Date().toISOString()}).eq("id",t.id).select().single();return{data:r,error:i}}async function Hd(){const{data:n,error:e}=await Fe.from("audition_roles").select("*").order("display_order",{ascending:!0}).order("name",{ascending:!0});return{data:n||[],error:e}}async function lx(){const{data:n,error:e}=await Fe.from("vocal_role_day_mappings").select("*");return{data:n||[],error:e}}async function cx(n,e,t){const{data:r,error:i}=await Fe.from("vocal_role_day_mappings").upsert({audition_role_id:n,audition_date:e,created_by_staff_user_id:t,updated_by_staff_user_id:t,updated_at:new Date().toISOString()},{onConflict:"audition_role_id"}).select().single();return{data:r,error:i}}async function ux(n){const{error:e}=await Fe.from("vocal_role_day_mappings").delete().eq("audition_role_id",n);return{error:e}}async function dx(n,e,t){const{data:r,error:i}=await Fe.from("audition_roles").insert({name:n,display_order:e,created_by_staff_user_id:t,updated_by_staff_user_id:t}).select().single();return{data:r,error:i}}async function hx(n,e,t){const{data:r,error:i}=await Fe.from("audition_roles").update({...e,updated_by_staff_user_id:t,updated_at:new Date().toISOString()}).eq("id",n).select().single();return{data:r,error:i}}async function fx(n){const{error:e}=await Fe.from("audition_roles").delete().eq("id",n);return{error:e}}async function px(n){const{data:e,error:t}=await Fe.from("student_role_preferences").select("*, audition_roles(id, name)").eq("student_id",n).order("rank_order",{ascending:!0});return{data:e||[],error:t}}async function mx(n,e,t){const{error:r}=await Fe.from("student_role_preferences").delete().eq("student_id",n);if(r)return{error:r};if(e.length===0)return{error:null};const i=e.map(a=>({student_id:n,audition_role_id:a.roleId,rank_order:a.rank,created_by_user_id:t,updated_by_user_id:t})),{error:s}=await Fe.from("student_role_preferences").insert(i);return{error:s}}async function gx(){const{data:n,error:e}=await Fe.from("students").select(`
      id, first_name, last_name, grade, parent_email, parent_first_name,
      registration_complete, callback_invited,
      parent2_email, parent2_first_name, student_email, sings_own_disney_song, song_name,
      student_role_preferences(id, audition_role_id, rank_order, audition_roles(id, name))
    `).eq("registration_complete",!0).order("last_name",{ascending:!0});return{data:(n||[]).map(r=>({...r,role_preferences:r.student_role_preferences||[]})),error:e}}async function Bv(){const{data:n,error:e}=await Fe.from("vocal_day_assignments").select("*, students(id, first_name, last_name, grade, parent_email, parent_first_name, parent2_email, parent2_first_name, student_email, sings_own_disney_song, song_name)").order("audition_date",{ascending:!0});return{data:n||[],error:e}}async function mc(n,e){const{data:t,error:r}=await Fe.rpc("assign_vocal_day",{p_student_id:n,p_audition_date:e});return{data:t,error:r}}async function vx(n){const{data:e,error:t}=await Fe.rpc("unassign_vocal_day",{p_student_id:n});return{data:e,error:t}}async function Tp(n){const{data:e,error:t}=await Fe.from("vocal_day_assignments").select("*").eq("student_id",n).maybeSingle();return{data:e,error:t}}async function bx(n,e,t,r){const{data:i,error:s}=await Fe.rpc("log_notification_send",{p_student_id:n,p_recipient_email:e,p_subject:t,p_body_preview:r});return{data:i,error:s}}async function yx(){const{data:n,error:e}=await Fe.from("registration_email_templates").select("*").eq("template_key","registration_schedule").maybeSingle();return{data:n,error:e}}async function wx(n,e){const t={template_key:"registration_schedule",...n,updated_by_staff_user_id:e,updated_at:new Date().toISOString()},{data:r,error:i}=await Fe.from("registration_email_templates").upsert(t,{onConflict:"template_key"}).select().single();return{data:r,error:i}}function Va(n){return(n==null?void 0:n.vocal_mode)==="day_assignment"}function _x(n,e){const t=[];if(!Array.isArray(n)||n.length===0)return{valid:!0,errors:[]};const r=new Set(e.map(a=>a.id)),i=new Set,s=new Set;for(const a of n)(!a.roleId||!r.has(a.roleId))&&t.push("Invalid role selection."),s.has(a.roleId)&&t.push("Duplicate role selected."),s.add(a.roleId),(!Number.isInteger(a.rank)||a.rank<1)&&t.push("Rank must be a positive integer."),i.has(a.rank)&&t.push(`Duplicate rank: ${a.rank}. Each role must have a unique rank.`),i.add(a.rank);return{valid:t.length===0,errors:t}}function Pl(n){return[...n].sort((e,t)=>e.rank_order-t.rank_order)}function xx(n,e){const t=new Map,r=new Map(e.map(i=>[i.id,i]));for(const i of e)t.set(i.id,{role:i,students:[]});t.set("__none__",{role:null,students:[]});for(const i of n){const s=i.role_preferences||[],o=Pl(s)[0];o&&r.has(o.audition_role_id)?t.get(o.audition_role_id).students.push(i):t.get("__none__").students.push(i)}return t}function Ax(n,e,t){const r=t.find(m=>m.audition_date===e),i=rn(e),s=r!=null&&r.vocal_start_time&&(r!=null&&r.vocal_end_time)?`${bt(r.vocal_start_time)}  ${bt(r.vocal_end_time)}`:"TBD",a=n.parent_first_name||"Parent/Guardian",o=`${n.first_name||""} ${n.last_name||""}`.trim()||"your student",l="Vocal Audition Day Assignment  BATB Auditions",c=[`Dear ${a},`,"",`${o} has been assigned to the following vocal audition day:`,"",`Date: ${i}`,`Time: ${s}`,"","Please arrive at least 15 minutes early. If you have any questions, contact the production team.","","Break a leg!","Beauty and the Beast Auditions Team"].join(`
`),d=c.length>200?c.slice(0,200)+"":c;return{subject:l,body:c,bodyPreview:d}}function os(n){return!!(n&&typeof n=="string"&&n.trim())}function Sx(n){return n?os(n.first_name)&&os(n.last_name)&&os(n.grade):!1}function Ex(n){return n?os(n.parent_first_name)&&os(n.parent_last_name)&&os(n.parent_email)&&os(n.parent_phone):!1}function Nx(n){return n?os(n.photo_storage_path):!1}function kx(n,e){return!n||!e?!1:n.some(t=>t.contract_id===e&&os(t.student_typed_signature)&&os(t.parent_typed_signature))}function Lx(n,e){return n&&!os(e)?{valid:!1,error:"Please enter the song name."}:{valid:!0,error:null}}function Cp(n,e,t){const r=[];return Sx(n)||r.push("Required student information (name, grade)"),Ex(n)||r.push("Parent/guardian information"),Nx(n)||r.push("Student photo"),kx(e,t)||r.push("Contract signature (student and parent)"),{complete:r.length===0,missing:r}}function ye(n){if(n==null)return"";const e=document.createElement("div");return e.textContent=String(n),e.innerHTML}async function Tx(n){const[e,t,r,i]=await Promise.all([Ol(n),Np(),Po(),Rl()]),s=e.data||[],a=t.data,o=(a==null?void 0:a.id)||null,l=r.data||[],c=Va(i.data),d=l.filter(p=>p.dance_start_time&&p.dance_end_time);return{students:await Promise.all(s.map(async p=>{const[{data:h},{data:b},{data:w}]=await Promise.all([Fd(p.id),c?Promise.resolve({data:null}):Ud(p.id),c?Tp(p.id):Promise.resolve({data:null})]),S=Cp(p,h||[],o);return{...p,registrationStatus:S,danceWindows:d,hasDanceAssigned:d.length>0,vocalBooking:b,vocalDayAssignment:w}})),activeContract:a,dayMode:c}}function Cx(n,e,t){if(n.length===0)return{icon:"",title:"Get started!",message:"You haven't registered any students yet.",href:"#/family/register"};const r=n.find(a=>!a.registrationStatus.complete);if(r){const a=r.registrationStatus.missing;return a.some(o=>o.includes("Contract"))?{icon:"",title:"Contract unsigned",message:`${ye(r.first_name)} needs a signed contract.`,href:"#/family/contract"}:{icon:"",title:"Registration incomplete",message:`${ye(r.first_name)} still needs: ${a.join(", ")}.`,href:"#/family/register"}}const i=n.find(a=>!a.hasDanceAssigned);if(i)return{icon:"",title:"Dance schedule pending",message:`${ye(i.first_name)} is waiting on assigned dance day/time.`,href:"#/family/dance"};const s=t?n.find(a=>!a.vocalDayAssignment):n.find(a=>!a.vocalBooking);return s?t?{icon:"",title:"Vocal day pending",message:`${ye(s.first_name)} is waiting on a role-based vocal day assignment.`,href:"#/family/vocal"}:{icon:"",title:"Book vocal audition",message:`${ye(s.first_name)} doesn't have a vocal slot yet.`,href:"#/family/vocal"}:{icon:"",title:"You're all set!",message:"All students are registered and assigned. Break a leg!",href:null}}function Ix(n,e){const{registrationStatus:t,danceWindows:r,hasDanceAssigned:i,vocalBooking:s,vocalDayAssignment:a}=n,o=t.complete?"success-box":"warning-box",l=`${(n.first_name||"?")[0]}${(n.last_name||"?")[0]}`.toUpperCase(),c=t.complete?'<span class="status-badge--complete"> Registered</span>':'<span class="status-badge--pending"> Incomplete</span>',d=i?'<span class="status-badge--complete"> Dance</span>':'<span class="status-badge--locked"> Dance</span>',m=e?a?'<span class="status-badge--complete"> Vocal Day</span>':'<span class="status-badge--locked"> Vocal Day</span>':s?'<span class="status-badge--complete"> Vocal</span>':'<span class="status-badge--locked"> Vocal</span>';let p="";r&&r.length>0&&(p=` Dance (required): ${r.map(A=>`${rn(A.audition_date)} ${bt(A.dance_start_time)}  ${bt(A.dance_end_time)}`).join("; ")}`);let h="";if(e&&a)h=` Vocal Day: ${rn(a.audition_date)}`;else if(!e&&s&&s.audition_slots){const S=s.audition_slots;h=` Vocal: ${rn(S.audition_date)} ${bt(S.start_time)}  ${bt(S.end_time)}`}let b="";t.complete?i?(e&&!a||!e&&!s)&&(b=e?'<a href="#/family/vocal" style="font-weight:600;font-size:var(--text-small)">View vocal day assignment </a>':'<a href="#/family/vocal" style="font-weight:600;font-size:var(--text-small)">Book vocal slot </a>'):b='<a href="#/family/dance" style="font-weight:600;font-size:var(--text-small)">View dance assignment </a>':b='<a href="#/family/register" style="font-weight:600;font-size:var(--text-small)">Complete registration </a>';const w=`#/family/register?studentId=${encodeURIComponent(n.id)}`;return`
    <div class="student-card ${o}">
      <div style="display:flex;align-items:center;gap:var(--space-md);margin-bottom:var(--space-sm)">
        <div class="avatar">${l}</div>
        <div>
          <h3 style="margin:0">${ye(n.first_name||"Unnamed")} ${ye(n.last_name||"Student")}</h3>
          <span style="font-size:var(--text-small);color:var(--color-text-secondary)">Grade ${ye(n.grade||"")}</span>
        </div>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:var(--space-xs);margin-bottom:var(--space-sm)">
        ${c} ${d} ${m}
      </div>
      ${n.callback_invited?'<p style="color:var(--color-success);font-weight:600;font-size:var(--text-small)"> Invited to Callbacks</p>':""}
      ${p?`<p style="font-size:var(--text-small);color:var(--color-text-secondary)">${ye(p)}</p>`:""}
      ${h?`<p style="font-size:var(--text-small);color:var(--color-text-secondary)">${ye(h)}</p>`:""}
      ${t.complete?"":`<div style="font-size:var(--text-small);margin-top:var(--space-xs)"><strong>Missing:</strong><ul style="margin:0.25rem 0 0 1.25rem;padding:0">${t.missing.map(S=>`<li>${S}</li>`).join("")}</ul></div>`}
      <div style="margin-top:var(--space-sm)">
        <a
          href="${w}"
          data-edit-registration="${ye(n.id)}"
          style="font-weight:600;font-size:var(--text-small)"
        >Edit registration </a>
      </div>
      ${b?`<div style="margin-top:var(--space-sm)">${b}</div>`:""}
    </div>
  `}function Ox(){const{user:n}=Jt(),e=document.createElement("div");return e.className="page",e.innerHTML=`
    <h1>Family Dashboard </h1>
    <div id="students-list"><p>Loading</p></div>
  `,setTimeout(async()=>{if(!n)return;const{students:t,activeContract:r,dayMode:i}=await Tx(n.id),s=document.getElementById("students-list");if(!s)return;const a=Cx(t,r,i),o=`
      <div class="enchanted-banner">
        <div class="enchanted-banner__icon">${a.icon}</div>
        <div class="enchanted-banner__content">
          <div class="enchanted-banner__title">${a.title}</div>
          <div class="enchanted-banner__message">${a.message}</div>
          ${a.href?`<a class="enchanted-banner__link" href="${a.href}">Get started </a>`:""}
        </div>
      </div>
    `;if(t.length===0)s.innerHTML=`
        ${o}
        <div style="text-align:center;padding:var(--space-2xl) 0;color:var(--color-text-secondary)">
          <div style="font-size:2rem;margin-bottom:var(--space-md)"></div>
          <p>No students registered yet.</p>
          <a href="#/family/register" class="btn-accent" style="margin-top:var(--space-md);display:inline-flex">Register your first student</a>
        </div>
      `;else{const l=`
        <div class="quick-actions">
          <a href="#/family/register" class="quick-action">
            <span class="quick-action__icon"></span>
            <span class="quick-action__text">Register</span>
          </a>
          <a href="#/family/dance" class="quick-action">
            <span class="quick-action__icon"></span>
            <span class="quick-action__text">Dance Schedule</span>
          </a>
          <a href="#/family/vocal" class="quick-action">
            <span class="quick-action__icon"></span>
            <span class="quick-action__text">Vocal Booking</span>
          </a>
          <a href="#/family/schedule" class="quick-action">
            <span class="quick-action__icon"></span>
            <span class="quick-action__text">View Schedule</span>
          </a>
        </div>
      `;s.innerHTML=`
        ${o}
        ${l}
        <h2>Your Students</h2>
        ${t.map(c=>Ix(c,i)).join("")}
      `}},0),e}function Rx(){const{user:n,role:e,staffProfile:t}=Jt(),r=(t==null?void 0:t.display_name)||(n==null?void 0:n.email)||"staff",i=document.createElement("div");return i.className="page",i.innerHTML=`
    <div style="margin-bottom:var(--space-xl)">
      <h1>Welcome back, ${ye(r)} </h1>
      <span class="badge active" style="font-size:var(--text-xs)">${ye(e)}</span>
    </div>

    <div class="quick-actions" style="margin-bottom:var(--space-xl)">
      <a href="#/staff/scheduling" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Scheduling</span>
      </a>
      <a href="#/staff/dance-roster" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Dance Roster</span>
      </a>
      <a href="#/staff/vocal-roster" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Vocal Roster</span>
      </a>
      <a href="#/staff/callbacks" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Callbacks</span>
      </a>
      <a href="#/staff/roles" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Audition Roles</span>
      </a>
      <a href="#/staff/vocal-assignments" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Vocal Assignments</span>
      </a>
    </div>

    <h2>Quick Links</h2>
    <ul class="admin-links">
      <li><a href="#/staff/scheduling">Scheduling Configuration</a></li>
      <li><a href="#/staff/dance-roster">Dance Roster</a></li>
      <li><a href="#/staff/vocal-roster">Vocal Roster</a></li>
      <li><a href="#/staff/callbacks">Callback Management</a></li>
      <li><a href="#/staff/roles">Audition Roles</a></li>
      <li><a href="#/staff/vocal-assignments">Vocal Assignments</a></li>
    </ul>
  `,i}function Px(){const{user:n,staffProfile:e}=Jt(),t=(e==null?void 0:e.display_name)||(n==null?void 0:n.email)||"admin",r=document.createElement("div");return r.className="page",r.innerHTML=`
    <div style="margin-bottom:var(--space-xl)">
      <h1>Admin Dashboard </h1>
      <p>Welcome, ${ye(t)}.</p>
    </div>

    <div class="quick-actions" style="margin-bottom:var(--space-xl)">
      <a href="#/admin/contracts" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Contracts</span>
      </a>
      <a href="#/admin/registrations" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Registrations</span>
      </a>
      <a href="#/staff/dance-roster" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Dance Roster</span>
      </a>
      <a href="#/staff/vocal-roster" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Vocal Roster</span>
      </a>
      <a href="#/staff/callbacks" class="quick-action">
        <span class="quick-action__icon"></span>
        <span class="quick-action__text">Callbacks</span>
      </a>
    </div>

    <h2>Management</h2>
    <ul class="admin-links">
      <li><a href="#/admin/contracts">Contract Management</a></li>
      <li><a href="#/admin/registrations">Student Registrations</a></li>
      <li><a href="#/staff/dance-roster">Dance Roster & Overrides</a></li>
      <li><a href="#/staff/vocal-roster">Vocal Roster & Overrides</a></li>
      <li><a href="#/staff/callbacks">Callback Management</a></li>
    </ul>
  `,r}async function So(n,e,t,r={}){var l;const{data:i}=await Fe.auth.getUser(),s=(l=i==null?void 0:i.user)==null?void 0:l.id;if(!s)return{data:null,error:{message:"Not authenticated."}};const{data:a,error:o}=await Fe.rpc("log_admin_audit",{p_action:n,p_actor_id:s,p_table_name:e,p_record_id:t,p_details:r});return{data:a,error:o}}function Dx(n){return!n||n.length===0?1:Math.max(...n.map(t=>t.version_number))+1}function qv(n,e){return!n||!e?!1:n.some(t=>t.contract_id===e)}function jv(n,e){const t=[];return(!n||n.trim().length===0)&&t.push("Student typed signature is required."),(!e||e.trim().length===0)&&t.push("Parent typed signature is required."),{valid:t.length===0,errors:t}}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:$v,setPrototypeOf:Rg,isFrozen:Bx,getPrototypeOf:qx,getOwnPropertyDescriptor:jx}=Object;let{freeze:Jr,seal:ji,create:Rf}=Object,{apply:Pf,construct:Df}=typeof Reflect<"u"&&Reflect;Jr||(Jr=function(e){return e});ji||(ji=function(e){return e});Pf||(Pf=function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return e.apply(t,i)});Df||(Df=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return new e(...r)});const $u=Xr(Array.prototype.forEach),$x=Xr(Array.prototype.lastIndexOf),Pg=Xr(Array.prototype.pop),rc=Xr(Array.prototype.push),Mx=Xr(Array.prototype.splice),od=Xr(String.prototype.toLowerCase),Lh=Xr(String.prototype.toString),Th=Xr(String.prototype.match),ic=Xr(String.prototype.replace),Fx=Xr(String.prototype.indexOf),Ux=Xr(String.prototype.trim),Zi=Xr(Object.prototype.hasOwnProperty),Kr=Xr(RegExp.prototype.test),sc=zx(TypeError);function Xr(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Pf(n,e,r)}}function zx(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Df(n,t)}}function Ht(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:od;Rg&&Rg(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const s=t(i);s!==i&&(Bx(e)||(e[r]=s),i=s)}n[i]=!0}return n}function Hx(n){for(let e=0;e<n.length;e++)Zi(n,e)||(n[e]=null);return n}function Ss(n){const e=Rf(null);for(const[t,r]of $v(n))Zi(n,t)&&(Array.isArray(r)?e[t]=Hx(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Ss(r):e[t]=r);return e}function ac(n,e){for(;n!==null;){const r=jx(n,e);if(r){if(r.get)return Xr(r.get);if(typeof r.value=="function")return Xr(r.value)}n=qx(n)}function t(){return null}return t}const Dg=Jr(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ch=Jr(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ih=Jr(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Wx=Jr(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Oh=Jr(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Vx=Jr(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Bg=Jr(["#text"]),qg=Jr(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Rh=Jr(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),jg=Jr(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Mu=Jr(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Gx=ji(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Kx=ji(/<%[\w\W]*|[\w\W]*%>/gm),Yx=ji(/\$\{[\w\W]*/gm),Jx=ji(/^data-[\-\w.\u00B7-\uFFFF]+$/),Xx=ji(/^aria-[\-\w]+$/),Mv=ji(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Zx=ji(/^(?:\w+script|data):/i),Qx=ji(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Fv=ji(/^html$/i),eA=ji(/^[a-z][.\w]*(-[.\w]+)+$/i);var $g=Object.freeze({__proto__:null,ARIA_ATTR:Xx,ATTR_WHITESPACE:Qx,CUSTOM_ELEMENT:eA,DATA_ATTR:Jx,DOCTYPE_NAME:Fv,ERB_EXPR:Kx,IS_ALLOWED_URI:Mv,IS_SCRIPT_OR_DATA:Zx,MUSTACHE_EXPR:Gx,TMPLIT_EXPR:Yx});const oc={element:1,text:3,progressingInstruction:7,comment:8,document:9},tA=function(){return typeof window>"u"?null:window},nA=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(r=t.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},Mg=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Uv(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tA();const e=ze=>Uv(ze);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==oc.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:o,Element:l,NodeFilter:c,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:m,DOMParser:p,trustedTypes:h}=n,b=l.prototype,w=ac(b,"cloneNode"),S=ac(b,"remove"),A=ac(b,"nextSibling"),I=ac(b,"childNodes"),O=ac(b,"parentNode");if(typeof a=="function"){const ze=t.createElement("template");ze.content&&ze.content.ownerDocument&&(t=ze.content.ownerDocument)}let P,K="";const{implementation:le,createNodeIterator:he,createDocumentFragment:ne,getElementsByTagName:V}=t,{importNode:ue}=r;let _=Mg();e.isSupported=typeof $v=="function"&&typeof O=="function"&&le&&le.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:L,ERB_EXPR:C,TMPLIT_EXPR:M,DATA_ATTR:Y,ARIA_ATTR:G,IS_SCRIPT_OR_DATA:te,ATTR_WHITESPACE:X,CUSTOM_ELEMENT:ae}=$g;let{IS_ALLOWED_URI:me}=$g,fe=null;const k=Ht({},[...Dg,...Ch,...Ih,...Oh,...Bg]);let q=null;const W=Ht({},[...qg,...Rh,...jg,...Mu]);let U=Object.seal(Rf(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Q=null,se=null;const oe=Object.seal(Rf(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let pe=!0,be=!0,xe=!1,Oe=!0,Te=!1,qe=!0,j=!1,Be=!1,xt=!1,Qe=!1,Le=!1,Je=!1,$e=!0,st=!1;const tt="user-content-";let Tt=!0,At=!1,mt={},gt=null;const Nt=Ht({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ue=null;const ut=Ht({},["audio","video","img","source","image","track"]);let He=null;const sn=Ht({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ot="http://www.w3.org/1998/Math/MathML",wt="http://www.w3.org/2000/svg",ft="http://www.w3.org/1999/xhtml";let Wt=ft,Ke=!1,$t=null;const Xe=Ht({},[Ot,wt,ft],Lh);let pt=Ht({},["mi","mo","mn","ms","mtext"]),Vt=Ht({},["annotation-xml"]);const St=Ht({},["title","style","font","a","script"]);let et=null;const qt=["application/xhtml+xml","text/html"],Mr="text/html";let Rt=null,Dn=null;const Fn=t.createElement("form"),dt=function(ee){return ee instanceof RegExp||ee instanceof Function},Cn=function(){let ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Dn&&Dn===ee)){if((!ee||typeof ee!="object")&&(ee={}),ee=Ss(ee),et=qt.indexOf(ee.PARSER_MEDIA_TYPE)===-1?Mr:ee.PARSER_MEDIA_TYPE,Rt=et==="application/xhtml+xml"?Lh:od,fe=Zi(ee,"ALLOWED_TAGS")?Ht({},ee.ALLOWED_TAGS,Rt):k,q=Zi(ee,"ALLOWED_ATTR")?Ht({},ee.ALLOWED_ATTR,Rt):W,$t=Zi(ee,"ALLOWED_NAMESPACES")?Ht({},ee.ALLOWED_NAMESPACES,Lh):Xe,He=Zi(ee,"ADD_URI_SAFE_ATTR")?Ht(Ss(sn),ee.ADD_URI_SAFE_ATTR,Rt):sn,Ue=Zi(ee,"ADD_DATA_URI_TAGS")?Ht(Ss(ut),ee.ADD_DATA_URI_TAGS,Rt):ut,gt=Zi(ee,"FORBID_CONTENTS")?Ht({},ee.FORBID_CONTENTS,Rt):Nt,Q=Zi(ee,"FORBID_TAGS")?Ht({},ee.FORBID_TAGS,Rt):Ss({}),se=Zi(ee,"FORBID_ATTR")?Ht({},ee.FORBID_ATTR,Rt):Ss({}),mt=Zi(ee,"USE_PROFILES")?ee.USE_PROFILES:!1,pe=ee.ALLOW_ARIA_ATTR!==!1,be=ee.ALLOW_DATA_ATTR!==!1,xe=ee.ALLOW_UNKNOWN_PROTOCOLS||!1,Oe=ee.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=ee.SAFE_FOR_TEMPLATES||!1,qe=ee.SAFE_FOR_XML!==!1,j=ee.WHOLE_DOCUMENT||!1,Qe=ee.RETURN_DOM||!1,Le=ee.RETURN_DOM_FRAGMENT||!1,Je=ee.RETURN_TRUSTED_TYPE||!1,xt=ee.FORCE_BODY||!1,$e=ee.SANITIZE_DOM!==!1,st=ee.SANITIZE_NAMED_PROPS||!1,Tt=ee.KEEP_CONTENT!==!1,At=ee.IN_PLACE||!1,me=ee.ALLOWED_URI_REGEXP||Mv,Wt=ee.NAMESPACE||ft,pt=ee.MATHML_TEXT_INTEGRATION_POINTS||pt,Vt=ee.HTML_INTEGRATION_POINTS||Vt,U=ee.CUSTOM_ELEMENT_HANDLING||{},ee.CUSTOM_ELEMENT_HANDLING&&dt(ee.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(U.tagNameCheck=ee.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ee.CUSTOM_ELEMENT_HANDLING&&dt(ee.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(U.attributeNameCheck=ee.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ee.CUSTOM_ELEMENT_HANDLING&&typeof ee.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(U.allowCustomizedBuiltInElements=ee.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(be=!1),Le&&(Qe=!0),mt&&(fe=Ht({},Bg),q=[],mt.html===!0&&(Ht(fe,Dg),Ht(q,qg)),mt.svg===!0&&(Ht(fe,Ch),Ht(q,Rh),Ht(q,Mu)),mt.svgFilters===!0&&(Ht(fe,Ih),Ht(q,Rh),Ht(q,Mu)),mt.mathMl===!0&&(Ht(fe,Oh),Ht(q,jg),Ht(q,Mu))),ee.ADD_TAGS&&(typeof ee.ADD_TAGS=="function"?oe.tagCheck=ee.ADD_TAGS:(fe===k&&(fe=Ss(fe)),Ht(fe,ee.ADD_TAGS,Rt))),ee.ADD_ATTR&&(typeof ee.ADD_ATTR=="function"?oe.attributeCheck=ee.ADD_ATTR:(q===W&&(q=Ss(q)),Ht(q,ee.ADD_ATTR,Rt))),ee.ADD_URI_SAFE_ATTR&&Ht(He,ee.ADD_URI_SAFE_ATTR,Rt),ee.FORBID_CONTENTS&&(gt===Nt&&(gt=Ss(gt)),Ht(gt,ee.FORBID_CONTENTS,Rt)),ee.ADD_FORBID_CONTENTS&&(gt===Nt&&(gt=Ss(gt)),Ht(gt,ee.ADD_FORBID_CONTENTS,Rt)),Tt&&(fe["#text"]=!0),j&&Ht(fe,["html","head","body"]),fe.table&&(Ht(fe,["tbody"]),delete Q.tbody),ee.TRUSTED_TYPES_POLICY){if(typeof ee.TRUSTED_TYPES_POLICY.createHTML!="function")throw sc('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ee.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw sc('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');P=ee.TRUSTED_TYPES_POLICY,K=P.createHTML("")}else P===void 0&&(P=nA(h,i)),P!==null&&typeof K=="string"&&(K=P.createHTML(""));Jr&&Jr(ee),Dn=ee}},Nr=Ht({},[...Ch,...Ih,...Wx]),er=Ht({},[...Oh,...Vx]),ur=function(ee){let ke=O(ee);(!ke||!ke.tagName)&&(ke={namespaceURI:Wt,tagName:"template"});const Me=od(ee.tagName),en=od(ke.tagName);return $t[ee.namespaceURI]?ee.namespaceURI===wt?ke.namespaceURI===ft?Me==="svg":ke.namespaceURI===Ot?Me==="svg"&&(en==="annotation-xml"||pt[en]):!!Nr[Me]:ee.namespaceURI===Ot?ke.namespaceURI===ft?Me==="math":ke.namespaceURI===wt?Me==="math"&&Vt[en]:!!er[Me]:ee.namespaceURI===ft?ke.namespaceURI===wt&&!Vt[en]||ke.namespaceURI===Ot&&!pt[en]?!1:!er[Me]&&(St[Me]||!Nr[Me]):!!(et==="application/xhtml+xml"&&$t[ee.namespaceURI]):!1},Mt=function(ee){rc(e.removed,{element:ee});try{O(ee).removeChild(ee)}catch{S(ee)}},Qt=function(ee,ke){try{rc(e.removed,{attribute:ke.getAttributeNode(ee),from:ke})}catch{rc(e.removed,{attribute:null,from:ke})}if(ke.removeAttribute(ee),ee==="is")if(Qe||Le)try{Mt(ke)}catch{}else try{ke.setAttribute(ee,"")}catch{}},Ft=function(ee){let ke=null,Me=null;if(xt)ee="<remove></remove>"+ee;else{const an=Th(ee,/^[\r\n\t ]+/);Me=an&&an[0]}et==="application/xhtml+xml"&&Wt===ft&&(ee='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ee+"</body></html>");const en=P?P.createHTML(ee):ee;if(Wt===ft)try{ke=new p().parseFromString(en,et)}catch{}if(!ke||!ke.documentElement){ke=le.createDocument(Wt,"template",null);try{ke.documentElement.innerHTML=Ke?K:en}catch{}}const vn=ke.body||ke.documentElement;return ee&&Me&&vn.insertBefore(t.createTextNode(Me),vn.childNodes[0]||null),Wt===ft?V.call(ke,j?"html":"body")[0]:j?ke.documentElement:vn},Zr=function(ee){return he.call(ee.ownerDocument||ee,ee,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},kr=function(ee){return ee instanceof m&&(typeof ee.nodeName!="string"||typeof ee.textContent!="string"||typeof ee.removeChild!="function"||!(ee.attributes instanceof d)||typeof ee.removeAttribute!="function"||typeof ee.setAttribute!="function"||typeof ee.namespaceURI!="string"||typeof ee.insertBefore!="function"||typeof ee.hasChildNodes!="function")},dr=function(ee){return typeof o=="function"&&ee instanceof o};function kn(ze,ee,ke){$u(ze,Me=>{Me.call(e,ee,ke,Dn)})}const hr=function(ee){let ke=null;if(kn(_.beforeSanitizeElements,ee,null),kr(ee))return Mt(ee),!0;const Me=Rt(ee.nodeName);if(kn(_.uponSanitizeElement,ee,{tagName:Me,allowedTags:fe}),qe&&ee.hasChildNodes()&&!dr(ee.firstElementChild)&&Kr(/<[/\w!]/g,ee.innerHTML)&&Kr(/<[/\w!]/g,ee.textContent)||ee.nodeType===oc.progressingInstruction||qe&&ee.nodeType===oc.comment&&Kr(/<[/\w]/g,ee.data))return Mt(ee),!0;if(!(oe.tagCheck instanceof Function&&oe.tagCheck(Me))&&(!fe[Me]||Q[Me])){if(!Q[Me]&&tr(Me)&&(U.tagNameCheck instanceof RegExp&&Kr(U.tagNameCheck,Me)||U.tagNameCheck instanceof Function&&U.tagNameCheck(Me)))return!1;if(Tt&&!gt[Me]){const en=O(ee)||ee.parentNode,vn=I(ee)||ee.childNodes;if(vn&&en){const an=vn.length;for(let In=an-1;In>=0;--In){const on=w(vn[In],!0);on.__removalCount=(ee.__removalCount||0)+1,en.insertBefore(on,A(ee))}}}return Mt(ee),!0}return ee instanceof l&&!ur(ee)||(Me==="noscript"||Me==="noembed"||Me==="noframes")&&Kr(/<\/no(script|embed|frames)/i,ee.innerHTML)?(Mt(ee),!0):(Te&&ee.nodeType===oc.text&&(ke=ee.textContent,$u([L,C,M],en=>{ke=ic(ke,en," ")}),ee.textContent!==ke&&(rc(e.removed,{element:ee.cloneNode()}),ee.textContent=ke)),kn(_.afterSanitizeElements,ee,null),!1)},tn=function(ee,ke,Me){if($e&&(ke==="id"||ke==="name")&&(Me in t||Me in Fn))return!1;if(!(be&&!se[ke]&&Kr(Y,ke))){if(!(pe&&Kr(G,ke))){if(!(oe.attributeCheck instanceof Function&&oe.attributeCheck(ke,ee))){if(!q[ke]||se[ke]){if(!(tr(ee)&&(U.tagNameCheck instanceof RegExp&&Kr(U.tagNameCheck,ee)||U.tagNameCheck instanceof Function&&U.tagNameCheck(ee))&&(U.attributeNameCheck instanceof RegExp&&Kr(U.attributeNameCheck,ke)||U.attributeNameCheck instanceof Function&&U.attributeNameCheck(ke,ee))||ke==="is"&&U.allowCustomizedBuiltInElements&&(U.tagNameCheck instanceof RegExp&&Kr(U.tagNameCheck,Me)||U.tagNameCheck instanceof Function&&U.tagNameCheck(Me))))return!1}else if(!He[ke]){if(!Kr(me,ic(Me,X,""))){if(!((ke==="src"||ke==="xlink:href"||ke==="href")&&ee!=="script"&&Fx(Me,"data:")===0&&Ue[ee])){if(!(xe&&!Kr(te,ic(Me,X,"")))){if(Me)return!1}}}}}}}return!0},tr=function(ee){return ee!=="annotation-xml"&&Th(ee,ae)},Qr=function(ee){kn(_.beforeSanitizeAttributes,ee,null);const{attributes:ke}=ee;if(!ke||kr(ee))return;const Me={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:q,forceKeepAttr:void 0};let en=ke.length;for(;en--;){const vn=ke[en],{name:an,namespaceURI:In,value:on}=vn,mr=Rt(an),Fr=on;let Kt=an==="value"?Fr:Ux(Fr);if(Me.attrName=mr,Me.attrValue=Kt,Me.keepAttr=!0,Me.forceKeepAttr=void 0,kn(_.uponSanitizeAttribute,ee,Me),Kt=Me.attrValue,st&&(mr==="id"||mr==="name")&&(Qt(an,ee),Kt=tt+Kt),qe&&Kr(/((--!?|])>)|<\/(style|title|textarea)/i,Kt)){Qt(an,ee);continue}if(mr==="attributename"&&Th(Kt,"href")){Qt(an,ee);continue}if(Me.forceKeepAttr)continue;if(!Me.keepAttr){Qt(an,ee);continue}if(!Oe&&Kr(/\/>/i,Kt)){Qt(an,ee);continue}Te&&$u([L,C,M],Mi=>{Kt=ic(Kt,Mi," ")});const ci=Rt(ee.nodeName);if(!tn(ci,mr,Kt)){Qt(an,ee);continue}if(P&&typeof h=="object"&&typeof h.getAttributeType=="function"&&!In)switch(h.getAttributeType(ci,mr)){case"TrustedHTML":{Kt=P.createHTML(Kt);break}case"TrustedScriptURL":{Kt=P.createScriptURL(Kt);break}}if(Kt!==Fr)try{In?ee.setAttributeNS(In,an,Kt):ee.setAttribute(an,Kt),kr(ee)?Mt(ee):Pg(e.removed)}catch{Qt(an,ee)}}kn(_.afterSanitizeAttributes,ee,null)},Lr=function ze(ee){let ke=null;const Me=Zr(ee);for(kn(_.beforeSanitizeShadowDOM,ee,null);ke=Me.nextNode();)kn(_.uponSanitizeShadowNode,ke,null),hr(ke),Qr(ke),ke.content instanceof s&&ze(ke.content);kn(_.afterSanitizeShadowDOM,ee,null)};return e.sanitize=function(ze){let ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ke=null,Me=null,en=null,vn=null;if(Ke=!ze,Ke&&(ze="<!-->"),typeof ze!="string"&&!dr(ze))if(typeof ze.toString=="function"){if(ze=ze.toString(),typeof ze!="string")throw sc("dirty is not a string, aborting")}else throw sc("toString is not a function");if(!e.isSupported)return ze;if(Be||Cn(ee),e.removed=[],typeof ze=="string"&&(At=!1),At){if(ze.nodeName){const on=Rt(ze.nodeName);if(!fe[on]||Q[on])throw sc("root node is forbidden and cannot be sanitized in-place")}}else if(ze instanceof o)ke=Ft("<!---->"),Me=ke.ownerDocument.importNode(ze,!0),Me.nodeType===oc.element&&Me.nodeName==="BODY"||Me.nodeName==="HTML"?ke=Me:ke.appendChild(Me);else{if(!Qe&&!Te&&!j&&ze.indexOf("<")===-1)return P&&Je?P.createHTML(ze):ze;if(ke=Ft(ze),!ke)return Qe?null:Je?K:""}ke&&xt&&Mt(ke.firstChild);const an=Zr(At?ze:ke);for(;en=an.nextNode();)hr(en),Qr(en),en.content instanceof s&&Lr(en.content);if(At)return ze;if(Qe){if(Le)for(vn=ne.call(ke.ownerDocument);ke.firstChild;)vn.appendChild(ke.firstChild);else vn=ke;return(q.shadowroot||q.shadowrootmode)&&(vn=ue.call(r,vn,!0)),vn}let In=j?ke.outerHTML:ke.innerHTML;return j&&fe["!doctype"]&&ke.ownerDocument&&ke.ownerDocument.doctype&&ke.ownerDocument.doctype.name&&Kr(Fv,ke.ownerDocument.doctype.name)&&(In="<!DOCTYPE "+ke.ownerDocument.doctype.name+`>
`+In),Te&&$u([L,C,M],on=>{In=ic(In,on," ")}),P&&Je?P.createHTML(In):In},e.setConfig=function(){let ze=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Cn(ze),Be=!0},e.clearConfig=function(){Dn=null,Be=!1},e.isValidAttribute=function(ze,ee,ke){Dn||Cn({});const Me=Rt(ze),en=Rt(ee);return tn(Me,en,ke)},e.addHook=function(ze,ee){typeof ee=="function"&&rc(_[ze],ee)},e.removeHook=function(ze,ee){if(ee!==void 0){const ke=$x(_[ze],ee);return ke===-1?void 0:Mx(_[ze],ke,1)[0]}return Pg(_[ze])},e.removeHooks=function(ze){_[ze]=[]},e.removeAllHooks=function(){_=Mg()},e}var zv=Uv();const rA=Object.freeze(Object.defineProperty({__proto__:null,default:zv},Symbol.toStringTag,{value:"Module"})),iA=["h1","h2","h3","h4","p","br","hr","strong","b","em","i","u","s","ul","ol","li","a","blockquote","pre","code","span","div"],sA=["href","target","rel","class","style"];function aA(n){return zv.sanitize(n,{ALLOWED_TAGS:iA,ALLOWED_ATTR:sA,ALLOW_DATA_ATTR:!1})}function oA(n){return!n||typeof n!="string"?!1:/<[a-z][\s\S]*>/i.test(n)}function Ip(n){return n?oA(n)?aA(n):`<div style="white-space:pre-wrap">${ye(n)}</div>`:""}var Hv=typeof global=="object"&&global&&global.Object===Object&&global,lA=typeof self=="object"&&self&&self.Object===Object&&self,Bs=Hv||lA||Function("return this")(),Ha=Bs.Symbol,Wv=Object.prototype,cA=Wv.hasOwnProperty,uA=Wv.toString,lc=Ha?Ha.toStringTag:void 0;function dA(n){var e=cA.call(n,lc),t=n[lc];try{n[lc]=void 0;var r=!0}catch{}var i=uA.call(n);return r&&(e?n[lc]=t:delete n[lc]),i}var hA=Object.prototype,fA=hA.toString;function pA(n){return fA.call(n)}var mA="[object Null]",gA="[object Undefined]",Fg=Ha?Ha.toStringTag:void 0;function Dl(n){return n==null?n===void 0?gA:mA:Fg&&Fg in Object(n)?dA(n):pA(n)}function sa(n){return n!=null&&typeof n=="object"}var Eo=Array.isArray;function Ga(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}function Vv(n){return n}var vA="[object AsyncFunction]",bA="[object Function]",yA="[object GeneratorFunction]",wA="[object Proxy]";function Op(n){if(!Ga(n))return!1;var e=Dl(n);return e==bA||e==yA||e==vA||e==wA}var Ph=Bs["__core-js_shared__"],Ug=(function(){var n=/[^.]+$/.exec(Ph&&Ph.keys&&Ph.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function _A(n){return!!Ug&&Ug in n}var xA=Function.prototype,AA=xA.toString;function Do(n){if(n!=null){try{return AA.call(n)}catch{}try{return n+""}catch{}}return""}var SA=/[\\^$.*+?()[\]{}|]/g,EA=/^\[object .+?Constructor\]$/,NA=Function.prototype,kA=Object.prototype,LA=NA.toString,TA=kA.hasOwnProperty,CA=RegExp("^"+LA.call(TA).replace(SA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function IA(n){if(!Ga(n)||_A(n))return!1;var e=Op(n)?CA:EA;return e.test(Do(n))}function OA(n,e){return n==null?void 0:n[e]}function Bo(n,e){var t=OA(n,e);return IA(t)?t:void 0}var Bf=Bo(Bs,"WeakMap"),zg=Object.create,RA=(function(){function n(){}return function(e){if(!Ga(e))return{};if(zg)return zg(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}})();function PA(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function DA(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var BA=800,qA=16,jA=Date.now;function $A(n){var e=0,t=0;return function(){var r=jA(),i=qA-(r-t);if(t=r,i>0){if(++e>=BA)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function MA(n){return function(){return n}}var Ed=(function(){try{var n=Bo(Object,"defineProperty");return n({},"",{}),n}catch{}})(),FA=Ed?function(n,e){return Ed(n,"toString",{configurable:!0,enumerable:!1,value:MA(e),writable:!0})}:Vv,UA=$A(FA);function zA(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var HA=9007199254740991,WA=/^(?:0|[1-9]\d*)$/;function Gv(n,e){var t=typeof n;return e=e??HA,!!e&&(t=="number"||t!="symbol"&&WA.test(n))&&n>-1&&n%1==0&&n<e}function Rp(n,e,t){e=="__proto__"&&Ed?Ed(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function su(n,e){return n===e||n!==n&&e!==e}var VA=Object.prototype,GA=VA.hasOwnProperty;function Kv(n,e,t){var r=n[e];(!(GA.call(n,e)&&su(r,t))||t===void 0&&!(e in n))&&Rp(n,e,t)}function KA(n,e,t,r){var i=!t;t||(t={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=void 0;l===void 0&&(l=n[o]),i?Rp(t,o,l):Kv(t,o,l)}return t}var Hg=Math.max;function YA(n,e,t){return e=Hg(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=Hg(r.length-e,0),a=Array(s);++i<s;)a[i]=r[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=r[i];return o[e]=t(a),PA(n,this,o)}}function JA(n,e){return UA(YA(n,e,Vv),n+"")}var XA=9007199254740991;function Yv(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=XA}function Wd(n){return n!=null&&Yv(n.length)&&!Op(n)}function ZA(n,e,t){if(!Ga(t))return!1;var r=typeof e;return(r=="number"?Wd(t)&&Gv(e,t.length):r=="string"&&e in t)?su(t[e],n):!1}function QA(n){return JA(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,a=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,a&&ZA(t[0],t[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var o=t[r];o&&n(e,o,r,s)}return e})}var e3=Object.prototype;function Pp(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||e3;return n===t}function t3(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var n3="[object Arguments]";function Wg(n){return sa(n)&&Dl(n)==n3}var Jv=Object.prototype,r3=Jv.hasOwnProperty,i3=Jv.propertyIsEnumerable,qf=Wg((function(){return arguments})())?Wg:function(n){return sa(n)&&r3.call(n,"callee")&&!i3.call(n,"callee")};function s3(){return!1}var Xv=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Vg=Xv&&typeof module=="object"&&module&&!module.nodeType&&module,a3=Vg&&Vg.exports===Xv,Gg=a3?Bs.Buffer:void 0,o3=Gg?Gg.isBuffer:void 0,Uc=o3||s3,l3="[object Arguments]",c3="[object Array]",u3="[object Boolean]",d3="[object Date]",h3="[object Error]",f3="[object Function]",p3="[object Map]",m3="[object Number]",g3="[object Object]",v3="[object RegExp]",b3="[object Set]",y3="[object String]",w3="[object WeakMap]",_3="[object ArrayBuffer]",x3="[object DataView]",A3="[object Float32Array]",S3="[object Float64Array]",E3="[object Int8Array]",N3="[object Int16Array]",k3="[object Int32Array]",L3="[object Uint8Array]",T3="[object Uint8ClampedArray]",C3="[object Uint16Array]",I3="[object Uint32Array]",En={};En[A3]=En[S3]=En[E3]=En[N3]=En[k3]=En[L3]=En[T3]=En[C3]=En[I3]=!0;En[l3]=En[c3]=En[_3]=En[u3]=En[x3]=En[d3]=En[h3]=En[f3]=En[p3]=En[m3]=En[g3]=En[v3]=En[b3]=En[y3]=En[w3]=!1;function O3(n){return sa(n)&&Yv(n.length)&&!!En[Dl(n)]}function Dp(n){return function(e){return n(e)}}var Zv=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Sc=Zv&&typeof module=="object"&&module&&!module.nodeType&&module,R3=Sc&&Sc.exports===Zv,Dh=R3&&Hv.process,Sl=(function(){try{var n=Sc&&Sc.require&&Sc.require("util").types;return n||Dh&&Dh.binding&&Dh.binding("util")}catch{}})(),Kg=Sl&&Sl.isTypedArray,Bp=Kg?Dp(Kg):O3,P3=Object.prototype,D3=P3.hasOwnProperty;function Qv(n,e){var t=Eo(n),r=!t&&qf(n),i=!t&&!r&&Uc(n),s=!t&&!r&&!i&&Bp(n),a=t||r||i||s,o=a?t3(n.length,String):[],l=o.length;for(var c in n)(e||D3.call(n,c))&&!(a&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Gv(c,l)))&&o.push(c);return o}function eb(n,e){return function(t){return n(e(t))}}var B3=eb(Object.keys,Object),q3=Object.prototype,j3=q3.hasOwnProperty;function $3(n){if(!Pp(n))return B3(n);var e=[];for(var t in Object(n))j3.call(n,t)&&t!="constructor"&&e.push(t);return e}function M3(n){return Wd(n)?Qv(n):$3(n)}function F3(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var U3=Object.prototype,z3=U3.hasOwnProperty;function H3(n){if(!Ga(n))return F3(n);var e=Pp(n),t=[];for(var r in n)r=="constructor"&&(e||!z3.call(n,r))||t.push(r);return t}function tb(n){return Wd(n)?Qv(n,!0):H3(n)}var zc=Bo(Object,"create");function W3(){this.__data__=zc?zc(null):{},this.size=0}function V3(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var G3="__lodash_hash_undefined__",K3=Object.prototype,Y3=K3.hasOwnProperty;function J3(n){var e=this.__data__;if(zc){var t=e[n];return t===G3?void 0:t}return Y3.call(e,n)?e[n]:void 0}var X3=Object.prototype,Z3=X3.hasOwnProperty;function Q3(n){var e=this.__data__;return zc?e[n]!==void 0:Z3.call(e,n)}var e4="__lodash_hash_undefined__";function t4(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=zc&&e===void 0?e4:e,this}function No(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}No.prototype.clear=W3;No.prototype.delete=V3;No.prototype.get=J3;No.prototype.has=Q3;No.prototype.set=t4;function n4(){this.__data__=[],this.size=0}function Vd(n,e){for(var t=n.length;t--;)if(su(n[t][0],e))return t;return-1}var r4=Array.prototype,i4=r4.splice;function s4(n){var e=this.__data__,t=Vd(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():i4.call(e,t,1),--this.size,!0}function a4(n){var e=this.__data__,t=Vd(e,n);return t<0?void 0:e[t][1]}function o4(n){return Vd(this.__data__,n)>-1}function l4(n,e){var t=this.__data__,r=Vd(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function ua(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}ua.prototype.clear=n4;ua.prototype.delete=s4;ua.prototype.get=a4;ua.prototype.has=o4;ua.prototype.set=l4;var Hc=Bo(Bs,"Map");function c4(){this.size=0,this.__data__={hash:new No,map:new(Hc||ua),string:new No}}function u4(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function Gd(n,e){var t=n.__data__;return u4(e)?t[typeof e=="string"?"string":"hash"]:t.map}function d4(n){var e=Gd(this,n).delete(n);return this.size-=e?1:0,e}function h4(n){return Gd(this,n).get(n)}function f4(n){return Gd(this,n).has(n)}function p4(n,e){var t=Gd(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function qo(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}qo.prototype.clear=c4;qo.prototype.delete=d4;qo.prototype.get=h4;qo.prototype.has=f4;qo.prototype.set=p4;function m4(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var nb=eb(Object.getPrototypeOf,Object),g4="[object Object]",v4=Function.prototype,b4=Object.prototype,rb=v4.toString,y4=b4.hasOwnProperty,w4=rb.call(Object);function _4(n){if(!sa(n)||Dl(n)!=g4)return!1;var e=nb(n);if(e===null)return!0;var t=y4.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&rb.call(t)==w4}function x4(){this.__data__=new ua,this.size=0}function A4(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function S4(n){return this.__data__.get(n)}function E4(n){return this.__data__.has(n)}var N4=200;function k4(n,e){var t=this.__data__;if(t instanceof ua){var r=t.__data__;if(!Hc||r.length<N4-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new qo(r)}return t.set(n,e),this.size=t.size,this}function Is(n){var e=this.__data__=new ua(n);this.size=e.size}Is.prototype.clear=x4;Is.prototype.delete=A4;Is.prototype.get=S4;Is.prototype.has=E4;Is.prototype.set=k4;var ib=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Yg=ib&&typeof module=="object"&&module&&!module.nodeType&&module,L4=Yg&&Yg.exports===ib,Jg=L4?Bs.Buffer:void 0,Xg=Jg?Jg.allocUnsafe:void 0;function sb(n,e){if(e)return n.slice();var t=n.length,r=Xg?Xg(t):new n.constructor(t);return n.copy(r),r}function T4(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var a=n[t];e(a,t,n)&&(s[i++]=a)}return s}function C4(){return[]}var I4=Object.prototype,O4=I4.propertyIsEnumerable,Zg=Object.getOwnPropertySymbols,R4=Zg?function(n){return n==null?[]:(n=Object(n),T4(Zg(n),function(e){return O4.call(n,e)}))}:C4;function P4(n,e,t){var r=e(n);return Eo(n)?r:m4(r,t(n))}function jf(n){return P4(n,M3,R4)}var $f=Bo(Bs,"DataView"),Mf=Bo(Bs,"Promise"),Ff=Bo(Bs,"Set"),Qg="[object Map]",D4="[object Object]",e1="[object Promise]",t1="[object Set]",n1="[object WeakMap]",r1="[object DataView]",B4=Do($f),q4=Do(Hc),j4=Do(Mf),$4=Do(Ff),M4=Do(Bf),ss=Dl;($f&&ss(new $f(new ArrayBuffer(1)))!=r1||Hc&&ss(new Hc)!=Qg||Mf&&ss(Mf.resolve())!=e1||Ff&&ss(new Ff)!=t1||Bf&&ss(new Bf)!=n1)&&(ss=function(n){var e=Dl(n),t=e==D4?n.constructor:void 0,r=t?Do(t):"";if(r)switch(r){case B4:return r1;case q4:return Qg;case j4:return e1;case $4:return t1;case M4:return n1}return e});var F4=Object.prototype,U4=F4.hasOwnProperty;function z4(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&U4.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var Nd=Bs.Uint8Array;function qp(n){var e=new n.constructor(n.byteLength);return new Nd(e).set(new Nd(n)),e}function H4(n,e){var t=qp(n.buffer);return new n.constructor(t,n.byteOffset,n.byteLength)}var W4=/\w*$/;function V4(n){var e=new n.constructor(n.source,W4.exec(n));return e.lastIndex=n.lastIndex,e}var i1=Ha?Ha.prototype:void 0,s1=i1?i1.valueOf:void 0;function G4(n){return s1?Object(s1.call(n)):{}}function ab(n,e){var t=e?qp(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var K4="[object Boolean]",Y4="[object Date]",J4="[object Map]",X4="[object Number]",Z4="[object RegExp]",Q4="[object Set]",eS="[object String]",tS="[object Symbol]",nS="[object ArrayBuffer]",rS="[object DataView]",iS="[object Float32Array]",sS="[object Float64Array]",aS="[object Int8Array]",oS="[object Int16Array]",lS="[object Int32Array]",cS="[object Uint8Array]",uS="[object Uint8ClampedArray]",dS="[object Uint16Array]",hS="[object Uint32Array]";function fS(n,e,t){var r=n.constructor;switch(e){case nS:return qp(n);case K4:case Y4:return new r(+n);case rS:return H4(n);case iS:case sS:case aS:case oS:case lS:case cS:case uS:case dS:case hS:return ab(n,t);case J4:return new r;case X4:case eS:return new r(n);case Z4:return V4(n);case Q4:return new r;case tS:return G4(n)}}function ob(n){return typeof n.constructor=="function"&&!Pp(n)?RA(nb(n)):{}}var pS="[object Map]";function mS(n){return sa(n)&&ss(n)==pS}var a1=Sl&&Sl.isMap,gS=a1?Dp(a1):mS,vS="[object Set]";function bS(n){return sa(n)&&ss(n)==vS}var o1=Sl&&Sl.isSet,yS=o1?Dp(o1):bS,wS=1,lb="[object Arguments]",_S="[object Array]",xS="[object Boolean]",AS="[object Date]",SS="[object Error]",cb="[object Function]",ES="[object GeneratorFunction]",NS="[object Map]",kS="[object Number]",ub="[object Object]",LS="[object RegExp]",TS="[object Set]",CS="[object String]",IS="[object Symbol]",OS="[object WeakMap]",RS="[object ArrayBuffer]",PS="[object DataView]",DS="[object Float32Array]",BS="[object Float64Array]",qS="[object Int8Array]",jS="[object Int16Array]",$S="[object Int32Array]",MS="[object Uint8Array]",FS="[object Uint8ClampedArray]",US="[object Uint16Array]",zS="[object Uint32Array]",An={};An[lb]=An[_S]=An[RS]=An[PS]=An[xS]=An[AS]=An[DS]=An[BS]=An[qS]=An[jS]=An[$S]=An[NS]=An[kS]=An[ub]=An[LS]=An[TS]=An[CS]=An[IS]=An[MS]=An[FS]=An[US]=An[zS]=!0;An[SS]=An[cb]=An[OS]=!1;function ld(n,e,t,r,i,s){var a,o=e&wS;if(a!==void 0)return a;if(!Ga(n))return n;var l=Eo(n);if(l)a=z4(n);else{var c=ss(n),d=c==cb||c==ES;if(Uc(n))return sb(n,o);if(c==ub||c==lb||d&&!i)a=d?{}:ob(n);else{if(!An[c])return i?n:{};a=fS(n,c,o)}}s||(s=new Is);var m=s.get(n);if(m)return m;s.set(n,a),yS(n)?n.forEach(function(b){a.add(ld(b,e,t,b,n,s))}):gS(n)&&n.forEach(function(b,w){a.set(w,ld(b,e,t,w,n,s))});var p=jf,h=l?void 0:p(n);return zA(h||n,function(b,w){h&&(w=b,b=n[w]),Kv(a,w,ld(b,e,t,w,n,s))}),a}var HS=1,WS=4;function vl(n){return ld(n,HS|WS)}var VS="__lodash_hash_undefined__";function GS(n){return this.__data__.set(n,VS),this}function KS(n){return this.__data__.has(n)}function kd(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new qo;++e<t;)this.add(n[e])}kd.prototype.add=kd.prototype.push=GS;kd.prototype.has=KS;function YS(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function JS(n,e){return n.has(e)}var XS=1,ZS=2;function db(n,e,t,r,i,s){var a=t&XS,o=n.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(n),d=s.get(e);if(c&&d)return c==e&&d==n;var m=-1,p=!0,h=t&ZS?new kd:void 0;for(s.set(n,e),s.set(e,n);++m<o;){var b=n[m],w=e[m];if(r)var S=a?r(w,b,m,e,n,s):r(b,w,m,n,e,s);if(S!==void 0){if(S)continue;p=!1;break}if(h){if(!YS(e,function(A,I){if(!JS(h,I)&&(b===A||i(b,A,t,r,s)))return h.push(I)})){p=!1;break}}else if(!(b===w||i(b,w,t,r,s))){p=!1;break}}return s.delete(n),s.delete(e),p}function QS(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function eE(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var tE=1,nE=2,rE="[object Boolean]",iE="[object Date]",sE="[object Error]",aE="[object Map]",oE="[object Number]",lE="[object RegExp]",cE="[object Set]",uE="[object String]",dE="[object Symbol]",hE="[object ArrayBuffer]",fE="[object DataView]",l1=Ha?Ha.prototype:void 0,Bh=l1?l1.valueOf:void 0;function pE(n,e,t,r,i,s,a){switch(t){case fE:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case hE:return!(n.byteLength!=e.byteLength||!s(new Nd(n),new Nd(e)));case rE:case iE:case oE:return su(+n,+e);case sE:return n.name==e.name&&n.message==e.message;case lE:case uE:return n==e+"";case aE:var o=QS;case cE:var l=r&tE;if(o||(o=eE),n.size!=e.size&&!l)return!1;var c=a.get(n);if(c)return c==e;r|=nE,a.set(n,e);var d=db(o(n),o(e),r,i,s,a);return a.delete(n),d;case dE:if(Bh)return Bh.call(n)==Bh.call(e)}return!1}var mE=1,gE=Object.prototype,vE=gE.hasOwnProperty;function bE(n,e,t,r,i,s){var a=t&mE,o=jf(n),l=o.length,c=jf(e),d=c.length;if(l!=d&&!a)return!1;for(var m=l;m--;){var p=o[m];if(!(a?p in e:vE.call(e,p)))return!1}var h=s.get(n),b=s.get(e);if(h&&b)return h==e&&b==n;var w=!0;s.set(n,e),s.set(e,n);for(var S=a;++m<l;){p=o[m];var A=n[p],I=e[p];if(r)var O=a?r(I,A,p,e,n,s):r(A,I,p,n,e,s);if(!(O===void 0?A===I||i(A,I,t,r,s):O)){w=!1;break}S||(S=p=="constructor")}if(w&&!S){var P=n.constructor,K=e.constructor;P!=K&&"constructor"in n&&"constructor"in e&&!(typeof P=="function"&&P instanceof P&&typeof K=="function"&&K instanceof K)&&(w=!1)}return s.delete(n),s.delete(e),w}var yE=1,c1="[object Arguments]",u1="[object Array]",Fu="[object Object]",wE=Object.prototype,d1=wE.hasOwnProperty;function _E(n,e,t,r,i,s){var a=Eo(n),o=Eo(e),l=a?u1:ss(n),c=o?u1:ss(e);l=l==c1?Fu:l,c=c==c1?Fu:c;var d=l==Fu,m=c==Fu,p=l==c;if(p&&Uc(n)){if(!Uc(e))return!1;a=!0,d=!1}if(p&&!d)return s||(s=new Is),a||Bp(n)?db(n,e,t,r,i,s):pE(n,e,l,t,r,i,s);if(!(t&yE)){var h=d&&d1.call(n,"__wrapped__"),b=m&&d1.call(e,"__wrapped__");if(h||b){var w=h?n.value():n,S=b?e.value():e;return s||(s=new Is),i(w,S,t,r,s)}}return p?(s||(s=new Is),bE(n,e,t,r,i,s)):!1}function hb(n,e,t,r,i){return n===e?!0:n==null||e==null||!sa(n)&&!sa(e)?n!==n&&e!==e:_E(n,e,t,r,hb,i)}function xE(n){return function(e,t,r){for(var i=-1,s=Object(e),a=r(e),o=a.length;o--;){var l=a[++i];if(t(s[l],l,s)===!1)break}return e}}var AE=xE();function Uf(n,e,t){(t!==void 0&&!su(n[e],t)||t===void 0&&!(e in n))&&Rp(n,e,t)}function SE(n){return sa(n)&&Wd(n)}function zf(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}function EE(n){return KA(n,tb(n))}function NE(n,e,t,r,i,s,a){var o=zf(n,t),l=zf(e,t),c=a.get(l);if(c){Uf(n,t,c);return}var d=s?s(o,l,t+"",n,e,a):void 0,m=d===void 0;if(m){var p=Eo(l),h=!p&&Uc(l),b=!p&&!h&&Bp(l);d=l,p||h||b?Eo(o)?d=o:SE(o)?d=DA(o):h?(m=!1,d=sb(l,!0)):b?(m=!1,d=ab(l,!0)):d=[]:_4(l)||qf(l)?(d=o,qf(o)?d=EE(o):(!Ga(o)||Op(o))&&(d=ob(l))):m=!1}m&&(a.set(l,d),i(d,l,r,s,a),a.delete(l)),Uf(n,t,d)}function fb(n,e,t,r,i){n!==e&&AE(e,function(s,a){if(i||(i=new Is),Ga(s))NE(n,e,a,t,fb,r,i);else{var o=r?r(zf(n,a),s,a+"",n,e,i):void 0;o===void 0&&(o=s),Uf(n,a,o)}},tb)}function jp(n,e){return hb(n,e)}var za=QA(function(n,e,t){fb(n,e,t)}),ot=(n=>(n[n.TYPE=3]="TYPE",n[n.LEVEL=12]="LEVEL",n[n.ATTRIBUTE=13]="ATTRIBUTE",n[n.BLOT=14]="BLOT",n[n.INLINE=7]="INLINE",n[n.BLOCK=11]="BLOCK",n[n.BLOCK_BLOT=10]="BLOCK_BLOT",n[n.INLINE_BLOT=6]="INLINE_BLOT",n[n.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",n[n.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",n[n.ANY=15]="ANY",n))(ot||{});class Ps{constructor(e,t,r={}){this.attrName=e,this.keyName=t;const i=ot.TYPE&ot.ATTRIBUTE;this.scope=r.scope!=null?r.scope&ot.LEVEL|i:ot.ATTRIBUTE,r.whitelist!=null&&(this.whitelist=r.whitelist)}static keys(e){return Array.from(e.attributes).map(t=>t.name)}add(e,t){return this.canAdd(e,t)?(e.setAttribute(this.keyName,t),!0):!1}canAdd(e,t){return this.whitelist==null?!0:typeof t=="string"?this.whitelist.indexOf(t.replace(/["']/g,""))>-1:this.whitelist.indexOf(t)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const t=e.getAttribute(this.keyName);return this.canAdd(e,t)&&t?t:""}}class bl extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const pb=class Hf{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,t=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(t){let r=null;try{r=e.parentNode}catch{return null}return this.find(r,t)}return null}create(e,t,r){const i=this.query(t);if(i==null)throw new bl(`Unable to create ${t} blot`);const s=i,a=t instanceof Node||t.nodeType===Node.TEXT_NODE?t:s.create(r),o=new s(e,a,r);return Hf.blots.set(o.domNode,o),o}find(e,t=!1){return Hf.find(e,t)}query(e,t=ot.ANY){let r;return typeof e=="string"?r=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?r=this.types.text:typeof e=="number"?e&ot.LEVEL&ot.BLOCK?r=this.types.block:e&ot.LEVEL&ot.INLINE&&(r=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(i=>(r=this.classes[i],!!r)),r=r||this.tags[e.tagName]),r==null?null:"scope"in r&&t&ot.LEVEL&r.scope&&t&ot.TYPE&r.scope?r:null}register(...e){return e.map(t=>{const r="blotName"in t,i="attrName"in t;if(!r&&!i)throw new bl("Invalid definition");if(r&&t.blotName==="abstract")throw new bl("Cannot register abstract class");const s=r?t.blotName:i?t.attrName:void 0;return this.types[s]=t,i?typeof t.keyName=="string"&&(this.attributes[t.keyName]=t):r&&(t.className&&(this.classes[t.className]=t),t.tagName&&(Array.isArray(t.tagName)?t.tagName=t.tagName.map(a=>a.toUpperCase()):t.tagName=t.tagName.toUpperCase(),(Array.isArray(t.tagName)?t.tagName:[t.tagName]).forEach(a=>{(this.tags[a]==null||t.className==null)&&(this.tags[a]=t)}))),t})}};pb.blots=new WeakMap;let El=pb;function h1(n,e){return(n.getAttribute("class")||"").split(/\s+/).filter(t=>t.indexOf(`${e}-`)===0)}class kE extends Ps{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(t=>t.split("-").slice(0,-1).join("-"))}add(e,t){return this.canAdd(e,t)?(this.remove(e),e.classList.add(`${this.keyName}-${t}`),!0):!1}remove(e){h1(e,this.keyName).forEach(t=>{e.classList.remove(t)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const t=(h1(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,t)?t:""}}const ds=kE;function qh(n){const e=n.split("-"),t=e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("");return e[0]+t}class LE extends Ps{static keys(e){return(e.getAttribute("style")||"").split(";").map(t=>t.split(":")[0].trim())}add(e,t){return this.canAdd(e,t)?(e.style[qh(this.keyName)]=t,!0):!1}remove(e){e.style[qh(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const t=e.style[qh(this.keyName)];return this.canAdd(e,t)?t:""}}const Ka=LE;class TE{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,t){t?e.add(this.domNode,t)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=El.find(this.domNode);if(e==null)return;const t=Ps.keys(this.domNode),r=ds.keys(this.domNode),i=Ka.keys(this.domNode);t.concat(r).concat(i).forEach(s=>{const a=e.scroll.query(s,ot.ATTRIBUTE);a instanceof Ps&&(this.attributes[a.attrName]=a)})}copy(e){Object.keys(this.attributes).forEach(t=>{const r=this.attributes[t].value(this.domNode);e.format(t,r)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(t=>{this.attributes[t].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,t)=>(e[t]=this.attributes[t].value(this.domNode),e),{})}}const Kd=TE,mb=class{constructor(e,t){this.scroll=e,this.domNode=t,El.blots.set(t,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new bl("Blot definition missing tagName");let t,r;return Array.isArray(this.tagName)?(typeof e=="string"?(r=e.toUpperCase(),parseInt(r,10).toString()===r&&(r=parseInt(r,10))):typeof e=="number"&&(r=e),typeof r=="number"?t=document.createElement(this.tagName[r-1]):r&&this.tagName.indexOf(r)>-1?t=document.createElement(r):t=document.createElement(this.tagName[0])):t=document.createElement(this.tagName),this.className&&t.classList.add(this.className),t}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),El.blots.delete(this.domNode)}deleteAt(e,t){this.isolate(e,t).remove()}formatAt(e,t,r,i){const s=this.isolate(e,t);if(this.scroll.query(r,ot.BLOT)!=null&&i)s.wrap(r,i);else if(this.scroll.query(r,ot.ATTRIBUTE)!=null){const a=this.scroll.create(this.statics.scope);s.wrap(a),a.format(r,i)}}insertAt(e,t,r){const i=r==null?this.scroll.create("text",t):this.scroll.create(t,r),s=this.split(e);this.parent.insertBefore(i,s||void 0)}isolate(e,t){const r=this.split(e);if(r==null)throw new Error("Attempt to isolate at end");return r.split(t),r}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,t){const r=typeof e=="string"?this.scroll.create(e,t):e;return this.parent!=null&&(this.parent.insertBefore(r,this.next||void 0),this.remove()),r}split(e,t){return e===0?this:this.next}update(e,t){}wrap(e,t){const r=typeof e=="string"?this.scroll.create(e,t):e;if(this.parent!=null&&this.parent.insertBefore(r,this.next||void 0),typeof r.appendChild!="function")throw new bl(`Cannot wrap ${e}`);return r.appendChild(this),r}};mb.blotName="abstract";let gb=mb;const vb=class extends gb{static value(e){return!0}index(e,t){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(t,1):-1}position(e,t){let r=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(r+=1),[this.parent.domNode,r]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};vb.scope=ot.INLINE_BLOT;let CE=vb;const jr=CE;class IE{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const t=e.slice(1);this.append(...t)}}at(e){const t=this.iterator();let r=t();for(;r&&e>0;)e-=1,r=t();return r}contains(e){const t=this.iterator();let r=t();for(;r;){if(r===e)return!0;r=t()}return!1}indexOf(e){const t=this.iterator();let r=t(),i=0;for(;r;){if(r===e)return i;i+=1,r=t()}return-1}insertBefore(e,t){e!=null&&(this.remove(e),e.next=t,t!=null?(e.prev=t.prev,t.prev!=null&&(t.prev.next=e),t.prev=e,t===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let t=0,r=this.head;for(;r!=null;){if(r===e)return t;t+=r.length(),r=r.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const t=e;return e!=null&&(e=e.next),t}}find(e,t=!1){const r=this.iterator();let i=r();for(;i;){const s=i.length();if(e<s||t&&e===s&&(i.next==null||i.next.length()!==0))return[i,e];e-=s,i=r()}return[null,0]}forEach(e){const t=this.iterator();let r=t();for(;r;)e(r),r=t()}forEachAt(e,t,r){if(t<=0)return;const[i,s]=this.find(e);let a=e-s;const o=this.iterator(i);let l=o();for(;l&&a<e+t;){const c=l.length();e>a?r(l,e-a,Math.min(t,a+c-e)):r(l,0,Math.min(c,e+t-a)),a+=c,l=o()}}map(e){return this.reduce((t,r)=>(t.push(e(r)),t),[])}reduce(e,t){const r=this.iterator();let i=r();for(;i;)t=e(t,i),i=r();return t}}function f1(n,e){const t=e.find(n);if(t)return t;try{return e.create(n)}catch{const r=e.create(ot.INLINE);return Array.from(n.childNodes).forEach(i=>{r.domNode.appendChild(i)}),n.parentNode&&n.parentNode.replaceChild(r.domNode,n),r.attach(),r}}const bb=class Da extends gb{constructor(e,t){super(e,t),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,Da.uiClass&&this.uiNode.classList.add(Da.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new IE,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const t=f1(e,this.scroll);this.insertBefore(t,this.children.head||void 0)}catch(t){if(t instanceof bl)return;throw t}})}deleteAt(e,t){if(e===0&&t===this.length())return this.remove();this.children.forEachAt(e,t,(r,i,s)=>{r.deleteAt(i,s)})}descendant(e,t=0){const[r,i]=this.children.find(t);return e.blotName==null&&e(r)||e.blotName!=null&&r instanceof e?[r,i]:r instanceof Da?r.descendant(e,i):[null,-1]}descendants(e,t=0,r=Number.MAX_VALUE){let i=[],s=r;return this.children.forEachAt(t,r,(a,o,l)=>{(e.blotName==null&&e(a)||e.blotName!=null&&a instanceof e)&&i.push(a),a instanceof Da&&(i=i.concat(a.descendants(e,o,s))),s-=l}),i}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(t=>{e||this.statics.allowedChildren.some(r=>t instanceof r)||(t.statics.scope===ot.BLOCK_BLOT?(t.next!=null&&this.splitAfter(t),t.prev!=null&&this.splitAfter(t.prev),t.parent.unwrap(),e=!0):t instanceof Da?t.unwrap():t.remove())})}formatAt(e,t,r,i){this.children.forEachAt(e,t,(s,a,o)=>{s.formatAt(a,o,r,i)})}insertAt(e,t,r){const[i,s]=this.children.find(e);if(i)i.insertAt(s,t,r);else{const a=r==null?this.scroll.create("text",t):this.scroll.create(t,r);this.appendChild(a)}}insertBefore(e,t){e.parent!=null&&e.parent.children.remove(e);let r=null;this.children.insertBefore(e,t||null),e.parent=this,t!=null&&(r=t.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==r)&&this.domNode.insertBefore(e.domNode,r),e.attach()}length(){return this.children.reduce((e,t)=>e+t.length(),0)}moveChildren(e,t){this.children.forEach(r=>{e.insertBefore(r,t)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const t=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(t)}else this.remove()}path(e,t=!1){const[r,i]=this.children.find(e,t),s=[[this,e]];return r instanceof Da?s.concat(r.path(i,t)):(r!=null&&s.push([r,i]),s)}removeChild(e){this.children.remove(e)}replaceWith(e,t){const r=typeof e=="string"?this.scroll.create(e,t):e;return r instanceof Da&&this.moveChildren(r),super.replaceWith(r)}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}const r=this.clone();return this.parent&&this.parent.insertBefore(r,this.next||void 0),this.children.forEachAt(e,this.length(),(i,s,a)=>{const o=i.split(s,t);o!=null&&r.appendChild(o)}),r}splitAfter(e){const t=this.clone();for(;e.next!=null;)t.appendChild(e.next);return this.parent&&this.parent.insertBefore(t,this.next||void 0),t}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,t){const r=[],i=[];e.forEach(s=>{s.target===this.domNode&&s.type==="childList"&&(r.push(...s.addedNodes),i.push(...s.removedNodes))}),i.forEach(s=>{if(s.parentNode!=null&&s.tagName!=="IFRAME"&&document.body.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const a=this.scroll.find(s);a!=null&&(a.domNode.parentNode==null||a.domNode.parentNode===this.domNode)&&a.detach()}),r.filter(s=>s.parentNode===this.domNode&&s!==this.uiNode).sort((s,a)=>s===a?0:s.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(s=>{let a=null;s.nextSibling!=null&&(a=this.scroll.find(s.nextSibling));const o=f1(s,this.scroll);(o.next!==a||o.next==null)&&(o.parent!=null&&o.parent.removeChild(this),this.insertBefore(o,a||void 0))}),this.enforceAllowedChildren()}};bb.uiClass="";let OE=bb;const ls=OE;function RE(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}const sl=class al extends ls{static create(e){return super.create(e)}static formats(e,t){const r=t.query(al.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new Kd(this.domNode)}format(e,t){if(e===this.statics.blotName&&!t)this.children.forEach(r=>{r instanceof al||(r=r.wrap(al.blotName,!0)),this.attributes.copy(r)}),this.unwrap();else{const r=this.scroll.query(e,ot.INLINE);if(r==null)return;r instanceof Ps?this.attributes.attribute(r,t):t&&(e!==this.statics.blotName||this.formats()[e]!==t)&&this.replaceWith(e,t)}}formats(){const e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,r,i){this.formats()[r]!=null||this.scroll.query(r,ot.ATTRIBUTE)?this.isolate(e,t).format(r,i):super.formatAt(e,t,r,i)}optimize(e){super.optimize(e);const t=this.formats();if(Object.keys(t).length===0)return this.unwrap();const r=this.next;r instanceof al&&r.prev===this&&RE(t,r.formats())&&(r.moveChildren(this),r.remove())}replaceWith(e,t){const r=super.replaceWith(e,t);return this.attributes.copy(r),r}update(e,t){super.update(e,t),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}wrap(e,t){const r=super.wrap(e,t);return r instanceof al&&this.attributes.move(r),r}};sl.allowedChildren=[sl,jr],sl.blotName="inline",sl.scope=ot.INLINE_BLOT,sl.tagName="SPAN";let PE=sl;const $p=PE,ol=class Wf extends ls{static create(e){return super.create(e)}static formats(e,t){const r=t.query(Wf.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new Kd(this.domNode)}format(e,t){const r=this.scroll.query(e,ot.BLOCK);r!=null&&(r instanceof Ps?this.attributes.attribute(r,t):e===this.statics.blotName&&!t?this.replaceWith(Wf.blotName):t&&(e!==this.statics.blotName||this.formats()[e]!==t)&&this.replaceWith(e,t))}formats(){const e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,r,i){this.scroll.query(r,ot.BLOCK)!=null?this.format(r,i):super.formatAt(e,t,r,i)}insertAt(e,t,r){if(r==null||this.scroll.query(t,ot.INLINE)!=null)super.insertAt(e,t,r);else{const i=this.split(e);if(i!=null){const s=this.scroll.create(t,r);i.parent.insertBefore(s,i)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,t){const r=super.replaceWith(e,t);return this.attributes.copy(r),r}update(e,t){super.update(e,t),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}};ol.blotName="block",ol.scope=ot.BLOCK_BLOT,ol.tagName="P",ol.allowedChildren=[$p,ol,jr];let DE=ol;const Wc=DE,Vf=class extends ls{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,t){super.deleteAt(e,t),this.enforceAllowedChildren()}formatAt(e,t,r,i){super.formatAt(e,t,r,i),this.enforceAllowedChildren()}insertAt(e,t,r){super.insertAt(e,t,r),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};Vf.blotName="container",Vf.scope=ot.BLOCK_BLOT;let BE=Vf;const Yd=BE;class qE extends jr{static formats(e,t){}format(e,t){super.formatAt(0,this.length(),e,t)}formatAt(e,t,r,i){e===0&&t===this.length()?this.format(r,i):super.formatAt(e,t,r,i)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const Ei=qE,jE={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},$E=100,ll=class extends ls{constructor(e,t){super(null,t),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(r=>{this.update(r)}),this.observer.observe(this.domNode,jE),this.attach()}create(e,t){return this.registry.create(this,e,t)}find(e,t=!1){const r=this.registry.find(e,t);return r?r.scroll===this?r:t?this.find(r.scroll.domNode.parentNode,!0):null:null}query(e,t=ot.ANY){return this.registry.query(e,t)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,t){this.update(),e===0&&t===this.length()?this.children.forEach(r=>{r.remove()}):super.deleteAt(e,t)}formatAt(e,t,r,i){this.update(),super.formatAt(e,t,r,i)}insertAt(e,t,r){this.update(),super.insertAt(e,t,r)}optimize(e=[],t={}){super.optimize(t);const r=t.mutationsMap||new WeakMap;let i=Array.from(this.observer.takeRecords());for(;i.length>0;)e.push(i.pop());const s=(l,c=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(r.has(l.domNode)||r.set(l.domNode,[]),c&&s(l.parent))},a=l=>{r.has(l.domNode)&&(l instanceof ls&&l.children.forEach(a),r.delete(l.domNode),l.optimize(t))};let o=e;for(let l=0;o.length>0;l+=1){if(l>=$E)throw new Error("[Parchment] Maximum optimize iterations reached");for(o.forEach(c=>{const d=this.find(c.target,!0);d!=null&&(d.domNode===c.target&&(c.type==="childList"?(s(this.find(c.previousSibling,!1)),Array.from(c.addedNodes).forEach(m=>{const p=this.find(m,!1);s(p,!1),p instanceof ls&&p.children.forEach(h=>{s(h,!1)})})):c.type==="attributes"&&s(d.prev)),s(d))}),this.children.forEach(a),o=Array.from(this.observer.takeRecords()),i=o.slice();i.length>0;)e.push(i.pop())}}update(e,t={}){e=e||this.observer.takeRecords();const r=new WeakMap;e.map(i=>{const s=this.find(i.target,!0);return s==null?null:r.has(s.domNode)?(r.get(s.domNode).push(i),null):(r.set(s.domNode,[i]),s)}).forEach(i=>{i!=null&&i!==this&&r.has(i.domNode)&&i.update(r.get(i.domNode)||[],t)}),t.mutationsMap=r,r.has(this.domNode)&&super.update(r.get(this.domNode),t),this.optimize(e,t)}};ll.blotName="scroll",ll.defaultChild=Wc,ll.allowedChildren=[Wc,Yd],ll.scope=ot.BLOCK_BLOT,ll.tagName="DIV";let ME=ll;const Mp=ME,Gf=class yb extends jr{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,t){super(e,t),this.text=this.statics.value(this.domNode)}deleteAt(e,t){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+t)}index(e,t){return this.domNode===e?t:-1}insertAt(e,t,r){r==null?(this.text=this.text.slice(0,e)+t+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,t,r)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof yb&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,t=!1){return[this.domNode,e]}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}const r=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(r,this.next||void 0),this.text=this.statics.value(this.domNode),r}update(e,t){e.some(r=>r.type==="characterData"&&r.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};Gf.blotName="text",Gf.scope=ot.INLINE_BLOT;let FE=Gf;const Ld=FE,UE=Object.freeze(Object.defineProperty({__proto__:null,Attributor:Ps,AttributorStore:Kd,BlockBlot:Wc,ClassAttributor:ds,ContainerBlot:Yd,EmbedBlot:Ei,InlineBlot:$p,LeafBlot:jr,ParentBlot:ls,Registry:El,Scope:ot,ScrollBlot:Mp,StyleAttributor:Ka,TextBlot:Ld},Symbol.toStringTag,{value:"Module"}));var $a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Uu={exports:{}},jh,p1;function zE(){if(p1)return jh;p1=1;var n=-1,e=1,t=0;function r(_,L,C,M,Y){if(_===L)return _?[[t,_]]:[];if(C!=null){var G=V(_,L,C);if(G)return G}var te=o(_,L),X=_.substring(0,te);_=_.substring(te),L=L.substring(te),te=c(_,L);var ae=_.substring(_.length-te);_=_.substring(0,_.length-te),L=L.substring(0,L.length-te);var me=i(_,L);return X&&me.unshift([t,X]),ae&&me.push([t,ae]),I(me,Y),M&&m(me),me}function i(_,L){var C;if(!_)return[[e,L]];if(!L)return[[n,_]];var M=_.length>L.length?_:L,Y=_.length>L.length?L:_,G=M.indexOf(Y);if(G!==-1)return C=[[e,M.substring(0,G)],[t,Y],[e,M.substring(G+Y.length)]],_.length>L.length&&(C[0][0]=C[2][0]=n),C;if(Y.length===1)return[[n,_],[e,L]];var te=d(_,L);if(te){var X=te[0],ae=te[1],me=te[2],fe=te[3],k=te[4],q=r(X,me),W=r(ae,fe);return q.concat([[t,k]],W)}return s(_,L)}function s(_,L){for(var C=_.length,M=L.length,Y=Math.ceil((C+M)/2),G=Y,te=2*Y,X=new Array(te),ae=new Array(te),me=0;me<te;me++)X[me]=-1,ae[me]=-1;X[G+1]=0,ae[G+1]=0;for(var fe=C-M,k=fe%2!==0,q=0,W=0,U=0,Q=0,se=0;se<Y;se++){for(var oe=-se+q;oe<=se-W;oe+=2){var pe=G+oe,be;oe===-se||oe!==se&&X[pe-1]<X[pe+1]?be=X[pe+1]:be=X[pe-1]+1;for(var xe=be-oe;be<C&&xe<M&&_.charAt(be)===L.charAt(xe);)be++,xe++;if(X[pe]=be,be>C)W+=2;else if(xe>M)q+=2;else if(k){var Oe=G+fe-oe;if(Oe>=0&&Oe<te&&ae[Oe]!==-1){var Te=C-ae[Oe];if(be>=Te)return a(_,L,be,xe)}}}for(var qe=-se+U;qe<=se-Q;qe+=2){var Oe=G+qe,Te;qe===-se||qe!==se&&ae[Oe-1]<ae[Oe+1]?Te=ae[Oe+1]:Te=ae[Oe-1]+1;for(var j=Te-qe;Te<C&&j<M&&_.charAt(C-Te-1)===L.charAt(M-j-1);)Te++,j++;if(ae[Oe]=Te,Te>C)Q+=2;else if(j>M)U+=2;else if(!k){var pe=G+fe-qe;if(pe>=0&&pe<te&&X[pe]!==-1){var be=X[pe],xe=G+be-pe;if(Te=C-Te,be>=Te)return a(_,L,be,xe)}}}}return[[n,_],[e,L]]}function a(_,L,C,M){var Y=_.substring(0,C),G=L.substring(0,M),te=_.substring(C),X=L.substring(M),ae=r(Y,G),me=r(te,X);return ae.concat(me)}function o(_,L){if(!_||!L||_.charAt(0)!==L.charAt(0))return 0;for(var C=0,M=Math.min(_.length,L.length),Y=M,G=0;C<Y;)_.substring(G,Y)==L.substring(G,Y)?(C=Y,G=C):M=Y,Y=Math.floor((M-C)/2+C);return O(_.charCodeAt(Y-1))&&Y--,Y}function l(_,L){var C=_.length,M=L.length;if(C==0||M==0)return 0;C>M?_=_.substring(C-M):C<M&&(L=L.substring(0,C));var Y=Math.min(C,M);if(_==L)return Y;for(var G=0,te=1;;){var X=_.substring(Y-te),ae=L.indexOf(X);if(ae==-1)return G;te+=ae,(ae==0||_.substring(Y-te)==L.substring(0,te))&&(G=te,te++)}}function c(_,L){if(!_||!L||_.slice(-1)!==L.slice(-1))return 0;for(var C=0,M=Math.min(_.length,L.length),Y=M,G=0;C<Y;)_.substring(_.length-Y,_.length-G)==L.substring(L.length-Y,L.length-G)?(C=Y,G=C):M=Y,Y=Math.floor((M-C)/2+C);return P(_.charCodeAt(_.length-Y))&&Y--,Y}function d(_,L){var C=_.length>L.length?_:L,M=_.length>L.length?L:_;if(C.length<4||M.length*2<C.length)return null;function Y(W,U,Q){for(var se=W.substring(Q,Q+Math.floor(W.length/4)),oe=-1,pe="",be,xe,Oe,Te;(oe=U.indexOf(se,oe+1))!==-1;){var qe=o(W.substring(Q),U.substring(oe)),j=c(W.substring(0,Q),U.substring(0,oe));pe.length<j+qe&&(pe=U.substring(oe-j,oe)+U.substring(oe,oe+qe),be=W.substring(0,Q-j),xe=W.substring(Q+qe),Oe=U.substring(0,oe-j),Te=U.substring(oe+qe))}return pe.length*2>=W.length?[be,xe,Oe,Te,pe]:null}var G=Y(C,M,Math.ceil(C.length/4)),te=Y(C,M,Math.ceil(C.length/2)),X;if(!G&&!te)return null;te?G?X=G[4].length>te[4].length?G:te:X=te:X=G;var ae,me,fe,k;_.length>L.length?(ae=X[0],me=X[1],fe=X[2],k=X[3]):(fe=X[0],k=X[1],ae=X[2],me=X[3]);var q=X[4];return[ae,me,fe,k,q]}function m(_){for(var L=!1,C=[],M=0,Y=null,G=0,te=0,X=0,ae=0,me=0;G<_.length;)_[G][0]==t?(C[M++]=G,te=ae,X=me,ae=0,me=0,Y=_[G][1]):(_[G][0]==e?ae+=_[G][1].length:me+=_[G][1].length,Y&&Y.length<=Math.max(te,X)&&Y.length<=Math.max(ae,me)&&(_.splice(C[M-1],0,[n,Y]),_[C[M-1]+1][0]=e,M--,M--,G=M>0?C[M-1]:-1,te=0,X=0,ae=0,me=0,Y=null,L=!0)),G++;for(L&&I(_),A(_),G=1;G<_.length;){if(_[G-1][0]==n&&_[G][0]==e){var fe=_[G-1][1],k=_[G][1],q=l(fe,k),W=l(k,fe);q>=W?(q>=fe.length/2||q>=k.length/2)&&(_.splice(G,0,[t,k.substring(0,q)]),_[G-1][1]=fe.substring(0,fe.length-q),_[G+1][1]=k.substring(q),G++):(W>=fe.length/2||W>=k.length/2)&&(_.splice(G,0,[t,fe.substring(0,W)]),_[G-1][0]=e,_[G-1][1]=k.substring(0,k.length-W),_[G+1][0]=n,_[G+1][1]=fe.substring(W),G++),G++}G++}}var p=/[^a-zA-Z0-9]/,h=/\s/,b=/[\r\n]/,w=/\n\r?\n$/,S=/^\r?\n\r?\n/;function A(_){function L(W,U){if(!W||!U)return 6;var Q=W.charAt(W.length-1),se=U.charAt(0),oe=Q.match(p),pe=se.match(p),be=oe&&Q.match(h),xe=pe&&se.match(h),Oe=be&&Q.match(b),Te=xe&&se.match(b),qe=Oe&&W.match(w),j=Te&&U.match(S);return qe||j?5:Oe||Te?4:oe&&!be&&xe?3:be||xe?2:oe||pe?1:0}for(var C=1;C<_.length-1;){if(_[C-1][0]==t&&_[C+1][0]==t){var M=_[C-1][1],Y=_[C][1],G=_[C+1][1],te=c(M,Y);if(te){var X=Y.substring(Y.length-te);M=M.substring(0,M.length-te),Y=X+Y.substring(0,Y.length-te),G=X+G}for(var ae=M,me=Y,fe=G,k=L(M,Y)+L(Y,G);Y.charAt(0)===G.charAt(0);){M+=Y.charAt(0),Y=Y.substring(1)+G.charAt(0),G=G.substring(1);var q=L(M,Y)+L(Y,G);q>=k&&(k=q,ae=M,me=Y,fe=G)}_[C-1][1]!=ae&&(ae?_[C-1][1]=ae:(_.splice(C-1,1),C--),_[C][1]=me,fe?_[C+1][1]=fe:(_.splice(C+1,1),C--))}C++}}function I(_,L){_.push([t,""]);for(var C=0,M=0,Y=0,G="",te="",X;C<_.length;){if(C<_.length-1&&!_[C][1]){_.splice(C,1);continue}switch(_[C][0]){case e:Y++,te+=_[C][1],C++;break;case n:M++,G+=_[C][1],C++;break;case t:var ae=C-Y-M-1;if(L){if(ae>=0&&le(_[ae][1])){var me=_[ae][1].slice(-1);if(_[ae][1]=_[ae][1].slice(0,-1),G=me+G,te=me+te,!_[ae][1]){_.splice(ae,1),C--;var fe=ae-1;_[fe]&&_[fe][0]===e&&(Y++,te=_[fe][1]+te,fe--),_[fe]&&_[fe][0]===n&&(M++,G=_[fe][1]+G,fe--),ae=fe}}if(K(_[C][1])){var me=_[C][1].charAt(0);_[C][1]=_[C][1].slice(1),G+=me,te+=me}}if(C<_.length-1&&!_[C][1]){_.splice(C,1);break}if(G.length>0||te.length>0){G.length>0&&te.length>0&&(X=o(te,G),X!==0&&(ae>=0?_[ae][1]+=te.substring(0,X):(_.splice(0,0,[t,te.substring(0,X)]),C++),te=te.substring(X),G=G.substring(X)),X=c(te,G),X!==0&&(_[C][1]=te.substring(te.length-X)+_[C][1],te=te.substring(0,te.length-X),G=G.substring(0,G.length-X)));var k=Y+M;G.length===0&&te.length===0?(_.splice(C-k,k),C=C-k):G.length===0?(_.splice(C-k,k,[e,te]),C=C-k+1):te.length===0?(_.splice(C-k,k,[n,G]),C=C-k+1):(_.splice(C-k,k,[n,G],[e,te]),C=C-k+2)}C!==0&&_[C-1][0]===t?(_[C-1][1]+=_[C][1],_.splice(C,1)):C++,Y=0,M=0,G="",te="";break}}_[_.length-1][1]===""&&_.pop();var q=!1;for(C=1;C<_.length-1;)_[C-1][0]===t&&_[C+1][0]===t&&(_[C][1].substring(_[C][1].length-_[C-1][1].length)===_[C-1][1]?(_[C][1]=_[C-1][1]+_[C][1].substring(0,_[C][1].length-_[C-1][1].length),_[C+1][1]=_[C-1][1]+_[C+1][1],_.splice(C-1,1),q=!0):_[C][1].substring(0,_[C+1][1].length)==_[C+1][1]&&(_[C-1][1]+=_[C+1][1],_[C][1]=_[C][1].substring(_[C+1][1].length)+_[C+1][1],_.splice(C+1,1),q=!0)),C++;q&&I(_,L)}function O(_){return _>=55296&&_<=56319}function P(_){return _>=56320&&_<=57343}function K(_){return P(_.charCodeAt(0))}function le(_){return O(_.charCodeAt(_.length-1))}function he(_){for(var L=[],C=0;C<_.length;C++)_[C][1].length>0&&L.push(_[C]);return L}function ne(_,L,C,M){return le(_)||K(M)?null:he([[t,_],[n,L],[e,C],[t,M]])}function V(_,L,C){var M=typeof C=="number"?{index:C,length:0}:C.oldRange,Y=typeof C=="number"?null:C.newRange,G=_.length,te=L.length;if(M.length===0&&(Y===null||Y.length===0)){var X=M.index,ae=_.slice(0,X),me=_.slice(X),fe=Y?Y.index:null;e:{var k=X+te-G;if(fe!==null&&fe!==k||k<0||k>te)break e;var q=L.slice(0,k),W=L.slice(k);if(W!==me)break e;var U=Math.min(X,k),Q=ae.slice(0,U),se=q.slice(0,U);if(Q!==se)break e;var oe=ae.slice(U),pe=q.slice(U);return ne(Q,oe,pe,me)}e:{if(fe!==null&&fe!==X)break e;var be=X,q=L.slice(0,be),W=L.slice(be);if(q!==ae)break e;var xe=Math.min(G-be,te-be),Oe=me.slice(me.length-xe),Te=W.slice(W.length-xe);if(Oe!==Te)break e;var oe=me.slice(0,me.length-xe),pe=W.slice(0,W.length-xe);return ne(ae,oe,pe,Oe)}}if(M.length>0&&Y&&Y.length===0)e:{var Q=_.slice(0,M.index),Oe=_.slice(M.index+M.length),U=Q.length,xe=Oe.length;if(te<U+xe)break e;var se=L.slice(0,U),Te=L.slice(te-xe);if(Q!==se||Oe!==Te)break e;var oe=_.slice(U,G-xe),pe=L.slice(U,te-xe);return ne(Q,oe,pe,Oe)}return null}function ue(_,L,C,M){return r(_,L,C,M,!0)}return ue.INSERT=e,ue.DELETE=n,ue.EQUAL=t,jh=ue,jh}var gc={exports:{}};gc.exports;var m1;function _b(){return m1||(m1=1,(function(n,e){var t=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",a="[object Array]",o="[object Boolean]",l="[object Date]",c="[object Error]",d="[object Function]",m="[object GeneratorFunction]",p="[object Map]",h="[object Number]",b="[object Object]",w="[object Promise]",S="[object RegExp]",A="[object Set]",I="[object String]",O="[object Symbol]",P="[object WeakMap]",K="[object ArrayBuffer]",le="[object DataView]",he="[object Float32Array]",ne="[object Float64Array]",V="[object Int8Array]",ue="[object Int16Array]",_="[object Int32Array]",L="[object Uint8Array]",C="[object Uint8ClampedArray]",M="[object Uint16Array]",Y="[object Uint32Array]",G=/[\\^$.*+?()[\]{}|]/g,te=/\w*$/,X=/^\[object .+?Constructor\]$/,ae=/^(?:0|[1-9]\d*)$/,me={};me[s]=me[a]=me[K]=me[le]=me[o]=me[l]=me[he]=me[ne]=me[V]=me[ue]=me[_]=me[p]=me[h]=me[b]=me[S]=me[A]=me[I]=me[O]=me[L]=me[C]=me[M]=me[Y]=!0,me[c]=me[d]=me[P]=!1;var fe=typeof $a=="object"&&$a&&$a.Object===Object&&$a,k=typeof self=="object"&&self&&self.Object===Object&&self,q=fe||k||Function("return this")(),W=e&&!e.nodeType&&e,U=W&&!0&&n&&!n.nodeType&&n,Q=U&&U.exports===W;function se(y,D){return y.set(D[0],D[1]),y}function oe(y,D){return y.add(D),y}function pe(y,D){for(var J=-1,we=y?y.length:0;++J<we&&D(y[J],J,y)!==!1;);return y}function be(y,D){for(var J=-1,we=D.length,Et=y.length;++J<we;)y[Et+J]=D[J];return y}function xe(y,D,J,we){for(var Et=-1,We=y?y.length:0;++Et<We;)J=D(J,y[Et],Et,y);return J}function Oe(y,D){for(var J=-1,we=Array(y);++J<y;)we[J]=D(J);return we}function Te(y,D){return y==null?void 0:y[D]}function qe(y){var D=!1;if(y!=null&&typeof y.toString!="function")try{D=!!(y+"")}catch{}return D}function j(y){var D=-1,J=Array(y.size);return y.forEach(function(we,Et){J[++D]=[Et,we]}),J}function Be(y,D){return function(J){return y(D(J))}}function xt(y){var D=-1,J=Array(y.size);return y.forEach(function(we){J[++D]=we}),J}var Qe=Array.prototype,Le=Function.prototype,Je=Object.prototype,$e=q["__core-js_shared__"],st=(function(){var y=/[^.]+$/.exec($e&&$e.keys&&$e.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""})(),tt=Le.toString,Tt=Je.hasOwnProperty,At=Je.toString,mt=RegExp("^"+tt.call(Tt).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gt=Q?q.Buffer:void 0,Nt=q.Symbol,Ue=q.Uint8Array,ut=Be(Object.getPrototypeOf,Object),He=Object.create,sn=Je.propertyIsEnumerable,Ot=Qe.splice,wt=Object.getOwnPropertySymbols,ft=gt?gt.isBuffer:void 0,Wt=Be(Object.keys,Object),Ke=Cr(q,"DataView"),$t=Cr(q,"Map"),Xe=Cr(q,"Promise"),pt=Cr(q,"Set"),Vt=Cr(q,"WeakMap"),St=Cr(Object,"create"),et=Rn(Ke),qt=Rn($t),Mr=Rn(Xe),Rt=Rn(pt),Dn=Rn(Vt),Fn=Nt?Nt.prototype:void 0,dt=Fn?Fn.valueOf:void 0;function Cn(y){var D=-1,J=y?y.length:0;for(this.clear();++D<J;){var we=y[D];this.set(we[0],we[1])}}function Nr(){this.__data__=St?St(null):{}}function er(y){return this.has(y)&&delete this.__data__[y]}function ur(y){var D=this.__data__;if(St){var J=D[y];return J===r?void 0:J}return Tt.call(D,y)?D[y]:void 0}function Mt(y){var D=this.__data__;return St?D[y]!==void 0:Tt.call(D,y)}function Qt(y,D){var J=this.__data__;return J[y]=St&&D===void 0?r:D,this}Cn.prototype.clear=Nr,Cn.prototype.delete=er,Cn.prototype.get=ur,Cn.prototype.has=Mt,Cn.prototype.set=Qt;function Ft(y){var D=-1,J=y?y.length:0;for(this.clear();++D<J;){var we=y[D];this.set(we[0],we[1])}}function Zr(){this.__data__=[]}function kr(y){var D=this.__data__,J=Fr(D,y);if(J<0)return!1;var we=D.length-1;return J==we?D.pop():Ot.call(D,J,1),!0}function dr(y){var D=this.__data__,J=Fr(D,y);return J<0?void 0:D[J][1]}function kn(y){return Fr(this.__data__,y)>-1}function hr(y,D){var J=this.__data__,we=Fr(J,y);return we<0?J.push([y,D]):J[we][1]=D,this}Ft.prototype.clear=Zr,Ft.prototype.delete=kr,Ft.prototype.get=dr,Ft.prototype.has=kn,Ft.prototype.set=hr;function tn(y){var D=-1,J=y?y.length:0;for(this.clear();++D<J;){var we=y[D];this.set(we[0],we[1])}}function tr(){this.__data__={hash:new Cn,map:new($t||Ft),string:new Cn}}function Qr(y){return Ni(this,y).delete(y)}function Lr(y){return Ni(this,y).get(y)}function ze(y){return Ni(this,y).has(y)}function ee(y,D){return Ni(this,y).set(y,D),this}tn.prototype.clear=tr,tn.prototype.delete=Qr,tn.prototype.get=Lr,tn.prototype.has=ze,tn.prototype.set=ee;function ke(y){this.__data__=new Ft(y)}function Me(){this.__data__=new Ft}function en(y){return this.__data__.delete(y)}function vn(y){return this.__data__.get(y)}function an(y){return this.__data__.has(y)}function In(y,D){var J=this.__data__;if(J instanceof Ft){var we=J.__data__;if(!$t||we.length<t-1)return we.push([y,D]),this;J=this.__data__=new tn(we)}return J.set(y,D),this}ke.prototype.clear=Me,ke.prototype.delete=en,ke.prototype.get=vn,ke.prototype.has=an,ke.prototype.set=In;function on(y,D){var J=Fs(y)||vt(y)?Oe(y.length,String):[],we=J.length,Et=!!we;for(var We in y)Tt.call(y,We)&&!(Et&&(We=="length"||Ms(We,we)))&&J.push(We);return J}function mr(y,D,J){var we=y[D];(!(Tt.call(y,D)&&ga(we,J))||J===void 0&&!(D in y))&&(y[D]=J)}function Fr(y,D){for(var J=y.length;J--;)if(ga(y[J][0],D))return J;return-1}function Kt(y,D){return y&&$s(D,zi(D),y)}function ci(y,D,J,we,Et,We,Ut){var jt;if(we&&(jt=We?we(y,Et,We,Ut):we(y)),jt!==void 0)return jt;if(!ii(y))return y;var bn=Fs(y);if(bn){if(jt=Xa(y),!D)return fa(y,jt)}else{var zt=gr(y),Bn=zt==d||zt==m;if(ri(y))return dn(y,D);if(zt==b||zt==s||Bn&&!We){if(qe(y))return We?y:{};if(jt=ni(Bn?{}:y),!D)return Ja(y,Kt(jt,y))}else{if(!me[zt])return We?y:{};jt=Za(y,zt,ci,D)}}Ut||(Ut=new ke);var nr=Ut.get(y);if(nr)return nr;if(Ut.set(y,jt),!bn)var Ln=J?ti(y):zi(y);return pe(Ln||y,function(yn,hn){Ln&&(hn=yn,yn=y[hn]),mr(jt,hn,ci(yn,D,J,we,hn,y,Ut))}),jt}function Mi(y){return ii(y)?He(y):{}}function ha(y,D,J){var we=D(y);return Fs(y)?we:be(we,J(y))}function ei(y){return At.call(y)}function gs(y){if(!ii(y)||Ur(y))return!1;var D=zr(y)||qe(y)?mt:X;return D.test(Rn(y))}function Ya(y){if(!ma(y))return Wt(y);var D=[];for(var J in Object(y))Tt.call(y,J)&&J!="constructor"&&D.push(J);return D}function dn(y,D){if(D)return y.slice();var J=new y.constructor(y.length);return y.copy(J),J}function vs(y){var D=new y.constructor(y.byteLength);return new Ue(D).set(new Ue(y)),D}function fr(y,D){var J=D?vs(y.buffer):y.buffer;return new y.constructor(J,y.byteOffset,y.byteLength)}function Fi(y,D,J){var we=D?J(j(y),!0):j(y);return xe(we,se,new y.constructor)}function js(y){var D=new y.constructor(y.source,te.exec(y));return D.lastIndex=y.lastIndex,D}function Tr(y,D,J){var we=D?J(xt(y),!0):xt(y);return xe(we,oe,new y.constructor)}function On(y){return dt?Object(dt.call(y)):{}}function ui(y,D){var J=D?vs(y.buffer):y.buffer;return new y.constructor(J,y.byteOffset,y.length)}function fa(y,D){var J=-1,we=y.length;for(D||(D=Array(we));++J<we;)D[J]=y[J];return D}function $s(y,D,J,we){J||(J={});for(var Et=-1,We=D.length;++Et<We;){var Ut=D[Et],jt=void 0;mr(J,Ut,jt===void 0?y[Ut]:jt)}return J}function Ja(y,D){return $s(y,Ir(y),D)}function ti(y){return ha(y,zi,Ir)}function Ni(y,D){var J=y.__data__;return pa(D)?J[typeof D=="string"?"string":"hash"]:J.map}function Cr(y,D){var J=Te(y,D);return gs(J)?J:void 0}var Ir=wt?Be(wt,Object):Hi,gr=ei;(Ke&&gr(new Ke(new ArrayBuffer(1)))!=le||$t&&gr(new $t)!=p||Xe&&gr(Xe.resolve())!=w||pt&&gr(new pt)!=A||Vt&&gr(new Vt)!=P)&&(gr=function(y){var D=At.call(y),J=D==b?y.constructor:void 0,we=J?Rn(J):void 0;if(we)switch(we){case et:return le;case qt:return p;case Mr:return w;case Rt:return A;case Dn:return P}return D});function Xa(y){var D=y.length,J=y.constructor(D);return D&&typeof y[0]=="string"&&Tt.call(y,"index")&&(J.index=y.index,J.input=y.input),J}function ni(y){return typeof y.constructor=="function"&&!ma(y)?Mi(ut(y)):{}}function Za(y,D,J,we){var Et=y.constructor;switch(D){case K:return vs(y);case o:case l:return new Et(+y);case le:return fr(y,we);case he:case ne:case V:case ue:case _:case L:case C:case M:case Y:return ui(y,we);case p:return Fi(y,we,J);case h:case I:return new Et(y);case S:return js(y);case A:return Tr(y,we,J);case O:return On(y)}}function Ms(y,D){return D=D??i,!!D&&(typeof y=="number"||ae.test(y))&&y>-1&&y%1==0&&y<D}function pa(y){var D=typeof y;return D=="string"||D=="number"||D=="symbol"||D=="boolean"?y!=="__proto__":y===null}function Ur(y){return!!st&&st in y}function ma(y){var D=y&&y.constructor,J=typeof D=="function"&&D.prototype||Je;return y===J}function Rn(y){if(y!=null){try{return tt.call(y)}catch{}try{return y+""}catch{}}return""}function bs(y){return ci(y,!0,!0)}function ga(y,D){return y===D||y!==y&&D!==D}function vt(y){return Qa(y)&&Tt.call(y,"callee")&&(!sn.call(y,"callee")||At.call(y)==s)}var Fs=Array.isArray;function ys(y){return y!=null&&va(y.length)&&!zr(y)}function Qa(y){return Ui(y)&&ys(y)}var ri=ft||eo;function zr(y){var D=ii(y)?At.call(y):"";return D==d||D==m}function va(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=i}function ii(y){var D=typeof y;return!!y&&(D=="object"||D=="function")}function Ui(y){return!!y&&typeof y=="object"}function zi(y){return ys(y)?on(y):Ya(y)}function Hi(){return[]}function eo(){return!1}n.exports=bs})(gc,gc.exports)),gc.exports}var vc={exports:{}};vc.exports;var g1;function xb(){return g1||(g1=1,(function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,a=9007199254740991,o="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",d="[object Boolean]",m="[object Date]",p="[object Error]",h="[object Function]",b="[object GeneratorFunction]",w="[object Map]",S="[object Number]",A="[object Null]",I="[object Object]",O="[object Promise]",P="[object Proxy]",K="[object RegExp]",le="[object Set]",he="[object String]",ne="[object Symbol]",V="[object Undefined]",ue="[object WeakMap]",_="[object ArrayBuffer]",L="[object DataView]",C="[object Float32Array]",M="[object Float64Array]",Y="[object Int8Array]",G="[object Int16Array]",te="[object Int32Array]",X="[object Uint8Array]",ae="[object Uint8ClampedArray]",me="[object Uint16Array]",fe="[object Uint32Array]",k=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,U={};U[C]=U[M]=U[Y]=U[G]=U[te]=U[X]=U[ae]=U[me]=U[fe]=!0,U[o]=U[l]=U[_]=U[d]=U[L]=U[m]=U[p]=U[h]=U[w]=U[S]=U[I]=U[K]=U[le]=U[he]=U[ue]=!1;var Q=typeof $a=="object"&&$a&&$a.Object===Object&&$a,se=typeof self=="object"&&self&&self.Object===Object&&self,oe=Q||se||Function("return this")(),pe=e&&!e.nodeType&&e,be=pe&&!0&&n&&!n.nodeType&&n,xe=be&&be.exports===pe,Oe=xe&&Q.process,Te=(function(){try{return Oe&&Oe.binding&&Oe.binding("util")}catch{}})(),qe=Te&&Te.isTypedArray;function j(y,D){for(var J=-1,we=y==null?0:y.length,Et=0,We=[];++J<we;){var Ut=y[J];D(Ut,J,y)&&(We[Et++]=Ut)}return We}function Be(y,D){for(var J=-1,we=D.length,Et=y.length;++J<we;)y[Et+J]=D[J];return y}function xt(y,D){for(var J=-1,we=y==null?0:y.length;++J<we;)if(D(y[J],J,y))return!0;return!1}function Qe(y,D){for(var J=-1,we=Array(y);++J<y;)we[J]=D(J);return we}function Le(y){return function(D){return y(D)}}function Je(y,D){return y.has(D)}function $e(y,D){return y==null?void 0:y[D]}function st(y){var D=-1,J=Array(y.size);return y.forEach(function(we,Et){J[++D]=[Et,we]}),J}function tt(y,D){return function(J){return y(D(J))}}function Tt(y){var D=-1,J=Array(y.size);return y.forEach(function(we){J[++D]=we}),J}var At=Array.prototype,mt=Function.prototype,gt=Object.prototype,Nt=oe["__core-js_shared__"],Ue=mt.toString,ut=gt.hasOwnProperty,He=(function(){var y=/[^.]+$/.exec(Nt&&Nt.keys&&Nt.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""})(),sn=gt.toString,Ot=RegExp("^"+Ue.call(ut).replace(k,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wt=xe?oe.Buffer:void 0,ft=oe.Symbol,Wt=oe.Uint8Array,Ke=gt.propertyIsEnumerable,$t=At.splice,Xe=ft?ft.toStringTag:void 0,pt=Object.getOwnPropertySymbols,Vt=wt?wt.isBuffer:void 0,St=tt(Object.keys,Object),et=Ir(oe,"DataView"),qt=Ir(oe,"Map"),Mr=Ir(oe,"Promise"),Rt=Ir(oe,"Set"),Dn=Ir(oe,"WeakMap"),Fn=Ir(Object,"create"),dt=Rn(et),Cn=Rn(qt),Nr=Rn(Mr),er=Rn(Rt),ur=Rn(Dn),Mt=ft?ft.prototype:void 0,Qt=Mt?Mt.valueOf:void 0;function Ft(y){var D=-1,J=y==null?0:y.length;for(this.clear();++D<J;){var we=y[D];this.set(we[0],we[1])}}function Zr(){this.__data__=Fn?Fn(null):{},this.size=0}function kr(y){var D=this.has(y)&&delete this.__data__[y];return this.size-=D?1:0,D}function dr(y){var D=this.__data__;if(Fn){var J=D[y];return J===r?void 0:J}return ut.call(D,y)?D[y]:void 0}function kn(y){var D=this.__data__;return Fn?D[y]!==void 0:ut.call(D,y)}function hr(y,D){var J=this.__data__;return this.size+=this.has(y)?0:1,J[y]=Fn&&D===void 0?r:D,this}Ft.prototype.clear=Zr,Ft.prototype.delete=kr,Ft.prototype.get=dr,Ft.prototype.has=kn,Ft.prototype.set=hr;function tn(y){var D=-1,J=y==null?0:y.length;for(this.clear();++D<J;){var we=y[D];this.set(we[0],we[1])}}function tr(){this.__data__=[],this.size=0}function Qr(y){var D=this.__data__,J=dn(D,y);if(J<0)return!1;var we=D.length-1;return J==we?D.pop():$t.call(D,J,1),--this.size,!0}function Lr(y){var D=this.__data__,J=dn(D,y);return J<0?void 0:D[J][1]}function ze(y){return dn(this.__data__,y)>-1}function ee(y,D){var J=this.__data__,we=dn(J,y);return we<0?(++this.size,J.push([y,D])):J[we][1]=D,this}tn.prototype.clear=tr,tn.prototype.delete=Qr,tn.prototype.get=Lr,tn.prototype.has=ze,tn.prototype.set=ee;function ke(y){var D=-1,J=y==null?0:y.length;for(this.clear();++D<J;){var we=y[D];this.set(we[0],we[1])}}function Me(){this.size=0,this.__data__={hash:new Ft,map:new(qt||tn),string:new Ft}}function en(y){var D=Cr(this,y).delete(y);return this.size-=D?1:0,D}function vn(y){return Cr(this,y).get(y)}function an(y){return Cr(this,y).has(y)}function In(y,D){var J=Cr(this,y),we=J.size;return J.set(y,D),this.size+=J.size==we?0:1,this}ke.prototype.clear=Me,ke.prototype.delete=en,ke.prototype.get=vn,ke.prototype.has=an,ke.prototype.set=In;function on(y){var D=-1,J=y==null?0:y.length;for(this.__data__=new ke;++D<J;)this.add(y[D])}function mr(y){return this.__data__.set(y,r),this}function Fr(y){return this.__data__.has(y)}on.prototype.add=on.prototype.push=mr,on.prototype.has=Fr;function Kt(y){var D=this.__data__=new tn(y);this.size=D.size}function ci(){this.__data__=new tn,this.size=0}function Mi(y){var D=this.__data__,J=D.delete(y);return this.size=D.size,J}function ha(y){return this.__data__.get(y)}function ei(y){return this.__data__.has(y)}function gs(y,D){var J=this.__data__;if(J instanceof tn){var we=J.__data__;if(!qt||we.length<t-1)return we.push([y,D]),this.size=++J.size,this;J=this.__data__=new ke(we)}return J.set(y,D),this.size=J.size,this}Kt.prototype.clear=ci,Kt.prototype.delete=Mi,Kt.prototype.get=ha,Kt.prototype.has=ei,Kt.prototype.set=gs;function Ya(y,D){var J=vt(y),we=!J&&ga(y),Et=!J&&!we&&ys(y),We=!J&&!we&&!Et&&Ui(y),Ut=J||we||Et||We,jt=Ut?Qe(y.length,String):[],bn=jt.length;for(var zt in y)ut.call(y,zt)&&!(Ut&&(zt=="length"||Et&&(zt=="offset"||zt=="parent")||We&&(zt=="buffer"||zt=="byteLength"||zt=="byteOffset")||Za(zt,bn)))&&jt.push(zt);return jt}function dn(y,D){for(var J=y.length;J--;)if(bs(y[J][0],D))return J;return-1}function vs(y,D,J){var we=D(y);return vt(y)?we:Be(we,J(y))}function fr(y){return y==null?y===void 0?V:A:Xe&&Xe in Object(y)?gr(y):ma(y)}function Fi(y){return ii(y)&&fr(y)==o}function js(y,D,J,we,Et){return y===D?!0:y==null||D==null||!ii(y)&&!ii(D)?y!==y&&D!==D:Tr(y,D,J,we,js,Et)}function Tr(y,D,J,we,Et,We){var Ut=vt(y),jt=vt(D),bn=Ut?l:ni(y),zt=jt?l:ni(D);bn=bn==o?I:bn,zt=zt==o?I:zt;var Bn=bn==I,nr=zt==I,Ln=bn==zt;if(Ln&&ys(y)){if(!ys(D))return!1;Ut=!0,Bn=!1}if(Ln&&!Bn)return We||(We=new Kt),Ut||Ui(y)?$s(y,D,J,we,Et,We):Ja(y,D,bn,J,we,Et,We);if(!(J&i)){var yn=Bn&&ut.call(y,"__wrapped__"),hn=nr&&ut.call(D,"__wrapped__");if(yn||hn){var di=yn?y.value():y,vr=hn?D.value():D;return We||(We=new Kt),Et(di,vr,J,we,We)}}return Ln?(We||(We=new Kt),ti(y,D,J,we,Et,We)):!1}function On(y){if(!va(y)||pa(y))return!1;var D=ri(y)?Ot:q;return D.test(Rn(y))}function ui(y){return ii(y)&&zr(y.length)&&!!U[fr(y)]}function fa(y){if(!Ur(y))return St(y);var D=[];for(var J in Object(y))ut.call(y,J)&&J!="constructor"&&D.push(J);return D}function $s(y,D,J,we,Et,We){var Ut=J&i,jt=y.length,bn=D.length;if(jt!=bn&&!(Ut&&bn>jt))return!1;var zt=We.get(y);if(zt&&We.get(D))return zt==D;var Bn=-1,nr=!0,Ln=J&s?new on:void 0;for(We.set(y,D),We.set(D,y);++Bn<jt;){var yn=y[Bn],hn=D[Bn];if(we)var di=Ut?we(hn,yn,Bn,D,y,We):we(yn,hn,Bn,y,D,We);if(di!==void 0){if(di)continue;nr=!1;break}if(Ln){if(!xt(D,function(vr,ki){if(!Je(Ln,ki)&&(yn===vr||Et(yn,vr,J,we,We)))return Ln.push(ki)})){nr=!1;break}}else if(!(yn===hn||Et(yn,hn,J,we,We))){nr=!1;break}}return We.delete(y),We.delete(D),nr}function Ja(y,D,J,we,Et,We,Ut){switch(J){case L:if(y.byteLength!=D.byteLength||y.byteOffset!=D.byteOffset)return!1;y=y.buffer,D=D.buffer;case _:return!(y.byteLength!=D.byteLength||!We(new Wt(y),new Wt(D)));case d:case m:case S:return bs(+y,+D);case p:return y.name==D.name&&y.message==D.message;case K:case he:return y==D+"";case w:var jt=st;case le:var bn=we&i;if(jt||(jt=Tt),y.size!=D.size&&!bn)return!1;var zt=Ut.get(y);if(zt)return zt==D;we|=s,Ut.set(y,D);var Bn=$s(jt(y),jt(D),we,Et,We,Ut);return Ut.delete(y),Bn;case ne:if(Qt)return Qt.call(y)==Qt.call(D)}return!1}function ti(y,D,J,we,Et,We){var Ut=J&i,jt=Ni(y),bn=jt.length,zt=Ni(D),Bn=zt.length;if(bn!=Bn&&!Ut)return!1;for(var nr=bn;nr--;){var Ln=jt[nr];if(!(Ut?Ln in D:ut.call(D,Ln)))return!1}var yn=We.get(y);if(yn&&We.get(D))return yn==D;var hn=!0;We.set(y,D),We.set(D,y);for(var di=Ut;++nr<bn;){Ln=jt[nr];var vr=y[Ln],ki=D[Ln];if(we)var g=Ut?we(ki,vr,Ln,D,y,We):we(vr,ki,Ln,y,D,We);if(!(g===void 0?vr===ki||Et(vr,ki,J,we,We):g)){hn=!1;break}di||(di=Ln=="constructor")}if(hn&&!di){var E=y.constructor,F=D.constructor;E!=F&&"constructor"in y&&"constructor"in D&&!(typeof E=="function"&&E instanceof E&&typeof F=="function"&&F instanceof F)&&(hn=!1)}return We.delete(y),We.delete(D),hn}function Ni(y){return vs(y,zi,Xa)}function Cr(y,D){var J=y.__data__;return Ms(D)?J[typeof D=="string"?"string":"hash"]:J.map}function Ir(y,D){var J=$e(y,D);return On(J)?J:void 0}function gr(y){var D=ut.call(y,Xe),J=y[Xe];try{y[Xe]=void 0;var we=!0}catch{}var Et=sn.call(y);return we&&(D?y[Xe]=J:delete y[Xe]),Et}var Xa=pt?function(y){return y==null?[]:(y=Object(y),j(pt(y),function(D){return Ke.call(y,D)}))}:Hi,ni=fr;(et&&ni(new et(new ArrayBuffer(1)))!=L||qt&&ni(new qt)!=w||Mr&&ni(Mr.resolve())!=O||Rt&&ni(new Rt)!=le||Dn&&ni(new Dn)!=ue)&&(ni=function(y){var D=fr(y),J=D==I?y.constructor:void 0,we=J?Rn(J):"";if(we)switch(we){case dt:return L;case Cn:return w;case Nr:return O;case er:return le;case ur:return ue}return D});function Za(y,D){return D=D??a,!!D&&(typeof y=="number"||W.test(y))&&y>-1&&y%1==0&&y<D}function Ms(y){var D=typeof y;return D=="string"||D=="number"||D=="symbol"||D=="boolean"?y!=="__proto__":y===null}function pa(y){return!!He&&He in y}function Ur(y){var D=y&&y.constructor,J=typeof D=="function"&&D.prototype||gt;return y===J}function ma(y){return sn.call(y)}function Rn(y){if(y!=null){try{return Ue.call(y)}catch{}try{return y+""}catch{}}return""}function bs(y,D){return y===D||y!==y&&D!==D}var ga=Fi((function(){return arguments})())?Fi:function(y){return ii(y)&&ut.call(y,"callee")&&!Ke.call(y,"callee")},vt=Array.isArray;function Fs(y){return y!=null&&zr(y.length)&&!ri(y)}var ys=Vt||eo;function Qa(y,D){return js(y,D)}function ri(y){if(!va(y))return!1;var D=fr(y);return D==h||D==b||D==c||D==P}function zr(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=a}function va(y){var D=typeof y;return y!=null&&(D=="object"||D=="function")}function ii(y){return y!=null&&typeof y=="object"}var Ui=qe?Le(qe):ui;function zi(y){return Fs(y)?Ya(y):fa(y)}function Hi(){return[]}function eo(){return!1}n.exports=Qa})(vc,vc.exports)),vc.exports}var zu={},v1;function HE(){if(v1)return zu;v1=1,Object.defineProperty(zu,"__esModule",{value:!0});const n=_b(),e=xb();var t;return(function(r){function i(l={},c={},d=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let m=n(c);d||(m=Object.keys(m).reduce((p,h)=>(m[h]!=null&&(p[h]=m[h]),p),{}));for(const p in l)l[p]!==void 0&&c[p]===void 0&&(m[p]=l[p]);return Object.keys(m).length>0?m:void 0}r.compose=i;function s(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const d=Object.keys(l).concat(Object.keys(c)).reduce((m,p)=>(e(l[p],c[p])||(m[p]=c[p]===void 0?null:c[p]),m),{});return Object.keys(d).length>0?d:void 0}r.diff=s;function a(l={},c={}){l=l||{};const d=Object.keys(c).reduce((m,p)=>(c[p]!==l[p]&&l[p]!==void 0&&(m[p]=c[p]),m),{});return Object.keys(l).reduce((m,p)=>(l[p]!==c[p]&&c[p]===void 0&&(m[p]=null),m),d)}r.invert=a;function o(l,c,d=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!d)return c;const m=Object.keys(c).reduce((p,h)=>(l[h]===void 0&&(p[h]=c[h]),p),{});return Object.keys(m).length>0?m:void 0}r.transform=o})(t||(t={})),zu.default=t,zu}var Hu={},b1;function Ab(){if(b1)return Hu;b1=1,Object.defineProperty(Hu,"__esModule",{value:!0});var n;return(function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t})(n||(n={})),Hu.default=n,Hu}var Wu={},y1;function WE(){if(y1)return Wu;y1=1,Object.defineProperty(Wu,"__esModule",{value:!0});const n=Ab();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const i=this.ops[this.index];if(i){const s=this.offset,a=n.default.length(i);if(r>=a-s?(r=a-s,this.index+=1,this.offset=0):this.offset+=r,typeof i.delete=="number")return{delete:r};{const o={};return i.attributes&&(o.attributes=i.attributes),typeof i.retain=="number"?o.retain=r:typeof i.retain=="object"&&i.retain!==null?o.retain=i.retain:typeof i.insert=="string"?o.insert=i.insert.substr(s,r):o.insert=i.insert,o}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,i=this.index,s=this.next(),a=this.ops.slice(this.index);return this.offset=r,this.index=i,[s].concat(a)}}else return[]}}return Wu.default=e,Wu}var w1;function VE(){return w1||(w1=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=zE(),r=_b(),i=xb(),s=HE();e.AttributeMap=s.default;const a=Ab();e.Op=a.default;const o=WE();e.OpIterator=o.default;const l="\0",c=(m,p)=>{if(typeof m!="object"||m===null)throw new Error(`cannot retain a ${typeof m}`);if(typeof p!="object"||p===null)throw new Error(`cannot retain a ${typeof p}`);const h=Object.keys(m)[0];if(!h||h!==Object.keys(p)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(p)[0]}`);return[h,m[h],p[h]]};class d{constructor(p){Array.isArray(p)?this.ops=p:p!=null&&Array.isArray(p.ops)?this.ops=p.ops:this.ops=[]}static registerEmbed(p,h){this.handlers[p]=h}static unregisterEmbed(p){delete this.handlers[p]}static getHandler(p){const h=this.handlers[p];if(!h)throw new Error(`no handlers for embed type "${p}"`);return h}insert(p,h){const b={};return typeof p=="string"&&p.length===0?this:(b.insert=p,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(b.attributes=h),this.push(b))}delete(p){return p<=0?this:this.push({delete:p})}retain(p,h){if(typeof p=="number"&&p<=0)return this;const b={retain:p};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(b.attributes=h),this.push(b)}push(p){let h=this.ops.length,b=this.ops[h-1];if(p=r(p),typeof b=="object"){if(typeof p.delete=="number"&&typeof b.delete=="number")return this.ops[h-1]={delete:b.delete+p.delete},this;if(typeof b.delete=="number"&&p.insert!=null&&(h-=1,b=this.ops[h-1],typeof b!="object"))return this.ops.unshift(p),this;if(i(p.attributes,b.attributes)){if(typeof p.insert=="string"&&typeof b.insert=="string")return this.ops[h-1]={insert:b.insert+p.insert},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this;if(typeof p.retain=="number"&&typeof b.retain=="number")return this.ops[h-1]={retain:b.retain+p.retain},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this}}return h===this.ops.length?this.ops.push(p):this.ops.splice(h,0,p),this}chop(){const p=this.ops[this.ops.length-1];return p&&typeof p.retain=="number"&&!p.attributes&&this.ops.pop(),this}filter(p){return this.ops.filter(p)}forEach(p){this.ops.forEach(p)}map(p){return this.ops.map(p)}partition(p){const h=[],b=[];return this.forEach(w=>{(p(w)?h:b).push(w)}),[h,b]}reduce(p,h){return this.ops.reduce(p,h)}changeLength(){return this.reduce((p,h)=>h.insert?p+a.default.length(h):h.delete?p-h.delete:p,0)}length(){return this.reduce((p,h)=>p+a.default.length(h),0)}slice(p=0,h=1/0){const b=[],w=new o.default(this.ops);let S=0;for(;S<h&&w.hasNext();){let A;S<p?A=w.next(p-S):(A=w.next(h-S),b.push(A)),S+=a.default.length(A)}return new d(b)}compose(p){const h=new o.default(this.ops),b=new o.default(p.ops),w=[],S=b.peek();if(S!=null&&typeof S.retain=="number"&&S.attributes==null){let I=S.retain;for(;h.peekType()==="insert"&&h.peekLength()<=I;)I-=h.peekLength(),w.push(h.next());S.retain-I>0&&b.next(S.retain-I)}const A=new d(w);for(;h.hasNext()||b.hasNext();)if(b.peekType()==="insert")A.push(b.next());else if(h.peekType()==="delete")A.push(h.next());else{const I=Math.min(h.peekLength(),b.peekLength()),O=h.next(I),P=b.next(I);if(P.retain){const K={};if(typeof O.retain=="number")K.retain=typeof P.retain=="number"?I:P.retain;else if(typeof P.retain=="number")O.retain==null?K.insert=O.insert:K.retain=O.retain;else{const he=O.retain==null?"insert":"retain",[ne,V,ue]=c(O[he],P.retain),_=d.getHandler(ne);K[he]={[ne]:_.compose(V,ue,he==="retain")}}const le=s.default.compose(O.attributes,P.attributes,typeof O.retain=="number");if(le&&(K.attributes=le),A.push(K),!b.hasNext()&&i(A.ops[A.ops.length-1],K)){const he=new d(h.rest());return A.concat(he).chop()}}else typeof P.delete=="number"&&(typeof O.retain=="number"||typeof O.retain=="object"&&O.retain!==null)&&A.push(P)}return A.chop()}concat(p){const h=new d(this.ops.slice());return p.ops.length>0&&(h.push(p.ops[0]),h.ops=h.ops.concat(p.ops.slice(1))),h}diff(p,h){if(this.ops===p.ops)return new d;const b=[this,p].map(O=>O.map(P=>{if(P.insert!=null)return typeof P.insert=="string"?P.insert:l;const K=O===p?"on":"with";throw new Error("diff() called "+K+" non-document")}).join("")),w=new d,S=t(b[0],b[1],h,!0),A=new o.default(this.ops),I=new o.default(p.ops);return S.forEach(O=>{let P=O[1].length;for(;P>0;){let K=0;switch(O[0]){case t.INSERT:K=Math.min(I.peekLength(),P),w.push(I.next(K));break;case t.DELETE:K=Math.min(P,A.peekLength()),A.next(K),w.delete(K);break;case t.EQUAL:K=Math.min(A.peekLength(),I.peekLength(),P);const le=A.next(K),he=I.next(K);i(le.insert,he.insert)?w.retain(K,s.default.diff(le.attributes,he.attributes)):w.push(he).delete(K);break}P-=K}}),w.chop()}eachLine(p,h=`
`){const b=new o.default(this.ops);let w=new d,S=0;for(;b.hasNext();){if(b.peekType()!=="insert")return;const A=b.peek(),I=a.default.length(A)-b.peekLength(),O=typeof A.insert=="string"?A.insert.indexOf(h,I)-I:-1;if(O<0)w.push(b.next());else if(O>0)w.push(b.next(O));else{if(p(w,b.next(1).attributes||{},S)===!1)return;S+=1,w=new d}}w.length()>0&&p(w,{},S)}invert(p){const h=new d;return this.reduce((b,w)=>{if(w.insert)h.delete(a.default.length(w));else{if(typeof w.retain=="number"&&w.attributes==null)return h.retain(w.retain),b+w.retain;if(w.delete||typeof w.retain=="number"){const S=w.delete||w.retain;return p.slice(b,b+S).forEach(I=>{w.delete?h.push(I):w.retain&&w.attributes&&h.retain(a.default.length(I),s.default.invert(w.attributes,I.attributes))}),b+S}else if(typeof w.retain=="object"&&w.retain!==null){const S=p.slice(b,b+1),A=new o.default(S.ops).next(),[I,O,P]=c(w.retain,A.insert),K=d.getHandler(I);return h.retain({[I]:K.invert(O,P)},s.default.invert(w.attributes,A.attributes)),b+1}}return b},0),h.chop()}transform(p,h=!1){if(h=!!h,typeof p=="number")return this.transformPosition(p,h);const b=p,w=new o.default(this.ops),S=new o.default(b.ops),A=new d;for(;w.hasNext()||S.hasNext();)if(w.peekType()==="insert"&&(h||S.peekType()!=="insert"))A.retain(a.default.length(w.next()));else if(S.peekType()==="insert")A.push(S.next());else{const I=Math.min(w.peekLength(),S.peekLength()),O=w.next(I),P=S.next(I);if(O.delete)continue;if(P.delete)A.push(P);else{const K=O.retain,le=P.retain;let he=typeof le=="object"&&le!==null?le:I;if(typeof K=="object"&&K!==null&&typeof le=="object"&&le!==null){const ne=Object.keys(K)[0];if(ne===Object.keys(le)[0]){const V=d.getHandler(ne);V&&(he={[ne]:V.transform(K[ne],le[ne],h)})}}A.retain(he,s.default.transform(O.attributes,P.attributes,h))}}return A.chop()}transformPosition(p,h=!1){h=!!h;const b=new o.default(this.ops);let w=0;for(;b.hasNext()&&w<=p;){const S=b.peekLength(),A=b.peekType();if(b.next(),A==="delete"){p-=Math.min(S,p-w);continue}else A==="insert"&&(w<p||!h)&&(p+=S);w+=S}return p}}d.Op=a.default,d.OpIterator=o.default,d.AttributeMap=s.default,d.handlers={},e.default=d,n.exports=d,n.exports.default=d})(Uu,Uu.exports)),Uu.exports}var Bi=VE();const it=wb(Bi);class hs extends Ei{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}hs.blotName="break";hs.tagName="BR";let cs=class extends Ld{};const GE={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Jd(n){return n.replace(/[&<>"']/g,e=>GE[e])}const Ns=class Ns extends $p{static compare(e,t){const r=Ns.order.indexOf(e),i=Ns.order.indexOf(t);return r>=0||i>=0?r-i:e===t?0:e<t?-1:1}formatAt(e,t,r,i){if(Ns.compare(this.statics.blotName,r)<0&&this.scroll.query(r,ot.BLOT)){const s=this.isolate(e,t);i&&s.wrap(r,i)}else super.formatAt(e,t,r,i)}optimize(e){if(super.optimize(e),this.parent instanceof Ns&&Ns.compare(this.statics.blotName,this.parent.statics.blotName)>0){const t=this.parent.isolate(this.offset(),this.length());this.moveChildren(t),t.wrap(this)}}};Re(Ns,"allowedChildren",[Ns,hs,Ei,cs]),Re(Ns,"order",["cursor","inline","link","underline","strike","italic","bold","script","code"]);let Ds=Ns;const _1=1;class Er extends Wc{constructor(){super(...arguments);Re(this,"cache",{})}delta(){return this.cache.delta==null&&(this.cache.delta=Sb(this)),this.cache.delta}deleteAt(t,r){super.deleteAt(t,r),this.cache={}}formatAt(t,r,i,s){r<=0||(this.scroll.query(i,ot.BLOCK)?t+r===this.length()&&this.format(i,s):super.formatAt(t,Math.min(r,this.length()-t-1),i,s),this.cache={})}insertAt(t,r,i){if(i!=null){super.insertAt(t,r,i),this.cache={};return}if(r.length===0)return;const s=r.split(`
`),a=s.shift();a.length>0&&(t<this.length()-1||this.children.tail==null?super.insertAt(Math.min(t,this.length()-1),a):this.children.tail.insertAt(this.children.tail.length(),a),this.cache={});let o=this;s.reduce((l,c)=>(o=o.split(l,!0),o.insertAt(0,c),c.length),t+a.length)}insertBefore(t,r){const{head:i}=this.children;super.insertBefore(t,r),i instanceof hs&&i.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+_1),this.cache.length}moveChildren(t,r){super.moveChildren(t,r),this.cache={}}optimize(t){super.optimize(t),this.cache={}}path(t){return super.path(t,!0)}removeChild(t){super.removeChild(t),this.cache={}}split(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(r&&(t===0||t>=this.length()-_1)){const s=this.clone();return t===0?(this.parent.insertBefore(s,this),this):(this.parent.insertBefore(s,this.next),s)}const i=super.split(t,r);return this.cache={},i}}Er.blotName="block";Er.tagName="P";Er.defaultChild=hs;Er.allowedChildren=[hs,Ds,Ei,cs];class Di extends Ei{attach(){super.attach(),this.attributes=new Kd(this.domNode)}delta(){return new it().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,t){const r=this.scroll.query(e,ot.BLOCK_ATTRIBUTE);r!=null&&this.attributes.attribute(r,t)}formatAt(e,t,r,i){this.format(r,i)}insertAt(e,t,r){if(r!=null){super.insertAt(e,t,r);return}const i=t.split(`
`),s=i.pop(),a=i.map(l=>{const c=this.scroll.create(Er.blotName);return c.insertAt(0,l),c}),o=this.split(e);a.forEach(l=>{this.parent.insertBefore(l,o)}),s&&this.parent.insertBefore(this.scroll.create("text",s),o)}}Di.scope=ot.BLOCK_BLOT;function Sb(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return n.descendants(jr).reduce((t,r)=>r.length()===0?t:t.insert(r.value(),Ri(r,{},e)),new it).insert(`
`,Ri(n))}function Ri(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return n==null||("formats"in n&&typeof n.formats=="function"&&(e={...e,...n.formats()},t&&delete e["code-token"]),n.parent==null||n.parent.statics.blotName==="scroll"||n.parent.statics.scope!==n.statics.scope)?e:Ri(n.parent,e,t)}const Oi=class Oi extends Ei{static value(){}constructor(e,t,r){super(e,t),this.selection=r,this.textNode=document.createTextNode(Oi.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,t){if(this.savedLength!==0){super.format(e,t);return}let r=this,i=0;for(;r!=null&&r.statics.scope!==ot.BLOCK_BLOT;)i+=r.offset(r.parent),r=r.parent;r!=null&&(this.savedLength=Oi.CONTENTS.length,r.optimize(),r.formatAt(i,Oi.CONTENTS.length,e,t),this.savedLength=0)}index(e,t){return e===this.textNode?0:super.index(e,t)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const t=this.prev instanceof cs?this.prev:null,r=t?t.length():0,i=this.next instanceof cs?this.next:null,s=i?i.text:"",{textNode:a}=this,o=a.data.split(Oi.CONTENTS).join("");a.data=Oi.CONTENTS;let l;if(t)l=t,(o||i)&&(t.insertAt(t.length(),o+s),i&&i.remove());else if(i)l=i,i.insertAt(0,o);else{const c=document.createTextNode(o);l=this.scroll.create(c),this.parent.insertBefore(l,this)}if(this.remove(),e){const c=(p,h)=>t&&p===t.domNode?h:p===a?r+h-1:i&&p===i.domNode?r+o.length+h:null,d=c(e.start.node,e.start.offset),m=c(e.end.node,e.end.offset);if(d!==null&&m!==null)return{startNode:l.domNode,startOffset:d,endNode:l.domNode,endOffset:m}}return null}update(e,t){if(e.some(r=>r.type==="characterData"&&r.target===this.textNode)){const r=this.restore();r&&(t.range=r)}}optimize(e){super.optimize(e);let{parent:t}=this;for(;t;){if(t.domNode.tagName==="A"){this.savedLength=Oi.CONTENTS.length,t.isolate(this.offset(t),this.length()).unwrap(),this.savedLength=0;break}t=t.parent}}value(){return""}};Re(Oi,"blotName","cursor"),Re(Oi,"className","ql-cursor"),Re(Oi,"tagName","span"),Re(Oi,"CONTENTS","\uFEFF");let Nl=Oi;var $h={exports:{}},x1;function KE(){return x1||(x1=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function s(l,c,d,m,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var h=new i(d,m||l,p),b=t?t+c:c;return l._events[b]?l._events[b].fn?l._events[b]=[l._events[b],h]:l._events[b].push(h):(l._events[b]=h,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],d,m;if(this._eventsCount===0)return c;for(m in d=this._events)e.call(d,m)&&c.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},o.prototype.listeners=function(c){var d=t?t+c:c,m=this._events[d];if(!m)return[];if(m.fn)return[m.fn];for(var p=0,h=m.length,b=new Array(h);p<h;p++)b[p]=m[p].fn;return b},o.prototype.listenerCount=function(c){var d=t?t+c:c,m=this._events[d];return m?m.fn?1:m.length:0},o.prototype.emit=function(c,d,m,p,h,b){var w=t?t+c:c;if(!this._events[w])return!1;var S=this._events[w],A=arguments.length,I,O;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),A){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,m),!0;case 4:return S.fn.call(S.context,d,m,p),!0;case 5:return S.fn.call(S.context,d,m,p,h),!0;case 6:return S.fn.call(S.context,d,m,p,h,b),!0}for(O=1,I=new Array(A-1);O<A;O++)I[O-1]=arguments[O];S.fn.apply(S.context,I)}else{var P=S.length,K;for(O=0;O<P;O++)switch(S[O].once&&this.removeListener(c,S[O].fn,void 0,!0),A){case 1:S[O].fn.call(S[O].context);break;case 2:S[O].fn.call(S[O].context,d);break;case 3:S[O].fn.call(S[O].context,d,m);break;case 4:S[O].fn.call(S[O].context,d,m,p);break;default:if(!I)for(K=1,I=new Array(A-1);K<A;K++)I[K-1]=arguments[K];S[O].fn.apply(S[O].context,I)}}return!0},o.prototype.on=function(c,d,m){return s(this,c,d,m,!1)},o.prototype.once=function(c,d,m){return s(this,c,d,m,!0)},o.prototype.removeListener=function(c,d,m,p){var h=t?t+c:c;if(!this._events[h])return this;if(!d)return a(this,h),this;var b=this._events[h];if(b.fn)b.fn===d&&(!p||b.once)&&(!m||b.context===m)&&a(this,h);else{for(var w=0,S=[],A=b.length;w<A;w++)(b[w].fn!==d||p&&!b[w].once||m&&b[w].context!==m)&&S.push(b[w]);S.length?this._events[h]=S.length===1?S[0]:S:a(this,h)}return this},o.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&a(this,d)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})($h)),$h.exports}var YE=KE();const JE=wb(YE),Kf=new WeakMap,Yf=["error","warn","log","info"];let Jf="warn";function Eb(n){if(Jf&&Yf.indexOf(n)<=Yf.indexOf(Jf)){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];console[n](...t)}}function da(n){return Yf.reduce((e,t)=>(e[t]=Eb.bind(console,t,n),e),{})}da.level=n=>{Jf=n};Eb.level=da.level;const Mh=da("quill:events"),XE=["selectionchange","mousedown","mouseup","click"];XE.forEach(n=>{document.addEventListener(n,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Array.from(document.querySelectorAll(".ql-container")).forEach(i=>{const s=Kf.get(i);s&&s.emitter&&s.emitter.handleDOM(...t)})})});class Ge extends JE{constructor(){super(),this.domListeners={},this.on("error",Mh.error)}emit(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Mh.log.call(Mh,...t),super.emit(...t)}handleDOM(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];(this.domListeners[e.type]||[]).forEach(s=>{let{node:a,handler:o}=s;(e.target===a||a.contains(e.target))&&o(e,...r)})}listenDOM(e,t,r){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:t,handler:r})}}Re(Ge,"events",{EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"}),Re(Ge,"sources",{API:"api",SILENT:"silent",USER:"user"});const Fh=da("quill:selection");class ko{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=t}}class ZE{constructor(e,t){this.emitter=t,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new ko(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,Ge.sources.USER),1)}),this.emitter.on(Ge.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const r=this.getNativeRange();r!=null&&r.start.node!==this.cursor.textNode&&this.emitter.once(Ge.events.SCROLL_UPDATE,(i,s)=>{try{this.root.contains(r.start.node)&&this.root.contains(r.end.node)&&this.setNativeRange(r.start.node,r.start.offset,r.end.node,r.end.offset);const a=s.some(o=>o.type==="characterData"||o.type==="childList"||o.type==="attributes"&&o.target===this.root);this.update(a?Ge.sources.SILENT:i)}catch{}})}),this.emitter.on(Ge.events.SCROLL_OPTIMIZE,(r,i)=>{if(i.range){const{startNode:s,startOffset:a,endNode:o,endOffset:l}=i.range;this.setNativeRange(s,a,o,l),this.update(Ge.sources.SILENT)}}),this.update(Ge.sources.SILENT)}handleComposition(){this.emitter.on(Ge.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(Ge.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(Ge.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,t){this.scroll.update();const r=this.getNativeRange();if(!(r==null||!r.native.collapsed||this.scroll.query(e,ot.BLOCK))){if(r.start.node!==this.cursor.textNode){const i=this.scroll.find(r.start.node,!1);if(i==null)return;if(i instanceof jr){const s=i.split(r.start.offset);i.parent.insertBefore(this.cursor,s)}else i.insertBefore(this.cursor,r.start.node);this.cursor.attach()}this.cursor.format(e,t),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=this.scroll.length();e=Math.min(e,r-1),t=Math.min(e+t,r-1)-e;let i,[s,a]=this.scroll.leaf(e);if(s==null)return null;if(t>0&&a===s.length()){const[d]=this.scroll.leaf(e+1);if(d){const[m]=this.scroll.line(e),[p]=this.scroll.line(e+1);m===p&&(s=d,a=0)}}[i,a]=s.position(a,!0);const o=document.createRange();if(t>0)return o.setStart(i,a),[s,a]=this.scroll.leaf(e+t),s==null?null:([i,a]=s.position(a,!0),o.setEnd(i,a),o.getBoundingClientRect());let l="left",c;if(i instanceof Text){if(!i.data.length)return null;a<i.data.length?(o.setStart(i,a),o.setEnd(i,a+1)):(o.setStart(i,a-1),o.setEnd(i,a),l="right"),c=o.getBoundingClientRect()}else{if(!(s.domNode instanceof Element))return null;c=s.domNode.getBoundingClientRect(),a>0&&(l="right")}return{bottom:c.top+c.height,height:c.height,left:c[l],right:c[l],top:c.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const t=e.getRangeAt(0);if(t==null)return null;const r=this.normalizeNative(t);return Fh.info("getNativeRange",r),r}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const t=this.getNativeRange();return t==null?[null,null]:[this.normalizedToRange(t),t]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&Uh(this.root,document.activeElement)}normalizedToRange(e){const t=[[e.start.node,e.start.offset]];e.native.collapsed||t.push([e.end.node,e.end.offset]);const r=t.map(a=>{const[o,l]=a,c=this.scroll.find(o,!0),d=c.offset(this.scroll);return l===0?d:c instanceof jr?d+c.index(o,l):d+c.length()}),i=Math.min(Math.max(...r),this.scroll.length()-1),s=Math.min(i,...r);return new ko(s,i-s)}normalizeNative(e){if(!Uh(this.root,e.startContainer)||!e.collapsed&&!Uh(this.root,e.endContainer))return null;const t={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[t.start,t.end].forEach(r=>{let{node:i,offset:s}=r;for(;!(i instanceof Text)&&i.childNodes.length>0;)if(i.childNodes.length>s)i=i.childNodes[s],s=0;else if(i.childNodes.length===s)i=i.lastChild,i instanceof Text?s=i.data.length:i.childNodes.length>0?s=i.childNodes.length:s=i.childNodes.length+1;else break;r.node=i,r.offset=s}),t}rangeToNative(e){const t=this.scroll.length(),r=(i,s)=>{i=Math.min(t-1,i);const[a,o]=this.scroll.leaf(i);return a?a.position(o,s):[null,-1]};return[...r(e.index,!1),...r(e.index+e.length,!0)]}setNativeRange(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:t,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(Fh.info("setNativeRange",e,t,r,i),e!=null&&(this.root.parentNode==null||e.parentNode==null||r.parentNode==null))return;const a=document.getSelection();if(a!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:o}=this.getNativeRange()||{};if(o==null||s||e!==o.startContainer||t!==o.startOffset||r!==o.endContainer||i!==o.endOffset){e instanceof Element&&e.tagName==="BR"&&(t=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),r instanceof Element&&r.tagName==="BR"&&(i=Array.from(r.parentNode.childNodes).indexOf(r),r=r.parentNode);const l=document.createRange();l.setStart(e,t),l.setEnd(r,i),a.removeAllRanges(),a.addRange(l)}}else a.removeAllRanges(),this.root.blur()}setRange(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ge.sources.API;if(typeof t=="string"&&(r=t,t=!1),Fh.info("setRange",e),e!=null){const i=this.rangeToNative(e);this.setNativeRange(...i,t)}else this.setNativeRange(null);this.update(r)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ge.sources.USER;const t=this.lastRange,[r,i]=this.getRange();if(this.lastRange=r,this.lastNative=i,this.lastRange!=null&&(this.savedRange=this.lastRange),!jp(t,this.lastRange)){if(!this.composing&&i!=null&&i.native.collapsed&&i.start.node!==this.cursor.textNode){const a=this.cursor.restore();a&&this.setNativeRange(a.startNode,a.startOffset,a.endNode,a.endOffset)}const s=[Ge.events.SELECTION_CHANGE,vl(this.lastRange),vl(t),e];this.emitter.emit(Ge.events.EDITOR_CHANGE,...s),e!==Ge.sources.SILENT&&this.emitter.emit(...s)}}}function Uh(n,e){try{e.parentNode}catch{return!1}return n.contains(e)}const QE=/^[ -~]*$/;class eN{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let t=this.scroll.length();this.scroll.batchStart();const r=A1(e),i=new it;return nN(r.ops.slice()).reduce((a,o)=>{const l=Bi.Op.length(o);let c=o.attributes||{},d=!1,m=!1;if(o.insert!=null){if(i.retain(l),typeof o.insert=="string"){const b=o.insert;m=!b.endsWith(`
`)&&(t<=a||!!this.scroll.descendant(Di,a)[0]),this.scroll.insertAt(a,b);const[w,S]=this.scroll.line(a);let A=za({},Ri(w));if(w instanceof Er){const[I]=w.descendant(jr,S);I&&(A=za(A,Ri(I)))}c=Bi.AttributeMap.diff(A,c)||{}}else if(typeof o.insert=="object"){const b=Object.keys(o.insert)[0];if(b==null)return a;const w=this.scroll.query(b,ot.INLINE)!=null;if(w)(t<=a||this.scroll.descendant(Di,a)[0])&&(m=!0);else if(a>0){const[S,A]=this.scroll.descendant(jr,a-1);S instanceof cs?S.value()[A]!==`
`&&(d=!0):S instanceof Ei&&S.statics.scope===ot.INLINE_BLOT&&(d=!0)}if(this.scroll.insertAt(a,b,o.insert[b]),w){const[S]=this.scroll.descendant(jr,a);if(S){const A=za({},Ri(S));c=Bi.AttributeMap.diff(A,c)||{}}}}t+=l}else if(i.push(o),o.retain!==null&&typeof o.retain=="object"){const b=Object.keys(o.retain)[0];if(b==null)return a;this.scroll.updateEmbedAt(a,b,o.retain[b])}Object.keys(c).forEach(b=>{this.scroll.formatAt(a,l,b,c[b])});const p=d?1:0,h=m?1:0;return t+=p+h,i.retain(p),i.delete(h),a+l+p+h},0),i.reduce((a,o)=>typeof o.delete=="number"?(this.scroll.deleteAt(a,o.delete),a):a+Bi.Op.length(o),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(r)}deleteText(e,t){return this.scroll.deleteAt(e,t),this.update(new it().retain(e).delete(t))}formatLine(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(r).forEach(s=>{this.scroll.lines(e,Math.max(t,1)).forEach(a=>{a.format(s,r[s])})}),this.scroll.optimize();const i=new it().retain(e).retain(t,vl(r));return this.update(i)}formatText(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(r).forEach(s=>{this.scroll.formatAt(e,t,s,r[s])});const i=new it().retain(e).retain(t,vl(r));return this.update(i)}getContents(e,t){return this.delta.slice(e,e+t)}getDelta(){return this.scroll.lines().reduce((e,t)=>e.concat(t.delta()),new it)}getFormat(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=[],i=[];t===0?this.scroll.path(e).forEach(o=>{const[l]=o;l instanceof Er?r.push(l):l instanceof jr&&i.push(l)}):(r=this.scroll.lines(e,t),i=this.scroll.descendants(jr,e,t));const[s,a]=[r,i].map(o=>{const l=o.shift();if(l==null)return{};let c=Ri(l);for(;Object.keys(c).length>0;){const d=o.shift();if(d==null)return c;c=tN(Ri(d),c)}return c});return{...s,...a}}getHTML(e,t){const[r,i]=this.scroll.line(e);if(r){const s=r.length();return r.length()>=i+t&&!(i===0&&t===s)?Vc(r,i,t,!0):Vc(this.scroll,e,t,!0)}return""}getText(e,t){return this.getContents(e,t).filter(r=>typeof r.insert=="string").map(r=>r.insert).join("")}insertContents(e,t){const r=A1(t),i=new it().retain(e).concat(r);return this.scroll.insertContents(e,r),this.update(i)}insertEmbed(e,t,r){return this.scroll.insertAt(e,t,r),this.update(new it().retain(e).insert({[t]:r}))}insertText(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,t),Object.keys(r).forEach(i=>{this.scroll.formatAt(e,t.length,i,r[i])}),this.update(new it().retain(e).insert(t,vl(r)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if((e==null?void 0:e.statics.blotName)!==Er.blotName)return!1;const t=e;return t.children.length>1?!1:t.children.head instanceof hs}removeFormat(e,t){const r=this.getText(e,t),[i,s]=this.scroll.line(e+t);let a=0,o=new it;i!=null&&(a=i.length()-s,o=i.delta().slice(s,s+a-1).insert(`
`));const c=this.getContents(e,t+a).diff(new it().insert(r).concat(o)),d=new it().retain(e).concat(c);return this.applyDelta(d)}update(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const i=this.delta;if(t.length===1&&t[0].type==="characterData"&&t[0].target.data.match(QE)&&this.scroll.find(t[0].target)){const s=this.scroll.find(t[0].target),a=Ri(s),o=s.offset(this.scroll),l=t[0].oldValue.replace(Nl.CONTENTS,""),c=new it().insert(l),d=new it().insert(s.value()),m=r&&{oldRange:S1(r.oldRange,-o),newRange:S1(r.newRange,-o)};e=new it().retain(o).concat(c.diff(d,m)).reduce((h,b)=>b.insert?h.insert(b.insert,a):h.push(b),new it),this.delta=i.compose(e)}else this.delta=this.getDelta(),(!e||!jp(i.compose(e),this.delta))&&(e=i.diff(this.delta,r));return e}}function cl(n,e,t){if(n.length===0){const[h]=zh(t.pop());return e<=0?`</li></${h}>`:`</li></${h}>${cl([],e-1,t)}`}const[{child:r,offset:i,length:s,indent:a,type:o},...l]=n,[c,d]=zh(o);if(a>e)return t.push(o),a===e+1?`<${c}><li${d}>${Vc(r,i,s)}${cl(l,a,t)}`:`<${c}><li>${cl(n,e+1,t)}`;const m=t[t.length-1];if(a===e&&o===m)return`</li><li${d}>${Vc(r,i,s)}${cl(l,a,t)}`;const[p]=zh(t.pop());return`</li></${p}>${cl(n,e-1,t)}`}function Vc(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in n&&typeof n.html=="function")return n.html(e,t);if(n instanceof cs)return Jd(n.value().slice(e,e+t)).replaceAll(" ","&nbsp;");if(n instanceof ls){if(n.statics.blotName==="list-container"){const c=[];return n.children.forEachAt(e,t,(d,m,p)=>{const h="formats"in d&&typeof d.formats=="function"?d.formats():{};c.push({child:d,offset:m,length:p,indent:h.indent||0,type:h.list})}),cl(c,-1,[])}const i=[];if(n.children.forEachAt(e,t,(c,d,m)=>{i.push(Vc(c,d,m))}),r||n.statics.blotName==="list")return i.join("");const{outerHTML:s,innerHTML:a}=n.domNode,[o,l]=s.split(`>${a}<`);return o==="<table"?`<table style="border: 1px solid #000;">${i.join("")}<${l}`:`${o}>${i.join("")}<${l}`}return n.domNode instanceof Element?n.domNode.outerHTML:""}function tN(n,e){return Object.keys(e).reduce((t,r)=>{if(n[r]==null)return t;const i=e[r];return i===n[r]?t[r]=i:Array.isArray(i)?i.indexOf(n[r])<0?t[r]=i.concat([n[r]]):t[r]=i:t[r]=[i,n[r]],t},{})}function zh(n){const e=n==="ordered"?"ol":"ul";switch(n){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function A1(n){return n.reduce((e,t)=>{if(typeof t.insert=="string"){const r=t.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(r,t.attributes)}return e.push(t)},new it)}function S1(n,e){let{index:t,length:r}=n;return new ko(t+e,r)}function nN(n){const e=[];return n.forEach(t=>{typeof t.insert=="string"?t.insert.split(`
`).forEach((i,s)=>{s&&e.push({insert:`
`,attributes:t.attributes}),i&&e.push({insert:i,attributes:t.attributes})}):e.push(t)}),e}class fs{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=t}}Re(fs,"DEFAULTS",{});const Vu="\uFEFF";class Fp extends Ei{constructor(e,t){super(e,t),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(r=>{this.contentNode.appendChild(r)}),this.leftGuard=document.createTextNode(Vu),this.rightGuard=document.createTextNode(Vu),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,t){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,t)}restore(e){let t=null,r;const i=e.data.split(Vu).join("");if(e===this.leftGuard)if(this.prev instanceof cs){const s=this.prev.length();this.prev.insertAt(s,i),t={startNode:this.prev.domNode,startOffset:s+i.length}}else r=document.createTextNode(i),this.parent.insertBefore(this.scroll.create(r),this),t={startNode:r,startOffset:i.length};else e===this.rightGuard&&(this.next instanceof cs?(this.next.insertAt(0,i),t={startNode:this.next.domNode,startOffset:i.length}):(r=document.createTextNode(i),this.parent.insertBefore(this.scroll.create(r),this.next),t={startNode:r,startOffset:i.length}));return e.data=Vu,t}update(e,t){e.forEach(r=>{if(r.type==="characterData"&&(r.target===this.leftGuard||r.target===this.rightGuard)){const i=this.restore(r.target);i&&(t.range=i)}})}}class rN{constructor(e,t){Re(this,"isComposing",!1);this.scroll=e,this.emitter=t,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const t=e.target instanceof Node?this.scroll.find(e.target,!0):null;t&&!(t instanceof Fp)&&(this.emitter.emit(Ge.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(Ge.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(Ge.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(Ge.events.COMPOSITION_END,e),this.isComposing=!1}}const Oc=class Oc{constructor(e,t){Re(this,"modules",{});this.quill=e,this.options=t}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const t=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new t(this.quill,this.options.modules[e]||{}),this.modules[e]}};Re(Oc,"DEFAULTS",{modules:{}}),Re(Oc,"themes",{default:Oc});let kl=Oc;const iN=n=>n.parentElement||n.getRootNode().host||null,sN=n=>{const e=n.getBoundingClientRect(),t="offsetWidth"in n&&Math.abs(e.width)/n.offsetWidth||1,r="offsetHeight"in n&&Math.abs(e.height)/n.offsetHeight||1;return{top:e.top,right:e.left+n.clientWidth*t,bottom:e.top+n.clientHeight*r,left:e.left}},Gu=n=>{const e=parseInt(n,10);return Number.isNaN(e)?0:e},E1=(n,e,t,r,i,s)=>n<t&&e>r?0:n<t?-(t-n+i):e>r?e-n>r-t?n+i-t:e-r+s:0,aN=(n,e)=>{var s,a,o;const t=n.ownerDocument;let r=e,i=n;for(;i;){const l=i===t.body,c=l?{top:0,right:((s=window.visualViewport)==null?void 0:s.width)??t.documentElement.clientWidth,bottom:((a=window.visualViewport)==null?void 0:a.height)??t.documentElement.clientHeight,left:0}:sN(i),d=getComputedStyle(i),m=E1(r.left,r.right,c.left,c.right,Gu(d.scrollPaddingLeft),Gu(d.scrollPaddingRight)),p=E1(r.top,r.bottom,c.top,c.bottom,Gu(d.scrollPaddingTop),Gu(d.scrollPaddingBottom));if(m||p)if(l)(o=t.defaultView)==null||o.scrollBy(m,p);else{const{scrollLeft:h,scrollTop:b}=i;p&&(i.scrollTop+=p),m&&(i.scrollLeft+=m);const w=i.scrollLeft-h,S=i.scrollTop-b;r={left:r.left-w,top:r.top-S,right:r.right-w,bottom:r.bottom-S}}i=l||d.position==="fixed"?null:iN(i)}},oN=100,lN=["block","break","cursor","inline","scroll","text"],cN=(n,e,t)=>{const r=new El;return lN.forEach(i=>{const s=e.query(i);s&&r.register(s)}),n.forEach(i=>{let s=e.query(i);s||t.error(`Cannot register "${i}" specified in "formats" config. Are you sure it was registered?`);let a=0;for(;s;)if(r.register(s),s="blotName"in s?s.requiredContainer??null:null,a+=1,a>oN){t.error(`Cycle detected in registering blot requiredContainer: "${i}"`);break}}),r},yl=da("quill"),Ku=new El;ls.uiClass="ql-ui";const Qi=class Qi{static debug(e){e===!0&&(e="log"),da.level(e)}static find(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return Kf.get(e)||Ku.find(e,t)}static import(e){return this.imports[e]==null&&yl.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],t=!!(!(arguments.length<=1)&&arguments[1]),r="attrName"in e?e.attrName:e.blotName;typeof r=="string"?this.register(`formats/${r}`,e,t):Object.keys(e).forEach(i=>{this.register(i,e[i],t)})}else{const e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],r=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!r&&yl.warn(`Overwriting ${e} with`,t),this.imports[e]=t,(e.startsWith("blots/")||e.startsWith("formats/"))&&t&&typeof t!="boolean"&&t.blotName!=="abstract"&&Ku.register(t),typeof t.register=="function"&&t.register(Ku)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=uN(e,t),this.container=this.options.container,this.container==null){yl.error("Invalid Quill container",e);return}this.options.debug&&Qi.debug(this.options.debug);const r=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",Kf.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new Ge;const i=Mp.blotName,s=this.options.registry.query(i);if(!s||!("blotName"in s))throw new Error(`Cannot initialize Quill without "${i}" blot`);if(this.scroll=new s(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new eN(this.scroll),this.selection=new ZE(this.scroll,this.emitter),this.composition=new rN(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(Ge.events.EDITOR_CHANGE,a=>{a===Ge.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(Ge.events.SCROLL_UPDATE,(a,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),d=l&&c?{oldRange:l,newRange:c}:void 0;Yi.call(this,()=>this.editor.update(null,o,d),a)}),this.emitter.on(Ge.events.SCROLL_EMBED_UPDATE,(a,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),d=l&&c?{oldRange:l,newRange:c}:void 0;Yi.call(this,()=>{const m=new it().retain(a.offset(this)).retain({[a.statics.blotName]:o});return this.editor.update(m,[],d)},Qi.sources.USER)}),r){const a=this.clipboard.convert({html:`${r}<p><br></p>`,text:`
`});this.setContents(a)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const r=e;e=document.createElement("div"),e.classList.add(r)}return this.container.insertBefore(e,t),e}blur(){this.selection.setRange(null)}deleteText(e,t,r){return[e,t,,r]=Xs(e,t,r),Yi.call(this,()=>this.editor.deleteText(e,t),r,e,-1*t)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const t=e();return this.allowReadOnlyEdits=!1,t}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ge.sources.API;return Yi.call(this,()=>{const i=this.getSelection(!0);let s=new it;if(i==null)return s;if(this.scroll.query(e,ot.BLOCK))s=this.editor.formatLine(i.index,i.length,{[e]:t});else{if(i.length===0)return this.selection.format(e,t),s;s=this.editor.formatText(i.index,i.length,{[e]:t})}return this.setSelection(i,Ge.sources.SILENT),s},r)}formatLine(e,t,r,i,s){let a;return[e,t,a,s]=Xs(e,t,r,i,s),Yi.call(this,()=>this.editor.formatLine(e,t,a),s,e,0)}formatText(e,t,r,i,s){let a;return[e,t,a,s]=Xs(e,t,r,i,s),Yi.call(this,()=>this.editor.formatText(e,t,a),s,e,0)}getBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=null;if(typeof e=="number"?r=this.selection.getBounds(e,t):r=this.selection.getBounds(e.index,e.length),!r)return null;const i=this.container.getBoundingClientRect();return{bottom:r.bottom-i.top,height:r.height,left:r.left-i.left,right:r.right-i.left,top:r.top-i.top,width:r.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,t]=Xs(e,t),this.editor.getContents(e,t)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,t):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,t)}getModule(e){return this.theme.modules[e]}getSelection(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(t=t??this.getLength()-e),[e,t]=Xs(e,t),this.editor.getHTML(e,t)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(t=t??this.getLength()-e),[e,t]=Xs(e,t),this.editor.getText(e,t)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Qi.sources.API;return Yi.call(this,()=>this.editor.insertEmbed(e,t,r),i,e)}insertText(e,t,r,i,s){let a;return[e,,a,s]=Xs(e,0,r,i,s),Yi.call(this,()=>this.editor.insertText(e,t,a),s,e,t.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,t,r){return[e,t,,r]=Xs(e,t,r),Yi.call(this,()=>this.editor.removeFormat(e,t),r,e)}scrollRectIntoView(e){aN(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,t=e&&this.selection.getBounds(e.index,e.length);t&&this.scrollRectIntoView(t)}setContents(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge.sources.API;return Yi.call(this,()=>{e=new it(e);const r=this.getLength(),i=this.editor.deleteText(0,r),s=this.editor.insertContents(0,e),a=this.editor.deleteText(this.getLength()-1,1);return i.compose(s).compose(a)},t)}setSelection(e,t,r){e==null?this.selection.setRange(null,t||Qi.sources.API):([e,t,,r]=Xs(e,t,r),this.selection.setRange(new ko(Math.max(0,e),t),r),r!==Ge.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge.sources.API;const r=new it().insert(e);return this.setContents(r,t)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ge.sources.USER;const t=this.scroll.update(e);return this.selection.update(e),t}updateContents(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge.sources.API;return Yi.call(this,()=>(e=new it(e),this.editor.applyDelta(e)),t,!0)}};Re(Qi,"DEFAULTS",{bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:Ku,theme:"default"}),Re(Qi,"events",Ge.events),Re(Qi,"sources",Ge.sources),Re(Qi,"version","2.0.3"),Re(Qi,"imports",{delta:it,parchment:UE,"core/module":fs,"core/theme":kl});let Ne=Qi;function N1(n){return typeof n=="string"?document.querySelector(n):n}function Hh(n){return Object.entries(n??{}).reduce((e,t)=>{let[r,i]=t;return{...e,[r]:i===!0?{}:i}},{})}function k1(n){return Object.fromEntries(Object.entries(n).filter(e=>e[1]!==void 0))}function uN(n,e){const t=N1(n);if(!t)throw new Error("Invalid Quill container");const i=!e.theme||e.theme===Ne.DEFAULTS.theme?kl:Ne.import(`themes/${e.theme}`);if(!i)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:s,...a}=Ne.DEFAULTS,{modules:o,...l}=i.DEFAULTS;let c=Hh(e.modules);c!=null&&c.toolbar&&c.toolbar.constructor!==Object&&(c={...c,toolbar:{container:c.toolbar}});const d=za({},Hh(s),Hh(o),c),m={...a,...k1(l),...k1(e)};let p=e.registry;return p?e.formats&&yl.warn('Ignoring "formats" option because "registry" is specified'):p=e.formats?cN(e.formats,m.registry,yl):m.registry,{...m,registry:p,container:t,theme:i,modules:Object.entries(d).reduce((h,b)=>{let[w,S]=b;if(!S)return h;const A=Ne.import(`modules/${w}`);return A==null?(yl.error(`Cannot load ${w} module. Are you sure you registered it?`),h):{...h,[w]:za({},A.DEFAULTS||{},S)}},{}),bounds:N1(m.bounds)}}function Yi(n,e,t,r){if(!this.isEnabled()&&e===Ge.sources.USER&&!this.allowReadOnlyEdits)return new it;let i=t==null?null:this.getSelection();const s=this.editor.delta,a=n();if(i!=null&&(t===!0&&(t=i.index),r==null?i=L1(i,a,e):r!==0&&(i=L1(i,t,r,e)),this.setSelection(i,Ge.sources.SILENT)),a.length()>0){const o=[Ge.events.TEXT_CHANGE,a,s,e];this.emitter.emit(Ge.events.EDITOR_CHANGE,...o),e!==Ge.sources.SILENT&&this.emitter.emit(...o)}return a}function Xs(n,e,t,r,i){let s={};return typeof n.index=="number"&&typeof n.length=="number"?typeof e!="number"?(i=r,r=t,t=e,e=n.length,n=n.index):(e=n.length,n=n.index):typeof e!="number"&&(i=r,r=t,t=e,e=0),typeof t=="object"?(s=t,i=r):typeof t=="string"&&(r!=null?s[t]=r:i=t),i=i||Ge.sources.API,[n,e,s,i]}function L1(n,e,t,r){const i=typeof t=="number"?t:0;if(n==null)return null;let s,a;return e&&typeof e.transformPosition=="function"?[s,a]=[n.index,n.index+n.length].map(o=>e.transformPosition(o,r!==Ge.sources.USER)):[s,a]=[n.index,n.index+n.length].map(o=>o<e||o===e&&r===Ge.sources.USER?o:i>=0?o+i:Math.max(e,o+i)),new ko(s,a-s)}class jo extends Yd{}function T1(n){return n instanceof Er||n instanceof Di}function C1(n){return typeof n.updateContent=="function"}class ul extends Mp{constructor(e,t,r){let{emitter:i}=r;super(e,t),this.emitter=i,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",s=>this.handleDragStart(s))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(Ge.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(Ge.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,t){this.emitter.emit(Ge.events.SCROLL_EMBED_UPDATE,e,t)}deleteAt(e,t){const[r,i]=this.line(e),[s]=this.line(e+t);if(super.deleteAt(e,t),s!=null&&r!==s&&i>0){if(r instanceof Di||s instanceof Di){this.optimize();return}const a=s.children.head instanceof hs?null:s.children.head;r.moveChildren(s,a),r.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,t,r,i){super.formatAt(e,t,r,i),this.optimize()}insertAt(e,t,r){if(e>=this.length())if(r==null||this.scroll.query(t,ot.BLOCK)==null){const i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i),r==null&&t.endsWith(`
`)?i.insertAt(0,t.slice(0,-1),r):i.insertAt(0,t,r)}else{const i=this.scroll.create(t,r);this.appendChild(i)}else super.insertAt(e,t,r);this.optimize()}insertBefore(e,t){if(e.statics.scope===ot.INLINE_BLOT){const r=this.scroll.create(this.statics.defaultChild.blotName);r.appendChild(e),super.insertBefore(r,t)}else super.insertBefore(e,t)}insertContents(e,t){const r=this.deltaToRenderBlocks(t.concat(new it().insert(`
`))),i=r.pop();if(i==null)return;this.batchStart();const s=r.shift();if(s){const l=s.type==="block"&&(s.delta.length()===0||!this.descendant(Di,e)[0]&&e<this.length()),c=s.type==="block"?s.delta:new it().insert({[s.key]:s.value});Wh(this,e,c);const d=s.type==="block"?1:0,m=e+c.length()+d;l&&this.insertAt(m-1,`
`);const p=Ri(this.line(e)[0]),h=Bi.AttributeMap.diff(p,s.attributes)||{};Object.keys(h).forEach(b=>{this.formatAt(m-1,1,b,h[b])}),e=m}let[a,o]=this.children.find(e);if(r.length&&(a&&(a=a.split(o),o=0),r.forEach(l=>{if(l.type==="block"){const c=this.createBlock(l.attributes,a||void 0);Wh(c,0,l.delta)}else{const c=this.create(l.key,l.value);this.insertBefore(c,a||void 0),Object.keys(l.attributes).forEach(d=>{c.format(d,l.attributes[d])})}})),i.type==="block"&&i.delta.length()){const l=a?a.offset(a.scroll)+o:this.length();Wh(this,l,i.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const t=this.path(e).pop();if(!t)return[null,-1];const[r,i]=t;return r instanceof jr?[r,i]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(T1,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const r=(i,s,a)=>{let o=[],l=a;return i.children.forEachAt(s,a,(c,d,m)=>{T1(c)?o.push(c):c instanceof Yd&&(o=o.concat(r(c,d,l))),l-=m}),o};return r(this,e,t)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,t),e.length>0&&this.emitter.emit(Ge.events.SCROLL_OPTIMIZE,e,t))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let t=Ge.sources.USER;typeof e=="string"&&(t=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(r=>{let{target:i}=r;const s=this.find(i,!0);return s&&!C1(s)}),e.length>0&&this.emitter.emit(Ge.events.SCROLL_BEFORE_UPDATE,t,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(Ge.events.SCROLL_UPDATE,t,e)}updateEmbedAt(e,t,r){const[i]=this.descendant(s=>s instanceof Di,e);i&&i.statics.blotName===t&&C1(i)&&i.updateContent(r)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const t=[];let r=new it;return e.forEach(i=>{const s=i==null?void 0:i.insert;if(s)if(typeof s=="string"){const a=s.split(`
`);a.slice(0,-1).forEach(l=>{r.insert(l,i.attributes),t.push({type:"block",delta:r,attributes:i.attributes??{}}),r=new it});const o=a[a.length-1];o&&r.insert(o,i.attributes)}else{const a=Object.keys(s)[0];if(!a)return;this.query(a,ot.INLINE)?r.push(i):(r.length()&&t.push({type:"block",delta:r,attributes:{}}),r=new it,t.push({type:"blockEmbed",key:a,value:s[a],attributes:i.attributes??{}}))}}),r.length()&&t.push({type:"block",delta:r,attributes:{}}),t}createBlock(e,t){let r;const i={};Object.entries(e).forEach(o=>{let[l,c]=o;this.query(l,ot.BLOCK&ot.BLOT)!=null?r=l:i[l]=c});const s=this.create(r||this.statics.defaultChild.blotName,r?e[r]:void 0);this.insertBefore(s,t||void 0);const a=s.length();return Object.entries(i).forEach(o=>{let[l,c]=o;s.formatAt(0,a,l,c)}),s}}Re(ul,"blotName","scroll"),Re(ul,"className","ql-editor"),Re(ul,"tagName","DIV"),Re(ul,"defaultChild",Er),Re(ul,"allowedChildren",[Er,Di,jo]);function Wh(n,e,t){t.reduce((r,i)=>{const s=Bi.Op.length(i);let a=i.attributes||{};if(i.insert!=null){if(typeof i.insert=="string"){const o=i.insert;n.insertAt(r,o);const[l]=n.descendant(jr,r),c=Ri(l);a=Bi.AttributeMap.diff(c,a)||{}}else if(typeof i.insert=="object"){const o=Object.keys(i.insert)[0];if(o==null)return r;if(n.insertAt(r,o,i.insert[o]),n.scroll.query(o,ot.INLINE)!=null){const[c]=n.descendant(jr,r),d=Ri(c);a=Bi.AttributeMap.diff(d,a)||{}}}}return Object.keys(a).forEach(o=>{n.formatAt(r,s,o,a[o])}),r+s},e)}const Up={scope:ot.BLOCK,whitelist:["right","center","justify"]},dN=new Ps("align","align",Up),Nb=new ds("align","ql-align",Up),kb=new Ka("align","text-align",Up);class Lb extends Ka{value(e){let t=super.value(e);return t.startsWith("rgb(")?(t=t.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${t.split(",").map(i=>`00${parseInt(i,10).toString(16)}`.slice(-2)).join("")}`):t}}const hN=new ds("color","ql-color",{scope:ot.INLINE}),zp=new Lb("color","color",{scope:ot.INLINE}),fN=new ds("background","ql-bg",{scope:ot.INLINE}),Hp=new Lb("background","background-color",{scope:ot.INLINE});class $o extends jo{static create(e){const t=super.create(e);return t.setAttribute("spellcheck","false"),t}code(e,t){return this.children.map(r=>r.length()<=1?"":r.domNode.innerText).join(`
`).slice(e,e+t)}html(e,t){return`<pre>
${Jd(this.code(e,t))}
</pre>`}}class $r extends Er{static register(){Ne.register($o)}}Re($r,"TAB","  ");class Wp extends Ds{}Wp.blotName="code";Wp.tagName="CODE";$r.blotName="code-block";$r.className="ql-code-block";$r.tagName="DIV";$o.blotName="code-block-container";$o.className="ql-code-block-container";$o.tagName="DIV";$o.allowedChildren=[$r];$r.allowedChildren=[cs,hs,Nl];$r.requiredContainer=$o;const Vp={scope:ot.BLOCK,whitelist:["rtl"]},Tb=new Ps("direction","dir",Vp),Cb=new ds("direction","ql-direction",Vp),Ib=new Ka("direction","direction",Vp),Ob={scope:ot.INLINE,whitelist:["serif","monospace"]},Rb=new ds("font","ql-font",Ob);class pN extends Ka{value(e){return super.value(e).replace(/["']/g,"")}}const Pb=new pN("font","font-family",Ob),Db=new ds("size","ql-size",{scope:ot.INLINE,whitelist:["small","large","huge"]}),Bb=new Ka("size","font-size",{scope:ot.INLINE,whitelist:["10px","18px","32px"]}),mN=da("quill:keyboard"),gN=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class Xd extends fs{static match(e,t){return["altKey","ctrlKey","metaKey","shiftKey"].some(r=>!!t[r]!==e[r]&&t[r]!==null)?!1:t.key===e.key||t.key===e.which}constructor(e,t){super(e,t),this.bindings={},Object.keys(this.options.bindings).forEach(r=>{this.options.bindings[r]&&this.addBinding(this.options.bindings[r])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=bN(e);if(i==null){mN.warn("Attempted to add invalid keyboard binding",i);return}typeof t=="function"&&(t={handler:t}),typeof r=="function"&&(r={handler:r}),(Array.isArray(i.key)?i.key:[i.key]).forEach(a=>{const o={...i,key:a,...t,...r};this.bindings[o.key]=this.bindings[o.key]||[],this.bindings[o.key].push(o)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const i=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(A=>Xd.match(e,A));if(i.length===0)return;const s=Ne.find(e.target,!0);if(s&&s.scroll!==this.quill.scroll)return;const a=this.quill.getSelection();if(a==null||!this.quill.hasFocus())return;const[o,l]=this.quill.getLine(a.index),[c,d]=this.quill.getLeaf(a.index),[m,p]=a.length===0?[c,d]:this.quill.getLeaf(a.index+a.length),h=c instanceof Ld?c.value().slice(0,d):"",b=m instanceof Ld?m.value().slice(p):"",w={collapsed:a.length===0,empty:a.length===0&&o.length()<=1,format:this.quill.getFormat(a),line:o,offset:l,prefix:h,suffix:b,event:e};i.some(A=>{if(A.collapsed!=null&&A.collapsed!==w.collapsed||A.empty!=null&&A.empty!==w.empty||A.offset!=null&&A.offset!==w.offset)return!1;if(Array.isArray(A.format)){if(A.format.every(I=>w.format[I]==null))return!1}else if(typeof A.format=="object"&&!Object.keys(A.format).every(I=>A.format[I]===!0?w.format[I]!=null:A.format[I]===!1?w.format[I]==null:jp(A.format[I],w.format[I])))return!1;return A.prefix!=null&&!A.prefix.test(w.prefix)||A.suffix!=null&&!A.suffix.test(w.suffix)?!1:A.handler.call(this,a,w,A)!==!0})&&e.preventDefault()})}handleBackspace(e,t){const r=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(t.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let i={};const[s]=this.quill.getLine(e.index);let a=new it().retain(e.index-r).delete(r);if(t.offset===0){const[o]=this.quill.getLine(e.index-1);if(o&&!(o.statics.blotName==="block"&&o.length()<=1)){const c=s.formats(),d=this.quill.getFormat(e.index-1,1);if(i=Bi.AttributeMap.diff(c,d)||{},Object.keys(i).length>0){const m=new it().retain(e.index+s.length()-2).retain(1,i);a=a.compose(m)}}}this.quill.updateContents(a,Ne.sources.USER),this.quill.focus()}handleDelete(e,t){const r=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(t.suffix)?2:1;if(e.index>=this.quill.getLength()-r)return;let i={};const[s]=this.quill.getLine(e.index);let a=new it().retain(e.index).delete(r);if(t.offset>=s.length()-1){const[o]=this.quill.getLine(e.index+1);if(o){const l=s.formats(),c=this.quill.getFormat(e.index,1);i=Bi.AttributeMap.diff(l,c)||{},Object.keys(i).length>0&&(a=a.retain(o.length()-1).retain(1,i))}}this.quill.updateContents(a,Ne.sources.USER),this.quill.focus()}handleDeleteRange(e){Gp({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,t){const r=Object.keys(t.format).reduce((s,a)=>(this.quill.scroll.query(a,ot.BLOCK)&&!Array.isArray(t.format[a])&&(s[a]=t.format[a]),s),{}),i=new it().retain(e.index).delete(e.length).insert(`
`,r);this.quill.updateContents(i,Ne.sources.USER),this.quill.setSelection(e.index+1,Ne.sources.SILENT),this.quill.focus()}}const vN={bindings:{bold:Vh("bold"),italic:Vh("italic"),underline:Vh("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(n,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",Ne.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(n,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",Ne.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(n,e){e.format.indent!=null?this.quill.format("indent","-1",Ne.sources.USER):e.format.list!=null&&this.quill.format("list",!1,Ne.sources.USER)}},"indent code-block":I1(!0),"outdent code-block":I1(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(n){this.quill.deleteText(n.index-1,1,Ne.sources.USER)}},tab:{key:"Tab",handler(n,e){if(e.format.table)return!0;this.quill.history.cutoff();const t=new it().retain(n.index).delete(n.length).insert("	");return this.quill.updateContents(t,Ne.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(n.index+1,Ne.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,Ne.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(n,e){const t={list:!1};e.format.indent&&(t.indent=!1),this.quill.formatLine(n.index,n.length,t,Ne.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(n){const[e,t]=this.quill.getLine(n.index),r={...e.formats(),list:"checked"},i=new it().retain(n.index).insert(`
`,r).retain(e.length()-t-1).retain(1,{list:"unchecked"});this.quill.updateContents(i,Ne.sources.USER),this.quill.setSelection(n.index+1,Ne.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(n,e){const[t,r]=this.quill.getLine(n.index),i=new it().retain(n.index).insert(`
`,e.format).retain(t.length()-r-1).retain(1,{header:null});this.quill.updateContents(i,Ne.sources.USER),this.quill.setSelection(n.index+1,Ne.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(n){const e=this.quill.getModule("table");if(e){const[t,r,i,s]=e.getTable(n),a=yN(t,r,i,s);if(a==null)return;let o=t.offset();if(a<0){const l=new it().retain(o).insert(`
`);this.quill.updateContents(l,Ne.sources.USER),this.quill.setSelection(n.index+1,n.length,Ne.sources.SILENT)}else if(a>0){o+=t.length();const l=new it().retain(o).insert(`
`);this.quill.updateContents(l,Ne.sources.USER),this.quill.setSelection(o,Ne.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(n,e){const{event:t,line:r}=e,i=r.offset(this.quill.scroll);t.shiftKey?this.quill.setSelection(i-1,Ne.sources.USER):this.quill.setSelection(i+r.length(),Ne.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(n,e){if(this.quill.scroll.query("list")==null)return!0;const{length:t}=e.prefix,[r,i]=this.quill.getLine(n.index);if(i>t)return!0;let s;switch(e.prefix.trim()){case"[]":case"[ ]":s="unchecked";break;case"[x]":s="checked";break;case"-":case"*":s="bullet";break;default:s="ordered"}this.quill.insertText(n.index," ",Ne.sources.USER),this.quill.history.cutoff();const a=new it().retain(n.index-i).delete(t+1).retain(r.length()-2-i).retain(1,{list:s});return this.quill.updateContents(a,Ne.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(n.index-t,Ne.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(n){const[e,t]=this.quill.getLine(n.index);let r=2,i=e;for(;i!=null&&i.length()<=1&&i.formats()["code-block"];)if(i=i.prev,r-=1,r<=0){const s=new it().retain(n.index+e.length()-t-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(s,Ne.sources.USER),this.quill.setSelection(n.index-1,Ne.sources.SILENT),!1}return!0}},"embed left":Yu("ArrowLeft",!1),"embed left shift":Yu("ArrowLeft",!0),"embed right":Yu("ArrowRight",!1),"embed right shift":Yu("ArrowRight",!0),"table down":O1(!1),"table up":O1(!0)}};Xd.DEFAULTS=vN;function I1(n){return{key:"Tab",shiftKey:!n,format:{"code-block":!0},handler(e,t){let{event:r}=t;const i=this.quill.scroll.query("code-block"),{TAB:s}=i;if(e.length===0&&!r.shiftKey){this.quill.insertText(e.index,s,Ne.sources.USER),this.quill.setSelection(e.index+s.length,Ne.sources.SILENT);return}const a=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:o,length:l}=e;a.forEach((c,d)=>{n?(c.insertAt(0,s),d===0?o+=s.length:l+=s.length):c.domNode.textContent.startsWith(s)&&(c.deleteAt(0,s.length),d===0?o-=s.length:l-=s.length)}),this.quill.update(Ne.sources.USER),this.quill.setSelection(o,l,Ne.sources.SILENT)}}}function Yu(n,e){return{key:n,shiftKey:e,altKey:null,[n==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(r){let{index:i}=r;n==="ArrowRight"&&(i+=r.length+1);const[s]=this.quill.getLeaf(i);return s instanceof Ei?(n==="ArrowLeft"?e?this.quill.setSelection(r.index-1,r.length+1,Ne.sources.USER):this.quill.setSelection(r.index-1,Ne.sources.USER):e?this.quill.setSelection(r.index,r.length+1,Ne.sources.USER):this.quill.setSelection(r.index+r.length+1,Ne.sources.USER),!1):!0}}}function Vh(n){return{key:n[0],shortKey:!0,handler(e,t){this.quill.format(n,!t.format[n],Ne.sources.USER)}}}function O1(n){return{key:n?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,t){const r=n?"prev":"next",i=t.line,s=i.parent[r];if(s!=null){if(s.statics.blotName==="table-row"){let a=s.children.head,o=i;for(;o.prev!=null;)o=o.prev,a=a.next;const l=a.offset(this.quill.scroll)+Math.min(t.offset,a.length()-1);this.quill.setSelection(l,0,Ne.sources.USER)}}else{const a=i.table()[r];a!=null&&(n?this.quill.setSelection(a.offset(this.quill.scroll)+a.length()-1,0,Ne.sources.USER):this.quill.setSelection(a.offset(this.quill.scroll),0,Ne.sources.USER))}return!1}}}function bN(n){if(typeof n=="string"||typeof n=="number")n={key:n};else if(typeof n=="object")n=vl(n);else return null;return n.shortKey&&(n[gN]=n.shortKey,delete n.shortKey),n}function Gp(n){let{quill:e,range:t}=n;const r=e.getLines(t);let i={};if(r.length>1){const s=r[0].formats(),a=r[r.length-1].formats();i=Bi.AttributeMap.diff(a,s)||{}}e.deleteText(t,Ne.sources.USER),Object.keys(i).length>0&&e.formatLine(t.index,1,i,Ne.sources.USER),e.setSelection(t.index,Ne.sources.SILENT)}function yN(n,e,t,r){return e.prev==null&&e.next==null?t.prev==null&&t.next==null?r===0?-1:1:t.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const wN=/font-weight:\s*normal/,_N=["P","OL","UL"],R1=n=>n&&_N.includes(n.tagName),xN=n=>{Array.from(n.querySelectorAll("br")).filter(e=>R1(e.previousElementSibling)&&R1(e.nextElementSibling)).forEach(e=>{var t;(t=e.parentNode)==null||t.removeChild(e)})},AN=n=>{Array.from(n.querySelectorAll('b[style*="font-weight"]')).filter(e=>{var t;return(t=e.getAttribute("style"))==null?void 0:t.match(wN)}).forEach(e=>{var r;const t=n.createDocumentFragment();t.append(...e.childNodes),(r=e.parentNode)==null||r.replaceChild(t,e)})};function SN(n){n.querySelector('[id^="docs-internal-guid-"]')&&(AN(n),xN(n))}const EN=/\bmso-list:[^;]*ignore/i,NN=/\bmso-list:[^;]*\bl(\d+)/i,kN=/\bmso-list:[^;]*\blevel(\d+)/i,LN=(n,e)=>{const t=n.getAttribute("style"),r=t==null?void 0:t.match(NN);if(!r)return null;const i=Number(r[1]),s=t==null?void 0:t.match(kN),a=s?Number(s[1]):1,o=new RegExp(`@list l${i}:level${a}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(o),c=l&&l[1]==="bullet"?"bullet":"ordered";return{id:i,indent:a,type:c,element:n}},TN=n=>{var a,o;const e=Array.from(n.querySelectorAll("[style*=mso-list]")),t=[],r=[];e.forEach(l=>{(l.getAttribute("style")||"").match(EN)?t.push(l):r.push(l)}),t.forEach(l=>{var c;return(c=l.parentNode)==null?void 0:c.removeChild(l)});const i=n.documentElement.innerHTML,s=r.map(l=>LN(l,i)).filter(l=>l);for(;s.length;){const l=[];let c=s.shift();for(;c;)l.push(c),c=s.length&&((a=s[0])==null?void 0:a.element)===c.element.nextElementSibling&&s[0].id===c.id?s.shift():null;const d=document.createElement("ul");l.forEach(h=>{const b=document.createElement("li");b.setAttribute("data-list",h.type),h.indent>1&&b.setAttribute("class",`ql-indent-${h.indent-1}`),b.innerHTML=h.element.innerHTML,d.appendChild(b)});const m=(o=l[0])==null?void 0:o.element,{parentNode:p}=m??{};m&&(p==null||p.replaceChild(d,m)),l.slice(1).forEach(h=>{let{element:b}=h;p==null||p.removeChild(b)})}};function CN(n){n.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&TN(n)}const IN=[CN,SN],ON=n=>{n.documentElement&&IN.forEach(e=>{e(n)})},RN=da("quill:clipboard"),PN=[[Node.TEXT_NODE,VN],[Node.TEXT_NODE,D1],["br",$N],[Node.ELEMENT_NODE,D1],[Node.ELEMENT_NODE,jN],[Node.ELEMENT_NODE,qN],[Node.ELEMENT_NODE,HN],["li",UN],["ol, ul",zN],["pre",MN],["tr",WN],["b",Gh("bold")],["i",Gh("italic")],["strike",Gh("strike")],["style",FN]],DN=[dN,Tb].reduce((n,e)=>(n[e.keyName]=e,n),{}),P1=[kb,Hp,zp,Ib,Pb,Bb].reduce((n,e)=>(n[e.keyName]=e,n),{});class qb extends fs{constructor(e,t){super(e,t),this.quill.root.addEventListener("copy",r=>this.onCaptureCopy(r,!1)),this.quill.root.addEventListener("cut",r=>this.onCaptureCopy(r,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],PN.concat(this.options.matchers??[]).forEach(r=>{let[i,s]=r;this.addMatcher(i,s)})}addMatcher(e,t){this.matchers.push([e,t])}convert(e){let{html:t,text:r}=e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i[$r.blotName])return new it().insert(r||"",{[$r.blotName]:i[$r.blotName]});if(!t)return new it().insert(r||"",i);const s=this.convertHTML(t);return au(s,`
`)&&(s.ops[s.ops.length-1].attributes==null||i.table)?s.compose(new it().retain(s.length()-1).delete(1)):s}normalizeHTML(e){ON(e)}convertHTML(e){const t=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(t);const r=t.body,i=new WeakMap,[s,a]=this.prepareMatching(r,i);return Kp(this.quill.scroll,r,s,a,i)}dangerouslyPasteHTML(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ne.sources.API;if(typeof e=="string"){const i=this.convert({html:e,text:""});this.quill.setContents(i,t),this.quill.setSelection(0,Ne.sources.SILENT)}else{const i=this.convert({html:t,text:""});this.quill.updateContents(new it().retain(e).concat(i),r),this.quill.setSelection(e+i.length(),Ne.sources.SILENT)}}onCaptureCopy(e){var a,o;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[r]=this.quill.selection.getRange();if(r==null)return;const{html:i,text:s}=this.onCopy(r,t);(a=e.clipboardData)==null||a.setData("text/plain",s),(o=e.clipboardData)==null||o.setData("text/html",i),t&&Gp({range:r,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(t=>t[0]!=="#").join(`
`)}onCapturePaste(e){var a,o,l,c,d;if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const t=this.quill.getSelection(!0);if(t==null)return;const r=(a=e.clipboardData)==null?void 0:a.getData("text/html");let i=(o=e.clipboardData)==null?void 0:o.getData("text/plain");if(!r&&!i){const m=(l=e.clipboardData)==null?void 0:l.getData("text/uri-list");m&&(i=this.normalizeURIList(m))}const s=Array.from(((c=e.clipboardData)==null?void 0:c.files)||[]);if(!r&&s.length>0){this.quill.uploader.upload(t,s);return}if(r&&s.length>0){const m=new DOMParser().parseFromString(r,"text/html");if(m.body.childElementCount===1&&((d=m.body.firstElementChild)==null?void 0:d.tagName)==="IMG"){this.quill.uploader.upload(t,s);return}}this.onPaste(t,{html:r,text:i})}onCopy(e){const t=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:t}}onPaste(e,t){let{text:r,html:i}=t;const s=this.quill.getFormat(e.index),a=this.convert({text:r,html:i},s);RN.log("onPaste",a,{text:r,html:i});const o=new it().retain(e.index).delete(e.length).concat(a);this.quill.updateContents(o,Ne.sources.USER),this.quill.setSelection(o.length()-e.length,Ne.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,t){const r=[],i=[];return this.matchers.forEach(s=>{const[a,o]=s;switch(a){case Node.TEXT_NODE:i.push(o);break;case Node.ELEMENT_NODE:r.push(o);break;default:Array.from(e.querySelectorAll(a)).forEach(l=>{if(t.has(l)){const c=t.get(l);c==null||c.push(o)}else t.set(l,[o])});break}}),[r,i]}}Re(qb,"DEFAULTS",{matchers:[]});function Mo(n,e,t,r){return r.query(e)?n.reduce((i,s)=>{if(!s.insert)return i;if(s.attributes&&s.attributes[e])return i.push(s);const a=t?{[e]:t}:{};return i.insert(s.insert,{...a,...s.attributes})},new it):n}function au(n,e){let t="";for(let r=n.ops.length-1;r>=0&&t.length<e.length;--r){const i=n.ops[r];if(typeof i.insert!="string")break;t=i.insert+t}return t.slice(-1*e.length)===e}function Ma(n,e){if(!(n instanceof Element))return!1;const t=e.query(n);return t&&t.prototype instanceof Ei?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(n.tagName.toLowerCase())}function BN(n,e){return n.previousElementSibling&&n.nextElementSibling&&!Ma(n.previousElementSibling,e)&&!Ma(n.nextElementSibling,e)}const Ju=new WeakMap;function jb(n){return n==null?!1:(Ju.has(n)||(n.tagName==="PRE"?Ju.set(n,!0):Ju.set(n,jb(n.parentNode))),Ju.get(n))}function Kp(n,e,t,r,i){return e.nodeType===e.TEXT_NODE?r.reduce((s,a)=>a(e,s,n),new it):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((s,a)=>{let o=Kp(n,a,t,r,i);return a.nodeType===e.ELEMENT_NODE&&(o=t.reduce((l,c)=>c(a,l,n),o),o=(i.get(a)||[]).reduce((l,c)=>c(a,l,n),o)),s.concat(o)},new it):new it}function Gh(n){return(e,t,r)=>Mo(t,n,!0,r)}function qN(n,e,t){const r=Ps.keys(n),i=ds.keys(n),s=Ka.keys(n),a={};return r.concat(i).concat(s).forEach(o=>{let l=t.query(o,ot.ATTRIBUTE);l!=null&&(a[l.attrName]=l.value(n),a[l.attrName])||(l=DN[o],l!=null&&(l.attrName===o||l.keyName===o)&&(a[l.attrName]=l.value(n)||void 0),l=P1[o],l!=null&&(l.attrName===o||l.keyName===o)&&(l=P1[o],a[l.attrName]=l.value(n)||void 0))}),Object.entries(a).reduce((o,l)=>{let[c,d]=l;return Mo(o,c,d,t)},e)}function jN(n,e,t){const r=t.query(n);if(r==null)return e;if(r.prototype instanceof Ei){const i={},s=r.value(n);if(s!=null)return i[r.blotName]=s,new it().insert(i,r.formats(n,t))}else if(r.prototype instanceof Wc&&!au(e,`
`)&&e.insert(`
`),"blotName"in r&&"formats"in r&&typeof r.formats=="function")return Mo(e,r.blotName,r.formats(n,t),t);return e}function $N(n,e){return au(e,`
`)||e.insert(`
`),e}function MN(n,e,t){const r=t.query("code-block"),i=r&&"formats"in r&&typeof r.formats=="function"?r.formats(n,t):!0;return Mo(e,"code-block",i,t)}function FN(){return new it}function UN(n,e,t){const r=t.query(n);if(r==null||r.blotName!=="list"||!au(e,`
`))return e;let i=-1,s=n.parentNode;for(;s!=null;)["OL","UL"].includes(s.tagName)&&(i+=1),s=s.parentNode;return i<=0?e:e.reduce((a,o)=>o.insert?o.attributes&&typeof o.attributes.indent=="number"?a.push(o):a.insert(o.insert,{indent:i,...o.attributes||{}}):a,new it)}function zN(n,e,t){const r=n;let i=r.tagName==="OL"?"ordered":"bullet";const s=r.getAttribute("data-checked");return s&&(i=s==="true"?"checked":"unchecked"),Mo(e,"list",i,t)}function D1(n,e,t){if(!au(e,`
`)){if(Ma(n,t)&&(n.childNodes.length>0||n instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&n.nextSibling){let r=n.nextSibling;for(;r!=null;){if(Ma(r,t))return e.insert(`
`);const i=t.query(r);if(i&&i.prototype instanceof Di)return e.insert(`
`);r=r.firstChild}}}return e}function HN(n,e,t){var s;const r={},i=n.style||{};return i.fontStyle==="italic"&&(r.italic=!0),i.textDecoration==="underline"&&(r.underline=!0),i.textDecoration==="line-through"&&(r.strike=!0),((s=i.fontWeight)!=null&&s.startsWith("bold")||parseInt(i.fontWeight,10)>=700)&&(r.bold=!0),e=Object.entries(r).reduce((a,o)=>{let[l,c]=o;return Mo(a,l,c,t)},e),parseFloat(i.textIndent||0)>0?new it().insert("	").concat(e):e}function WN(n,e,t){var i,s;const r=((i=n.parentElement)==null?void 0:i.tagName)==="TABLE"?n.parentElement:(s=n.parentElement)==null?void 0:s.parentElement;if(r!=null){const o=Array.from(r.querySelectorAll("tr")).indexOf(n)+1;return Mo(e,"table",o,t)}return e}function VN(n,e,t){var i;let r=n.data;if(((i=n.parentElement)==null?void 0:i.tagName)==="O:P")return e.insert(r.trim());if(!jb(n)){if(r.trim().length===0&&r.includes(`
`)&&!BN(n,t))return e;r=r.replace(/[^\S\u00a0]/g," "),r=r.replace(/ {2,}/g," "),(n.previousSibling==null&&n.parentElement!=null&&Ma(n.parentElement,t)||n.previousSibling instanceof Element&&Ma(n.previousSibling,t))&&(r=r.replace(/^ /,"")),(n.nextSibling==null&&n.parentElement!=null&&Ma(n.parentElement,t)||n.nextSibling instanceof Element&&Ma(n.nextSibling,t))&&(r=r.replace(/ $/,"")),r=r.replaceAll(""," ")}return e.insert(r)}class $b extends fs{constructor(t,r){super(t,r);Re(this,"lastRecorded",0);Re(this,"ignoreChange",!1);Re(this,"stack",{undo:[],redo:[]});Re(this,"currentRange",null);this.quill.on(Ne.events.EDITOR_CHANGE,(i,s,a,o)=>{i===Ne.events.SELECTION_CHANGE?s&&o!==Ne.sources.SILENT&&(this.currentRange=s):i===Ne.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||o===Ne.sources.USER?this.record(s,a):this.transform(s)),this.currentRange=Xf(this.currentRange,s))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",i=>{i.inputType==="historyUndo"?(this.undo(),i.preventDefault()):i.inputType==="historyRedo"&&(this.redo(),i.preventDefault())})}change(t,r){if(this.stack[t].length===0)return;const i=this.stack[t].pop();if(!i)return;const s=this.quill.getContents(),a=i.delta.invert(s);this.stack[r].push({delta:a,range:Xf(i.range,a)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(i.delta,Ne.sources.USER),this.ignoreChange=!1,this.restoreSelection(i)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(t,r){if(t.ops.length===0)return;this.stack.redo=[];let i=t.invert(r),s=this.currentRange;const a=Date.now();if(this.lastRecorded+this.options.delay>a&&this.stack.undo.length>0){const o=this.stack.undo.pop();o&&(i=i.compose(o.delta),s=o.range)}else this.lastRecorded=a;i.length()!==0&&(this.stack.undo.push({delta:i,range:s}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(t){B1(this.stack.undo,t),B1(this.stack.redo,t)}undo(){this.change("undo","redo")}restoreSelection(t){if(t.range)this.quill.setSelection(t.range,Ne.sources.USER);else{const r=KN(this.quill.scroll,t.delta);this.quill.setSelection(r,Ne.sources.USER)}}}Re($b,"DEFAULTS",{delay:1e3,maxStack:100,userOnly:!1});function B1(n,e){let t=e;for(let r=n.length-1;r>=0;r-=1){const i=n[r];n[r]={delta:t.transform(i.delta,!0),range:i.range&&Xf(i.range,t)},t=i.delta.transform(t),n[r].delta.length()===0&&n.splice(r,1)}}function GN(n,e){const t=e.ops[e.ops.length-1];return t==null?!1:t.insert!=null?typeof t.insert=="string"&&t.insert.endsWith(`
`):t.attributes!=null?Object.keys(t.attributes).some(r=>n.query(r,ot.BLOCK)!=null):!1}function KN(n,e){const t=e.reduce((i,s)=>i+(s.delete||0),0);let r=e.length()-t;return GN(n,e)&&(r-=1),r}function Xf(n,e){if(!n)return n;const t=e.transformPosition(n.index),r=e.transformPosition(n.index+n.length);return{index:t,length:r-t}}class Mb extends fs{constructor(e,t){super(e,t),e.root.addEventListener("drop",r=>{var a;r.preventDefault();let i=null;if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(r.clientX,r.clientY);else if(document.caretPositionFromPoint){const o=document.caretPositionFromPoint(r.clientX,r.clientY);i=document.createRange(),i.setStart(o.offsetNode,o.offset),i.setEnd(o.offsetNode,o.offset)}const s=i&&e.selection.normalizeNative(i);if(s){const o=e.selection.normalizedToRange(s);(a=r.dataTransfer)!=null&&a.files&&this.upload(o,r.dataTransfer.files)}})}upload(e,t){const r=[];Array.from(t).forEach(i=>{var s;i&&((s=this.options.mimetypes)!=null&&s.includes(i.type))&&r.push(i)}),r.length>0&&this.options.handler.call(this,e,r)}}Mb.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(n,e){if(!this.quill.scroll.query("image"))return;const t=e.map(r=>new Promise(i=>{const s=new FileReader;s.onload=()=>{i(s.result)},s.readAsDataURL(r)}));Promise.all(t).then(r=>{const i=r.reduce((s,a)=>s.insert({image:a}),new it().retain(n.index).delete(n.length));this.quill.updateContents(i,Ge.sources.USER),this.quill.setSelection(n.index+r.length,Ge.sources.SILENT)})}};const YN=["insertText","insertReplacementText"];class JN extends fs{constructor(e,t){super(e,t),e.root.addEventListener("beforeinput",r=>{this.handleBeforeInput(r)}),/Android/i.test(navigator.userAgent)||e.on(Ne.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){Gp({range:e,quill:this.quill})}replaceText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(t){const r=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new it().retain(e.index).insert(t,r),Ne.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+t.length,0,Ne.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!YN.includes(e.inputType))return;const t=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!t||t.collapsed===!0)return;const r=XN(e);if(r==null)return;const i=this.quill.selection.normalizeNative(t),s=i?this.quill.selection.normalizedToRange(i):null;s&&this.replaceText(s,r)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function XN(n){var e;return typeof n.data=="string"?n.data:(e=n.dataTransfer)!=null&&e.types.includes("text/plain")?n.dataTransfer.getData("text/plain"):null}const ZN=/Mac/i.test(navigator.platform),QN=100,ek=n=>!!(n.key==="ArrowLeft"||n.key==="ArrowRight"||n.key==="ArrowUp"||n.key==="ArrowDown"||n.key==="Home"||ZN&&n.key==="a"&&n.ctrlKey===!0);class tk extends fs{constructor(t,r){super(t,r);Re(this,"isListening",!1);Re(this,"selectionChangeDeadline",0);this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(t,r){let{line:i,event:s}=r;if(!(i instanceof ls)||!i.uiNode)return!0;const a=getComputedStyle(i.domNode).direction==="rtl";return a&&s.key!=="ArrowRight"||!a&&s.key!=="ArrowLeft"?!0:(this.quill.setSelection(t.index-1,t.length+(s.shiftKey?1:0),Ne.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",t=>{!t.defaultPrevented&&ek(t)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+QN,this.isListening)return;this.isListening=!0;const t=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",t,{once:!0})}handleSelectionChange(){const t=document.getSelection();if(!t)return;const r=t.getRangeAt(0);if(r.collapsed!==!0||r.startOffset!==0)return;const i=this.quill.scroll.find(r.startContainer);if(!(i instanceof ls)||!i.uiNode)return;const s=document.createRange();s.setStartAfter(i.uiNode),s.setEndAfter(i.uiNode),t.removeAllRanges(),t.addRange(s)}}Ne.register({"blots/block":Er,"blots/block/embed":Di,"blots/break":hs,"blots/container":jo,"blots/cursor":Nl,"blots/embed":Fp,"blots/inline":Ds,"blots/scroll":ul,"blots/text":cs,"modules/clipboard":qb,"modules/history":$b,"modules/keyboard":Xd,"modules/uploader":Mb,"modules/input":JN,"modules/uiNode":tk});class nk extends ds{add(e,t){let r=0;if(t==="+1"||t==="-1"){const i=this.value(e)||0;r=t==="+1"?i+1:i-1}else typeof t=="number"&&(r=t);return r===0?(this.remove(e),!0):super.add(e,r.toString())}canAdd(e,t){return super.canAdd(e,t)||super.canAdd(e,parseInt(t,10))}value(e){return parseInt(super.value(e),10)||void 0}}const rk=new nk("indent","ql-indent",{scope:ot.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class Zf extends Er{}Re(Zf,"blotName","blockquote"),Re(Zf,"tagName","blockquote");class Qf extends Er{static formats(e){return this.tagName.indexOf(e.tagName)+1}}Re(Qf,"blotName","header"),Re(Qf,"tagName",["H1","H2","H3","H4","H5","H6"]);class ou extends jo{}ou.blotName="list-container";ou.tagName="OL";class lu extends Er{static create(e){const t=super.create();return t.setAttribute("data-list",e),t}static formats(e){return e.getAttribute("data-list")||void 0}static register(){Ne.register(ou)}constructor(e,t){super(e,t);const r=t.ownerDocument.createElement("span"),i=s=>{if(!e.isEnabled())return;const a=this.statics.formats(t,e);a==="checked"?(this.format("list","unchecked"),s.preventDefault()):a==="unchecked"&&(this.format("list","checked"),s.preventDefault())};r.addEventListener("mousedown",i),r.addEventListener("touchstart",i),this.attachUI(r)}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("data-list",t):super.format(e,t)}}lu.blotName="list";lu.tagName="LI";ou.allowedChildren=[lu];lu.requiredContainer=ou;class Gc extends Ds{static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}Re(Gc,"blotName","bold"),Re(Gc,"tagName",["STRONG","B"]);class ep extends Gc{}Re(ep,"blotName","italic"),Re(ep,"tagName",["EM","I"]);class Fa extends Ds{static create(e){const t=super.create(e);return t.setAttribute("href",this.sanitize(e)),t.setAttribute("rel","noopener noreferrer"),t.setAttribute("target","_blank"),t}static formats(e){return e.getAttribute("href")}static sanitize(e){return Fb(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,t){e!==this.statics.blotName||!t?super.format(e,t):this.domNode.setAttribute("href",this.constructor.sanitize(t))}}Re(Fa,"blotName","link"),Re(Fa,"tagName","A"),Re(Fa,"SANITIZED_URL","about:blank"),Re(Fa,"PROTOCOL_WHITELIST",["http","https","mailto","tel","sms"]);function Fb(n,e){const t=document.createElement("a");t.href=n;const r=t.href.slice(0,t.href.indexOf(":"));return e.indexOf(r)>-1}class tp extends Ds{static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}Re(tp,"blotName","script"),Re(tp,"tagName",["SUB","SUP"]);class np extends Gc{}Re(np,"blotName","strike"),Re(np,"tagName",["S","STRIKE"]);class rp extends Ds{}Re(rp,"blotName","underline"),Re(rp,"tagName","U");class cd extends Fp{static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const t=super.create(e);return typeof e=="string"&&(window.katex.render(e,t,{throwOnError:!1,errorColor:"#f00"}),t.setAttribute("data-value",e)),t}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}Re(cd,"blotName","formula"),Re(cd,"className","ql-formula"),Re(cd,"tagName","SPAN");const q1=["alt","height","width"];class ip extends Ei{static create(e){const t=super.create(e);return typeof e=="string"&&t.setAttribute("src",this.sanitize(e)),t}static formats(e){return q1.reduce((t,r)=>(e.hasAttribute(r)&&(t[r]=e.getAttribute(r)),t),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return Fb(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,t){q1.indexOf(e)>-1?t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):super.format(e,t)}}Re(ip,"blotName","image"),Re(ip,"tagName","IMG");const j1=["height","width"];class ud extends Di{static create(e){const t=super.create(e);return t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen","true"),t.setAttribute("src",this.sanitize(e)),t}static formats(e){return j1.reduce((t,r)=>(e.hasAttribute(r)&&(t[r]=e.getAttribute(r)),t),{})}static sanitize(e){return Fa.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,t){j1.indexOf(e)>-1?t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):super.format(e,t)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}Re(ud,"blotName","video"),Re(ud,"className","ql-video"),Re(ud,"tagName","IFRAME");const bc=new ds("code-token","hljs",{scope:ot.INLINE});class aa extends Ds{static formats(e,t){for(;e!=null&&e!==t.domNode;){if(e.classList&&e.classList.contains($r.className))return super.formats(e,t);e=e.parentNode}}constructor(e,t,r){super(e,t,r),bc.add(this.domNode,r)}format(e,t){e!==aa.blotName?super.format(e,t):t?bc.add(this.domNode,t):(bc.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),bc.value(this.domNode)||this.unwrap()}}aa.blotName="code-token";aa.className="ql-token";class Pi extends $r{static create(e){const t=super.create(e);return typeof e=="string"&&t.setAttribute("data-language",e),t}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("data-language",t):super.format(e,t)}replaceWith(e,t){return this.formatAt(0,this.length(),aa.blotName,!1),super.replaceWith(e,t)}}class Ec extends $o{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,t){e===Pi.blotName&&(this.forceNext=!0,this.children.forEach(r=>{r.format(e,t)}))}formatAt(e,t,r,i){r===Pi.blotName&&(this.forceNext=!0),super.formatAt(e,t,r,i)}highlight(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const i=`${Array.from(this.domNode.childNodes).filter(a=>a!==this.uiNode).map(a=>a.textContent).join(`
`)}
`,s=Pi.formats(this.children.head.domNode);if(t||this.forceNext||this.cachedText!==i){if(i.trim().length>0||this.cachedText==null){const a=this.children.reduce((l,c)=>l.concat(Sb(c,!1)),new it),o=e(i,s);a.diff(o).reduce((l,c)=>{let{retain:d,attributes:m}=c;return d?(m&&Object.keys(m).forEach(p=>{[Pi.blotName,aa.blotName].includes(p)&&this.formatAt(l,d,p,m[p])}),l+d):l},0)}this.cachedText=i,this.forceNext=!1}}html(e,t){const[r]=this.children.find(e);return`<pre data-language="${r?Pi.formats(r.domNode):"plain"}">
${Jd(this.code(e,t))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const t=Pi.formats(this.children.head.domNode);t!==this.uiNode.value&&(this.uiNode.value=t)}}}Ec.allowedChildren=[Pi];Pi.requiredContainer=Ec;Pi.allowedChildren=[aa,Nl,cs,hs];const ik=(n,e,t)=>{if(typeof n.versionString=="string"){const r=n.versionString.split(".")[0];if(parseInt(r,10)>=11)return n.highlight(t,{language:e}).value}return n.highlight(e,t).value};class Ub extends fs{static register(){Ne.register(aa,!0),Ne.register(Pi,!0),Ne.register(Ec,!0)}constructor(e,t){if(super(e,t),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((r,i)=>{let{key:s}=i;return r[s]=!0,r},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(Ne.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof Ec))return;const t=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(r=>{let{key:i,label:s}=r;const a=t.ownerDocument.createElement("option");a.textContent=s,a.setAttribute("value",i),t.appendChild(a)}),t.addEventListener("change",()=>{e.format(Pi.blotName,t.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(t),e.children.head&&(t.value=Pi.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(Ne.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(Ne.sources.USER);const r=this.quill.getSelection();(e==null?this.quill.scroll.descendants(Ec):[e]).forEach(s=>{s.highlight(this.highlightBlot,t)}),this.quill.update(Ne.sources.SILENT),r!=null&&this.quill.setSelection(r,Ne.sources.SILENT)}highlightBlot(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(t=this.languages[t]?t:"plain",t==="plain")return Jd(e).split(`
`).reduce((i,s,a)=>(a!==0&&i.insert(`
`,{[$r.blotName]:t}),i.insert(s)),new it);const r=this.quill.root.ownerDocument.createElement("div");return r.classList.add($r.className),r.innerHTML=ik(this.options.hljs,t,e),Kp(this.quill.scroll,r,[(i,s)=>{const a=bc.value(i);return a?s.compose(new it().retain(s.length(),{[aa.blotName]:a})):s}],[(i,s)=>i.data.split(`
`).reduce((a,o,l)=>(l!==0&&a.insert(`
`,{[$r.blotName]:t}),a.insert(o)),s)],new WeakMap)}}Ub.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};const Rc=class Rc extends Er{static create(e){const t=super.create();return e?t.setAttribute("data-row",e):t.setAttribute("data-row",Yp()),t}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,t){e===Rc.blotName&&t?this.domNode.setAttribute("data-row",t):super.format(e,t)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}};Re(Rc,"blotName","table"),Re(Rc,"tagName","TD");let as=Rc;class oa extends jo{checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),t=this.children.tail.formats(),r=this.next.children.head.formats(),i=this.next.children.tail.formats();return e.table===t.table&&e.table===r.table&&e.table===i.table}return!1}optimize(e){super.optimize(e),this.children.forEach(t=>{if(t.next==null)return;const r=t.formats(),i=t.next.formats();if(r.table!==i.table){const s=this.splitAfter(t);s&&s.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}Re(oa,"blotName","table-row"),Re(oa,"tagName","TR");class Os extends jo{}Re(Os,"blotName","table-body"),Re(Os,"tagName","TBODY");class Ll extends jo{balanceCells(){const e=this.descendants(oa),t=e.reduce((r,i)=>Math.max(i.children.length,r),0);e.forEach(r=>{new Array(t-r.children.length).fill(0).forEach(()=>{let i;r.children.head!=null&&(i=as.formats(r.children.head.domNode));const s=this.scroll.create(as.blotName,i);r.appendChild(s),s.optimize()})})}cells(e){return this.rows().map(t=>t.children.at(e))}deleteColumn(e){const[t]=this.descendant(Os);t==null||t.children.head==null||t.children.forEach(r=>{const i=r.children.at(e);i!=null&&i.remove()})}insertColumn(e){const[t]=this.descendant(Os);t==null||t.children.head==null||t.children.forEach(r=>{const i=r.children.at(e),s=as.formats(r.children.head.domNode),a=this.scroll.create(as.blotName,s);r.insertBefore(a,i)})}insertRow(e){const[t]=this.descendant(Os);if(t==null||t.children.head==null)return;const r=Yp(),i=this.scroll.create(oa.blotName);t.children.head.children.forEach(()=>{const a=this.scroll.create(as.blotName,r);i.appendChild(a)});const s=t.children.at(e);t.insertBefore(i,s)}rows(){const e=this.children.head;return e==null?[]:e.children.map(t=>t)}}Re(Ll,"blotName","table-container"),Re(Ll,"tagName","TABLE");Ll.allowedChildren=[Os];Os.requiredContainer=Ll;Os.allowedChildren=[oa];oa.requiredContainer=Os;oa.allowedChildren=[as];as.requiredContainer=oa;function Yp(){return`row-${Math.random().toString(36).slice(2,6)}`}class sk extends fs{static register(){Ne.register(as),Ne.register(oa),Ne.register(Os),Ne.register(Ll)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(Ll).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,t]=this.getTable();t!=null&&(e.deleteColumn(t.cellOffset()),this.quill.update(Ne.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(Ne.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const t=e.offset();e.remove(),this.quill.update(Ne.sources.USER),this.quill.setSelection(t,Ne.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[t,r]=this.quill.getLine(e.index);if(t==null||t.statics.blotName!==as.blotName)return[null,null,null,-1];const i=t.parent;return[i.parent.parent,i,t,r]}insertColumn(e){const t=this.quill.getSelection();if(!t)return;const[r,i,s]=this.getTable(t);if(s==null)return;const a=s.cellOffset();r.insertColumn(a+e),this.quill.update(Ne.sources.USER);let o=i.rowOffset();e===0&&(o+=1),this.quill.setSelection(t.index+o,t.length,Ne.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const t=this.quill.getSelection();if(!t)return;const[r,i,s]=this.getTable(t);if(s==null)return;const a=i.rowOffset();r.insertRow(a+e),this.quill.update(Ne.sources.USER),e>0?this.quill.setSelection(t,Ne.sources.SILENT):this.quill.setSelection(t.index+i.children.length,t.length,Ne.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,t){const r=this.quill.getSelection();if(r==null)return;const i=new Array(e).fill(0).reduce(s=>{const a=new Array(t).fill(`
`).join("");return s.insert(a,{table:Yp()})},new it().retain(r.index));this.quill.updateContents(i,Ne.sources.USER),this.quill.setSelection(r.index,Ne.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(Ne.events.SCROLL_OPTIMIZE,e=>{e.some(t=>["TD","TR","TBODY","TABLE"].includes(t.target.tagName)?(this.quill.once(Ne.events.TEXT_CHANGE,(r,i,s)=>{s===Ne.sources.USER&&this.balanceTables()}),!0):!1)})}}const $1=da("quill:toolbar");class Jp extends fs{constructor(e,t){var r,i;if(super(e,t),Array.isArray(this.options.container)){const s=document.createElement("div");s.setAttribute("role","toolbar"),ak(s,this.options.container),(i=(r=e.container)==null?void 0:r.parentNode)==null||i.insertBefore(s,e.container),this.container=s}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){$1.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(s=>{var o;const a=(o=this.options.handlers)==null?void 0:o[s];a&&this.addHandler(s,a)}),Array.from(this.container.querySelectorAll("button, select")).forEach(s=>{this.attach(s)}),this.quill.on(Ne.events.EDITOR_CHANGE,()=>{const[s]=this.quill.selection.getRange();this.update(s)})}addHandler(e,t){this.handlers[e]=t}attach(e){let t=Array.from(e.classList).find(i=>i.indexOf("ql-")===0);if(!t)return;if(t=t.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[t]==null&&this.quill.scroll.query(t)==null){$1.warn("ignoring attaching to nonexistent format",t,e);return}const r=e.tagName==="SELECT"?"change":"click";e.addEventListener(r,i=>{let s;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const o=e.options[e.selectedIndex];o.hasAttribute("selected")?s=!1:s=o.value||!1}else e.classList.contains("ql-active")?s=!1:s=e.value||!e.hasAttribute("value"),i.preventDefault();this.quill.focus();const[a]=this.quill.selection.getRange();if(this.handlers[t]!=null)this.handlers[t].call(this,s);else if(this.quill.scroll.query(t).prototype instanceof Ei){if(s=prompt(`Enter ${t}`),!s)return;this.quill.updateContents(new it().retain(a.index).delete(a.length).insert({[t]:s}),Ne.sources.USER)}else this.quill.format(t,s,Ne.sources.USER);this.update(a)}),this.controls.push([t,e])}update(e){const t=e==null?{}:this.quill.getFormat(e);this.controls.forEach(r=>{const[i,s]=r;if(s.tagName==="SELECT"){let a=null;if(e==null)a=null;else if(t[i]==null)a=s.querySelector("option[selected]");else if(!Array.isArray(t[i])){let o=t[i];typeof o=="string"&&(o=o.replace(/"/g,'\\"')),a=s.querySelector(`option[value="${o}"]`)}a==null?(s.value="",s.selectedIndex=-1):a.selected=!0}else if(e==null)s.classList.remove("ql-active"),s.setAttribute("aria-pressed","false");else if(s.hasAttribute("value")){const a=t[i],o=a===s.getAttribute("value")||a!=null&&a.toString()===s.getAttribute("value")||a==null&&!s.getAttribute("value");s.classList.toggle("ql-active",o),s.setAttribute("aria-pressed",o.toString())}else{const a=t[i]!=null;s.classList.toggle("ql-active",a),s.setAttribute("aria-pressed",a.toString())}})}}Jp.DEFAULTS={};function M1(n,e,t){const r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(`ql-${e}`),r.setAttribute("aria-pressed","false"),t!=null?(r.value=t,r.setAttribute("aria-label",`${e}: ${t}`)):r.setAttribute("aria-label",e),n.appendChild(r)}function ak(n,e){Array.isArray(e[0])||(e=[e]),e.forEach(t=>{const r=document.createElement("span");r.classList.add("ql-formats"),t.forEach(i=>{if(typeof i=="string")M1(r,i);else{const s=Object.keys(i)[0],a=i[s];Array.isArray(a)?ok(r,s,a):M1(r,s,a)}}),n.appendChild(r)})}function ok(n,e,t){const r=document.createElement("select");r.classList.add(`ql-${e}`),t.forEach(i=>{const s=document.createElement("option");i!==!1?s.setAttribute("value",String(i)):s.setAttribute("selected","selected"),r.appendChild(s)}),n.appendChild(r)}Jp.DEFAULTS={container:null,handlers:{clean(){const n=this.quill.getSelection();if(n!=null)if(n.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(t=>{this.quill.scroll.query(t,ot.INLINE)!=null&&this.quill.format(t,!1,Ne.sources.USER)})}else this.quill.removeFormat(n.index,n.length,Ne.sources.USER)},direction(n){const{align:e}=this.quill.getFormat();n==="rtl"&&e==null?this.quill.format("align","right",Ne.sources.USER):!n&&e==="right"&&this.quill.format("align",!1,Ne.sources.USER),this.quill.format("direction",n,Ne.sources.USER)},indent(n){const e=this.quill.getSelection(),t=this.quill.getFormat(e),r=parseInt(t.indent||0,10);if(n==="+1"||n==="-1"){let i=n==="+1"?1:-1;t.direction==="rtl"&&(i*=-1),this.quill.format("indent",r+i,Ne.sources.USER)}},link(n){n===!0&&(n=prompt("Enter link URL:")),this.quill.format("link",n,Ne.sources.USER)},list(n){const e=this.quill.getSelection(),t=this.quill.getFormat(e);n==="check"?t.list==="checked"||t.list==="unchecked"?this.quill.format("list",!1,Ne.sources.USER):this.quill.format("list","unchecked",Ne.sources.USER):this.quill.format("list",n,Ne.sources.USER)}}};const lk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',ck='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',uk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',dk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',hk='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',fk='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',pk='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',mk='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',F1='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',gk='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',vk='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',bk='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',yk='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',wk='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',_k='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',xk='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Ak='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',Sk='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Ek='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',Nk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',kk='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',Lk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',Tk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',Ck='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',Ik='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',Ok='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',Rk='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',Pk='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',Dk='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',Bk='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',qk='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',jk='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',$k='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',Kc={align:{"":lk,center:ck,right:uk,justify:dk},background:hk,blockquote:fk,bold:pk,clean:mk,code:F1,"code-block":F1,color:gk,direction:{"":vk,rtl:bk},formula:yk,header:{1:wk,2:_k,3:xk,4:Ak,5:Sk,6:Ek},italic:Nk,image:kk,indent:{"+1":Lk,"-1":Tk},link:Ck,list:{bullet:Ik,check:Ok,ordered:Rk},script:{sub:Pk,super:Dk},strike:Bk,table:qk,underline:jk,video:$k},Mk='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let U1=0;function z1(n,e){n.setAttribute(e,`${n.getAttribute(e)!=="true"}`)}class Zd{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",t=>{switch(t.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),t.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),z1(this.label,"aria-expanded"),z1(this.options,"aria-hidden")}buildItem(e){const t=document.createElement("span");t.tabIndex="0",t.setAttribute("role","button"),t.classList.add("ql-picker-item");const r=e.getAttribute("value");return r&&t.setAttribute("data-value",r),e.textContent&&t.setAttribute("data-label",e.textContent),t.addEventListener("click",()=>{this.selectItem(t,!0)}),t.addEventListener("keydown",i=>{switch(i.key){case"Enter":this.selectItem(t,!0),i.preventDefault();break;case"Escape":this.escape(),i.preventDefault();break}}),t}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=Mk,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${U1}`,U1+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(t=>{const r=this.buildItem(t);e.appendChild(r),t.selected===!0&&this.selectItem(r)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=this.container.querySelector(".ql-selected");e!==r&&(r!=null&&r.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),t&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const r=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(r)}else this.selectItem(null);const t=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",t)}}class zb extends Zd{constructor(e,t){super(e),this.label.innerHTML=t,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(r=>{r.classList.add("ql-primary")})}buildItem(e){const t=super.buildItem(e);return t.style.backgroundColor=e.getAttribute("value")||"",t}selectItem(e,t){super.selectItem(e,t);const r=this.label.querySelector(".ql-color-label"),i=e&&e.getAttribute("data-value")||"";r&&(r.tagName==="line"?r.style.stroke=i:r.style.fill=i)}}class Hb extends Zd{constructor(e,t){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(r=>{r.innerHTML=t[r.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,t){super.selectItem(e,t);const r=e||this.defaultItem;if(r!=null){if(this.label.innerHTML===r.innerHTML)return;this.label.innerHTML=r.innerHTML}}}const Fk=n=>{const{overflowY:e}=getComputedStyle(n,null);return e!=="visible"&&e!=="clip"};class Wb{constructor(e,t){this.quill=e,this.boundsContainer=t||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,Fk(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const t=e.left+e.width/2-this.root.offsetWidth/2,r=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${t}px`,this.root.style.top=`${r}px`,this.root.classList.remove("ql-flip");const i=this.boundsContainer.getBoundingClientRect(),s=this.root.getBoundingClientRect();let a=0;if(s.right>i.right&&(a=i.right-s.right,this.root.style.left=`${t+a}px`),s.left<i.left&&(a=i.left-s.left,this.root.style.left=`${t+a}px`),s.bottom>i.bottom){const o=s.bottom-s.top,l=e.bottom-e.top+o;this.root.style.top=`${r-l}px`,this.root.classList.add("ql-flip")}return a}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const Uk=[!1,"center","right","justify"],zk=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],Hk=[!1,"serif","monospace"],Wk=["1","2","3",!1],Vk=["small",!1,"large","huge"];class cu extends kl{constructor(e,t){super(e,t);const r=i=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",r);return}this.tooltip!=null&&!this.tooltip.root.contains(i.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(s=>{s.container.contains(i.target)||s.close()})};e.emitter.listenDOM("click",document.body,r)}addModule(e){const t=super.addModule(e);return e==="toolbar"&&this.extendToolbar(t),t}buildButtons(e,t){Array.from(e).forEach(r=>{(r.getAttribute("class")||"").split(/\s+/).forEach(s=>{if(s.startsWith("ql-")&&(s=s.slice(3),t[s]!=null))if(s==="direction")r.innerHTML=t[s][""]+t[s].rtl;else if(typeof t[s]=="string")r.innerHTML=t[s];else{const a=r.value||"";a!=null&&t[s][a]&&(r.innerHTML=t[s][a])}})})}buildPickers(e,t){this.pickers=Array.from(e).map(i=>{if(i.classList.contains("ql-align")&&(i.querySelector("option")==null&&cc(i,Uk),typeof t.align=="object"))return new Hb(i,t.align);if(i.classList.contains("ql-background")||i.classList.contains("ql-color")){const s=i.classList.contains("ql-background")?"background":"color";return i.querySelector("option")==null&&cc(i,zk,s==="background"?"#ffffff":"#000000"),new zb(i,t[s])}return i.querySelector("option")==null&&(i.classList.contains("ql-font")?cc(i,Hk):i.classList.contains("ql-header")?cc(i,Wk):i.classList.contains("ql-size")&&cc(i,Vk)),new Zd(i)});const r=()=>{this.pickers.forEach(i=>{i.update()})};this.quill.on(Ge.events.EDITOR_CHANGE,r)}}cu.DEFAULTS=za({},kl.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let n=this.container.querySelector("input.ql-image[type=file]");n==null&&(n=document.createElement("input"),n.setAttribute("type","file"),n.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),n.classList.add("ql-image"),n.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,n.files),n.value=""}),this.container.appendChild(n)),n.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class Vb extends Wb{constructor(e,t){super(e,t),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;t!=null?this.textbox.value=t:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const r=this.quill.getBounds(this.quill.selection.savedRange);r!=null&&this.position(r),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:t}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,Ge.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,Ge.sources.USER)),this.quill.root.scrollTop=t;break}case"video":e=Gk(e);case"formula":{if(!e)break;const t=this.quill.getSelection(!0);if(t!=null){const r=t.index+t.length;this.quill.insertEmbed(r,this.root.getAttribute("data-mode"),e,Ge.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(r+1," ",Ge.sources.USER),this.quill.setSelection(r+2,Ge.sources.USER)}break}}this.textbox.value="",this.hide()}}function Gk(n){let e=n.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||n.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=n.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:n}function cc(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(r=>{const i=document.createElement("option");r===t?i.setAttribute("selected","selected"):i.setAttribute("value",String(r)),n.appendChild(i)})}const Kk=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class Gb extends Vb{constructor(e,t){super(e,t),this.quill.on(Ge.events.EDITOR_CHANGE,(r,i,s,a)=>{if(r===Ge.events.SELECTION_CHANGE)if(i!=null&&i.length>0&&a===Ge.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const o=this.quill.getLines(i.index,i.length);if(o.length===1){const l=this.quill.getBounds(i);l!=null&&this.position(l)}else{const l=o[o.length-1],c=this.quill.getIndex(l),d=Math.min(l.length()-1,i.index+i.length-c),m=this.quill.getBounds(new ko(c,d));m!=null&&this.position(m)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(Ge.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const t=this.quill.getBounds(e);t!=null&&this.position(t)}},1)})}cancel(){this.show()}position(e){const t=super.position(e),r=this.root.querySelector(".ql-tooltip-arrow");return r.style.marginLeft="",t!==0&&(r.style.marginLeft=`${-1*t-r.offsetWidth/2}px`),t}}Re(Gb,"TEMPLATE",['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""));class Kb extends cu{constructor(e,t){t.modules.toolbar!=null&&t.modules.toolbar.container==null&&(t.modules.toolbar.container=Kk),super(e,t),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new Gb(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),Kc),this.buildPickers(e.container.querySelectorAll("select"),Kc))}}Kb.DEFAULTS=za({},cu.DEFAULTS,{modules:{toolbar:{handlers:{link(n){n?this.quill.theme.tooltip.edit():this.quill.format("link",!1,Ne.sources.USER)}}}}});const Yk=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class Yb extends Vb{constructor(){super(...arguments);Re(this,"preview",this.root.querySelector("a.ql-preview"))}listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",t=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),t.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",t=>{if(this.linkRange!=null){const r=this.linkRange;this.restoreFocus(),this.quill.formatText(r,"link",!1,Ge.sources.USER),delete this.linkRange}t.preventDefault(),this.hide()}),this.quill.on(Ge.events.SELECTION_CHANGE,(t,r,i)=>{if(t!=null){if(t.length===0&&i===Ge.sources.USER){const[s,a]=this.quill.scroll.descendant(Fa,t.index);if(s!=null){this.linkRange=new ko(t.index-a,s.length());const o=Fa.formats(s.domNode);this.preview.textContent=o,this.preview.setAttribute("href",o),this.show();const l=this.quill.getBounds(this.linkRange);l!=null&&this.position(l);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}Re(Yb,"TEMPLATE",['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""));class Jb extends cu{constructor(e,t){t.modules.toolbar!=null&&t.modules.toolbar.container==null&&(t.modules.toolbar.container=Yk),super(e,t),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),Kc),this.buildPickers(e.container.querySelectorAll("select"),Kc),this.tooltip=new Yb(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(t,r)=>{e.handlers.link.call(e,!r.format.link)}))}}Jb.DEFAULTS=za({},cu.DEFAULTS,{modules:{toolbar:{handlers:{link(n){if(n){const e=this.quill.getSelection();if(e==null||e.length===0)return;let t=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(t)&&t.indexOf("mailto:")!==0&&(t=`mailto:${t}`);const{tooltip:r}=this.quill.theme;r.edit("link",t)}else this.quill.format("link",!1,Ne.sources.USER)}}}}});Ne.register({"attributors/attribute/direction":Tb,"attributors/class/align":Nb,"attributors/class/background":fN,"attributors/class/color":hN,"attributors/class/direction":Cb,"attributors/class/font":Rb,"attributors/class/size":Db,"attributors/style/align":kb,"attributors/style/background":Hp,"attributors/style/color":zp,"attributors/style/direction":Ib,"attributors/style/font":Pb,"attributors/style/size":Bb},!0);Ne.register({"formats/align":Nb,"formats/direction":Cb,"formats/indent":rk,"formats/background":Hp,"formats/color":zp,"formats/font":Rb,"formats/size":Db,"formats/blockquote":Zf,"formats/code-block":$r,"formats/header":Qf,"formats/list":lu,"formats/bold":Gc,"formats/code":Wp,"formats/italic":ep,"formats/link":Fa,"formats/script":tp,"formats/strike":np,"formats/underline":rp,"formats/formula":cd,"formats/image":ip,"formats/video":ud,"modules/syntax":Ub,"modules/table":sk,"modules/toolbar":Jp,"themes/bubble":Kb,"themes/snow":Jb,"ui/icons":Kc,"ui/picker":Zd,"ui/icon-picker":Hb,"ui/color-picker":zb,"ui/tooltip":Wb},!0);let Yc=[],po=null;async function Xb(){const{data:n,error:e}=await H_();if(e){console.error("Failed to load contracts:",e.message);return}Yc=n}function Zb(){return Yc.length===0?"<p>No contract versions yet. Create the first one below.</p>":`
    <table class="data-table">
      <thead>
        <tr>
          <th>Version</th>
          <th>Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${Yc.map(n=>`
          <tr>
            <td>v${n.version_number}</td>
            <td>${n.is_active?'<span class="badge active">Active</span>':"Inactive"}</td>
            <td>${new Date(n.created_at).toLocaleDateString()}</td>
            <td>
              ${n.is_active?"":`<button class="btn-small" data-activate="${n.id}">Set Active</button>`}
              <button class="btn-small btn-secondary" data-preview="${n.id}">Preview</button>
            </td>
          </tr>`).join("")}
      </tbody>
    </table>
  `}function Qb(){document.querySelectorAll("[data-activate]").forEach(e=>{e.addEventListener("click",async()=>{const t=e.getAttribute("data-activate");e.disabled=!0,e.textContent="Activating";const{error:r}=await V_(t);if(r){alert("Failed to activate contract: "+r.message),e.disabled=!1,e.textContent="Set Active";return}await H1()})}),document.querySelectorAll("[data-preview]").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-preview"),r=Yc.find(i=>i.id===t);if(r){const i=document.getElementById("contract-preview");i.innerHTML=`
          <h3>Contract v${r.version_number} Preview</h3>
          <div class="contract-text">${Ip(r.text_snapshot)}</div>
        `}})});const n=document.getElementById("create-contract-form");n&&n.addEventListener("submit",async e=>{e.preventDefault();const t=po?po.root.innerHTML:"",r=document.getElementById("create-contract-message");if(!(po?po.getText().trim():"")){r.textContent="Contract text is required.",r.className="form-message error";return}const{user:s}=Jt(),a=Dx(Yc),o=n.querySelector('button[type="submit"]');o.disabled=!0,o.textContent="Creating",r.textContent="";const{data:l,error:c}=await W_(a,t,s.id);if(c){r.textContent="Failed to create contract: "+c.message,r.className="form-message error",o.disabled=!1,o.textContent="Create Contract Version";return}l&&So("create_contract","contracts",l.id,{version_number:a}),po&&po.setText(""),r.textContent=`Contract v${a} created successfully.`,r.className="form-message success",o.disabled=!1,o.textContent="Create Contract Version",await H1()})}async function H1(){await Xb();const n=document.getElementById("contract-list");n&&(n.innerHTML=Zb(),Qb())}function Jk(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Contract Management </h1>
      <button class="btn-ghost" onclick="location.hash='#/admin'" style="min-height:auto;width:auto"> Dashboard</button>
    </div>

    <div class="card" style="margin-bottom:var(--space-lg)">
      <h2 style="margin-bottom:var(--space-md)">Contract Versions</h2>
      <div id="contract-list"><p>Loading</p></div>
    </div>

    <div id="contract-preview" class="contract-preview-box card" style="margin-bottom:var(--space-lg)"></div>

    <div class="card">
      <h2 style="margin-bottom:var(--space-md)">Create New Version</h2>
      <form id="create-contract-form" class="login-form" style="max-width:none">
        <label>Contract Text</label>
        <div id="quill-editor"></div>
        <button type="submit" class="btn-accent">Create Contract Version</button>
        <div id="create-contract-message" class="form-message" aria-live="polite"></div>
      </form>
    </div>
  `,setTimeout(async()=>{const e=document.getElementById("quill-editor");e&&(po=new Ne(e,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,4,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["blockquote","link"],["clean"]]},placeholder:"Enter the contract text here"})),await Xb();const t=document.getElementById("contract-list");t&&(t.innerHTML=Zb(),Qb())},0),n}let _o=[],Xp=[],Jc="",xo="";function Xk(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Student Registrations</h1>
      <button class="btn-ghost" onclick="location.hash='#/admin'" style="min-height:auto;width:auto"> Admin Dashboard</button>
    </div>
    <div class="form-message" id="registrations-msg" aria-live="polite"></div>
    <div id="registrations-content"><p>Loading</p></div>
  `,setTimeout(()=>Zk(),0),n}async function Zk(){const[n,e]=await Promise.all([z_(),Hd()]);if(n.error){Qk(n.error.message||"Failed to load students.");return}_o=n.data||[],Xp=e.data||[],yc()}function Qk(n){const e=document.getElementById("registrations-content");e&&(e.innerHTML=`<div class="placeholder-notice">${ye(n)}</div>`)}function sp(n){var t;return((t=Pl(n.role_preferences||[])[0])==null?void 0:t.audition_role_id)||""}function e6(n){var e;return n&&((e=Xp.find(t=>t.id===n))==null?void 0:e.name)||""}function t6(){return _o.filter(n=>Jc&&String(n.grade||"")!==Jc?!1:xo?xo==="__none__"?!sp(n):sp(n)===xo:!0)}function n6(){const e=[...new Set(_o.map(r=>String(r.grade||"").trim()).filter(Boolean))].sort((r,i)=>r.localeCompare(i,void 0,{numeric:!0})).map(r=>`<option value="${ye(r)}" ${Jc===r?"selected":""}>${ye(r)}</option>`).join(""),t=Xp.map(r=>`<option value="${r.id}" ${xo===r.id?"selected":""}>${ye(r.name)}</option>`).join("");return`
    <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);align-items:flex-end;margin-bottom:var(--space-md)">
      <div>
        <label for="registration-filter-grade" style="font-size:var(--text-small);font-weight:600">Grade</label>
        <select id="registration-filter-grade" style="min-width:140px">
          <option value="">All Grades</option>
          ${e}
        </select>
      </div>
      <div>
        <label for="registration-filter-role" style="font-size:var(--text-small);font-weight:600">Role (#1 Preference)</label>
        <select id="registration-filter-role" style="min-width:220px">
          <option value="">All Roles</option>
          ${t}
          <option value="__none__" ${xo==="__none__"?"selected":""}>No Preference</option>
        </select>
      </div>
      <button id="registration-clear-filters" class="btn-small btn-secondary">Clear Filters</button>
    </div>
  `}function r6(n){return n.length===0?'<div class="placeholder-notice">No students match the selected filters.</div>':`
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Student</th>
            <th>Grade</th>
            <th>#1 Role</th>
            <th>Registration</th>
            <th>Callback</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>${n.map(t=>{const r=`${t.first_name||""} ${t.last_name||""}`.trim(),i=e6(sp(t));return`
      <tr>
        <td>
          <a href="#/staff/student-profile?id=${t.id}" data-registration-student-link="${t.id}">
            ${ye(r||"Unnamed Student")}
          </a>
        </td>
        <td>${ye(t.grade||"")}</td>
        <td>${i?ye(i):'<span style="color:var(--color-text-muted)"></span>'}</td>
        <td>${t.registration_complete?'<span class="status-badge--complete">Complete</span>':'<span class="status-badge--pending">Incomplete</span>'}</td>
        <td>${t.callback_invited?"":""}</td>
        <td><button class="btn-small btn-secondary delete-registration-btn" data-student-id="${t.id}">Delete</button></td>
      </tr>
    `}).join("")}</tbody>
      </table>
    </div>
  `}function i6(){const n=document.getElementById("registration-filter-grade");n&&n.addEventListener("change",()=>{Jc=n.value,yc()});const e=document.getElementById("registration-filter-role");e&&e.addEventListener("change",()=>{xo=e.value,yc()});const t=document.getElementById("registration-clear-filters");t&&t.addEventListener("click",()=>{Jc="",xo="",yc()}),document.querySelectorAll(".delete-registration-btn").forEach(r=>{r.addEventListener("click",async()=>{const i=r.getAttribute("data-student-id"),s=_o.find(c=>c.id===i),a=`${(s==null?void 0:s.first_name)||""} ${(s==null?void 0:s.last_name)||""}`.trim()||"this student";if(!i||!window.confirm(`Delete registration for ${a}? This permanently removes the student and related records.`))return;r.disabled=!0,r.textContent="Deleting";const o=document.getElementById("registrations-msg"),{error:l}=await Ov(i);if(l){r.disabled=!1,r.textContent="Delete",o&&(o.className="form-message error",o.textContent=l.message||"Failed to delete registration.");return}_o=_o.filter(c=>c.id!==i),o&&(o.className="form-message success",o.textContent=`Deleted registration for ${a}.`),yc()})})}function yc(){const n=document.getElementById("registrations-content");if(!n)return;const e=t6();n.innerHTML=`
    ${n6()}
    <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
      Showing <strong>${e.length}</strong> of <strong>${_o.length}</strong> students.
    </p>
    ${r6(e)}
  `,i6()}async function s6(n){const[e,t]=await Promise.all([Np(),Ol(n)]),r=e.data,i=t.data||[],s=await Promise.all(i.map(async a=>{const{data:o}=await Fd(a.id);return{...a,acceptances:o||[]}}));return{activeContract:r,students:s}}function a6(n,e){if(qv(n.acceptances,e.id)){const r=n.acceptances.find(i=>i.contract_id===e.id);return`
      <div class="card" style="margin-bottom:var(--space-md);border-left:4px solid var(--color-success)">
        <div class="acceptance-status success-box" style="margin:0">
          <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-sm)">
            <span class="status-badge--complete"> Signed</span>
            <strong>${ye(n.first_name||"this student")}</strong>
          </div>
          <p style="font-size:var(--text-small);color:var(--color-text-secondary)">Student: ${ye(r.student_typed_signature)}</p>
          <p style="font-size:var(--text-small);color:var(--color-text-secondary)">Parent: ${ye(r.parent_typed_signature)}</p>
          <p style="font-size:var(--text-small);color:var(--color-text-muted)">Signed: ${new Date(r.created_at).toLocaleString()}</p>
        </div>
      </div>
    `}return`
    <div class="card" style="margin-bottom:var(--space-md)">
      <form class="signing-form login-form" data-student-id="${n.id}" data-contract-id="${e.id}" style="margin:0;padding:0;border:none;max-width:100%">
        <h3 style="margin-bottom:var(--space-md)">Sign for ${ye(n.first_name||"Student")} ${ye(n.last_name||"")}</h3>
        <label>
          <input type="checkbox" class="agree-checkbox" style="margin-right:var(--space-sm)" />
          I have read and agree to the terms above
        </label>
        <label for="student-sig-${n.id}">Student Typed Signature</label>
        <input type="text" id="student-sig-${n.id}" required placeholder="Type student's full name" disabled />
        <label for="parent-sig-${n.id}">Parent/Guardian Typed Signature</label>
        <input type="text" id="parent-sig-${n.id}" required placeholder="Type parent/guardian's full name" disabled />
        <button type="submit" class="btn-accent" disabled>Sign & Complete</button>
        <div class="form-message" data-msg-student="${n.id}" aria-live="polite"></div>
      </form>
    </div>
  `}function o6(n){document.querySelectorAll(".agree-checkbox").forEach(e=>{e.addEventListener("change",()=>{const t=e.closest(".signing-form"),r=t.querySelectorAll('input[type="text"]'),i=t.querySelector('button[type="submit"]');r.forEach(a=>{a.disabled=!e.checked});function s(){const a=Array.from(r).every(o=>o.value.trim());i.disabled=!(e.checked&&a)}s(),r.forEach(a=>a.addEventListener("input",s))})}),document.querySelectorAll(".signing-form").forEach(e=>{e.addEventListener("submit",async t=>{t.preventDefault();const r=e.getAttribute("data-student-id"),i=e.getAttribute("data-contract-id"),s=document.getElementById(`student-sig-${r}`).value.trim(),a=document.getElementById(`parent-sig-${r}`).value.trim(),o=document.querySelector(`[data-msg-student="${r}"]`),l=e.querySelector("button"),{valid:c,errors:d}=jv(s,a);if(!c){o.textContent=d.join(" "),o.className="form-message error";return}l.disabled=!0,l.textContent="Signing",o.textContent="";const{error:m}=await Rv({studentId:r,contractId:i,studentTypedSignature:s,parentTypedSignature:a,signedByUserId:n});if(m){o.textContent="Failed to sign: "+m.message,o.className="form-message error",l.disabled=!1,l.textContent="Sign & Complete";return}o.textContent="Contract signed successfully! ",o.className="form-message success",l.disabled=!0,l.textContent="Signed "})})}function l6(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <p><a href="#/family"> Back to Dashboard</a></p>
    <h1>Contract </h1>
    <div id="contract-content"><p>Loading</p></div>
  `,setTimeout(async()=>{const{user:e}=Jt();if(!e)return;const{activeContract:t,students:r}=await s6(e.id),i=document.getElementById("contract-content");if(i){if(!t){i.innerHTML=`
        <div class="placeholder-notice">
          No active contract is available at this time. Please check back later.
        </div>
      `;return}if(r.length===0){i.innerHTML=`
        <div class="placeholder-notice">
          No students registered yet. Please <a href="#/family/register">complete student registration</a> first.
        </div>
      `;return}i.innerHTML=`
      <h2>Contract (v${t.version_number})</h2>
      <div class="contract-text">${Ip(t.text_snapshot)}</div>
      <hr>
      <h2>Signatures</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Please read the contract above, then sign for each student below.
      </p>
      ${r.map(s=>a6(s,t)).join("")}
    `,o6(e.id)}},0),n}const e2="student-photos";function c6(n,e){var i;const t=((i=e.split(".").pop())==null?void 0:i.toLowerCase())||"jpg",r=crypto.randomUUID();return`${n}/${r}.${t}`}async function u6(n,e){const{data:t,error:r}=await Fe.storage.from(e2).upload(n,e,{upsert:!0});return{data:t,error:r}}async function Zp(n,e=300){const{data:t,error:r}=await Fe.storage.from(e2).createSignedUrl(n,e);return{url:(t==null?void 0:t.signedUrl)||null,error:r}}async function Qp({to:n,subject:e,text:t,html:r=null}){const{data:i,error:s}=await Fe.functions.invoke("send-notification-email",{body:{to:n,subject:e,text:t,html:r}});return{data:i,error:s}}async function d6(n){const{data:e,error:t}=await Fe.functions.invoke("send-registration-schedule-email",{body:{studentId:n}});return{data:e,error:t}}let ra=[],De=null,la=[],oi=null,Qn=1,t2=null,Tl=[],Cl=[];function h6(){const n=window.location.hash||"",e=n.indexOf("?");return e===-1?null:new URLSearchParams(n.slice(e+1)).get("studentId")||null}function em(){return Tl.length>0&&Va(t2)}function n2(){const n=["Student Info","Parent/Guardian","Audition Song","Photo"];return em()&&n.push("Role Preferences"),n.push("Review & Sign"),n}async function f6(n,e=null,t=!1){const[r,i,s,a]=await Promise.all([Ol(n),Np(),Rl(),Hd()]);if(ra=r.data||[],oi=i.data,t2=s.data,Tl=a.data||[],t?De=null:e?De=ra.find(o=>o.id===e)||null:ra.length>0?De=ra[0]:De=null,De){const[o,l]=await Promise.all([Fd(De.id),em()?px(De.id):{data:[]}]);la=o.data||[],Cl=l.data||[]}else la=[],Cl=[]}function p6(){const n=n2();let e='<div class="wizard-progress">';for(let t=1;t<=n.length;t++){t>1&&(e+=`<div class="wizard-progress__connector${t<=Qn?" wizard-progress__connector--complete":""}"></div>`);let r="wizard-progress__dot",i=String(t);t<Qn?(r+=" wizard-progress__dot--complete",i=""):t===Qn&&(r+=" wizard-progress__dot--active"),e+=`<div class="wizard-progress__step"><div class="${r}">${i}</div><span class="${t===Qn?"wizard-progress__label wizard-progress__label--active":"wizard-progress__label"}">${n[t-1]}</span></div>`}return e+="</div>",e}function m6(){let n="";if(ra.length>1){const e=ra.map(t=>{const r=De&&t.id===De.id?"selected":"";return`<option value="${t.id}" ${r}>${ye(t.first_name||"Unnamed")} ${ye(t.last_name||"Student")}</option>`}).join("");n+=`<div class="student-selector"><label for="student-select"><strong>Student:</strong></label><select id="student-select">${e}</select></div>`}return ra.length>=1&&(n+=`
      <div style="display:flex;gap:var(--space-sm);flex-wrap:wrap;margin-bottom:var(--space-md)">
        <button id="add-student-btn" class="btn-small">+ Add Another Student</button>
        ${De?'<button id="clear-registration-btn" class="btn-small btn-secondary">Clear This Registration</button>':""}
      </div>
    `),n}function g6(){const n=Cp(De,la,(oi==null?void 0:oi.id)||null);return n.complete?'<div class="enchanted-banner" style="margin-bottom:var(--space-md)"><div class="enchanted-banner__icon"></div><div class="enchanted-banner__content"><div class="enchanted-banner__title">Registration Complete!</div><div class="enchanted-banner__message">All requirements are met. Dance and vocal schedules are assigned by staff.</div><a class="enchanted-banner__link" href="#/family/schedule">View schedule </a></div></div>':`<div class="warning-box student-card" style="margin-bottom:var(--space-md)"><strong>Registration Incomplete</strong><p style="margin-top:var(--space-xs)">Still needed:</p><ul style="margin:0.25rem 0 0 1.25rem;padding:0">${n.missing.map(e=>`<li>${e}</li>`).join("")}</ul></div>`}function v6(){return De&&(De.parent_first_name||De.parent_email)?De:ra.find(e=>e.parent_first_name||e.parent_email)||De||{}}function b6(){const n=De||{};return`
    <div class="card">
      <h2>Student Information</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">Enter the student's basic details.</p>
      <form id="student-form" class="login-form" style="max-width:100%">
        <label for="reg-first-name">First Name *</label>
        <input type="text" id="reg-first-name" required value="${ye(n.first_name||"")}" />
        <label for="reg-last-name">Last Name *</label>
        <input type="text" id="reg-last-name" required value="${ye(n.last_name||"")}" />
        <label for="reg-grade">Grade *</label>
        <input type="text" id="reg-grade" required value="${ye(n.grade||"")}" placeholder="e.g. 5, 6, 7" />
        <label for="reg-student-email">Student Email (optional)</label>
        <input type="email" id="reg-student-email" value="${ye(n.student_email||"")}" placeholder="student@example.com" />
        <button type="submit" class="btn-accent">Save & Continue</button>
        <div id="student-form-msg" class="form-message" aria-live="polite"></div>
      </form>
    </div>
  `}function y6(){if(!De)return'<div class="card"><h2>Parent/Guardian Information</h2><p class="placeholder-notice">Complete student info first.</p></div>';const n=v6();return`
    <div class="card">
      <h2>Parent/Guardian Information</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">This information is used for communication and day-of logistics.</p>
      <form id="parent-form" class="login-form" style="max-width:100%">
        <label for="reg-parent-first">First Name *</label>
        <input type="text" id="reg-parent-first" required value="${ye(n.parent_first_name||"")}" />
        <label for="reg-parent-last">Last Name *</label>
        <input type="text" id="reg-parent-last" required value="${ye(n.parent_last_name||"")}" />
        <label for="reg-parent-email">Email *</label>
        <input type="email" id="reg-parent-email" required value="${ye(n.parent_email||"")}" />
        <label for="reg-parent-phone">Phone *</label>
        <input type="tel" id="reg-parent-phone" required value="${ye(n.parent_phone||"")}" placeholder="(555) 123-4567" />

        <div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">
          <label style="display:flex;align-items:center;gap:var(--space-sm);cursor:pointer">
            <input type="checkbox" id="reg-show-parent2" ${n.parent2_first_name||n.parent2_email?"checked":""} />
            Add second parent/guardian (optional)
          </label>
        </div>
        <div id="parent2-fields" style="display:${n.parent2_first_name||n.parent2_email?"block":"none"};margin-top:var(--space-sm)">
          <label for="reg-parent2-first">First Name</label>
          <input type="text" id="reg-parent2-first" value="${ye(n.parent2_first_name||"")}" />
          <label for="reg-parent2-last">Last Name</label>
          <input type="text" id="reg-parent2-last" value="${ye(n.parent2_last_name||"")}" />
          <label for="reg-parent2-email">Email</label>
          <input type="email" id="reg-parent2-email" value="${ye(n.parent2_email||"")}" />
          <label for="reg-parent2-phone">Phone</label>
          <input type="tel" id="reg-parent2-phone" value="${ye(n.parent2_phone||"")}" placeholder="(555) 123-4567" />
        </div>

        <button type="submit" class="btn-accent">Save & Continue</button>
        <div id="parent-form-msg" class="form-message" aria-live="polite"></div>
      </form>
    </div>
  `}function w6(){if(!De)return'<div class="card"><h2>Audition Song</h2><p class="placeholder-notice">Complete student info first.</p></div>';const n=De,e=n.sings_own_disney_song||!1;return`
    <div class="card">
      <h2>Audition Song</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Will this student sing their own Disney song for the vocal audition?
      </p>
      <form id="song-form" class="login-form" style="max-width:100%">
        <div style="display:flex;gap:var(--space-lg);margin-bottom:var(--space-md)">
          <label style="display:flex;align-items:center;gap:var(--space-xs);cursor:pointer">
            <input type="radio" name="sings-own" value="yes" ${e?"checked":""} /> Yes
          </label>
          <label style="display:flex;align-items:center;gap:var(--space-xs);cursor:pointer">
            <input type="radio" name="sings-own" value="no" ${e?"":"checked"} /> No
          </label>
        </div>
        <div id="song-name-field" style="display:${e?"block":"none"}">
          <label for="reg-song-name">Song Name *</label>
          <input type="text" id="reg-song-name" value="${ye(n.song_name||"")}" placeholder="e.g. Part of Your World" />
        </div>
        <button type="submit" class="btn-accent">Save & Continue</button>
        <div id="song-form-msg" class="form-message" aria-live="polite"></div>
      </form>
    </div>
  `}function _6(){if(!De)return'<div class="card"><h2>Student Photo</h2><p class="placeholder-notice">Complete student info first.</p></div>';const n=De.photo_storage_path;return`
    <div class="card">
      <h2>Student Photo</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Upload a clear headshot photo of the student. This will be included in staff materials.
      </p>
      ${n?'<p class="form-message success" style="margin-bottom:var(--space-sm)"> Photo uploaded. You can replace it below.</p>':""}
      <div id="photo-preview" style="margin-bottom:var(--space-md)"></div>
      <form id="photo-form" class="login-form" style="max-width:100%">
        <input type="file" id="reg-photo" accept="image/*" ${n?"":"required"} />
        <button type="submit" class="btn-accent">${n?"Replace & Continue":"Upload & Continue"}</button>
        <div id="photo-form-msg" class="form-message" aria-live="polite"></div>
      </form>
      ${n?'<button class="btn-ghost skip-step-btn" style="margin-top:var(--space-sm);width:100%">Skip  keep current photo</button>':""}
    </div>
  `}function x6(){if(!De)return'<div class="card"><h2>Role Preferences</h2><p class="placeholder-notice">Complete student info first.</p></div>';const n=Pl(Cl),e=new Map(n.map(s=>[s.audition_role_id,s.rank_order])),t=Tl.map((s,a)=>a+1);let r=Tl.map(s=>{const a=e.get(s.id)||"",o=t.map(l=>`<option value="${l}" ${a===l?"selected":""}>${l}</option>`).join("");return`
      <div class="role-pref-row" style="display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-sm) 0;border-bottom:1px solid var(--color-border)">
        <div style="flex:1"><strong>${ye(s.name)}</strong></div>
        <select class="role-rank-select" data-role-id="${s.id}" style="width:80px">
          <option value=""></option>
          ${o}
        </select>
      </div>
    `}).join("");return`
    <div class="card">
      <h2>Role Preferences</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Rank the roles your student would like to audition for. This helps the director assign audition days.
        This step is optional  you can skip it if you're unsure.
      </p>
      ${n.length>0?'<p class="form-message success" style="margin-bottom:var(--space-sm)"> Preferences saved.</p>':""}
      <div id="role-prefs-list" style="margin-bottom:var(--space-md)">
        ${r}
      </div>
      <button id="save-role-prefs-btn" class="btn-accent" style="width:100%">Save & Continue</button>
      <button id="skip-role-prefs-btn" class="btn-ghost" style="margin-top:var(--space-sm);width:100%">Skip  no preference</button>
      <div id="role-prefs-msg" class="form-message" aria-live="polite"></div>
    </div>
  `}function A6(){if(!De)return'<div class="card"><h2>Review & Sign</h2><p class="placeholder-notice">Complete previous steps first.</p></div>';const n=De,e=oi&&qv(la,oi.id);let t="";if(!oi)t='<p class="placeholder-notice" style="margin-top:var(--space-md)">No active contract available.</p>';else if(e){const r=la.find(i=>i.contract_id===oi.id);t=`
      <div class="success-box" style="padding:var(--space-md);border-radius:var(--radius-sm);margin-top:var(--space-lg)">
        <strong> Contract signed!</strong>
        <p style="font-size:var(--text-small)">Student: ${ye(r.student_typed_signature)}</p>
        <p style="font-size:var(--text-small)">Parent: ${ye(r.parent_typed_signature)}</p>
        <p style="font-size:var(--text-small);color:var(--color-text-muted)">Signed: ${new Date(r.created_at).toLocaleString()}</p>
      </div>
    `}else t=`
      <div style="margin-top:var(--space-lg)">
        <h3>Contract (v${oi.version_number})</h3>
        <div class="contract-text">${Ip(oi.text_snapshot)}</div>
        <form id="contract-form" class="login-form" style="max-width:100%;margin-top:var(--space-md)">
          <label for="reg-student-sig">Student Typed Signature *</label>
          <input type="text" id="reg-student-sig" required placeholder="Type student's full name" />
          <label for="reg-parent-sig">Parent/Guardian Typed Signature *</label>
          <input type="text" id="reg-parent-sig" required placeholder="Type parent/guardian's full name" />
          <button type="submit" class="btn-accent">Sign & Complete Registration</button>
          <div id="contract-form-msg" class="form-message" aria-live="polite"></div>
        </form>
      </div>
    `;return`
    <div class="card">
      <h2>Review & Sign</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">Review your information, then sign the contract to complete registration.</p>

      <div style="display:grid;gap:var(--space-md)">
        <div style="padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-sm)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-xs)">
            <strong>Student Info</strong>
            <button class="link-btn edit-step-btn" data-step="1">Edit</button>
          </div>
          <p style="font-size:var(--text-small)">${ye(n.first_name||"")} ${ye(n.last_name||"")}, Grade ${ye(n.grade||"")}</p>
          ${n.student_email?`<p style="font-size:var(--text-small)">Email: ${ye(n.student_email)}</p>`:""}
        </div>

        <div style="padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-sm)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-xs)">
            <strong>Parent/Guardian</strong>
            <button class="link-btn edit-step-btn" data-step="2">Edit</button>
          </div>
          <p style="font-size:var(--text-small)">${ye(n.parent_first_name||"")} ${ye(n.parent_last_name||"")}</p>
          <p style="font-size:var(--text-small)">${ye(n.parent_email||"")} | ${ye(n.parent_phone||"")}</p>
          ${n.parent2_first_name||n.parent2_email?`
          <p style="font-size:var(--text-small);margin-top:var(--space-xs)"><strong>Parent 2:</strong> ${ye(n.parent2_first_name||"")} ${ye(n.parent2_last_name||"")}</p>
          <p style="font-size:var(--text-small)">${ye(n.parent2_email||"")} | ${ye(n.parent2_phone||"")}</p>
          `:""}
        </div>

        <div style="padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-sm)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-xs)">
            <strong>Audition Song</strong>
            <button class="link-btn edit-step-btn" data-step="3">Edit</button>
          </div>
          <p style="font-size:var(--text-small)">${n.sings_own_disney_song?`Own song: ${ye(n.song_name||"")}`:"No own song"}</p>
        </div>

        <div style="padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-sm)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-xs)">
            <strong>Photo</strong>
            <button class="link-btn edit-step-btn" data-step="4">Edit</button>
          </div>
          <p style="font-size:var(--text-small)">${n.photo_storage_path?" Photo uploaded":" No photo yet"}</p>
        </div>

        ${em()?`
        <div style="padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-sm)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-xs)">
            <strong>Role Preferences</strong>
            <button class="link-btn edit-step-btn" data-step="5">Edit</button>
          </div>
          <p style="font-size:var(--text-small)">${Cl.length>0?Pl(Cl).map(r=>{const i=Tl.find(s=>s.id===r.audition_role_id);return`${r.rank_order}. ${ye((i==null?void 0:i.name)||"Unknown")}`}).join(", "):" No preferences set (optional)"}</p>
        </div>
        `:""}
      </div>

      ${t}
    </div>
  `}async function uc(n){if(!De)return;const e=Cp(De,la,(oi==null?void 0:oi.id)||null),t=De.registration_complete===!0;if(e.complete!==De.registration_complete&&(await pc(De.id,{registration_complete:e.complete},n),De.registration_complete=e.complete),!t&&e.complete){const{error:r}=await d6(De.id);r&&console.error("Registration schedule email failed:",r.message||r)}}function S6(n,e){const t=document.getElementById("student-select");t&&t.addEventListener("change",()=>{Qn=1,e(t.value)});const r=document.getElementById("add-student-btn");r&&r.addEventListener("click",()=>{De=null,la=[],Qn=1,e(null,!0)});const i=document.getElementById("clear-registration-btn");i&&i.addEventListener("click",async()=>{if(!(De!=null&&De.id))return;const s=`${De.first_name||""} ${De.last_name||""}`.trim()||"this student";if(!window.confirm(`Clear registration for ${s}? This deletes the student record and all related registration data.`))return;i.disabled=!0;const{error:o}=await Ov(De.id);if(o){i.disabled=!1,window.alert("Failed to clear registration: "+o.message);return}De=ra.filter(c=>c.id!==De.id)[0]||null,la=[],Cl=[],Qn=1,e((De==null?void 0:De.id)||null,!De)})}function E6(n){const e=document.getElementById("wizard-back-btn");e&&e.addEventListener("click",()=>{Qn>1&&(Qn--,n(De==null?void 0:De.id))}),document.querySelectorAll(".edit-step-btn").forEach(r=>{r.addEventListener("click",()=>{Qn=parseInt(r.dataset.step,10),n(De==null?void 0:De.id)})});const t=document.querySelector(".skip-step-btn");t&&t.addEventListener("click",()=>{Qn++,n(De==null?void 0:De.id)})}async function N6(n){const e=document.getElementById("photo-preview");if(!e||!n)return;const{url:t}=await Zp(n);t&&(e.innerHTML=`<img src="${t}" alt="Student photo" class="photo-preview" />`)}function k6(n,e){const t=document.getElementById("student-form");t&&t.addEventListener("submit",async c=>{var b;c.preventDefault();const d=document.getElementById("student-form-msg"),m=t.querySelector("button"),p={firstName:document.getElementById("reg-first-name").value.trim(),lastName:document.getElementById("reg-last-name").value.trim(),grade:document.getElementById("reg-grade").value.trim()},h=((b=document.getElementById("reg-student-email"))==null?void 0:b.value.trim())||"";if(!p.firstName||!p.lastName||!p.grade){d.textContent="First name, last name, and grade are required.",d.className="form-message error";return}if(m.disabled=!0,m.textContent="Saving",De){const{data:w,error:S}=await pc(De.id,{first_name:p.firstName,last_name:p.lastName,grade:p.grade,student_email:h||null},n);if(S){d.textContent="Error: "+S.message,d.className="form-message error",m.disabled=!1,m.textContent="Save & Continue";return}De={...De,...w},await uc(n),Qn=2,e(De.id)}else{const{data:w,error:S}=await U_({familyAccountId:n,firstName:p.firstName,lastName:p.lastName,grade:p.grade,studentEmail:h||void 0,createdByUserId:n});if(S){d.textContent="Error: "+S.message,d.className="form-message error",m.disabled=!1,m.textContent="Save & Continue";return}De=w,await uc(n),Qn=2,e(De.id)}});const r=document.getElementById("parent-form");if(r){r.addEventListener("submit",async d=>{var A,I,O,P,K;d.preventDefault();const m=document.getElementById("parent-form-msg"),p=r.querySelector("button"),h={parent_first_name:document.getElementById("reg-parent-first").value.trim(),parent_last_name:document.getElementById("reg-parent-last").value.trim(),parent_email:document.getElementById("reg-parent-email").value.trim(),parent_phone:document.getElementById("reg-parent-phone").value.trim()};if(((A=document.getElementById("reg-show-parent2"))==null?void 0:A.checked)?(h.parent2_first_name=((I=document.getElementById("reg-parent2-first"))==null?void 0:I.value.trim())||null,h.parent2_last_name=((O=document.getElementById("reg-parent2-last"))==null?void 0:O.value.trim())||null,h.parent2_email=((P=document.getElementById("reg-parent2-email"))==null?void 0:P.value.trim())||null,h.parent2_phone=((K=document.getElementById("reg-parent2-phone"))==null?void 0:K.value.trim())||null):(h.parent2_first_name=null,h.parent2_last_name=null,h.parent2_email=null,h.parent2_phone=null),!h.parent_first_name||!h.parent_last_name||!h.parent_email||!h.parent_phone){m.textContent="Parent 1 fields are required.",m.className="form-message error";return}if(Cv(h.parent_email)){m.textContent="Student email addresses cannot be used. Please use a parent or guardian email.",m.className="form-message error";return}p.disabled=!0,p.textContent="Saving";const{data:w,error:S}=await pc(De.id,h,n);if(S){m.textContent="Error: "+S.message,m.className="form-message error",p.disabled=!1,p.textContent="Save & Continue";return}De={...De,...w},await uc(n),Qn=3,e(De.id)});const c=document.getElementById("reg-show-parent2");c&&c.addEventListener("change",()=>{const d=document.getElementById("parent2-fields");d&&(d.style.display=c.checked?"block":"none")})}const i=document.getElementById("song-form");i&&(i.querySelectorAll('input[name="sings-own"]').forEach(c=>{c.addEventListener("change",()=>{const d=document.getElementById("song-name-field");d&&(d.style.display=c.value==="yes"&&c.checked?"block":"none")})}),i.addEventListener("submit",async c=>{var O,P;c.preventDefault();const d=document.getElementById("song-form-msg"),m=i.querySelector('button[type="submit"]'),p=((O=i.querySelector('input[name="sings-own"]:checked'))==null?void 0:O.value)==="yes",h=((P=document.getElementById("reg-song-name"))==null?void 0:P.value.trim())||"",{valid:b,error:w}=Lx(p,h);if(!b){d.textContent=w,d.className="form-message error";return}m.disabled=!0,m.textContent="Saving";const S={sings_own_disney_song:p,song_name:p?h:null},{data:A,error:I}=await pc(De.id,S,n);if(I){d.textContent="Error: "+I.message,d.className="form-message error",m.disabled=!1,m.textContent="Save & Continue";return}De={...De,...A},Qn=4,e(De.id)}));const s=document.getElementById("photo-form");s&&(s.addEventListener("submit",async c=>{c.preventDefault();const d=document.getElementById("photo-form-msg"),m=s.querySelector("button"),h=document.getElementById("reg-photo").files[0];if(!h){d.textContent="Please select a photo.",d.className="form-message error";return}m.disabled=!0,m.textContent="Uploading",d.textContent="";try{const b=c6(n,h.name),{error:w}=await u6(b,h);if(w){d.textContent="Upload failed: "+(w.message||JSON.stringify(w)),d.className="form-message error",m.disabled=!1,m.textContent="Upload & Continue";return}const{data:S,error:A}=await pc(De.id,{photo_storage_path:b},n);if(A){d.textContent="Error saving photo reference: "+(A.message||JSON.stringify(A)),d.className="form-message error",m.disabled=!1,m.textContent="Upload & Continue";return}De={...De,...S},await uc(n),Qn++,e(De.id)}catch(b){d.textContent="Unexpected error: "+(b.message||String(b)),d.className="form-message error",m.disabled=!1,m.textContent="Upload & Continue"}}),De!=null&&De.photo_storage_path&&N6(De.photo_storage_path));const a=document.getElementById("save-role-prefs-btn");a&&a.addEventListener("click",async()=>{const c=document.getElementById("role-prefs-msg"),d=document.querySelectorAll(".role-rank-select"),m=[];d.forEach(b=>{const w=parseInt(b.value,10);w&&m.push({roleId:b.dataset.roleId,rank:w})});const p=_x(m,Tl);if(!p.valid){c&&(c.textContent=p.errors[0]||"Each rank can only be used once.",c.className="form-message error");return}a.disabled=!0,a.textContent="Saving",c&&(c.textContent="");const{error:h}=await mx(De.id,m,n);if(h){c&&(c.textContent="Error: "+h.message,c.className="form-message error"),a.disabled=!1,a.textContent="Save & Continue";return}Qn++,e(De.id)});const o=document.getElementById("skip-role-prefs-btn");o&&o.addEventListener("click",()=>{Qn++,e(De.id)});const l=document.getElementById("contract-form");l&&l.addEventListener("submit",async c=>{c.preventDefault();const d=document.getElementById("contract-form-msg"),m=l.querySelector("button"),p=document.getElementById("reg-student-sig").value.trim(),h=document.getElementById("reg-parent-sig").value.trim(),{valid:b,errors:w}=jv(p,h);if(!b){d.textContent=w.join(" "),d.className="form-message error";return}m.disabled=!0,m.textContent="Signing";const{error:S}=await Rv({studentId:De.id,contractId:oi.id,studentTypedSignature:p,parentTypedSignature:h,signedByUserId:n});if(S){d.textContent="Error: "+S.message,d.className="form-message error",m.disabled=!1,m.textContent="Sign & Complete Registration";return}const{data:A}=await Fd(De.id);la=A||[],await uc(n),e(De.id)})}function L6(){const n=document.createElement("div");n.className="page",n.innerHTML=`
    <p><a href="#/family"> Back to Dashboard</a></p>
    <h1>Student Registration </h1>
    <div id="reg-student-selector"></div>
    <div id="reg-checklist"></div>
    <div id="reg-content"><p>Loading</p></div>
  `;const{user:e}=Jt();if(!e)return n;const t=h6();async function r(i,s=!1){await f6(e.id,i,s);const a=document.getElementById("reg-student-selector"),o=document.getElementById("reg-checklist"),l=document.getElementById("reg-content");if(!l)return;a&&(a.innerHTML=m6()),o&&(o.innerHTML=De?g6():"");const c=n2(),d=c[Qn-1]||c[c.length-1];let m="";d==="Student Info"?m=b6():d==="Parent/Guardian"?m=y6():d==="Audition Song"?m=w6():d==="Photo"?m=_6():d==="Role Preferences"?m=x6():d==="Review & Sign"&&(m=A6());const p=Qn>1?'<button id="wizard-back-btn" class="btn-ghost" style="margin-bottom:var(--space-md)"> Back</button>':"";l.innerHTML=`
      ${p6()}
      ${p}
      ${m}
    `,S6(e.id,r),E6(r),k6(e.id,r)}return setTimeout(()=>r(t),0),n}let Td=[];async function T6(){const{data:n,error:e}=await Po();if(e){console.error("Failed to load configs:",e.message);return}Td=n}function C6(){const{role:n}=Jt();return Td.length===0?"<p>No audition dates configured yet.</p>":`
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Dance</th>
          <th>Vocal</th>
          <th>Callback</th>
          <th>Last Updated By</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${Td.map(e=>`
          <tr>
            <td>${rn(e.audition_date)}</td>
            <td>${bt(e.dance_start_time)}  ${bt(e.dance_end_time)}</td>
            <td>${bt(e.vocal_start_time)}  ${bt(e.vocal_end_time)}</td>
            <td>${bt(e.callback_start_time)}  ${bt(e.callback_end_time)}</td>
            <td>${new Date(e.updated_at).toLocaleString()}</td>
            <td>
              <button class="btn-small" data-edit="${e.id}">Edit</button>
              ${Ro(n)?`<button class="btn-small btn-secondary" data-delete="${e.id}">Delete</button>`:""}
            </td>
          </tr>`).join("")}
      </tbody>
    </table>
    </div>
    <p class="lock-time-notice">Lock time: ${Pv} (server-enforced, admin override only)</p>
  `}function tm(n){const e=n||{},t=!!n;return`
    <form id="config-form" class="login-form">
      <h3>${t?"Edit":"Add"} Audition Date</h3>
      ${t?`<input type="hidden" id="config-id" value="${e.id}" />`:""}
      <label for="cfg-date">Audition Date *</label>
      <input type="date" id="cfg-date" required value="${e.audition_date||""}" ${t?"readonly":""} />

      <label for="cfg-dance-start">Dance Start Time</label>
      <input type="time" id="cfg-dance-start" value="${e.dance_start_time||""}" />
      <label for="cfg-dance-end">Dance End Time</label>
      <input type="time" id="cfg-dance-end" value="${e.dance_end_time||""}" />

      <label for="cfg-vocal-start">Vocal Start Time</label>
      <input type="time" id="cfg-vocal-start" value="${e.vocal_start_time||""}" />
      <label for="cfg-vocal-end">Vocal End Time</label>
      <input type="time" id="cfg-vocal-end" value="${e.vocal_end_time||""}" />

      <label for="cfg-callback-start">Callback Start Time</label>
      <input type="time" id="cfg-callback-start" value="${e.callback_start_time||""}" />
      <label for="cfg-callback-end">Callback End Time</label>
      <input type="time" id="cfg-callback-end" value="${e.callback_end_time||""}" />

      <button type="submit">${t?"Update":"Add"} Date</button>
      ${t?'<button type="button" id="cancel-edit" class="btn-small btn-secondary" style="margin-top:0.25rem">Cancel</button>':""}
      <div id="config-form-msg" class="form-message" aria-live="polite"></div>
    </form>
  `}function I6(n){document.querySelectorAll("[data-edit]").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-edit"),r=Td.find(i=>i.id===t);if(r){const i=document.getElementById("config-form-container");i&&(i.innerHTML=tm(r),ap(n))}})}),document.querySelectorAll("[data-delete]").forEach(e=>{e.addEventListener("click",async()=>{const t=e.getAttribute("data-delete");if(!window.confirm("Delete this audition date config?"))return;e.disabled=!0;const{error:r}=await Y_(t);if(r){alert("Failed to delete: "+r.message),e.disabled=!1;return}n()})}),ap(n)}function ap(n){const e=document.getElementById("config-form");if(!e)return;const t=document.getElementById("cancel-edit");t&&t.addEventListener("click",()=>{const r=document.getElementById("config-form-container");r&&(r.innerHTML=tm(null),ap(n))}),e.addEventListener("submit",async r=>{r.preventDefault();const{user:i}=Jt(),s=document.getElementById("config-form-msg"),a=e.querySelector('button[type="submit"]'),o=document.getElementById("config-id"),l=!!o,c={audition_date:document.getElementById("cfg-date").value,dance_start_time:document.getElementById("cfg-dance-start").value||null,dance_end_time:document.getElementById("cfg-dance-end").value||null,vocal_start_time:document.getElementById("cfg-vocal-start").value||null,vocal_end_time:document.getElementById("cfg-vocal-end").value||null,callback_start_time:document.getElementById("cfg-callback-start").value||null,callback_end_time:document.getElementById("cfg-callback-end").value||null},{valid:d,errors:m}=J_(c);if(!d){s.textContent=m.join(" "),s.className="form-message error";return}a.disabled=!0,a.textContent="Saving",s.textContent="";let p;if(l){const h={...c};delete h.audition_date,p=await K_(o.value,h,i.id)}else p=await G_(c,i.id);if(p.error){s.textContent="Error: "+p.error.message,s.className="form-message error",a.disabled=!1,a.textContent=l?"Update Date":"Add Date";return}l?So("update_config","audition_window_config",o.value,c):p.data&&So("create_config","audition_window_config",p.data.id,c),s.textContent=l?"Updated!":"Added!",s.className="form-message success",setTimeout(()=>n(),300)})}function O6(){const n=document.createElement("div");n.className="page",n.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Scheduling Configuration </h1>
      <button class="btn-ghost" onclick="location.hash='#/staff'" style="min-height:auto;width:auto"> Dashboard</button>
    </div>
    <div class="card" style="margin-bottom:var(--space-lg)">
      <div id="config-table"><p>Loading</p></div>
    </div>
    <div class="card" id="config-form-container"></div>
  `;async function e(){await T6();const t=document.getElementById("config-table"),r=document.getElementById("config-form-container");t&&(t.innerHTML=C6()),r&&(r.innerHTML=tm(null)),I6(e)}return setTimeout(e,0),n}function Qd(n){return(n==null?void 0:n.callback_invited)===!0}function r2(n,e){const t=`${n.first_name||""} ${n.last_name||""}`.trim()||"your student",r=n.parent_first_name?`Dear ${n.parent_first_name},`:"Dear Parent/Guardian,",i=(e||[]).filter(c=>c.callback_start_time&&c.callback_end_time);let s="";i.length>0?s=i.map(c=>`  - ${c.audition_date}: ${bt(c.callback_start_time)}  ${bt(c.callback_end_time)}`).join(`
`):s="  - Callback times will be announced soon.";const a="Callback Invitation  BATB Auditions",o=[r,"",`Congratulations! ${t} has been invited to callbacks for the BATB auditions.`,"","Callback Schedule:",s,"","Please ensure your student arrives on time. No sign-up is required  just attend during the scheduled window.","","If you have any questions, please contact the audition team.","","Thank you,","BATB Audition Team"].join(`
`),l=o.length>200?o.slice(0,200)+"":o;return{subject:a,body:o,bodyPreview:l}}function eh(n){return n?!n.parent_email||!n.parent_email.trim()?{valid:!1,reason:"No parent email on file."}:{valid:!0,reason:null}:{valid:!1,reason:"Student not found."}}function R6(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <p><a href="#/family"> Back to Dashboard</a></p>
    <h1>Audition Schedule </h1>
    <div id="schedule-content"><p>Loading</p></div>
  `,setTimeout(async()=>{const{user:e}=Jt();if(!e)return;const[t,r,i]=await Promise.all([Po(),Ol(e.id),Rl()]),s=t.data||[],a=r.data||[],o=i.data,l=document.getElementById("schedule-content");if(!l)return;if(s.length===0){l.innerHTML=`
        <div style="text-align:center;padding:var(--space-2xl) 0;color:var(--color-text-secondary)">
          <div style="font-size:2rem;margin-bottom:var(--space-md)"></div>
          <p>Audition dates have not been announced yet.</p>
          <p style="font-size:var(--text-small);margin-top:var(--space-sm)">Check back later for the schedule.</p>
        </div>
      `;return}const c=Va(o),d={};c&&await Promise.all(a.map(async h=>{const{data:b}=await Tp(h.id);b&&(d[h.id]=b)}));const m=a.some(h=>Qd(h));let p="";if(c&&a.length>0){const h=a.filter(w=>d[w.id]),b=a.filter(w=>!d[w.id]);h.length>0&&(p+=`
          <div class="success-box" style="padding:var(--space-md);border-radius:var(--radius-sm);margin-bottom:var(--space-md)">
            <strong>Vocal Audition Day Assignments</strong>
            ${h.map(w=>`
              <p style="font-size:var(--text-small);margin:var(--space-xs) 0 0">
                ${ye(w.first_name||"")} ${ye(w.last_name||"")}: <strong>${rn(d[w.id].audition_date)}</strong>
              </p>
            `).join("")}
          </div>
        `),b.length>0&&(p+=`
          <div class="placeholder-notice" style="margin-bottom:var(--space-md)">
            ${b.map(w=>`${ye(w.first_name||"")} ${ye(w.last_name||"")}`).join(", ")}
             awaiting vocal audition day assignment.
          </div>
        `)}l.innerHTML=`
      ${p}
      ${s.map(h=>`
        <div class="card" style="margin-bottom:var(--space-md)">
          <h3 style="margin-bottom:var(--space-sm)">${rn(h.audition_date)}</h3>
          <div style="display:flex;flex-direction:column;gap:var(--space-xs)">
            ${h.dance_start_time?`<p style="font-size:var(--text-small)"><span style="margin-right:var(--space-sm)"></span><strong>Dance:</strong> ${bt(h.dance_start_time)}  ${bt(h.dance_end_time)}</p>`:""}
            ${h.vocal_start_time?`<p style="font-size:var(--text-small)"><span style="margin-right:var(--space-sm)"></span><strong>Vocal:</strong> ${bt(h.vocal_start_time)}  ${bt(h.vocal_end_time)}</p>`:""}
            ${m&&h.callback_start_time?`<p style="font-size:var(--text-small)"><span style="margin-right:var(--space-sm)"></span><strong>Callbacks:</strong> ${bt(h.callback_start_time)}  ${bt(h.callback_end_time)}</p>`:""}
          </div>
        </div>
      `).join("")}
      ${m?'<div class="enchanted-banner" style="margin-top:var(--space-md)"><div class="enchanted-banner__icon"></div><div class="enchanted-banner__content"><div class="enchanted-banner__title">Callbacks!</div><div class="enchanted-banner__message">One or more of your students has been invited to callbacks! See the times listed above.</div></div></div>':""}
      <p class="lock-time-notice" style="margin-top:var(--space-md)">
        Dance and vocal schedules are assigned by staff. Contact the production team for schedule questions.
      </p>
    `},0),n}function P6(n){return(n||[]).filter(e=>e.dance_start_time&&e.dance_end_time)}function D6(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <p><a href="#/family"> Back to Dashboard</a></p>
    <h1>Dance Audition Schedule </h1>
    <p style="margin-bottom:var(--space-md)">
      Dance is required for all students. Families do not sign up for dance slots.
      The production team assigns the dance day and time.
    </p>
    <div id="dance-content"><p>Loading</p></div>
  `,setTimeout(async()=>{const{user:e}=Jt();if(!e)return;const t=document.getElementById("dance-content");if(!t)return;const[r,i]=await Promise.all([Ol(e.id),Po()]),s=r.data||[],a=P6(i.data||[]);if(s.length===0){t.innerHTML='<div class="placeholder-notice">No students registered yet. <a href="#/family/register">Start registration</a>.</div>';return}if(a.length===0){t.innerHTML=`
        <div class="placeholder-notice">
          Dance day/time has not been posted yet. Check back soon.
        </div>
      `;return}const o=s.map(l=>`
      <div class="card" style="margin-bottom:var(--space-md)">
        <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-sm)">
          <div class="avatar">${(l.first_name||"?")[0]}${(l.last_name||"?")[0]}</div>
          <h3 style="margin:0">${ye(l.first_name||"Unnamed")} ${ye(l.last_name||"Student")}</h3>
        </div>
        <div class="success-box" style="padding:var(--space-sm) var(--space-md);border-radius:var(--radius-sm)">
          <p style="font-size:var(--text-small);margin:0 0 var(--space-xs)"><strong>Assigned Dance Windows (Required):</strong></p>
          <ul style="margin:0;padding-left:1rem;font-size:var(--text-small)">
            ${a.map(c=>`
              <li>${rn(c.audition_date)}  ${bt(c.dance_start_time)}  ${bt(c.dance_end_time)}</li>
            `).join("")}
          </ul>
        </div>
      </div>
    `).join("");t.innerHTML=o},0),n}async function i2(){const{data:n,error:e}=await Fe.from("audition_window_config").select("id, audition_date, dance_start_time, dance_end_time").not("dance_start_time","is",null).not("dance_end_time","is",null).order("audition_date",{ascending:!0});return{data:(n||[]).map(r=>({id:r.id,audition_date:r.audition_date,start_time:r.dance_start_time,end_time:r.dance_end_time,label:null})),error:e}}async function nm(){return i2()}async function s2(){const[{data:n,error:e},t]=await Promise.all([i2(),Fe.from("students").select("id, first_name, last_name, grade, registration_complete").eq("registration_complete",!0).order("last_name",{ascending:!0}).order("first_name",{ascending:!0})]);if(e)return{data:[],error:e};if(t.error)return{data:[],error:t.error};const r=[];for(const i of n||[])for(const s of t.data||[])r.push({id:`${s.id}_${i.id}`,student_id:s.id,dance_window_id:i.id,students:s,dance_window:i});return{data:r,error:null}}async function rm(){return s2()}function B6(n,e){return e.map(t=>({session:t,students:n.filter(r=>r.dance_window_id===t.id||r.dance_session_id===t.id).map(r=>r.students).filter(Boolean)}))}function q6(n,e){return e.map(t=>({slot:t,students:n.filter(r=>r.audition_slot_id===t.id).map(r=>r.students).filter(Boolean)}))}function im(n,e){const r=s=>{const a=String(s??"");return a.includes('"')||a.includes(",")||a.includes(`
`)?'"'+a.replace(/"/g,'""')+'"':a};return"\uFEFF"+[n.map(r).join(","),...e.map(s=>s.map(r).join(","))].join(`\r
`)+`\r
`}function j6(n){const e=["Student First Name","Student Last Name","Grade","Session Date","Session Time","Session Label"],t=n.map(r=>{var i,s,a,o,l,c,d,m,p,h,b;return[((i=r.students)==null?void 0:i.first_name)||"",((s=r.students)==null?void 0:s.last_name)||"",((a=r.students)==null?void 0:a.grade)||"",((o=r.dance_window)==null?void 0:o.audition_date)||((l=r.dance_sessions)==null?void 0:l.audition_date)||"",r.dance_window||r.dance_sessions?`${((c=r.dance_window)==null?void 0:c.start_time)||((d=r.dance_sessions)==null?void 0:d.start_time)} - ${((m=r.dance_window)==null?void 0:m.end_time)||((p=r.dance_sessions)==null?void 0:p.end_time)}`:"",((h=r.dance_window)==null?void 0:h.label)||((b=r.dance_sessions)==null?void 0:b.label)||""]});return{headers:e,rows:t}}function $6(n){const e=["Student First Name","Student Last Name","Grade","Slot Date","Slot Time"],t=n.map(r=>{var i,s,a,o;return[((i=r.students)==null?void 0:i.first_name)||"",((s=r.students)==null?void 0:s.last_name)||"",((a=r.students)==null?void 0:a.grade)||"",((o=r.audition_slots)==null?void 0:o.audition_date)||"",r.audition_slots?`${r.audition_slots.start_time} - ${r.audition_slots.end_time}`:""]});return{headers:e,rows:t}}function M6(n){const e=["First Name","Last Name","Grade","Callback Invited","Registration Complete","Parent Email","Parent First Name","Parent 2 Email","Parent 2 First Name","Student Email","Sings Own Song","Song Name"],t=n.map(r=>[r.first_name||"",r.last_name||"",r.grade||"",r.callback_invited?"Yes":"No",r.registration_complete?"Yes":"No",r.parent_email||"",r.parent_first_name||"",r.parent2_email||"",r.parent2_first_name||"",r.student_email||"",r.sings_own_disney_song?"Yes":"No",r.song_name||""]);return{headers:e,rows:t}}function F6(){return`Generated ${new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}  Staff Only  Do Not Distribute`}function uu(n){return n==="admin"||n==="director"?{allowed:!0,reason:null}:{allowed:!1,reason:"Exports are restricted to staff members."}}async function Kh(n,e){const{data:t,error:r}=await Fe.rpc("toggle_callback_invite",{p_student_id:n,p_invited:e});return{data:t,error:r}}async function sm(){const{data:n,error:e}=await Fe.from("students").select("id, first_name, last_name, grade, callback_invited, parent_email, parent_first_name, registration_complete, parent2_email, parent2_first_name, student_email, sings_own_disney_song, song_name").order("last_name",{ascending:!0}).order("first_name",{ascending:!0});return{data:n||[],error:e}}async function a2(n,e,t,r){const{data:i,error:s}=await Fe.rpc("log_notification_send",{p_student_id:n,p_recipient_email:e,p_subject:t,p_body_preview:r});return{data:i,error:s}}async function du(){const{data:n,error:e}=await Fe.from("notification_sends").select("*, students(id, first_name, last_name)").order("created_at",{ascending:!1});return{data:n||[],error:e}}async function am(n){const{data:e,error:t}=await Fe.from("student_evaluations").select("*, staff_profiles:staff_user_id(id, display_name, role)").eq("student_id",n).order("created_at",{ascending:!1});return{data:e||[],error:t}}async function U6(n,e,t,r){const{data:i,error:s}=await Fe.from("student_evaluations").insert({student_id:n,staff_user_id:e,track:t,notes:r}).select().single();return{data:i,error:s}}async function z6(n,e){const{data:t,error:r}=await Fe.from("student_evaluations").update({notes:e,updated_at:new Date().toISOString()}).eq("id",n).select().single();return{data:t,error:r}}function om(n,e){const{role:t}=Jt(),{allowed:r,reason:i}=uu(t);if(!r)return{error:i};const s=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),o=document.createElement("a");return o.href=a,o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),{error:null}}const H6="modulepreload",W6=function(n,e){return new URL(n,e).href},W1={},Yh=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let a=function(d){return Promise.all(d.map(m=>Promise.resolve(m).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=a(t.map(d=>{if(d=W6(d,r),d in W1)return;W1[d]=!0;const m=d.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(!!r)for(let w=o.length-1;w>=0;w--){const S=o[w];if(S.href===d&&(!m||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${p}`))return;const b=document.createElement("link");if(b.rel=m?"stylesheet":H6,m||(b.as="script"),b.crossOrigin="",b.href=d,c&&b.setAttribute("nonce",c),document.head.appendChild(b),m)return new Promise((w,S)=>{b.addEventListener("load",w),b.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})};function un(n){"@babel/helpers - typeof";return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(n)}var us=Uint8Array,Si=Uint16Array,lm=Int32Array,cm=new us([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),um=new us([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),V1=new us([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o2=function(n,e){for(var t=new Si(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new lm(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},l2=o2(cm,2),V6=l2.b,op=l2.r;V6[28]=258,op[258]=28;var G6=o2(um,0),G1=G6.r,lp=new Si(32768);for(var Nn=0;Nn<32768;++Nn){var Ra=(Nn&43690)>>1|(Nn&21845)<<1;Ra=(Ra&52428)>>2|(Ra&13107)<<2,Ra=(Ra&61680)>>4|(Ra&3855)<<4,lp[Nn]=((Ra&65280)>>8|(Ra&255)<<8)>>1}var Nc=(function(n,e,t){for(var r=n.length,i=0,s=new Si(e);i<r;++i)n[i]&&++s[n[i]-1];var a=new Si(e);for(i=1;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(t){o=new Si(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],d=e-n[i],m=a[n[i]-1]++<<d,p=m|(1<<d)-1;m<=p;++m)o[lp[m]>>l]=c}else for(o=new Si(r),i=0;i<r;++i)n[i]&&(o[i]=lp[a[n[i]-1]++]>>15-n[i]);return o}),Lo=new us(288);for(var Nn=0;Nn<144;++Nn)Lo[Nn]=8;for(var Nn=144;Nn<256;++Nn)Lo[Nn]=9;for(var Nn=256;Nn<280;++Nn)Lo[Nn]=7;for(var Nn=280;Nn<288;++Nn)Lo[Nn]=8;var Cd=new us(32);for(var Nn=0;Nn<32;++Nn)Cd[Nn]=5;var K6=Nc(Lo,9,0),Y6=Nc(Cd,5,0),c2=function(n){return(n+7)/8|0},J6=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new us(n.subarray(e,t))},Zs=function(n,e,t){t<<=e&7;var r=e/8|0;n[r]|=t,n[r+1]|=t>>8},dc=function(n,e,t){t<<=e&7;var r=e/8|0;n[r]|=t,n[r+1]|=t>>8,n[r+2]|=t>>16},Jh=function(n,e){for(var t=[],r=0;r<n.length;++r)n[r]&&t.push({s:r,f:n[r]});var i=t.length,s=t.slice();if(!i)return{t:d2,l:0};if(i==1){var a=new us(t[0].s+1);return a[t[0].s]=1,{t:a,l:1}}t.sort(function(K,le){return K.f-le.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],c=0,d=1,m=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};d!=i-1;)o=t[t[c].f<t[m].f?c++:m++],l=t[c!=d&&t[c].f<t[m].f?c++:m++],t[d++]={s:-1,f:o.f+l.f,l:o,r:l};for(var p=s[0].s,r=1;r<i;++r)s[r].s>p&&(p=s[r].s);var h=new Si(p+1),b=cp(t[d-1],h,0);if(b>e){var r=0,w=0,S=b-e,A=1<<S;for(s.sort(function(le,he){return h[he.s]-h[le.s]||le.f-he.f});r<i;++r){var I=s[r].s;if(h[I]>e)w+=A-(1<<b-h[I]),h[I]=e;else break}for(w>>=S;w>0;){var O=s[r].s;h[O]<e?w-=1<<e-h[O]++-1:++r}for(;r>=0&&w;--r){var P=s[r].s;h[P]==e&&(--h[P],++w)}b=e}return{t:new us(h),l:b}},cp=function(n,e,t){return n.s==-1?Math.max(cp(n.l,e,t+1),cp(n.r,e,t+1)):e[n.s]=t},K1=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new Si(++e),r=0,i=n[0],s=1,a=function(l){t[r++]=l},o=1;o<=e;++o)if(n[o]==i&&o!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=n[o]}return{c:t.subarray(0,r),n:e}},hc=function(n,e){for(var t=0,r=0;r<e.length;++r)t+=n[r]*e[r];return t},u2=function(n,e,t){var r=t.length,i=c2(e+2);n[i]=r&255,n[i+1]=r>>8,n[i+2]=n[i]^255,n[i+3]=n[i+1]^255;for(var s=0;s<r;++s)n[i+s+4]=t[s];return(i+4+r)*8},Y1=function(n,e,t,r,i,s,a,o,l,c,d){Zs(e,d++,t),++i[256];for(var m=Jh(i,15),p=m.t,h=m.l,b=Jh(s,15),w=b.t,S=b.l,A=K1(p),I=A.c,O=A.n,P=K1(w),K=P.c,le=P.n,he=new Si(19),ne=0;ne<I.length;++ne)++he[I[ne]&31];for(var ne=0;ne<K.length;++ne)++he[K[ne]&31];for(var V=Jh(he,7),ue=V.t,_=V.l,L=19;L>4&&!ue[V1[L-1]];--L);var C=c+5<<3,M=hc(i,Lo)+hc(s,Cd)+a,Y=hc(i,p)+hc(s,w)+a+14+3*L+hc(he,ue)+2*he[16]+3*he[17]+7*he[18];if(l>=0&&C<=M&&C<=Y)return u2(e,d,n.subarray(l,l+c));var G,te,X,ae;if(Zs(e,d,1+(Y<M)),d+=2,Y<M){G=Nc(p,h,0),te=p,X=Nc(w,S,0),ae=w;var me=Nc(ue,_,0);Zs(e,d,O-257),Zs(e,d+5,le-1),Zs(e,d+10,L-4),d+=14;for(var ne=0;ne<L;++ne)Zs(e,d+3*ne,ue[V1[ne]]);d+=3*L;for(var fe=[I,K],k=0;k<2;++k)for(var q=fe[k],ne=0;ne<q.length;++ne){var W=q[ne]&31;Zs(e,d,me[W]),d+=ue[W],W>15&&(Zs(e,d,q[ne]>>5&127),d+=q[ne]>>12)}}else G=K6,te=Lo,X=Y6,ae=Cd;for(var ne=0;ne<o;++ne){var U=r[ne];if(U>255){var W=U>>18&31;dc(e,d,G[W+257]),d+=te[W+257],W>7&&(Zs(e,d,U>>23&31),d+=cm[W]);var Q=U&31;dc(e,d,X[Q]),d+=ae[Q],Q>3&&(dc(e,d,U>>5&8191),d+=um[Q])}else dc(e,d,G[U]),d+=te[U]}return dc(e,d,G[256]),d+te[256]},X6=new lm([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),d2=new us(0),Z6=function(n,e,t,r,i,s){var a=s.z||n.length,o=new us(r+a+5*(1+Math.ceil(a/7e3))+i),l=o.subarray(r,o.length-i),c=s.l,d=(s.r||0)&7;if(e){d&&(l[0]=s.r>>3);for(var m=X6[e-1],p=m>>13,h=m&8191,b=(1<<t)-1,w=s.p||new Si(32768),S=s.h||new Si(b+1),A=Math.ceil(t/3),I=2*A,O=function(qe){return(n[qe]^n[qe+1]<<A^n[qe+2]<<I)&b},P=new lm(25e3),K=new Si(288),le=new Si(32),he=0,ne=0,V=s.i||0,ue=0,_=s.w||0,L=0;V+2<a;++V){var C=O(V),M=V&32767,Y=S[C];if(w[M]=Y,S[C]=M,_<=V){var G=a-V;if((he>7e3||ue>24576)&&(G>423||!c)){d=Y1(n,l,0,P,K,le,ne,ue,L,V-L,d),ue=he=ne=0,L=V;for(var te=0;te<286;++te)K[te]=0;for(var te=0;te<30;++te)le[te]=0}var X=2,ae=0,me=h,fe=M-Y&32767;if(G>2&&C==O(V-fe))for(var k=Math.min(p,G)-1,q=Math.min(32767,V),W=Math.min(258,G);fe<=q&&--me&&M!=Y;){if(n[V+X]==n[V+X-fe]){for(var U=0;U<W&&n[V+U]==n[V+U-fe];++U);if(U>X){if(X=U,ae=fe,U>k)break;for(var Q=Math.min(fe,U-2),se=0,te=0;te<Q;++te){var oe=V-fe+te&32767,pe=w[oe],be=oe-pe&32767;be>se&&(se=be,Y=oe)}}}M=Y,Y=w[M],fe+=M-Y&32767}if(ae){P[ue++]=268435456|op[X]<<18|G1[ae];var xe=op[X]&31,Oe=G1[ae]&31;ne+=cm[xe]+um[Oe],++K[257+xe],++le[Oe],_=V+X,++he}else P[ue++]=n[V],++K[n[V]]}}for(V=Math.max(V,_);V<a;++V)P[ue++]=n[V],++K[n[V]];d=Y1(n,l,c,P,K,le,ne,ue,L,V-L,d),c||(s.r=d&7|l[d/8|0]<<3,d-=7,s.h=S,s.p=w,s.i=V,s.w=_)}else{for(var V=s.w||0;V<a+c;V+=65535){var Te=V+65535;Te>=a&&(l[d/8|0]=c,Te=a),d=u2(l,d+1,n.subarray(V,Te))}s.i=a}return J6(o,0,r+c2(d)+i)},h2=function(){var n=1,e=0;return{p:function(t){for(var r=n,i=e,s=t.length|0,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=r+=t[a];r=(r&65535)+15*(r>>16),i=(i&65535)+15*(i>>16)}n=r,e=i},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},Q6=function(n,e,t,r,i){if(!i&&(i={l:1},e.dictionary)){var s=e.dictionary.subarray(-32768),a=new us(s.length+n.length);a.set(s),a.set(n,s.length),n=a,i.w=s.length}return Z6(n,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,r,i)},f2=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},eL=function(n,e){var t=e.level,r=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=r<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var i=h2();i.p(e.dictionary),f2(n,2,i.d())}};function up(n,e){e||(e={});var t=h2();t.p(n);var r=Q6(n,e,e.dictionary?6:2,4);return eL(r,e),f2(r,r.length-4,t.d()),r}var tL=typeof TextDecoder<"u"&&new TextDecoder,nL=0;try{tL.decode(d2,{stream:!0}),nL=1}catch{}function rL(n){if(Array.isArray(n))return n}function iL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,c=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(d){c=!0,i=d}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw i}}return o}}function J1(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function sL(n,e){if(n){if(typeof n=="string")return J1(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?J1(n,e):void 0}}function aL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X1(n,e){return rL(n)||iL(n,e)||sL(n,e)||aL()}function Z1(n,e="utf8"){return new TextDecoder(e).decode(n)}const oL=new TextEncoder;function lL(n){return oL.encode(n)}const cL=1024*8,uL=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),Xh={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class dm{constructor(e=cL,t={}){Re(this,"buffer");Re(this,"byteLength");Re(this,"byteOffset");Re(this,"length");Re(this,"offset");Re(this,"lastWrittenByte");Re(this,"littleEndian");Re(this,"_data");Re(this,"_mark");Re(this,"_marks");let r=!1;typeof e=="number"?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const i=t.offset?t.offset>>>0:0,s=e.byteLength-i;let a=i;(ArrayBuffer.isView(e)||e instanceof dm)&&(e.byteLength!==e.buffer.byteLength&&(a=e.byteOffset+i),e=e.buffer),r?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,s),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const r=(this.offset+e)*2,i=new Uint8Array(r);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=r,this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const r=Xh[t].BYTES_PER_ELEMENT*e,i=this.byteOffset+this.offset,s=this.buffer.slice(i,i+r);if(this.littleEndian===uL&&t!=="uint8"&&t!=="int8"){const o=new Uint8Array(this.buffer.slice(i,i+r));o.reverse();const l=new Xh[t](o.buffer);return this.offset+=r,l.reverse(),l}const a=new Xh[t](s);return this.offset+=r,a}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let r=0;r<e;r++)t+=this.readChar();return t}readUtf8(e=1){return Z1(this.readBytes(e))}decodeText(e=1,t="utf8"){return Z1(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(lL(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Bl(n){let e=n.length;for(;--e>=0;)n[e]=0}const dL=3,hL=258,p2=29,fL=256,pL=fL+1+p2,m2=30,mL=512,gL=new Array((pL+2)*2);Bl(gL);const vL=new Array(m2*2);Bl(vL);const bL=new Array(mL);Bl(bL);const yL=new Array(hL-dL+1);Bl(yL);const wL=new Array(p2);Bl(wL);const _L=new Array(m2);Bl(_L);const xL=(n,e,t,r)=>{let i=n&65535|0,s=n>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do i=i+e[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};var dp=xL;const AL=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},SL=new Uint32Array(AL()),EL=(n,e,t,r)=>{const i=SL,s=r+t;n^=-1;for(let a=r;a<s;a++)n=n>>>8^i[(n^e[a])&255];return n^-1};var As=EL,hp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},g2={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const NL=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var kL=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const r in t)NL(t,r)&&(n[r]=t[r])}}return n},LL=n=>{let e=0;for(let r=0,i=n.length;r<i;r++)e+=n[r].length;const t=new Uint8Array(e);for(let r=0,i=0,s=n.length;r<s;r++){let a=n[r];t.set(a,i),i+=a.length}return t},v2={assign:kL,flattenChunks:LL};let b2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{b2=!1}const Xc=new Uint8Array(256);for(let n=0;n<256;n++)Xc[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Xc[254]=Xc[254]=1;var TL=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,r,i,s,a=n.length,o=0;for(i=0;i<a;i++)t=n.charCodeAt(i),(t&64512)===55296&&i+1<a&&(r=n.charCodeAt(i+1),(r&64512)===56320&&(t=65536+(t-55296<<10)+(r-56320),i++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(o),s=0,i=0;s<o;i++)t=n.charCodeAt(i),(t&64512)===55296&&i+1<a&&(r=n.charCodeAt(i+1),(r&64512)===56320&&(t=65536+(t-55296<<10)+(r-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e};const CL=(n,e)=>{if(e<65534&&n.subarray&&b2)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let r=0;r<e;r++)t+=String.fromCharCode(n[r]);return t};var IL=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let r,i;const s=new Array(t*2);for(i=0,r=0;r<t;){let a=n[r++];if(a<128){s[i++]=a;continue}let o=Xc[a];if(o>4){s[i++]=65533,r+=o-1;continue}for(a&=o===2?31:o===3?15:7;o>1&&r<t;)a=a<<6|n[r++]&63,o--;if(o>1){s[i++]=65533;continue}a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|a&1023)}return CL(s,i)},OL=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+Xc[n[t]]>e?t:e},fp={string2buf:TL,buf2string:IL,utf8border:OL};function RL(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var PL=RL;const Xu=16209,DL=16191;var BL=function(e,t){let r,i,s,a,o,l,c,d,m,p,h,b,w,S,A,I,O,P,K,le,he,ne,V,ue;const _=e.state;r=e.next_in,V=e.input,i=r+(e.avail_in-5),s=e.next_out,ue=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),l=_.dmax,c=_.wsize,d=_.whave,m=_.wnext,p=_.window,h=_.hold,b=_.bits,w=_.lencode,S=_.distcode,A=(1<<_.lenbits)-1,I=(1<<_.distbits)-1;e:do{b<15&&(h+=V[r++]<<b,b+=8,h+=V[r++]<<b,b+=8),O=w[h&A];t:for(;;){if(P=O>>>24,h>>>=P,b-=P,P=O>>>16&255,P===0)ue[s++]=O&65535;else if(P&16){K=O&65535,P&=15,P&&(b<P&&(h+=V[r++]<<b,b+=8),K+=h&(1<<P)-1,h>>>=P,b-=P),b<15&&(h+=V[r++]<<b,b+=8,h+=V[r++]<<b,b+=8),O=S[h&I];n:for(;;){if(P=O>>>24,h>>>=P,b-=P,P=O>>>16&255,P&16){if(le=O&65535,P&=15,b<P&&(h+=V[r++]<<b,b+=8,b<P&&(h+=V[r++]<<b,b+=8)),le+=h&(1<<P)-1,le>l){e.msg="invalid distance too far back",_.mode=Xu;break e}if(h>>>=P,b-=P,P=s-a,le>P){if(P=le-P,P>d&&_.sane){e.msg="invalid distance too far back",_.mode=Xu;break e}if(he=0,ne=p,m===0){if(he+=c-P,P<K){K-=P;do ue[s++]=p[he++];while(--P);he=s-le,ne=ue}}else if(m<P){if(he+=c+m-P,P-=m,P<K){K-=P;do ue[s++]=p[he++];while(--P);if(he=0,m<K){P=m,K-=P;do ue[s++]=p[he++];while(--P);he=s-le,ne=ue}}}else if(he+=m-P,P<K){K-=P;do ue[s++]=p[he++];while(--P);he=s-le,ne=ue}for(;K>2;)ue[s++]=ne[he++],ue[s++]=ne[he++],ue[s++]=ne[he++],K-=3;K&&(ue[s++]=ne[he++],K>1&&(ue[s++]=ne[he++]))}else{he=s-le;do ue[s++]=ue[he++],ue[s++]=ue[he++],ue[s++]=ue[he++],K-=3;while(K>2);K&&(ue[s++]=ue[he++],K>1&&(ue[s++]=ue[he++]))}}else if((P&64)===0){O=S[(O&65535)+(h&(1<<P)-1)];continue n}else{e.msg="invalid distance code",_.mode=Xu;break e}break}}else if((P&64)===0){O=w[(O&65535)+(h&(1<<P)-1)];continue t}else if(P&32){_.mode=DL;break e}else{e.msg="invalid literal/length code",_.mode=Xu;break e}break}}while(r<i&&s<o);K=b>>3,r-=K,b-=K<<3,h&=(1<<b)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<o?257+(o-s):257-(s-o),_.hold=h,_.bits=b};const Qo=15,Q1=852,e0=592,t0=0,Zh=1,n0=2,qL=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$L=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ML=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),FL=(n,e,t,r,i,s,a,o)=>{const l=o.bits;let c=0,d=0,m=0,p=0,h=0,b=0,w=0,S=0,A=0,I=0,O,P,K,le,he,ne=null,V;const ue=new Uint16Array(Qo+1),_=new Uint16Array(Qo+1);let L=null,C,M,Y;for(c=0;c<=Qo;c++)ue[c]=0;for(d=0;d<r;d++)ue[e[t+d]]++;for(h=l,p=Qo;p>=1&&ue[p]===0;p--);if(h>p&&(h=p),p===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,o.bits=1,0;for(m=1;m<p&&ue[m]===0;m++);for(h<m&&(h=m),S=1,c=1;c<=Qo;c++)if(S<<=1,S-=ue[c],S<0)return-1;if(S>0&&(n===t0||p!==1))return-1;for(_[1]=0,c=1;c<Qo;c++)_[c+1]=_[c]+ue[c];for(d=0;d<r;d++)e[t+d]!==0&&(a[_[e[t+d]]++]=d);if(n===t0?(ne=L=a,V=20):n===Zh?(ne=qL,L=jL,V=257):(ne=$L,L=ML,V=0),I=0,d=0,c=m,he=s,b=h,w=0,K=-1,A=1<<h,le=A-1,n===Zh&&A>Q1||n===n0&&A>e0)return 1;for(;;){C=c-w,a[d]+1<V?(M=0,Y=a[d]):a[d]>=V?(M=L[a[d]-V],Y=ne[a[d]-V]):(M=96,Y=0),O=1<<c-w,P=1<<b,m=P;do P-=O,i[he+(I>>w)+P]=C<<24|M<<16|Y|0;while(P!==0);for(O=1<<c-1;I&O;)O>>=1;if(O!==0?(I&=O-1,I+=O):I=0,d++,--ue[c]===0){if(c===p)break;c=e[t+a[d]]}if(c>h&&(I&le)!==K){for(w===0&&(w=h),he+=m,b=c-w,S=1<<b;b+w<p&&(S-=ue[b+w],!(S<=0));)b++,S<<=1;if(A+=1<<b,n===Zh&&A>Q1||n===n0&&A>e0)return 1;K=I&le,i[K]=h<<24|b<<16|he-s|0}}return I!==0&&(i[he+I]=c-w<<24|64<<16|0),o.bits=h,0};var kc=FL;const UL=0,y2=1,w2=2,{Z_FINISH:r0,Z_BLOCK:zL,Z_TREES:Zu,Z_OK:To,Z_STREAM_END:HL,Z_NEED_DICT:WL,Z_STREAM_ERROR:$i,Z_DATA_ERROR:_2,Z_MEM_ERROR:x2,Z_BUF_ERROR:VL,Z_DEFLATED:i0}=g2,th=16180,s0=16181,a0=16182,o0=16183,l0=16184,c0=16185,u0=16186,d0=16187,h0=16188,f0=16189,Id=16190,Qs=16191,Qh=16192,p0=16193,ef=16194,m0=16195,g0=16196,v0=16197,b0=16198,Qu=16199,ed=16200,y0=16201,w0=16202,_0=16203,x0=16204,A0=16205,tf=16206,S0=16207,E0=16208,Tn=16209,A2=16210,S2=16211,GL=852,KL=592,YL=15,JL=YL,N0=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function XL(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Fo=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<th||e.mode>S2?1:0},E2=n=>{if(Fo(n))return $i;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=th,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(GL),e.distcode=e.distdyn=new Int32Array(KL),e.sane=1,e.back=-1,To},N2=n=>{if(Fo(n))return $i;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,E2(n)},k2=(n,e)=>{let t;if(Fo(n))return $i;const r=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?$i:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=t,r.wbits=e,N2(n))},L2=(n,e)=>{if(!n)return $i;const t=new XL;n.state=t,t.strm=n,t.window=null,t.mode=th;const r=k2(n,e);return r!==To&&(n.state=null),r},ZL=n=>L2(n,JL);let k0=!0,nf,rf;const QL=n=>{if(k0){nf=new Int32Array(512),rf=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(kc(y2,n.lens,0,288,nf,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;kc(w2,n.lens,0,32,rf,0,n.work,{bits:5}),k0=!1}n.lencode=nf,n.lenbits=9,n.distcode=rf,n.distbits=5},T2=(n,e,t,r)=>{let i;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(t-r,t-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(t-r,t),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},eT=(n,e)=>{let t,r,i,s,a,o,l,c,d,m,p,h,b,w,S=0,A,I,O,P,K,le,he,ne;const V=new Uint8Array(4);let ue,_;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Fo(n)||!n.output||!n.input&&n.avail_in!==0)return $i;t=n.state,t.mode===Qs&&(t.mode=Qh),a=n.next_out,i=n.output,l=n.avail_out,s=n.next_in,r=n.input,o=n.avail_in,c=t.hold,d=t.bits,m=o,p=l,ne=To;e:for(;;)switch(t.mode){case th:if(t.wrap===0){t.mode=Qh;break}for(;d<16;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(t.wrap&2&&c===35615){t.wbits===0&&(t.wbits=15),t.check=0,V[0]=c&255,V[1]=c>>>8&255,t.check=As(t.check,V,2,0),c=0,d=0,t.mode=s0;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((c&255)<<8)+(c>>8))%31){n.msg="incorrect header check",t.mode=Tn;break}if((c&15)!==i0){n.msg="unknown compression method",t.mode=Tn;break}if(c>>>=4,d-=4,he=(c&15)+8,t.wbits===0&&(t.wbits=he),he>15||he>t.wbits){n.msg="invalid window size",t.mode=Tn;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=c&512?f0:Qs,c=0,d=0;break;case s0:for(;d<16;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(t.flags=c,(t.flags&255)!==i0){n.msg="unknown compression method",t.mode=Tn;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Tn;break}t.head&&(t.head.text=c>>8&1),t.flags&512&&t.wrap&4&&(V[0]=c&255,V[1]=c>>>8&255,t.check=As(t.check,V,2,0)),c=0,d=0,t.mode=a0;case a0:for(;d<32;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}t.head&&(t.head.time=c),t.flags&512&&t.wrap&4&&(V[0]=c&255,V[1]=c>>>8&255,V[2]=c>>>16&255,V[3]=c>>>24&255,t.check=As(t.check,V,4,0)),c=0,d=0,t.mode=o0;case o0:for(;d<16;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}t.head&&(t.head.xflags=c&255,t.head.os=c>>8),t.flags&512&&t.wrap&4&&(V[0]=c&255,V[1]=c>>>8&255,t.check=As(t.check,V,2,0)),c=0,d=0,t.mode=l0;case l0:if(t.flags&1024){for(;d<16;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}t.length=c,t.head&&(t.head.extra_len=c),t.flags&512&&t.wrap&4&&(V[0]=c&255,V[1]=c>>>8&255,t.check=As(t.check,V,2,0)),c=0,d=0}else t.head&&(t.head.extra=null);t.mode=c0;case c0:if(t.flags&1024&&(h=t.length,h>o&&(h=o),h&&(t.head&&(he=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(r.subarray(s,s+h),he)),t.flags&512&&t.wrap&4&&(t.check=As(t.check,r,h,s)),o-=h,s+=h,t.length-=h),t.length))break e;t.length=0,t.mode=u0;case u0:if(t.flags&2048){if(o===0)break e;h=0;do he=r[s+h++],t.head&&he&&t.length<65536&&(t.head.name+=String.fromCharCode(he));while(he&&h<o);if(t.flags&512&&t.wrap&4&&(t.check=As(t.check,r,h,s)),o-=h,s+=h,he)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=d0;case d0:if(t.flags&4096){if(o===0)break e;h=0;do he=r[s+h++],t.head&&he&&t.length<65536&&(t.head.comment+=String.fromCharCode(he));while(he&&h<o);if(t.flags&512&&t.wrap&4&&(t.check=As(t.check,r,h,s)),o-=h,s+=h,he)break e}else t.head&&(t.head.comment=null);t.mode=h0;case h0:if(t.flags&512){for(;d<16;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(t.wrap&4&&c!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Tn;break}c=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=Qs;break;case f0:for(;d<32;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}n.adler=t.check=N0(c),c=0,d=0,t.mode=Id;case Id:if(t.havedict===0)return n.next_out=a,n.avail_out=l,n.next_in=s,n.avail_in=o,t.hold=c,t.bits=d,WL;n.adler=t.check=1,t.mode=Qs;case Qs:if(e===zL||e===Zu)break e;case Qh:if(t.last){c>>>=d&7,d-=d&7,t.mode=tf;break}for(;d<3;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}switch(t.last=c&1,c>>>=1,d-=1,c&3){case 0:t.mode=p0;break;case 1:if(QL(t),t.mode=Qu,e===Zu){c>>>=2,d-=2;break e}break;case 2:t.mode=g0;break;case 3:n.msg="invalid block type",t.mode=Tn}c>>>=2,d-=2;break;case p0:for(c>>>=d&7,d-=d&7;d<32;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if((c&65535)!==(c>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Tn;break}if(t.length=c&65535,c=0,d=0,t.mode=ef,e===Zu)break e;case ef:t.mode=m0;case m0:if(h=t.length,h){if(h>o&&(h=o),h>l&&(h=l),h===0)break e;i.set(r.subarray(s,s+h),a),o-=h,s+=h,l-=h,a+=h,t.length-=h;break}t.mode=Qs;break;case g0:for(;d<14;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(t.nlen=(c&31)+257,c>>>=5,d-=5,t.ndist=(c&31)+1,c>>>=5,d-=5,t.ncode=(c&15)+4,c>>>=4,d-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Tn;break}t.have=0,t.mode=v0;case v0:for(;t.have<t.ncode;){for(;d<3;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}t.lens[L[t.have++]]=c&7,c>>>=3,d-=3}for(;t.have<19;)t.lens[L[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,ue={bits:t.lenbits},ne=kc(UL,t.lens,0,19,t.lencode,0,t.work,ue),t.lenbits=ue.bits,ne){n.msg="invalid code lengths set",t.mode=Tn;break}t.have=0,t.mode=b0;case b0:for(;t.have<t.nlen+t.ndist;){for(;S=t.lencode[c&(1<<t.lenbits)-1],A=S>>>24,I=S>>>16&255,O=S&65535,!(A<=d);){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(O<16)c>>>=A,d-=A,t.lens[t.have++]=O;else{if(O===16){for(_=A+2;d<_;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(c>>>=A,d-=A,t.have===0){n.msg="invalid bit length repeat",t.mode=Tn;break}he=t.lens[t.have-1],h=3+(c&3),c>>>=2,d-=2}else if(O===17){for(_=A+3;d<_;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}c>>>=A,d-=A,he=0,h=3+(c&7),c>>>=3,d-=3}else{for(_=A+7;d<_;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}c>>>=A,d-=A,he=0,h=11+(c&127),c>>>=7,d-=7}if(t.have+h>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Tn;break}for(;h--;)t.lens[t.have++]=he}}if(t.mode===Tn)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Tn;break}if(t.lenbits=9,ue={bits:t.lenbits},ne=kc(y2,t.lens,0,t.nlen,t.lencode,0,t.work,ue),t.lenbits=ue.bits,ne){n.msg="invalid literal/lengths set",t.mode=Tn;break}if(t.distbits=6,t.distcode=t.distdyn,ue={bits:t.distbits},ne=kc(w2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,ue),t.distbits=ue.bits,ne){n.msg="invalid distances set",t.mode=Tn;break}if(t.mode=Qu,e===Zu)break e;case Qu:t.mode=ed;case ed:if(o>=6&&l>=258){n.next_out=a,n.avail_out=l,n.next_in=s,n.avail_in=o,t.hold=c,t.bits=d,BL(n,p),a=n.next_out,i=n.output,l=n.avail_out,s=n.next_in,r=n.input,o=n.avail_in,c=t.hold,d=t.bits,t.mode===Qs&&(t.back=-1);break}for(t.back=0;S=t.lencode[c&(1<<t.lenbits)-1],A=S>>>24,I=S>>>16&255,O=S&65535,!(A<=d);){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(I&&(I&240)===0){for(P=A,K=I,le=O;S=t.lencode[le+((c&(1<<P+K)-1)>>P)],A=S>>>24,I=S>>>16&255,O=S&65535,!(P+A<=d);){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}c>>>=P,d-=P,t.back+=P}if(c>>>=A,d-=A,t.back+=A,t.length=O,I===0){t.mode=A0;break}if(I&32){t.back=-1,t.mode=Qs;break}if(I&64){n.msg="invalid literal/length code",t.mode=Tn;break}t.extra=I&15,t.mode=y0;case y0:if(t.extra){for(_=t.extra;d<_;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=w0;case w0:for(;S=t.distcode[c&(1<<t.distbits)-1],A=S>>>24,I=S>>>16&255,O=S&65535,!(A<=d);){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if((I&240)===0){for(P=A,K=I,le=O;S=t.distcode[le+((c&(1<<P+K)-1)>>P)],A=S>>>24,I=S>>>16&255,O=S&65535,!(P+A<=d);){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}c>>>=P,d-=P,t.back+=P}if(c>>>=A,d-=A,t.back+=A,I&64){n.msg="invalid distance code",t.mode=Tn;break}t.offset=O,t.extra=I&15,t.mode=_0;case _0:if(t.extra){for(_=t.extra;d<_;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Tn;break}t.mode=x0;case x0:if(l===0)break e;if(h=p-l,t.offset>h){if(h=t.offset-h,h>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Tn;break}h>t.wnext?(h-=t.wnext,b=t.wsize-h):b=t.wnext-h,h>t.length&&(h=t.length),w=t.window}else w=i,b=a-t.offset,h=t.length;h>l&&(h=l),l-=h,t.length-=h;do i[a++]=w[b++];while(--h);t.length===0&&(t.mode=ed);break;case A0:if(l===0)break e;i[a++]=t.length,l--,t.mode=ed;break;case tf:if(t.wrap){for(;d<32;){if(o===0)break e;o--,c|=r[s++]<<d,d+=8}if(p-=l,n.total_out+=p,t.total+=p,t.wrap&4&&p&&(n.adler=t.check=t.flags?As(t.check,i,p,a-p):dp(t.check,i,p,a-p)),p=l,t.wrap&4&&(t.flags?c:N0(c))!==t.check){n.msg="incorrect data check",t.mode=Tn;break}c=0,d=0}t.mode=S0;case S0:if(t.wrap&&t.flags){for(;d<32;){if(o===0)break e;o--,c+=r[s++]<<d,d+=8}if(t.wrap&4&&c!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Tn;break}c=0,d=0}t.mode=E0;case E0:ne=HL;break e;case Tn:ne=_2;break e;case A2:return x2;case S2:default:return $i}return n.next_out=a,n.avail_out=l,n.next_in=s,n.avail_in=o,t.hold=c,t.bits=d,(t.wsize||p!==n.avail_out&&t.mode<Tn&&(t.mode<tf||e!==r0))&&T2(n,n.output,n.next_out,p-n.avail_out),m-=n.avail_in,p-=n.avail_out,n.total_in+=m,n.total_out+=p,t.total+=p,t.wrap&4&&p&&(n.adler=t.check=t.flags?As(t.check,i,p,n.next_out-p):dp(t.check,i,p,n.next_out-p)),n.data_type=t.bits+(t.last?64:0)+(t.mode===Qs?128:0)+(t.mode===Qu||t.mode===ef?256:0),(m===0&&p===0||e===r0)&&ne===To&&(ne=VL),ne},tT=n=>{if(Fo(n))return $i;let e=n.state;return e.window&&(e.window=null),n.state=null,To},nT=(n,e)=>{if(Fo(n))return $i;const t=n.state;return(t.wrap&2)===0?$i:(t.head=e,e.done=!1,To)},rT=(n,e)=>{const t=e.length;let r,i,s;return Fo(n)||(r=n.state,r.wrap!==0&&r.mode!==Id)?$i:r.mode===Id&&(i=1,i=dp(i,e,t,0),i!==r.check)?_2:(s=T2(n,e,t,t),s?(r.mode=A2,x2):(r.havedict=1,To))};var iT=N2,sT=k2,aT=E2,oT=ZL,lT=L2,cT=eT,uT=tT,dT=nT,hT=rT,fT="pako inflate (from Nodeca project)",ta={inflateReset:iT,inflateReset2:sT,inflateResetKeep:aT,inflateInit:oT,inflateInit2:lT,inflate:cT,inflateEnd:uT,inflateGetHeader:dT,inflateSetDictionary:hT,inflateInfo:fT};function pT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var mT=pT;const C2=Object.prototype.toString,{Z_NO_FLUSH:gT,Z_FINISH:vT,Z_OK:Zc,Z_STREAM_END:sf,Z_NEED_DICT:af,Z_STREAM_ERROR:bT,Z_DATA_ERROR:L0,Z_MEM_ERROR:yT}=g2;function hu(n){this.options=v2.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new PL,this.strm.avail_out=0;let t=ta.inflateInit2(this.strm,e.windowBits);if(t!==Zc)throw new Error(hp[t]);if(this.header=new mT,ta.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=fp.string2buf(e.dictionary):C2.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ta.inflateSetDictionary(this.strm,e.dictionary),t!==Zc)))throw new Error(hp[t])}hu.prototype.push=function(n,e){const t=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?vT:gT,C2.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),s=ta.inflate(t,a),s===af&&i&&(s=ta.inflateSetDictionary(t,i),s===Zc?s=ta.inflate(t,a):s===L0&&(s=af));t.avail_in>0&&s===sf&&t.state.wrap>0&&n[t.next_in]!==0;)ta.inflateReset(t),s=ta.inflate(t,a);switch(s){case bT:case L0:case af:case yT:return this.onEnd(s),this.ended=!0,!1}if(o=t.avail_out,t.next_out&&(t.avail_out===0||s===sf))if(this.options.to==="string"){let l=fp.utf8border(t.output,t.next_out),c=t.next_out-l,d=fp.buf2string(t.output,l);t.next_out=c,t.avail_out=r-c,c&&t.output.set(t.output.subarray(l,l+c),0),this.onData(d)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Zc&&o===0)){if(s===sf)return s=ta.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};hu.prototype.onData=function(n){this.chunks.push(n)};hu.prototype.onEnd=function(n){n===Zc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=v2.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function wT(n,e){const t=new hu(e);if(t.push(n),t.err)throw t.msg||hp[t.err];return t.result}var _T=hu,xT=wT,AT={Inflate:_T,inflate:xT};const{Inflate:ST,inflate:ET}=AT;var T0=ST,NT=ET;const I2=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;I2[n]=e}const C0=4294967295;function kT(n,e,t){let r=n;for(let i=0;i<t;i++)r=I2[(r^e[i])&255]^r>>>8;return r}function LT(n,e){return(kT(C0,n,e)^C0)>>>0}function I0(n,e,t){const r=n.readUint32(),i=LT(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(i!==r)throw new Error(`CRC mismatch for chunk ${t}. Expected ${r}, found ${i}`)}function O2(n,e,t){for(let r=0;r<t;r++)e[r]=n[r]}function R2(n,e,t,r){let i=0;for(;i<r;i++)e[i]=n[i];for(;i<t;i++)e[i]=n[i]+e[i-r]&255}function P2(n,e,t,r){let i=0;if(t.length===0)for(;i<r;i++)e[i]=n[i];else for(;i<r;i++)e[i]=n[i]+t[i]&255}function D2(n,e,t,r,i){let s=0;if(t.length===0){for(;s<i;s++)e[s]=n[s];for(;s<r;s++)e[s]=n[s]+(e[s-i]>>1)&255}else{for(;s<i;s++)e[s]=n[s]+(t[s]>>1)&255;for(;s<r;s++)e[s]=n[s]+(e[s-i]+t[s]>>1)&255}}function B2(n,e,t,r,i){let s=0;if(t.length===0){for(;s<i;s++)e[s]=n[s];for(;s<r;s++)e[s]=n[s]+e[s-i]&255}else{for(;s<i;s++)e[s]=n[s]+t[s]&255;for(;s<r;s++)e[s]=n[s]+TT(e[s-i],t[s],t[s-i])&255}}function TT(n,e,t){const r=n+e-t,i=Math.abs(r-n),s=Math.abs(r-e),a=Math.abs(r-t);return i<=s&&i<=a?n:s<=a?e:t}function CT(n,e,t,r,i,s){switch(n){case 0:O2(e,t,i);break;case 1:R2(e,t,i,s);break;case 2:P2(e,t,r,i);break;case 3:D2(e,t,r,i,s);break;case 4:B2(e,t,r,i,s);break;default:throw new Error(`Unsupported filter: ${n}`)}}const IT=new Uint16Array([255]),OT=new Uint8Array(IT.buffer),RT=OT[0]===255;function PT(n){const{data:e,width:t,height:r,channels:i,depth:s}=n,a=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(s/8)*i,l=new Uint8Array(r*t*o);let c=0;for(let d=0;d<7;d++){const m=a[d],p=Math.ceil((t-m.x)/m.xStep),h=Math.ceil((r-m.y)/m.yStep);if(p<=0||h<=0)continue;const b=p*o,w=new Uint8Array(b);for(let S=0;S<h;S++){const A=e[c++],I=e.subarray(c,c+b);c+=b;const O=new Uint8Array(b);CT(A,I,O,w,b,o),w.set(O);for(let P=0;P<p;P++){const K=m.x+P*m.xStep,le=m.y+S*m.yStep;if(!(K>=t||le>=r))for(let he=0;he<o;he++)l[(le*t+K)*o+he]=O[P*o+he]}}}if(s===16){const d=new Uint16Array(l.buffer);if(RT)for(let m=0;m<d.length;m++)d[m]=DT(d[m]);return d}else return l}function DT(n){return(n&255)<<8|n>>8&255}const BT=new Uint16Array([255]),qT=new Uint8Array(BT.buffer),jT=qT[0]===255,$T=new Uint8Array(0);function O0(n){const{data:e,width:t,height:r,channels:i,depth:s}=n,a=Math.ceil(s/8)*i,o=Math.ceil(s/8*i*t),l=new Uint8Array(r*o);let c=$T,d=0,m,p;for(let h=0;h<r;h++){switch(m=e.subarray(d+1,d+1+o),p=l.subarray(h*o,(h+1)*o),e[d]){case 0:O2(m,p,o);break;case 1:R2(m,p,o,a);break;case 2:P2(m,p,c,o);break;case 3:D2(m,p,c,o,a);break;case 4:B2(m,p,c,o,a);break;default:throw new Error(`Unsupported filter: ${e[d]}`)}c=p,d+=o+1}if(s===16){const h=new Uint16Array(l.buffer);if(jT)for(let b=0;b<h.length;b++)h[b]=MT(h[b]);return h}else return l}function MT(n){return(n&255)<<8|n>>8&255}const dd=Uint8Array.of(137,80,78,71,13,10,26,10);function R0(n){if(!FT(n.readBytes(dd.length)))throw new Error("wrong PNG signature")}function FT(n){if(n.length<dd.length)return!1;for(let e=0;e<dd.length;e++)if(n[e]!==dd[e])return!1;return!0}const UT="tEXt",zT=0,q2=new TextDecoder("latin1");function HT(n){if(VT(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const WT=/^[\u0000-\u00FF]*$/;function VT(n){if(!WT.test(n))throw new Error("invalid latin1 text")}function GT(n,e,t){const r=j2(e);n[r]=KT(e,t-r.length-1)}function j2(n){for(n.mark();n.readByte()!==zT;);const e=n.offset;n.reset();const t=q2.decode(n.readBytes(e-n.offset-1));return n.skip(1),HT(t),t}function KT(n,e){return q2.decode(n.readBytes(e))}const wi={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},of={UNKNOWN:-1,DEFLATE:0},P0={UNKNOWN:-1,ADAPTIVE:0},lf={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},td={NONE:0,BACKGROUND:1,PREVIOUS:2},cf={SOURCE:0,OVER:1};class YT extends dm{constructor(t,r={}){super(t);Re(this,"_checkCrc");Re(this,"_inflator");Re(this,"_png");Re(this,"_apng");Re(this,"_end");Re(this,"_hasPalette");Re(this,"_palette");Re(this,"_hasTransparency");Re(this,"_transparency");Re(this,"_compressionMethod");Re(this,"_filterMethod");Re(this,"_interlaceMethod");Re(this,"_colorType");Re(this,"_isAnimated");Re(this,"_numberOfFrames");Re(this,"_numberOfPlays");Re(this,"_frames");Re(this,"_writingDataChunks");const{checkCrc:i=!1}=r;this._checkCrc=i,this._inflator=new T0,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=of.UNKNOWN,this._filterMethod=P0.UNKNOWN,this._interlaceMethod=lf.UNKNOWN,this._colorType=wi.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(R0(this);!this._end;){const t=this.readUint32(),r=this.readChars(4);this.decodeChunk(t,r)}return this.decodeImage(),this._png}decodeApng(){for(R0(this);!this._end;){const t=this.readUint32(),r=this.readChars(4);this.decodeApngChunk(t,r)}return this.decodeApngImage(),this._apng}decodeChunk(t,r){const i=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case UT:GT(this._png.text,this,t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-i!==t)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?I0(this,t+4,r):this.skip(4)}decodeApngChunk(t,r){const i=this.offset;switch(r!=="fdAT"&&r!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),r){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(t);break;default:this.decodeChunk(t,r),this.offset=i+t;break}if(this.offset-i!==t)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?I0(this,t+4,r):this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=JT(this.readUint8());const r=this.readUint8();this._colorType=r;let i;switch(r){case wi.GREYSCALE:i=1;break;case wi.TRUECOLOUR:i=3;break;case wi.INDEXED_COLOUR:i=1;break;case wi.GREYSCALE_ALPHA:i=2;break;case wi.TRUECOLOUR_ALPHA:i=4;break;case wi.UNKNOWN:default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==of.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const t={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(t)}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const r=t/3;this._hasPalette=!0;const i=[];this._palette=i;for(let s=0;s<r;s++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._writingDataChunks=!0;const r=t,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodeFDAT(t){this._writingDataChunks=!0;let r=t,i=this.offset+this.byteOffset;if(i+=4,r-=4,this._inflator.push(new Uint8Array(this.buffer,i,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodetRNS(t){switch(this._colorType){case wi.GREYSCALE:case wi.TRUECOLOUR:{if(t%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let r=0;r<t/2;r++)this._transparency[r]=this.readUint16();break}case wi.INDEXED_COLOUR:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let r=0;for(;r<t;r++){const i=this.readByte();this._palette[r].push(i)}for(;r<this._palette.length;r++)this._palette[r].push(255);break}case wi.UNKNOWN:case wi.GREYSCALE_ALPHA:case wi.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){const r=j2(this),i=this.readUint8();if(i!==of.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const s=this.readBytes(t-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:NT(s)}}decodepHYs(){const t=this.readUint32(),r=this.readUint32(),i=this.readByte();this._png.resolution={x:t,y:r,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let t=0;t<this._numberOfFrames;t++){const r={sequenceNumber:this._frames[t].sequenceNumber,delayNumber:this._frames[t].delayNumber,delayDenominator:this._frames[t].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(t);if(i){if(i.data=O0({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),t===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)r.data=i.data;else{const s=this._apng.frames.at(t-1);this.disposeFrame(i,s,r),this.addFrameDataToCanvas(r,i)}this._apng.frames.push(r)}}return this._apng}disposeFrame(t,r,i){switch(t.disposeOp){case td.NONE:break;case td.BACKGROUND:for(let s=0;s<this._png.height;s++)for(let a=0;a<this._png.width;a++){const o=(s*t.width+a)*this._png.channels;for(let l=0;l<this._png.channels;l++)i.data[o+l]=0}break;case td.PREVIOUS:i.data.set(r.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(t,r){const i=1<<this._png.depth,s=(a,o)=>{const l=((a+r.yOffset)*this._png.width+r.xOffset+o)*this._png.channels,c=(a*r.width+o)*this._png.channels;return{index:l,frameIndex:c}};switch(r.blendOp){case cf.SOURCE:for(let a=0;a<r.height;a++)for(let o=0;o<r.width;o++){const{index:l,frameIndex:c}=s(a,o);for(let d=0;d<this._png.channels;d++)t.data[l+d]=r.data[c+d]}break;case cf.OVER:for(let a=0;a<r.height;a++)for(let o=0;o<r.width;o++){const{index:l,frameIndex:c}=s(a,o);for(let d=0;d<this._png.channels;d++){const m=r.data[c+this._png.channels-1]/i,p=d%(this._png.channels-1)===0?1:r.data[c+d],h=Math.floor(m*p+(1-m)*t.data[l+d]);t.data[l+d]+=h}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var r;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._isAnimated?((r=this._frames)==null?void 0:r.at(0)).data:this._inflator.result;if(this._filterMethod!==P0.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===lf.NO_INTERLACE)this._png.data=O0({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===lf.ADAM7)this._png.data=PT({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const t=this._inflator.result,r=this._frames.at(-1);r?r.data=t:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:td.NONE,blendOp:cf.SOURCE,data:t}),this._inflator=new T0,this._writingDataChunks=!1}}function JT(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var D0;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(D0||(D0={}));function XT(n,e){return new YT(n,e).decode()}var kt=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function uf(){kt.console&&typeof kt.console.log=="function"&&kt.console.log.apply(kt.console,arguments)}var mn={log:uf,warn:function(n){kt.console&&(typeof kt.console.warn=="function"?kt.console.warn.apply(kt.console,arguments):uf.call(null,arguments))},error:function(n){kt.console&&(typeof kt.console.error=="function"?kt.console.error.apply(kt.console,arguments):uf(n))}};function df(n,e,t){var r=new XMLHttpRequest;r.open("GET",n),r.responseType="blob",r.onload=function(){mo(r.response,e,t)},r.onerror=function(){mn.error("could not download file")},r.send()}function B0(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function nd(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var mo=kt.saveAs||((typeof window>"u"?"undefined":un(window))!=="object"||window!==kt?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var r=kt.URL||kt.webkitURL,i=document.createElement("a");e=e||n.name||"download",i.download=e,i.rel="noopener",typeof n=="string"?(i.href=n,i.origin!==location.origin?B0(i.href)?df(n,e,t):nd(i,i.target="_blank"):nd(i)):(i.href=r.createObjectURL(n),setTimeout(function(){r.revokeObjectURL(i.href)},4e4),setTimeout(function(){nd(i)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(B0(n))df(n,e,t);else{var r=document.createElement("a");r.href=n,r.target="_blank",setTimeout(function(){nd(r)})}else navigator.msSaveOrOpenBlob((function(i,s){return s===void 0?s={autoBom:!1}:un(s)!=="object"&&(mn.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i})(n,t),e)}:function(n,e,t,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof n=="string")return df(n,e,t);var i=n.type==="application/octet-stream",s=/constructor/i.test(kt.HTMLElement)||kt.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":un(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var d=o.result;d=a?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=d:location=d,r=null},o.readAsDataURL(n)}else{var l=kt.URL||kt.webkitURL,c=l.createObjectURL(n);r?r.location=c:location.href=c,r=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function $2(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],r=0;r<t.length;r++){var i=t[r].re,s=t[r].process,a=i.exec(n);a&&(e=s(a),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),l=this.g.toString(16),c=this.b.toString(16);return o.length==1&&(o="0"+o),l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),"#"+o+l+c}}var hd=kt.atob.bind(kt),q0=kt.btoa.bind(kt);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function hf(n,e){var t=n[0],r=n[1],i=n[2],s=n[3];t=Rr(t,r,i,s,e[0],7,-680876936),s=Rr(s,t,r,i,e[1],12,-389564586),i=Rr(i,s,t,r,e[2],17,606105819),r=Rr(r,i,s,t,e[3],22,-1044525330),t=Rr(t,r,i,s,e[4],7,-176418897),s=Rr(s,t,r,i,e[5],12,1200080426),i=Rr(i,s,t,r,e[6],17,-1473231341),r=Rr(r,i,s,t,e[7],22,-45705983),t=Rr(t,r,i,s,e[8],7,1770035416),s=Rr(s,t,r,i,e[9],12,-1958414417),i=Rr(i,s,t,r,e[10],17,-42063),r=Rr(r,i,s,t,e[11],22,-1990404162),t=Rr(t,r,i,s,e[12],7,1804603682),s=Rr(s,t,r,i,e[13],12,-40341101),i=Rr(i,s,t,r,e[14],17,-1502002290),t=Pr(t,r=Rr(r,i,s,t,e[15],22,1236535329),i,s,e[1],5,-165796510),s=Pr(s,t,r,i,e[6],9,-1069501632),i=Pr(i,s,t,r,e[11],14,643717713),r=Pr(r,i,s,t,e[0],20,-373897302),t=Pr(t,r,i,s,e[5],5,-701558691),s=Pr(s,t,r,i,e[10],9,38016083),i=Pr(i,s,t,r,e[15],14,-660478335),r=Pr(r,i,s,t,e[4],20,-405537848),t=Pr(t,r,i,s,e[9],5,568446438),s=Pr(s,t,r,i,e[14],9,-1019803690),i=Pr(i,s,t,r,e[3],14,-187363961),r=Pr(r,i,s,t,e[8],20,1163531501),t=Pr(t,r,i,s,e[13],5,-1444681467),s=Pr(s,t,r,i,e[2],9,-51403784),i=Pr(i,s,t,r,e[7],14,1735328473),t=Dr(t,r=Pr(r,i,s,t,e[12],20,-1926607734),i,s,e[5],4,-378558),s=Dr(s,t,r,i,e[8],11,-2022574463),i=Dr(i,s,t,r,e[11],16,1839030562),r=Dr(r,i,s,t,e[14],23,-35309556),t=Dr(t,r,i,s,e[1],4,-1530992060),s=Dr(s,t,r,i,e[4],11,1272893353),i=Dr(i,s,t,r,e[7],16,-155497632),r=Dr(r,i,s,t,e[10],23,-1094730640),t=Dr(t,r,i,s,e[13],4,681279174),s=Dr(s,t,r,i,e[0],11,-358537222),i=Dr(i,s,t,r,e[3],16,-722521979),r=Dr(r,i,s,t,e[6],23,76029189),t=Dr(t,r,i,s,e[9],4,-640364487),s=Dr(s,t,r,i,e[12],11,-421815835),i=Dr(i,s,t,r,e[15],16,530742520),t=Br(t,r=Dr(r,i,s,t,e[2],23,-995338651),i,s,e[0],6,-198630844),s=Br(s,t,r,i,e[7],10,1126891415),i=Br(i,s,t,r,e[14],15,-1416354905),r=Br(r,i,s,t,e[5],21,-57434055),t=Br(t,r,i,s,e[12],6,1700485571),s=Br(s,t,r,i,e[3],10,-1894986606),i=Br(i,s,t,r,e[10],15,-1051523),r=Br(r,i,s,t,e[1],21,-2054922799),t=Br(t,r,i,s,e[8],6,1873313359),s=Br(s,t,r,i,e[15],10,-30611744),i=Br(i,s,t,r,e[6],15,-1560198380),r=Br(r,i,s,t,e[13],21,1309151649),t=Br(t,r,i,s,e[4],6,-145523070),s=Br(s,t,r,i,e[11],10,-1120210379),i=Br(i,s,t,r,e[2],15,718787259),r=Br(r,i,s,t,e[9],21,-343485551),n[0]=Ua(t,n[0]),n[1]=Ua(r,n[1]),n[2]=Ua(i,n[2]),n[3]=Ua(s,n[3])}function nh(n,e,t,r,i,s){return e=Ua(Ua(e,n),Ua(r,s)),Ua(e<<i|e>>>32-i,t)}function Rr(n,e,t,r,i,s,a){return nh(e&t|~e&r,n,e,i,s,a)}function Pr(n,e,t,r,i,s,a){return nh(e&r|t&~r,n,e,i,s,a)}function Dr(n,e,t,r,i,s,a){return nh(e^t^r,n,e,i,s,a)}function Br(n,e,t,r,i,s,a){return nh(t^(e|~r),n,e,i,s,a)}function M2(n){var e,t=n.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)hf(r,ZT(n.substring(e-64,e)));n=n.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)i[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(hf(r,i),e=0;e<16;e++)i[e]=0;return i[14]=8*t,hf(r,i),r}function ZT(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var j0="0123456789abcdef".split("");function QT(n){for(var e="",t=0;t<4;t++)e+=j0[n>>8*t+4&15]+j0[n>>8*t&15];return e}function e8(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function pp(n){return M2(n).map(e8).join("")}var t8=(function(n){for(var e=0;e<n.length;e++)n[e]=QT(n[e]);return n.join("")})(M2("hello"))!="5d41402abc4b2a76b9719d911017c592";function Ua(n,e){if(t8){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function mp(n,e){var t,r,i,s;if(n!==t){for(var a=(i=n,s=1+(256/n.length|0),new Array(s+1).join(i)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var d=o[l];c=(c+d+a.charCodeAt(l))%256,o[l]=o[c],o[c]=d}t=n,r=o}else o=r;var m=e.length,p=0,h=0,b="";for(l=0;l<m;l++)h=(h+(d=o[p=(p+1)%256]))%256,o[p]=o[h],o[h]=d,a=o[(o[p]+o[h])%256],b+=String.fromCharCode(e.charCodeAt(l)^a);return b}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var $0={print:4,modify:8,copy:16,"annot-forms":32};function dl(n,e,t,r){this.v=1,this.r=2;var i=192;n.forEach(function(o){if($0.perm!==void 0)throw new Error("Invalid permission: "+o);i+=$0[o]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(e+this.padding).substr(0,32),a=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=pp(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=mp(this.encryptionKey,this.padding)}function hl(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,r=0;r<t;r++){var i=n.charCodeAt(r);e+=i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?"#"+("0"+i.toString(16)).slice(-2):n[r]}return e}function M0(n){if(un(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,r,i){if(i=i||!1,typeof t!="string"||typeof r!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var s=Math.random().toString(35);return e[t][s]=[r,!!i],s},this.unsubscribe=function(t){for(var r in e)if(e[r][t])return delete e[r][t],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var r=Array.prototype.slice.call(arguments,1),i=[];for(var s in e[t]){var a=e[t][s];try{a[0].apply(n,r)}catch(o){kt.console&&mn.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function Od(n){if(!(this instanceof Od))return new Od(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function F2(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function yo(n,e,t,r,i){if(!(this instanceof yo))return new yo(n,e,t,r,i);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,F2.call(this,r,i)}function ml(n,e,t,r,i){if(!(this instanceof ml))return new ml(n,e,t,r,i);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,F2.call(this,r,i)}function at(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,l=16,c="S",d=null;un(n=n||{})==="object"&&(t=n.orientation,r=n.unit||r,i=n.format||i,s=n.compress||n.compressPdf||s,(d=n.encryption||null)!==null&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),o=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(l=n.floatPrecision),c=n.defaultPathOperation||"S"),a=n.filters||(s===!0?["FlateEncode"]:a),r=r||"mm",t=(""+(t||"P")).toLowerCase();var m=n.putOnlyUsedFonts||!1,p={},h={internal:{},__private__:{}};h.__private__.PubSub=M0;var b="1.3",w=h.__private__.getPdfVersion=function(){return b};h.__private__.setPdfVersion=function(g){b=g};var S={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};h.__private__.getPageFormats=function(){return S};var A=h.__private__.getPageFormat=function(g){return S[g]};i=i||"a4";var I="compat",O="advanced",P=I;function K(){this.saveGraphicsState(),j(new dt(ut,0,0,-ut,0,vr()*ut).toString()+" cm"),this.setFontSize(this.getFontSize()/ut),c="n",P=O}function le(){this.restoreGraphicsState(),c="S",P=I}var he=h.__private__.combineFontStyleAndFontWeight=function(g,E){if(g=="bold"&&E=="normal"||g=="bold"&&E==400||g=="normal"&&E=="italic"||g=="bold"&&E=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return E&&(g=E==400||E==="normal"?g==="italic"?"italic":"normal":E!=700&&E!=="bold"||g!=="normal"?(E==700?"bold":E)+""+g:"bold"),g};h.advancedAPI=function(g){var E=P===I;return E&&K.call(this),typeof g!="function"||(g(this),E&&le.call(this)),this},h.compatAPI=function(g){var E=P===O;return E&&le.call(this),typeof g!="function"||(g(this),E&&K.call(this)),this},h.isAdvancedAPI=function(){return P===O};var ne,V=function(g){if(P!==O)throw new Error(g+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},ue=h.roundToPrecision=h.__private__.roundToPrecision=function(g,E){var F=e||E;if(isNaN(g)||isNaN(F))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return g.toFixed(F).replace(/0+$/,"")};ne=h.hpf=h.__private__.hpf=typeof l=="number"?function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return ue(g,l)}:l==="smart"?function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return ue(g,g>-1&&g<1?16:5)}:function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return ue(g,16)};var _=h.f2=h.__private__.f2=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.f2");return ue(g,2)},L=h.__private__.f3=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.f3");return ue(g,3)},C=h.scale=h.__private__.scale=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.scale");return P===I?g*ut:P===O?g:void 0},M=function(g){return C((function(E){return P===I?vr()-E:P===O?E:void 0})(g))};h.__private__.setPrecision=h.setPrecision=function(g){typeof parseInt(g,10)=="number"&&(e=parseInt(g,10))};var Y,G="00000000000000000000000000000000",te=h.__private__.getFileId=function(){return G},X=h.__private__.setFileId=function(g){return G=g!==void 0&&/^[a-fA-F0-9]{32}$/.test(g)?g.toUpperCase():G.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),d!==null&&(On=new dl(d.userPermissions,d.userPassword,d.ownerPassword,G)),G};h.setFileId=function(g){return X(g),this},h.getFileId=function(){return te()};var ae=h.__private__.convertDateToPDFDate=function(g){var E=g.getTimezoneOffset(),F=E<0?"+":"-",Z=Math.floor(Math.abs(E/60)),ce=Math.abs(E%60),Se=[F,W(Z),"'",W(ce),"'"].join("");return["D:",g.getFullYear(),W(g.getMonth()+1),W(g.getDate()),W(g.getHours()),W(g.getMinutes()),W(g.getSeconds()),Se].join("")},me=h.__private__.convertPDFDateToDate=function(g){var E=parseInt(g.substr(2,4),10),F=parseInt(g.substr(6,2),10)-1,Z=parseInt(g.substr(8,2),10),ce=parseInt(g.substr(10,2),10),Se=parseInt(g.substr(12,2),10),Ce=parseInt(g.substr(14,2),10);return new Date(E,F,Z,ce,Se,Ce,0)},fe=h.__private__.setCreationDate=function(g){var E;if(g===void 0&&(g=new Date),g instanceof Date)E=ae(g);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(g))throw new Error("Invalid argument passed to jsPDF.setCreationDate");E=g}return Y=E},k=h.__private__.getCreationDate=function(g){var E=Y;return g==="jsDate"&&(E=me(Y)),E};h.setCreationDate=function(g){return fe(g),this},h.getCreationDate=function(g){return k(g)};var q,W=h.__private__.padd2=function(g){return("0"+parseInt(g)).slice(-2)},U=h.__private__.padd2Hex=function(g){return("00"+(g=g.toString())).substr(g.length)},Q=0,se=[],oe=[],pe=0,be=[],xe=[],Oe=!1,Te=oe;h.__private__.setCustomOutputDestination=function(g){Oe=!0,Te=g};var qe=function(g){Oe||(Te=g)};h.__private__.resetCustomOutputDestination=function(){Oe=!1,Te=oe};var j=h.__private__.out=function(g){return g=g.toString(),pe+=g.length+1,Te.push(g),Te},Be=h.__private__.write=function(g){return j(arguments.length===1?g.toString():Array.prototype.join.call(arguments," "))},xt=h.__private__.getArrayBuffer=function(g){for(var E=g.length,F=new ArrayBuffer(E),Z=new Uint8Array(F);E--;)Z[E]=g.charCodeAt(E);return F},Qe=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];h.__private__.getStandardFonts=function(){return Qe};var Le=n.fontSize||16;h.__private__.setFontSize=h.setFontSize=function(g){return Le=P===O?g/ut:g,this};var Je,$e=h.__private__.getFontSize=h.getFontSize=function(){return P===I?Le:Le*ut},st=n.R2L||!1;h.__private__.setR2L=h.setR2L=function(g){return st=g,this},h.__private__.getR2L=h.getR2L=function(){return st};var tt,Tt=h.__private__.setZoomMode=function(g){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(g))Je=g;else if(isNaN(g)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(g)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+g+'" is not recognized.');Je=g}else Je=parseInt(g,10)};h.__private__.getZoomMode=function(){return Je};var At,mt=h.__private__.setPageMode=function(g){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(g)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+g+'" is not recognized.');tt=g};h.__private__.getPageMode=function(){return tt};var gt=h.__private__.setLayoutMode=function(g){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(g)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+g+'" is not recognized.');At=g};h.__private__.getLayoutMode=function(){return At},h.__private__.setDisplayMode=h.setDisplayMode=function(g,E,F){return Tt(g),gt(E),mt(F),this};var Nt={title:"",subject:"",author:"",keywords:"",creator:""};h.__private__.getDocumentProperty=function(g){if(Object.keys(Nt).indexOf(g)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Nt[g]},h.__private__.getDocumentProperties=function(){return Nt},h.__private__.setDocumentProperties=h.setProperties=h.setDocumentProperties=function(g){for(var E in Nt)Nt.hasOwnProperty(E)&&g[E]&&(Nt[E]=g[E]);return this},h.__private__.setDocumentProperty=function(g,E){if(Object.keys(Nt).indexOf(g)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Nt[g]=E};var Ue,ut,He,sn,Ot,wt={},ft={},Wt=[],Ke={},$t={},Xe={},pt={},Vt=null,St=0,et=[],qt=new M0(h),Mr=n.hotfixes||[],Rt={},Dn={},Fn=[],dt=function g(E,F,Z,ce,Se,Ce){if(!(this instanceof g))return new g(E,F,Z,ce,Se,Ce);isNaN(E)&&(E=1),isNaN(F)&&(F=0),isNaN(Z)&&(Z=0),isNaN(ce)&&(ce=1),isNaN(Se)&&(Se=0),isNaN(Ce)&&(Ce=0),this._matrix=[E,F,Z,ce,Se,Ce]};Object.defineProperty(dt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(g){this._matrix[0]=g}}),Object.defineProperty(dt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(g){this._matrix[1]=g}}),Object.defineProperty(dt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(g){this._matrix[2]=g}}),Object.defineProperty(dt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(g){this._matrix[3]=g}}),Object.defineProperty(dt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(g){this._matrix[4]=g}}),Object.defineProperty(dt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(g){this._matrix[5]=g}}),Object.defineProperty(dt.prototype,"a",{get:function(){return this._matrix[0]},set:function(g){this._matrix[0]=g}}),Object.defineProperty(dt.prototype,"b",{get:function(){return this._matrix[1]},set:function(g){this._matrix[1]=g}}),Object.defineProperty(dt.prototype,"c",{get:function(){return this._matrix[2]},set:function(g){this._matrix[2]=g}}),Object.defineProperty(dt.prototype,"d",{get:function(){return this._matrix[3]},set:function(g){this._matrix[3]=g}}),Object.defineProperty(dt.prototype,"e",{get:function(){return this._matrix[4]},set:function(g){this._matrix[4]=g}}),Object.defineProperty(dt.prototype,"f",{get:function(){return this._matrix[5]},set:function(g){this._matrix[5]=g}}),Object.defineProperty(dt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(dt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(dt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(dt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),dt.prototype.join=function(g){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(ne).join(g)},dt.prototype.multiply=function(g){var E=g.sx*this.sx+g.shy*this.shx,F=g.sx*this.shy+g.shy*this.sy,Z=g.shx*this.sx+g.sy*this.shx,ce=g.shx*this.shy+g.sy*this.sy,Se=g.tx*this.sx+g.ty*this.shx+this.tx,Ce=g.tx*this.shy+g.ty*this.sy+this.ty;return new dt(E,F,Z,ce,Se,Ce)},dt.prototype.decompose=function(){var g=this.sx,E=this.shy,F=this.shx,Z=this.sy,ce=this.tx,Se=this.ty,Ce=Math.sqrt(g*g+E*E),Ze=(g/=Ce)*F+(E/=Ce)*Z;F-=g*Ze,Z-=E*Ze;var lt=Math.sqrt(F*F+Z*Z);return Ze/=lt,g*(Z/=lt)<E*(F/=lt)&&(g=-g,E=-E,Ze=-Ze,Ce=-Ce),{scale:new dt(Ce,0,0,lt,0,0),translate:new dt(1,0,0,1,ce,Se),rotate:new dt(g,E,-E,g,0,0),skew:new dt(1,0,Ze,1,0,0)}},dt.prototype.toString=function(g){return this.join(" ")},dt.prototype.inversed=function(){var g=this.sx,E=this.shy,F=this.shx,Z=this.sy,ce=this.tx,Se=this.ty,Ce=1/(g*Z-E*F),Ze=Z*Ce,lt=-E*Ce,Lt=-F*Ce,Pt=g*Ce;return new dt(Ze,lt,Lt,Pt,-Ze*ce-Lt*Se,-lt*ce-Pt*Se)},dt.prototype.applyToPoint=function(g){var E=g.x*this.sx+g.y*this.shx+this.tx,F=g.x*this.shy+g.y*this.sy+this.ty;return new We(E,F)},dt.prototype.applyToRectangle=function(g){var E=this.applyToPoint(g),F=this.applyToPoint(new We(g.x+g.w,g.y+g.h));return new Ut(E.x,E.y,F.x-E.x,F.y-E.y)},dt.prototype.clone=function(){var g=this.sx,E=this.shy,F=this.shx,Z=this.sy,ce=this.tx,Se=this.ty;return new dt(g,E,F,Z,ce,Se)},h.Matrix=dt;var Cn=h.matrixMult=function(g,E){return E.multiply(g)},Nr=new dt(1,0,0,1,0,0);h.unitMatrix=h.identityMatrix=Nr;var er=function(g,E){if(!$t[g]){var F=(E instanceof yo?"Sh":"P")+(Object.keys(Ke).length+1).toString(10);E.id=F,$t[g]=F,Ke[F]=E,qt.publish("addPattern",E)}};h.ShadingPattern=yo,h.TilingPattern=ml,h.addShadingPattern=function(g,E){return V("addShadingPattern()"),er(g,E),this},h.beginTilingPattern=function(g){V("beginTilingPattern()"),bn(g.boundingBox[0],g.boundingBox[1],g.boundingBox[2]-g.boundingBox[0],g.boundingBox[3]-g.boundingBox[1],g.matrix)},h.endTilingPattern=function(g,E){V("endTilingPattern()"),E.stream=xe[q].join(`
`),er(g,E),qt.publish("endTilingPattern",E),Fn.pop().restore()};var ur,Mt=h.__private__.newObject=function(){var g=Qt();return Ft(g,!0),g},Qt=h.__private__.newObjectDeferred=function(){return Q++,se[Q]=function(){return pe},Q},Ft=function(g,E){return E=typeof E=="boolean"&&E,se[g]=pe,E&&j(g+" 0 obj"),g},Zr=h.__private__.newAdditionalObject=function(){var g={objId:Qt(),content:""};return be.push(g),g},kr=Qt(),dr=Qt(),kn=h.__private__.decodeColorString=function(g){var E=g.split(" ");if(E.length!==2||E[1]!=="g"&&E[1]!=="G")E.length!==5||E[4]!=="k"&&E[4]!=="K"||(E=[(1-E[0])*(1-E[3]),(1-E[1])*(1-E[3]),(1-E[2])*(1-E[3]),"r"]);else{var F=parseFloat(E[0]);E=[F,F,F,"r"]}for(var Z="#",ce=0;ce<3;ce++)Z+=("0"+Math.floor(255*parseFloat(E[ce])).toString(16)).slice(-2);return Z},hr=h.__private__.encodeColorString=function(g){var E;typeof g=="string"&&(g={ch1:g});var F=g.ch1,Z=g.ch2,ce=g.ch3,Se=g.ch4,Ce=g.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof F=="string"&&F.charAt(0)!=="#"){var Ze=new $2(F);if(Ze.ok)F=Ze.toHex();else if(!/^\d*\.?\d*$/.test(F))throw new Error('Invalid color "'+F+'" passed to jsPDF.encodeColorString.')}if(typeof F=="string"&&/^#[0-9A-Fa-f]{3}$/.test(F)&&(F="#"+F[1]+F[1]+F[2]+F[2]+F[3]+F[3]),typeof F=="string"&&/^#[0-9A-Fa-f]{6}$/.test(F)){var lt=parseInt(F.substr(1),16);F=lt>>16&255,Z=lt>>8&255,ce=255&lt}if(Z===void 0||Se===void 0&&F===Z&&Z===ce)E=typeof F=="string"?F+" "+Ce[0]:g.precision===2?_(F/255)+" "+Ce[0]:L(F/255)+" "+Ce[0];else if(Se===void 0||un(Se)==="object"){if(Se&&!isNaN(Se.a)&&Se.a===0)return["1.","1.","1.",Ce[1]].join(" ");E=typeof F=="string"?[F,Z,ce,Ce[1]].join(" "):g.precision===2?[_(F/255),_(Z/255),_(ce/255),Ce[1]].join(" "):[L(F/255),L(Z/255),L(ce/255),Ce[1]].join(" ")}else E=typeof F=="string"?[F,Z,ce,Se,Ce[2]].join(" "):g.precision===2?[_(F),_(Z),_(ce),_(Se),Ce[2]].join(" "):[L(F),L(Z),L(ce),L(Se),Ce[2]].join(" ");return E},tn=h.__private__.getFilters=function(){return a},tr=h.__private__.putStream=function(g){var E=(g=g||{}).data||"",F=g.filters||tn(),Z=g.alreadyAppliedFilters||[],ce=g.addLength1||!1,Se=E.length,Ce=g.objectId,Ze=function(rr){return rr};if(d!==null&&Ce===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");d!==null&&(Ze=On.encryptor(Ce,0));var lt={};F===!0&&(F=["FlateEncode"]);var Lt=g.additionalKeyValues||[],Pt=(lt=at.API.processDataByFilters!==void 0?at.API.processDataByFilters(E,F):{data:E,reverseChain:[]}).reverseChain+(Array.isArray(Z)?Z.join(" "):Z.toString());if(lt.data.length!==0&&(Lt.push({key:"Length",value:lt.data.length}),ce===!0&&Lt.push({key:"Length1",value:Se})),Pt.length!=0)if(Pt.split("/").length-1==1)Lt.push({key:"Filter",value:Pt});else{Lt.push({key:"Filter",value:"["+Pt+"]"});for(var Xt=0;Xt<Lt.length;Xt+=1)if(Lt[Xt].key==="DecodeParms"){for(var Pn=[],Yn=0;Yn<lt.reverseChain.split("/").length-1;Yn+=1)Pn.push("null");Pn.push(Lt[Xt].value),Lt[Xt].value="["+Pn.join(" ")+"]"}}j("<<");for(var wn=0;wn<Lt.length;wn++)j("/"+Lt[wn].key+" "+Lt[wn].value);j(">>"),lt.data.length!==0&&(j("stream"),j(Ze(lt.data)),j("endstream"))},Qr=h.__private__.putPage=function(g){var E=g.number,F=g.data,Z=g.objId,ce=g.contentsObjId;Ft(Z,!0),j("<</Type /Page"),j("/Parent "+g.rootDictionaryObjId+" 0 R"),j("/Resources "+g.resourceDictionaryObjId+" 0 R"),j("/MediaBox ["+parseFloat(ne(g.mediaBox.bottomLeftX))+" "+parseFloat(ne(g.mediaBox.bottomLeftY))+" "+ne(g.mediaBox.topRightX)+" "+ne(g.mediaBox.topRightY)+"]"),g.cropBox!==null&&j("/CropBox ["+ne(g.cropBox.bottomLeftX)+" "+ne(g.cropBox.bottomLeftY)+" "+ne(g.cropBox.topRightX)+" "+ne(g.cropBox.topRightY)+"]"),g.bleedBox!==null&&j("/BleedBox ["+ne(g.bleedBox.bottomLeftX)+" "+ne(g.bleedBox.bottomLeftY)+" "+ne(g.bleedBox.topRightX)+" "+ne(g.bleedBox.topRightY)+"]"),g.trimBox!==null&&j("/TrimBox ["+ne(g.trimBox.bottomLeftX)+" "+ne(g.trimBox.bottomLeftY)+" "+ne(g.trimBox.topRightX)+" "+ne(g.trimBox.topRightY)+"]"),g.artBox!==null&&j("/ArtBox ["+ne(g.artBox.bottomLeftX)+" "+ne(g.artBox.bottomLeftY)+" "+ne(g.artBox.topRightX)+" "+ne(g.artBox.topRightY)+"]"),typeof g.userUnit=="number"&&g.userUnit!==1&&j("/UserUnit "+g.userUnit),qt.publish("putPage",{objId:Z,pageContext:et[E],pageNumber:E,page:F}),j("/Contents "+ce+" 0 R"),j(">>"),j("endobj");var Se=F.join(`
`);return P===O&&(Se+=`
Q`),Ft(ce,!0),tr({data:Se,filters:tn(),objectId:ce}),j("endobj"),Z},Lr=h.__private__.putPages=function(){var g,E,F=[];for(g=1;g<=St;g++)et[g].objId=Qt(),et[g].contentsObjId=Qt();for(g=1;g<=St;g++)F.push(Qr({number:g,data:xe[g],objId:et[g].objId,contentsObjId:et[g].contentsObjId,mediaBox:et[g].mediaBox,cropBox:et[g].cropBox,bleedBox:et[g].bleedBox,trimBox:et[g].trimBox,artBox:et[g].artBox,userUnit:et[g].userUnit,rootDictionaryObjId:kr,resourceDictionaryObjId:dr}));Ft(kr,!0),j("<</Type /Pages");var Z="/Kids [";for(E=0;E<St;E++)Z+=F[E]+" 0 R ";j(Z+"]"),j("/Count "+St),j(">>"),j("endobj"),qt.publish("postPutPages")},ze=function(g){qt.publish("putFont",{font:g,out:j,newObject:Mt,putStream:tr}),g.isAlreadyPutted!==!0&&(g.objectNumber=Mt(),j("<<"),j("/Type /Font"),j("/BaseFont /"+hl(g.postScriptName)),j("/Subtype /Type1"),typeof g.encoding=="string"&&j("/Encoding /"+g.encoding),j("/FirstChar 32"),j("/LastChar 255"),j(">>"),j("endobj"))},ee=function(g){g.objectNumber=Mt();var E=[];E.push({key:"Type",value:"/XObject"}),E.push({key:"Subtype",value:"/Form"}),E.push({key:"BBox",value:"["+[ne(g.x),ne(g.y),ne(g.x+g.width),ne(g.y+g.height)].join(" ")+"]"}),E.push({key:"Matrix",value:"["+g.matrix.toString()+"]"});var F=g.pages[1].join(`
`);tr({data:F,additionalKeyValues:E,objectId:g.objectNumber}),j("endobj")},ke=function(g,E){E||(E=21);var F=Mt(),Z=(function(Ce,Ze){var lt,Lt=[],Pt=1/(Ze-1);for(lt=0;lt<1;lt+=Pt)Lt.push(lt);if(Lt.push(1),Ce[0].offset!=0){var Xt={offset:0,color:Ce[0].color};Ce.unshift(Xt)}if(Ce[Ce.length-1].offset!=1){var Pn={offset:1,color:Ce[Ce.length-1].color};Ce.push(Pn)}for(var Yn="",wn=0,rr=0;rr<Lt.length;rr++){for(lt=Lt[rr];lt>Ce[wn+1].offset;)wn++;var Jn=Ce[wn].offset,br=(lt-Jn)/(Ce[wn+1].offset-Jn),Us=Ce[wn].color,Wi=Ce[wn+1].color;Yn+=U(Math.round((1-br)*Us[0]+br*Wi[0]).toString(16))+U(Math.round((1-br)*Us[1]+br*Wi[1]).toString(16))+U(Math.round((1-br)*Us[2]+br*Wi[2]).toString(16))}return Yn.trim()})(g.colors,E),ce=[];ce.push({key:"FunctionType",value:"0"}),ce.push({key:"Domain",value:"[0.0 1.0]"}),ce.push({key:"Size",value:"["+E+"]"}),ce.push({key:"BitsPerSample",value:"8"}),ce.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ce.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),tr({data:Z,additionalKeyValues:ce,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:F}),j("endobj"),g.objectNumber=Mt(),j("<< /ShadingType "+g.type),j("/ColorSpace /DeviceRGB");var Se="/Coords ["+ne(parseFloat(g.coords[0]))+" "+ne(parseFloat(g.coords[1]))+" ";g.type===2?Se+=ne(parseFloat(g.coords[2]))+" "+ne(parseFloat(g.coords[3])):Se+=ne(parseFloat(g.coords[2]))+" "+ne(parseFloat(g.coords[3]))+" "+ne(parseFloat(g.coords[4]))+" "+ne(parseFloat(g.coords[5])),j(Se+="]"),g.matrix&&j("/Matrix ["+g.matrix.toString()+"]"),j("/Function "+F+" 0 R"),j("/Extend [true true]"),j(">>"),j("endobj")},Me=function(g,E){var F=Qt(),Z=Mt();E.push({resourcesOid:F,objectOid:Z}),g.objectNumber=Z;var ce=[];ce.push({key:"Type",value:"/Pattern"}),ce.push({key:"PatternType",value:"1"}),ce.push({key:"PaintType",value:"1"}),ce.push({key:"TilingType",value:"1"}),ce.push({key:"BBox",value:"["+g.boundingBox.map(ne).join(" ")+"]"}),ce.push({key:"XStep",value:ne(g.xStep)}),ce.push({key:"YStep",value:ne(g.yStep)}),ce.push({key:"Resources",value:F+" 0 R"}),g.matrix&&ce.push({key:"Matrix",value:"["+g.matrix.toString()+"]"}),tr({data:g.stream,additionalKeyValues:ce,objectId:g.objectNumber}),j("endobj")},en=function(g){for(var E in g.objectNumber=Mt(),j("<<"),g)switch(E){case"opacity":j("/ca "+_(g[E]));break;case"stroke-opacity":j("/CA "+_(g[E]))}j(">>"),j("endobj")},vn=function(g){Ft(g.resourcesOid,!0),j("<<"),j("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var E in j("/Font <<"),wt)wt.hasOwnProperty(E)&&(m===!1||m===!0&&p.hasOwnProperty(E))&&j("/"+E+" "+wt[E].objectNumber+" 0 R");j(">>")})(),(function(){if(Object.keys(Ke).length>0){for(var E in j("/Shading <<"),Ke)Ke.hasOwnProperty(E)&&Ke[E]instanceof yo&&Ke[E].objectNumber>=0&&j("/"+E+" "+Ke[E].objectNumber+" 0 R");qt.publish("putShadingPatternDict"),j(">>")}})(),(function(E){if(Object.keys(Ke).length>0){for(var F in j("/Pattern <<"),Ke)Ke.hasOwnProperty(F)&&Ke[F]instanceof h.TilingPattern&&Ke[F].objectNumber>=0&&Ke[F].objectNumber<E&&j("/"+F+" "+Ke[F].objectNumber+" 0 R");qt.publish("putTilingPatternDict"),j(">>")}})(g.objectOid),(function(){if(Object.keys(Xe).length>0){var E;for(E in j("/ExtGState <<"),Xe)Xe.hasOwnProperty(E)&&Xe[E].objectNumber>=0&&j("/"+E+" "+Xe[E].objectNumber+" 0 R");qt.publish("putGStateDict"),j(">>")}})(),(function(){for(var E in j("/XObject <<"),Rt)Rt.hasOwnProperty(E)&&Rt[E].objectNumber>=0&&j("/"+E+" "+Rt[E].objectNumber+" 0 R");qt.publish("putXobjectDict"),j(">>")})(),j(">>"),j("endobj")},an=function(g){ft[g.fontName]=ft[g.fontName]||{},ft[g.fontName][g.fontStyle]=g.id},In=function(g,E,F,Z,ce){var Se={id:"F"+(Object.keys(wt).length+1).toString(10),postScriptName:g,fontName:E,fontStyle:F,encoding:Z,isStandardFont:ce||!1,metadata:{}};return qt.publish("addFont",{font:Se,instance:this}),wt[Se.id]=Se,an(Se),Se.id},on=h.__private__.pdfEscape=h.pdfEscape=function(g,E){return(function(F,Z){var ce,Se,Ce,Ze,lt,Lt,Pt,Xt,Pn;if(Ce=(Z=Z||{}).sourceEncoding||"Unicode",lt=Z.outputEncoding,(Z.autoencode||lt)&&wt[Ue].metadata&&wt[Ue].metadata[Ce]&&wt[Ue].metadata[Ce].encoding&&(Ze=wt[Ue].metadata[Ce].encoding,!lt&&wt[Ue].encoding&&(lt=wt[Ue].encoding),!lt&&Ze.codePages&&(lt=Ze.codePages[0]),typeof lt=="string"&&(lt=Ze[lt]),lt)){for(Pt=!1,Lt=[],ce=0,Se=F.length;ce<Se;ce++)(Xt=lt[F.charCodeAt(ce)])?Lt.push(String.fromCharCode(Xt)):Lt.push(F[ce]),Lt[ce].charCodeAt(0)>>8&&(Pt=!0);F=Lt.join("")}for(ce=F.length;Pt===void 0&&ce!==0;)F.charCodeAt(ce-1)>>8&&(Pt=!0),ce--;if(!Pt)return F;for(Lt=Z.noBOM?[]:[254,255],ce=0,Se=F.length;ce<Se;ce++){if((Pn=(Xt=F.charCodeAt(ce))>>8)>>8)throw new Error("Character at position "+ce+" of string '"+F+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Lt.push(Pn),Lt.push(Xt-(Pn<<8))}return String.fromCharCode.apply(void 0,Lt)})(g,E).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},mr=h.__private__.beginPage=function(g){xe[++St]=[],et[St]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(g[0]),topRightY:Number(g[1])}},ci(St),qe(xe[q])},Fr=function(g,E){var F,Z,ce;switch(t=E||t,typeof g=="string"&&(F=A(g.toLowerCase()),Array.isArray(F)&&(Z=F[0],ce=F[1])),Array.isArray(g)&&(Z=g[0]*ut,ce=g[1]*ut),isNaN(Z)&&(Z=i[0],ce=i[1]),(Z>14400||ce>14400)&&(mn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Z=Math.min(14400,Z),ce=Math.min(14400,ce)),i=[Z,ce],t.substr(0,1)){case"l":ce>Z&&(i=[ce,Z]);break;case"p":Z>ce&&(i=[ce,Z])}mr(i),vt(bs),j(Ui),J!==0&&j(J+" J"),we!==0&&j(we+" j"),qt.publish("addPage",{pageNumber:St})},Kt=function(g){g>0&&g<=St&&(xe.splice(g,1),et.splice(g,1),St--,q>St&&(q=St),this.setPage(q))},ci=function(g){g>0&&g<=St&&(q=g)},Mi=h.__private__.getNumberOfPages=h.getNumberOfPages=function(){return xe.length-1},ha=function(g,E,F){var Z,ce=void 0;return F=F||{},g=g!==void 0?g:wt[Ue].fontName,E=E!==void 0?E:wt[Ue].fontStyle,Z=g.toLowerCase(),ft[Z]!==void 0&&ft[Z][E]!==void 0?ce=ft[Z][E]:ft[g]!==void 0&&ft[g][E]!==void 0?ce=ft[g][E]:F.disableWarning===!1&&mn.warn("Unable to look up font label for font '"+g+"', '"+E+"'. Refer to getFontList() for available fonts."),ce||F.noFallback||(ce=ft.times[E])==null&&(ce=ft.times.normal),ce},ei=h.__private__.putInfo=function(){var g=Mt(),E=function(Z){return Z};for(var F in d!==null&&(E=On.encryptor(g,0)),j("<<"),j("/Producer ("+on(E("jsPDF "+at.version))+")"),Nt)Nt.hasOwnProperty(F)&&Nt[F]&&j("/"+F.substr(0,1).toUpperCase()+F.substr(1)+" ("+on(E(Nt[F]))+")");j("/CreationDate ("+on(E(Y))+")"),j(">>"),j("endobj")},gs=h.__private__.putCatalog=function(g){var E=(g=g||{}).rootDictionaryObjId||kr;switch(Mt(),j("<<"),j("/Type /Catalog"),j("/Pages "+E+" 0 R"),Je||(Je="fullwidth"),Je){case"fullwidth":j("/OpenAction [3 0 R /FitH null]");break;case"fullheight":j("/OpenAction [3 0 R /FitV null]");break;case"fullpage":j("/OpenAction [3 0 R /Fit]");break;case"original":j("/OpenAction [3 0 R /XYZ null null 1]");break;default:var F=""+Je;F.substr(F.length-1)==="%"&&(Je=parseInt(Je)/100),typeof Je=="number"&&j("/OpenAction [3 0 R /XYZ null null "+_(Je)+"]")}switch(At||(At="continuous"),At){case"continuous":j("/PageLayout /OneColumn");break;case"single":j("/PageLayout /SinglePage");break;case"two":case"twoleft":j("/PageLayout /TwoColumnLeft");break;case"tworight":j("/PageLayout /TwoColumnRight")}tt&&j("/PageMode /"+tt),qt.publish("putCatalog"),j(">>"),j("endobj")},Ya=h.__private__.putTrailer=function(){j("trailer"),j("<<"),j("/Size "+(Q+1)),j("/Root "+Q+" 0 R"),j("/Info "+(Q-1)+" 0 R"),d!==null&&j("/Encrypt "+On.oid+" 0 R"),j("/ID [ <"+G+"> <"+G+"> ]"),j(">>")},dn=h.__private__.putHeader=function(){j("%PDF-"+b),j("%")},vs=h.__private__.putXRef=function(){var g="0000000000";j("xref"),j("0 "+(Q+1)),j("0000000000 65535 f ");for(var E=1;E<=Q;E++)typeof se[E]=="function"?j((g+se[E]()).slice(-10)+" 00000 n "):se[E]!==void 0?j((g+se[E]).slice(-10)+" 00000 n "):j("0000000000 00000 n ")},fr=h.__private__.buildDocument=function(){var g;Q=0,pe=0,oe=[],se=[],be=[],kr=Qt(),dr=Qt(),qe(oe),qt.publish("buildDocument"),dn(),Lr(),(function(){qt.publish("putAdditionalObjects");for(var F=0;F<be.length;F++){var Z=be[F];Ft(Z.objId,!0),j(Z.content),j("endobj")}qt.publish("postPutAdditionalObjects")})(),g=[],(function(){for(var F in wt)wt.hasOwnProperty(F)&&(m===!1||m===!0&&p.hasOwnProperty(F))&&ze(wt[F])})(),(function(){var F;for(F in Xe)Xe.hasOwnProperty(F)&&en(Xe[F])})(),(function(){for(var F in Rt)Rt.hasOwnProperty(F)&&ee(Rt[F])})(),(function(F){var Z;for(Z in Ke)Ke.hasOwnProperty(Z)&&(Ke[Z]instanceof yo?ke(Ke[Z]):Ke[Z]instanceof ml&&Me(Ke[Z],F))})(g),qt.publish("putResources"),g.forEach(vn),vn({resourcesOid:dr,objectOid:Number.MAX_SAFE_INTEGER}),qt.publish("postPutResources"),d!==null&&(On.oid=Mt(),j("<<"),j("/Filter /Standard"),j("/V "+On.v),j("/R "+On.r),j("/U <"+On.toHexString(On.U)+">"),j("/O <"+On.toHexString(On.O)+">"),j("/P "+On.P),j(">>"),j("endobj")),ei(),gs();var E=pe;return vs(),Ya(),j("startxref"),j(""+E),j("%%EOF"),qe(xe[q]),oe.join(`
`)},Fi=h.__private__.getBlob=function(g){return new Blob([xt(g)],{type:"application/pdf"})},js=h.output=h.__private__.output=(ur=function(g,E){switch(typeof(E=E||{})=="string"?E={filename:E}:E.filename=E.filename||"generated.pdf",g){case void 0:return fr();case"save":h.save(E.filename);break;case"arraybuffer":return xt(fr());case"blob":return Fi(fr());case"bloburi":case"bloburl":if(kt.URL!==void 0&&typeof kt.URL.createObjectURL=="function")return kt.URL&&kt.URL.createObjectURL(Fi(fr()))||void 0;mn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var F="",Z=fr();try{F=q0(Z)}catch{F=q0(unescape(encodeURIComponent(Z)))}return"data:application/pdf;filename="+E.filename+";base64,"+F;case"pdfobjectnewwindow":if(Object.prototype.toString.call(kt)==="[object Window]"){var ce="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Se=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';E.pdfObjectUrl&&(ce=E.pdfObjectUrl,Se="");var Ce='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+ce+'"'+Se+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(E)+");<\/script></body></html>",Ze=kt.open();return Ze!==null&&Ze.document.write(Ce),Ze}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(kt)==="[object Window]"){var lt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(E.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+E.filename+'" width="500px" height="400px" /></body></html>',Lt=kt.open();if(Lt!==null){Lt.document.write(lt);var Pt=this;Lt.document.documentElement.querySelector("#pdfViewer").onload=function(){Lt.document.title=E.filename,Lt.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Pt.output("bloburl"))}}return Lt}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(kt)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Xt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",E)+'"></iframe></body></html>',Pn=kt.open();if(Pn!==null&&(Pn.document.write(Xt),Pn.document.title=E.filename),Pn||typeof safari>"u")return Pn;break;case"datauri":case"dataurl":return kt.document.location.href=this.output("datauristring",E);default:return null}},ur.foo=function(){try{return ur.apply(this,arguments)}catch(F){var g=F.stack||"";~g.indexOf(" at ")&&(g=g.split(" at ")[1]);var E="Error in function "+g.split(`
`)[0].split("<")[0]+": "+F.message;if(!kt.console)throw new Error(E);kt.console.error(E,F),kt.alert&&alert(E)}},ur.foo.bar=ur,ur.foo),Tr=function(g){return Array.isArray(Mr)===!0&&Mr.indexOf(g)>-1};switch(r){case"pt":ut=1;break;case"mm":ut=72/25.4;break;case"cm":ut=72/2.54;break;case"in":ut=72;break;case"px":ut=Tr("px_scaling")==1?.75:96/72;break;case"pc":case"em":ut=12;break;case"ex":ut=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);ut=r}var On=null;fe(),X();var ui=h.__private__.getPageInfo=h.getPageInfo=function(g){if(isNaN(g)||g%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:et[g].objId,pageNumber:g,pageContext:et[g]}},fa=h.__private__.getPageInfoByObjId=function(g){if(isNaN(g)||g%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var E in et)if(et[E].objId===g)break;return ui(E)},$s=h.__private__.getCurrentPageInfo=h.getCurrentPageInfo=function(){return{objId:et[q].objId,pageNumber:q,pageContext:et[q]}};h.addPage=function(){return Fr.apply(this,arguments),this},h.setPage=function(){return ci.apply(this,arguments),qe.call(this,xe[q]),this},h.insertPage=function(g){return this.addPage(),this.movePage(q,g),this},h.movePage=function(g,E){var F,Z;if(g>E){F=xe[g],Z=et[g];for(var ce=g;ce>E;ce--)xe[ce]=xe[ce-1],et[ce]=et[ce-1];xe[E]=F,et[E]=Z,this.setPage(E)}else if(g<E){F=xe[g],Z=et[g];for(var Se=g;Se<E;Se++)xe[Se]=xe[Se+1],et[Se]=et[Se+1];xe[E]=F,et[E]=Z,this.setPage(E)}return this},h.deletePage=function(){return Kt.apply(this,arguments),this},h.__private__.text=h.text=function(g,E,F,Z,ce){var Se,Ce,Ze,lt,Lt,Pt,Xt,Pn,Yn,wn=(Z=Z||{}).scope||this;if(typeof g=="number"&&typeof E=="number"&&(typeof F=="string"||Array.isArray(F))){var rr=F;F=E,E=g,g=rr}if(arguments[3]instanceof dt==0?(Ze=arguments[4],lt=arguments[5],un(Xt=arguments[3])==="object"&&Xt!==null||(typeof Ze=="string"&&(lt=Ze,Ze=null),typeof Xt=="string"&&(lt=Xt,Xt=null),typeof Xt=="number"&&(Ze=Xt,Xt=null),Z={flags:Xt,angle:Ze,align:lt})):(V("The transform parameter of text() with a Matrix value"),Yn=ce),isNaN(E)||isNaN(F)||g==null)throw new Error("Invalid arguments passed to jsPDF.text");if(g.length===0)return wn;var Jn,br="",Us=typeof Z.lineHeightFactor=="number"?Z.lineHeightFactor:Rn,Wi=wn.internal.scaleFactor;function zs(nn){return nn=nn.split("	").join(Array(Z.TabLen||9).join(" ")),on(nn,Xt)}function $l(nn){for(var fn,zn=nn.concat(),ir=[],Vs=zn.length;Vs--;)typeof(fn=zn.shift())=="string"?ir.push(fn):Array.isArray(nn)&&(fn.length===1||fn[1]===void 0&&fn[2]===void 0)?ir.push(fn[0]):ir.push([fn[0],fn[1],fn[2]]);return ir}function zo(nn,fn){var zn;if(typeof nn=="string")zn=fn(nn)[0];else if(Array.isArray(nn)){for(var ir,Vs,Yl=nn.concat(),Vo=[],mu=Yl.length;mu--;)typeof(ir=Yl.shift())=="string"?Vo.push(fn(ir)[0]):Array.isArray(ir)&&typeof ir[0]=="string"&&(Vs=fn(ir[0],ir[1],ir[2]),Vo.push([Vs[0],Vs[1],Vs[2]]));zn=Vo}return zn}var ba=!1,to=!0;if(typeof g=="string")ba=!0;else if(Array.isArray(g)){var no=g.concat();Ce=[];for(var ya,yr=no.length;yr--;)(typeof(ya=no.shift())!="string"||Array.isArray(ya)&&typeof ya[0]!="string")&&(to=!1);ba=to}if(ba===!1)throw new Error('Type of text must be string or Array. "'+g+'" is not recognized.');typeof g=="string"&&(g=g.match(/[\r?\n]/)?g.split(/\r\n|\r|\n/g):[g]);var ro=Le/wn.internal.scaleFactor,io=ro*(Us-1);switch(Z.baseline){case"bottom":F-=io;break;case"top":F+=ro-io;break;case"hanging":F+=ro-2*io;break;case"middle":F+=ro/2-io}if((Pt=Z.maxWidth||0)>0&&(typeof g=="string"?g=wn.splitTextToSize(g,Pt):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(nn,fn){return nn.concat(wn.splitTextToSize(fn,Pt))},[]))),Se={text:g,x:E,y:F,options:Z,mutex:{pdfEscape:on,activeFontKey:Ue,fonts:wt,activeFontSize:Le}},qt.publish("preProcessText",Se),g=Se.text,Ze=(Z=Se.options).angle,Yn instanceof dt==0&&Ze&&typeof Ze=="number"){Ze*=Math.PI/180,Z.rotationDirection===0&&(Ze=-Ze),P===O&&(Ze=-Ze);var Ml=Math.cos(Ze),Fl=Math.sin(Ze);Yn=new dt(Ml,Fl,-Fl,Ml,0,0)}else Ze&&Ze instanceof dt&&(Yn=Ze);P!==O||Yn||(Yn=Nr),(Lt=Z.charSpace||y)!==void 0&&(br+=ne(C(Lt))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Pn=Z.horizontalScale)!==void 0&&(br+=ne(100*Pn)+` Tz
`),Z.lang;var Hr=-1,Hs=Z.renderingMode!==void 0?Z.renderingMode:Z.stroke,Ho=wn.internal.getCurrentPageInfo().pageContext;switch(Hs){case 0:case!1:case"fill":Hr=0;break;case 1:case!0:case"stroke":Hr=1;break;case 2:case"fillThenStroke":Hr=2;break;case 3:case"invisible":Hr=3;break;case 4:case"fillAndAddForClipping":Hr=4;break;case 5:case"strokeAndAddPathForClipping":Hr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Hr=6;break;case 7:case"addToPathForClipping":Hr=7}var fu=Ho.usedRenderingMode!==void 0?Ho.usedRenderingMode:-1;Hr!==-1?br+=Hr+` Tr
`:fu!==-1&&(br+=`0 Tr
`),Hr!==-1&&(Ho.usedRenderingMode=Hr),lt=Z.align||"left";var Li,so=Le*Us,Ul=wn.internal.pageSize.getWidth(),zl=wt[Ue];Lt=Z.charSpace||y,Pt=Z.maxWidth||0,Xt=Object.assign({autoencode:!0,noBOM:!0},Z.flags);var wa=[],ao=function(nn){return wn.getStringUnitWidth(nn,{font:zl,charSpace:Lt,fontSize:Le,doKerning:!1})*Le/Wi};if(Object.prototype.toString.call(g)==="[object Array]"){var hi;Ce=$l(g),lt!=="left"&&(Li=Ce.map(ao));var fi,_a=0;if(lt==="right"){E-=Li[0],g=[],yr=Ce.length;for(var Ws=0;Ws<yr;Ws++)Ws===0?(fi=ri(E),hi=zr(F)):(fi=C(_a-Li[Ws]),hi=-so),g.push([Ce[Ws],fi,hi]),_a=Li[Ws]}else if(lt==="center"){E-=Li[0]/2,g=[],yr=Ce.length;for(var xa=0;xa<yr;xa++)xa===0?(fi=ri(E),hi=zr(F)):(fi=C((_a-Li[xa])/2),hi=-so),g.push([Ce[xa],fi,hi]),_a=Li[xa]}else if(lt==="left"){g=[],yr=Ce.length;for(var Hl=0;Hl<yr;Hl++)g.push(Ce[Hl])}else if(lt==="justify"&&zl.encoding==="Identity-H"){g=[],yr=Ce.length,Pt=Pt!==0?Pt:Ul;for(var Wo=0,Un=0;Un<yr;Un++)if(hi=Un===0?zr(F):-so,fi=Un===0?ri(E):Wo,Un<yr-1){var pu=C((Pt-Li[Un])/(Ce[Un].split(" ").length-1)),ws=Ce[Un].split(" ");g.push([ws[0]+" ",fi,hi]),Wo=0;for(var _s=1;_s<ws.length;_s++){var Wl=(ao(ws[_s-1]+" "+ws[_s])-ao(ws[_s]))*Wi+pu;_s==ws.length-1?g.push([ws[_s],Wl,0]):g.push([ws[_s]+" ",Wl,0]),Wo-=Wl}}else g.push([Ce[Un],fi,hi]);g.push(["",Wo,0])}else{if(lt!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(g=[],yr=Ce.length,Pt=Pt!==0?Pt:Ul,Un=0;Un<yr;Un++){hi=Un===0?zr(F):-so,fi=Un===0?ri(E):0;var Vl=Ce[Un].split(" ").length-1,Gl=Vl>0?(Pt-Li[Un])/Vl:0;Un<yr-1?wa.push(ne(C(Gl))):wa.push(0),g.push([Ce[Un],fi,hi])}}}(typeof Z.R2L=="boolean"?Z.R2L:st)===!0&&(g=zo(g,function(nn,fn,zn){return[nn.split("").reverse().join(""),fn,zn]})),Se={text:g,x:E,y:F,options:Z,mutex:{pdfEscape:on,activeFontKey:Ue,fonts:wt,activeFontSize:Le}},qt.publish("postProcessText",Se),g=Se.text,Jn=Se.mutex.isHex||!1;var Kl=wt[Ue].encoding;Kl!=="WinAnsiEncoding"&&Kl!=="StandardEncoding"||(g=zo(g,function(nn,fn,zn){return[zs(nn),fn,zn]})),Ce=$l(g),g=[];for(var Aa,Sa,Ea,oo=Array.isArray(Ce[0])?1:0,Na="",lo=function(nn,fn,zn){var ir="";return zn instanceof dt?(zn=typeof Z.angle=="number"?Cn(zn,new dt(1,0,0,1,nn,fn)):Cn(new dt(1,0,0,1,nn,fn),zn),P===O&&(zn=Cn(new dt(1,0,0,-1,0,0),zn)),ir=zn.join(" ")+` Tm
`):ir=ne(nn)+" "+ne(fn)+` Td
`,ir},Ti=0;Ti<Ce.length;Ti++){switch(Na="",oo){case 1:Ea=(Jn?"<":"(")+Ce[Ti][0]+(Jn?">":")"),Aa=parseFloat(Ce[Ti][1]),Sa=parseFloat(Ce[Ti][2]);break;case 0:Ea=(Jn?"<":"(")+Ce[Ti]+(Jn?">":")"),Aa=ri(E),Sa=zr(F)}wa!==void 0&&wa[Ti]!==void 0&&(Na=wa[Ti]+` Tw
`),Ti===0?g.push(Na+lo(Aa,Sa,Yn)+Ea):oo===0?g.push(Na+Ea):oo===1&&g.push(Na+lo(Aa,Sa,Yn)+Ea)}g=oo===0?g.join(` Tj
T* `):g.join(` Tj
`),g+=` Tj
`;var xs=`BT
/`;return xs+=Ue+" "+Le+` Tf
`,xs+=ne(Le*Us)+` TL
`,xs+=Hi+`
`,xs+=br,xs+=g,j(xs+="ET"),p[Ue]=!0,wn};var Ja=h.__private__.clip=h.clip=function(g){return j(g==="evenodd"?"W*":"W"),this};h.clipEvenOdd=function(){return Ja("evenodd")},h.__private__.discardPath=h.discardPath=function(){return j("n"),this};var ti=h.__private__.isValidStyle=function(g){var E=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(g)!==-1&&(E=!0),E};h.__private__.setDefaultPathOperation=h.setDefaultPathOperation=function(g){return ti(g)&&(c=g),this};var Ni=h.__private__.getStyle=h.getStyle=function(g){var E=c;switch(g){case"D":case"S":E="S";break;case"F":E="f";break;case"FD":case"DF":E="B";break;case"f":case"f*":case"B":case"B*":E=g}return E},Cr=h.close=function(){return j("h"),this};h.stroke=function(){return j("S"),this},h.fill=function(g){return Ir("f",g),this},h.fillEvenOdd=function(g){return Ir("f*",g),this},h.fillStroke=function(g){return Ir("B",g),this},h.fillStrokeEvenOdd=function(g){return Ir("B*",g),this};var Ir=function(g,E){un(E)==="object"?ni(E,g):j(g)},gr=function(g){g===null||P===O&&g===void 0||(g=Ni(g),j(g))};function Xa(g,E,F,Z,ce){var Se=new ml(E||this.boundingBox,F||this.xStep,Z||this.yStep,this.gState,ce||this.matrix);Se.stream=this.stream;var Ce=g+"$$"+this.cloneIndex+++"$$";return er(Ce,Se),Se}var ni=function(g,E){var F=$t[g.key],Z=Ke[F];if(Z instanceof yo)j("q"),j(Za(E)),Z.gState&&h.setGState(Z.gState),j(g.matrix.toString()+" cm"),j("/"+F+" sh"),j("Q");else if(Z instanceof ml){var ce=new dt(1,0,0,-1,0,vr());g.matrix&&(ce=ce.multiply(g.matrix||Nr),F=Xa.call(Z,g.key,g.boundingBox,g.xStep,g.yStep,ce).id),j("q"),j("/Pattern cs"),j("/"+F+" scn"),Z.gState&&h.setGState(Z.gState),j(E),j("Q")}},Za=function(g){switch(g){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Ms=h.moveTo=function(g,E){return j(ne(C(g))+" "+ne(M(E))+" m"),this},pa=h.lineTo=function(g,E){return j(ne(C(g))+" "+ne(M(E))+" l"),this},Ur=h.curveTo=function(g,E,F,Z,ce,Se){return j([ne(C(g)),ne(M(E)),ne(C(F)),ne(M(Z)),ne(C(ce)),ne(M(Se)),"c"].join(" ")),this};h.__private__.line=h.line=function(g,E,F,Z,ce){if(isNaN(g)||isNaN(E)||isNaN(F)||isNaN(Z)||!ti(ce))throw new Error("Invalid arguments passed to jsPDF.line");return P===I?this.lines([[F-g,Z-E]],g,E,[1,1],ce||"S"):this.lines([[F-g,Z-E]],g,E,[1,1]).stroke()},h.__private__.lines=h.lines=function(g,E,F,Z,ce,Se){var Ce,Ze,lt,Lt,Pt,Xt,Pn,Yn,wn,rr,Jn,br;if(typeof g=="number"&&(br=F,F=E,E=g,g=br),Z=Z||[1,1],Se=Se||!1,isNaN(E)||isNaN(F)||!Array.isArray(g)||!Array.isArray(Z)||!ti(ce)||typeof Se!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ms(E,F),Ce=Z[0],Ze=Z[1],Lt=g.length,rr=E,Jn=F,lt=0;lt<Lt;lt++)(Pt=g[lt]).length===2?(rr=Pt[0]*Ce+rr,Jn=Pt[1]*Ze+Jn,pa(rr,Jn)):(Xt=Pt[0]*Ce+rr,Pn=Pt[1]*Ze+Jn,Yn=Pt[2]*Ce+rr,wn=Pt[3]*Ze+Jn,rr=Pt[4]*Ce+rr,Jn=Pt[5]*Ze+Jn,Ur(Xt,Pn,Yn,wn,rr,Jn));return Se&&Cr(),gr(ce),this},h.path=function(g){for(var E=0;E<g.length;E++){var F=g[E],Z=F.c;switch(F.op){case"m":Ms(Z[0],Z[1]);break;case"l":pa(Z[0],Z[1]);break;case"c":Ur.apply(this,Z);break;case"h":Cr()}}return this},h.__private__.rect=h.rect=function(g,E,F,Z,ce){if(isNaN(g)||isNaN(E)||isNaN(F)||isNaN(Z)||!ti(ce))throw new Error("Invalid arguments passed to jsPDF.rect");return P===I&&(Z=-Z),j([ne(C(g)),ne(M(E)),ne(C(F)),ne(C(Z)),"re"].join(" ")),gr(ce),this},h.__private__.triangle=h.triangle=function(g,E,F,Z,ce,Se,Ce){if(isNaN(g)||isNaN(E)||isNaN(F)||isNaN(Z)||isNaN(ce)||isNaN(Se)||!ti(Ce))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[F-g,Z-E],[ce-F,Se-Z],[g-ce,E-Se]],g,E,[1,1],Ce,!0),this},h.__private__.roundedRect=h.roundedRect=function(g,E,F,Z,ce,Se,Ce){if(isNaN(g)||isNaN(E)||isNaN(F)||isNaN(Z)||isNaN(ce)||isNaN(Se)||!ti(Ce))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Ze=4/3*(Math.SQRT2-1);return ce=Math.min(ce,.5*F),Se=Math.min(Se,.5*Z),this.lines([[F-2*ce,0],[ce*Ze,0,ce,Se-Se*Ze,ce,Se],[0,Z-2*Se],[0,Se*Ze,-ce*Ze,Se,-ce,Se],[2*ce-F,0],[-ce*Ze,0,-ce,-Se*Ze,-ce,-Se],[0,2*Se-Z],[0,-Se*Ze,ce*Ze,-Se,ce,-Se]],g+ce,E,[1,1],Ce,!0),this},h.__private__.ellipse=h.ellipse=function(g,E,F,Z,ce){if(isNaN(g)||isNaN(E)||isNaN(F)||isNaN(Z)||!ti(ce))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Se=4/3*(Math.SQRT2-1)*F,Ce=4/3*(Math.SQRT2-1)*Z;return Ms(g+F,E),Ur(g+F,E-Ce,g+Se,E-Z,g,E-Z),Ur(g-Se,E-Z,g-F,E-Ce,g-F,E),Ur(g-F,E+Ce,g-Se,E+Z,g,E+Z),Ur(g+Se,E+Z,g+F,E+Ce,g+F,E),gr(ce),this},h.__private__.circle=h.circle=function(g,E,F,Z){if(isNaN(g)||isNaN(E)||isNaN(F)||!ti(Z))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(g,E,F,F,Z)},h.setFont=function(g,E,F){return F&&(E=he(E,F)),Ue=ha(g,E,{disableWarning:!1}),this};var ma=h.__private__.getFont=h.getFont=function(){return wt[ha.apply(h,arguments)]};h.__private__.getFontList=h.getFontList=function(){var g,E,F={};for(g in ft)if(ft.hasOwnProperty(g))for(E in F[g]=[],ft[g])ft[g].hasOwnProperty(E)&&F[g].push(E);return F},h.addFont=function(g,E,F,Z,ce){var Se=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Se.indexOf(arguments[3])!==-1?ce=arguments[3]:arguments[3]&&Se.indexOf(arguments[3])==-1&&(F=he(F,Z)),In.call(this,g,E,F,ce=ce||"Identity-H")};var Rn,bs=n.lineWidth||.200025,ga=h.__private__.getLineWidth=h.getLineWidth=function(){return bs},vt=h.__private__.setLineWidth=h.setLineWidth=function(g){return bs=g,j(ne(C(g))+" w"),this};h.__private__.setLineDash=at.API.setLineDash=at.API.setLineDashPattern=function(g,E){if(g=g||[],E=E||0,isNaN(E)||!Array.isArray(g))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return g=g.map(function(F){return ne(C(F))}).join(" "),E=ne(C(E)),j("["+g+"] "+E+" d"),this};var Fs=h.__private__.getLineHeight=h.getLineHeight=function(){return Le*Rn};h.__private__.getLineHeight=h.getLineHeight=function(){return Le*Rn};var ys=h.__private__.setLineHeightFactor=h.setLineHeightFactor=function(g){return typeof(g=g||1.15)=="number"&&(Rn=g),this},Qa=h.__private__.getLineHeightFactor=h.getLineHeightFactor=function(){return Rn};ys(n.lineHeight);var ri=h.__private__.getHorizontalCoordinate=function(g){return C(g)},zr=h.__private__.getVerticalCoordinate=function(g){return P===O?g:et[q].mediaBox.topRightY-et[q].mediaBox.bottomLeftY-C(g)},va=h.__private__.getHorizontalCoordinateString=h.getHorizontalCoordinateString=function(g){return ne(ri(g))},ii=h.__private__.getVerticalCoordinateString=h.getVerticalCoordinateString=function(g){return ne(zr(g))},Ui=n.strokeColor||"0 G";h.__private__.getStrokeColor=h.getDrawColor=function(){return kn(Ui)},h.__private__.setStrokeColor=h.setDrawColor=function(g,E,F,Z){return Ui=hr({ch1:g,ch2:E,ch3:F,ch4:Z,pdfColorType:"draw",precision:2}),j(Ui),this};var zi=n.fillColor||"0 g";h.__private__.getFillColor=h.getFillColor=function(){return kn(zi)},h.__private__.setFillColor=h.setFillColor=function(g,E,F,Z){return zi=hr({ch1:g,ch2:E,ch3:F,ch4:Z,pdfColorType:"fill",precision:2}),j(zi),this};var Hi=n.textColor||"0 g",eo=h.__private__.getTextColor=h.getTextColor=function(){return kn(Hi)};h.__private__.setTextColor=h.setTextColor=function(g,E,F,Z){return Hi=hr({ch1:g,ch2:E,ch3:F,ch4:Z,pdfColorType:"text",precision:3}),this};var y=n.charSpace,D=h.__private__.getCharSpace=h.getCharSpace=function(){return parseFloat(y||0)};h.__private__.setCharSpace=h.setCharSpace=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return y=g,this};var J=0;h.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},h.__private__.setLineCap=h.setLineCap=function(g){var E=h.CapJoinStyles[g];if(E===void 0)throw new Error("Line cap style of '"+g+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return J=E,j(E+" J"),this};var we=0;h.__private__.setLineJoin=h.setLineJoin=function(g){var E=h.CapJoinStyles[g];if(E===void 0)throw new Error("Line join style of '"+g+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return we=E,j(E+" j"),this},h.__private__.setLineMiterLimit=h.__private__.setMiterLimit=h.setLineMiterLimit=h.setMiterLimit=function(g){if(g=g||0,isNaN(g))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return j(ne(C(g))+" M"),this},h.GState=Od,h.setGState=function(g){(g=typeof g=="string"?Xe[pt[g]]:Et(null,g)).equals(Vt)||(j("/"+g.id+" gs"),Vt=g)};var Et=function(g,E){if(!g||!pt[g]){var F=!1;for(var Z in Xe)if(Xe.hasOwnProperty(Z)&&Xe[Z].equals(E)){F=!0;break}if(F)E=Xe[Z];else{var ce="GS"+(Object.keys(Xe).length+1).toString(10);Xe[ce]=E,E.id=ce}return g&&(pt[g]=E.id),qt.publish("addGState",E),E}};h.addGState=function(g,E){return Et(g,E),this},h.saveGraphicsState=function(){return j("q"),Wt.push({key:Ue,size:Le,color:Hi}),this},h.restoreGraphicsState=function(){j("Q");var g=Wt.pop();return Ue=g.key,Le=g.size,Hi=g.color,Vt=null,this},h.setCurrentTransformationMatrix=function(g){return j(g.toString()+" cm"),this},h.comment=function(g){return j("#"+g),this};var We=function(g,E){var F=g||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return F},set:function(Se){isNaN(Se)||(F=parseFloat(Se))}});var Z=E||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Z},set:function(Se){isNaN(Se)||(Z=parseFloat(Se))}});var ce="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return ce},set:function(Se){ce=Se.toString()}}),this},Ut=function(g,E,F,Z){We.call(this,g,E),this.type="rect";var ce=F||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return ce},set:function(Ce){isNaN(Ce)||(ce=parseFloat(Ce))}});var Se=Z||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Se},set:function(Ce){isNaN(Ce)||(Se=parseFloat(Ce))}}),this},jt=function(){this.page=St,this.currentPage=q,this.pages=xe.slice(0),this.pagesContext=et.slice(0),this.x=He,this.y=sn,this.matrix=Ot,this.width=Bn(q),this.height=Ln(q),this.outputDestination=Te,this.id="",this.objectNumber=-1};jt.prototype.restore=function(){St=this.page,q=this.currentPage,et=this.pagesContext,xe=this.pages,He=this.x,sn=this.y,Ot=this.matrix,nr(q,this.width),yn(q,this.height),Te=this.outputDestination};var bn=function(g,E,F,Z,ce){Fn.push(new jt),St=q=0,xe=[],He=g,sn=E,Ot=ce,mr([F,Z])};for(var zt in h.beginFormObject=function(g,E,F,Z,ce){return bn(g,E,F,Z,ce),this},h.endFormObject=function(g){return(function(E){if(Dn[E])Fn.pop().restore();else{var F=new jt,Z="Xo"+(Object.keys(Rt).length+1).toString(10);F.id=Z,Dn[E]=Z,Rt[Z]=F,qt.publish("addFormObject",F),Fn.pop().restore()}})(g),this},h.doFormObject=function(g,E){var F=Rt[Dn[g]];return j("q"),j(E.toString()+" cm"),j("/"+F.id+" Do"),j("Q"),this},h.getFormObject=function(g){var E=Rt[Dn[g]];return{x:E.x,y:E.y,width:E.width,height:E.height,matrix:E.matrix}},h.save=function(g,E){return g=g||"generated.pdf",(E=E||{}).returnPromise=E.returnPromise||!1,E.returnPromise===!1?(mo(Fi(fr()),g),typeof mo.unload=="function"&&kt.setTimeout&&setTimeout(mo.unload,911),this):new Promise(function(F,Z){try{var ce=mo(Fi(fr()),g);typeof mo.unload=="function"&&kt.setTimeout&&setTimeout(mo.unload,911),F(ce)}catch(Se){Z(Se.message)}})},at.API)at.API.hasOwnProperty(zt)&&(zt==="events"&&at.API.events.length?(function(g,E){var F,Z,ce;for(ce=E.length-1;ce!==-1;ce--)F=E[ce][0],Z=E[ce][1],g.subscribe.apply(g,[F].concat(typeof Z=="function"?[Z]:Z))})(qt,at.API.events):h[zt]=at.API[zt]);function Bn(g){return et[g].mediaBox.topRightX-et[g].mediaBox.bottomLeftX}function nr(g,E){et[g].mediaBox.topRightX=E+et[g].mediaBox.bottomLeftX}function Ln(g){return et[g].mediaBox.topRightY-et[g].mediaBox.bottomLeftY}function yn(g,E){et[g].mediaBox.topRightY=E+et[g].mediaBox.bottomLeftY}var hn=h.getPageWidth=function(g){return Bn(g=g||q)/ut},di=h.setPageWidth=function(g,E){nr(g,E*ut)},vr=h.getPageHeight=function(g){return Ln(g=g||q)/ut},ki=h.setPageHeight=function(g,E){yn(g,E*ut)};return h.internal={pdfEscape:on,getStyle:Ni,getFont:ma,getFontSize:$e,getCharSpace:D,getTextColor:eo,getLineHeight:Fs,getLineHeightFactor:Qa,getLineWidth:ga,write:Be,getHorizontalCoordinate:ri,getVerticalCoordinate:zr,getCoordinateString:va,getVerticalCoordinateString:ii,collections:{},newObject:Mt,newAdditionalObject:Zr,newObjectDeferred:Qt,newObjectDeferredBegin:Ft,getFilters:tn,putStream:tr,events:qt,scaleFactor:ut,pageSize:{getWidth:function(){return hn(q)},setWidth:function(g){di(q,g)},getHeight:function(){return vr(q)},setHeight:function(g){ki(q,g)}},encryptionOptions:d,encryption:On,getEncryptor:function(g){return d!==null?On.encryptor(g,0):function(E){return E}},output:js,getNumberOfPages:Mi,get pages(){return xe},out:j,f2:_,f3:L,getPageInfo:ui,getPageInfoByObjId:fa,getCurrentPageInfo:$s,getPDFVersion:w,Point:We,Rectangle:Ut,Matrix:dt,hasHotfix:Tr},Object.defineProperty(h.internal.pageSize,"width",{get:function(){return hn(q)},set:function(g){di(q,g)},enumerable:!0,configurable:!0}),Object.defineProperty(h.internal.pageSize,"height",{get:function(){return vr(q)},set:function(g){ki(q,g)},enumerable:!0,configurable:!0}),(function(g){for(var E=0,F=Qe.length;E<F;E++){var Z=In.call(this,g[E][0],g[E][1],g[E][2],Qe[E][3],!0);m===!1&&(p[Z]=!0);var ce=g[E][0].split("-");an({id:Z,fontName:ce[0],fontStyle:ce[1]||""})}qt.publish("addFonts",{fonts:wt,dictionary:ft})}).call(h,Qe),Ue="F1",Fr(i,t),qt.publish("initialized"),h}dl.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},dl.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},dl.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},dl.prototype.processOwnerPassword=function(n,e){return mp(pp(e).substr(0,5),n)},dl.prototype.encryptor=function(n,e){var t=pp(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return mp(t,r)}},Od.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||un(n)!==un(this))return!1;var r=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;r++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&r--;return r===0},at.API={events:[]},at.version="4.2.0";var $n=at.API,hm=1,Uo=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},el=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Co=function(n){return n.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return"#"+(t.length===1?"0"+t:t)})},Ct=function(n){return n.toFixed(2)},Pa=function(n){return n.toFixed(5)};$n.__acroform__={};var li=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},F0=function(n){return n*hm},Es=function(n){var e=new z2,t=Ye.internal.getHeight(n)||0,r=Ye.internal.getWidth(n)||0;return e.BBox=[0,0,Number(Ct(r)),Number(Ct(t))],e},n8=$n.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},r8=$n.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},i8=$n.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},Vn=$n.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return i8(n,e-1)},Gn=$n.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return n8(n,e-1)},Kn=$n.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return r8(n,e-1)},s8=$n.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,i=n[0],s=n[1],a=n[2],o=n[3],l={};return l.lowerLeft_X=t(i)||0,l.lowerLeft_Y=r(s+o)||0,l.upperRight_X=t(i+a)||0,l.upperRight_Y=r(s)||0,[Number(Ct(l.lowerLeft_X)),Number(Ct(l.lowerLeft_Y)),Number(Ct(l.upperRight_X)),Number(Ct(l.upperRight_Y))]},a8=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,r=gp(n,t),i=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+i+" "+Ct(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var s=Es(n);return s.scope=n.scope,s.stream=e.join(`
`),s}},gp=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,r={text:"",fontSize:""},i=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");i=n.multiline?i.map(function(_){return _.split(`
`)}):i.map(function(_){return[_]});var s=t,a=Ye.internal.getHeight(n)||0;a=a<0?-a:a;var o=Ye.internal.getWidth(n)||0;o=o<0?-o:o;var l=function(_,L,C){if(_+1<i.length){var M=L+" "+i[_+1][0];return rd(M,n,C).width<=o-4}return!1};s++;e:for(;s>0;){e="",s--;var c,d,m=rd("3",n,s).height,p=n.multiline?a-s:(a-m)/2,h=p+=2,b=0,w=0,S=0;if(s<=0){e=`(...) Tj
`,e+="% Width of Text: "+rd(e,n,s=12).width+", FieldWidth:"+o+`
`;break}for(var A="",I=0,O=0;O<i.length;O++)if(i.hasOwnProperty(O)){var P=!1;if(i[O].length!==1&&S!==i[O].length-1){if((m+2)*(I+2)+2>a)continue e;A+=i[O][S],P=!0,w=O,O--}else{A=(A+=i[O][S]+" ").substr(A.length-1)==" "?A.substr(0,A.length-1):A;var K=parseInt(O),le=l(K,A,s),he=O>=i.length-1;if(le&&!he){A+=" ",S=0;continue}if(le||he){if(he)w=K;else if(n.multiline&&(m+2)*(I+2)+2>a)continue e}else{if(!n.multiline||(m+2)*(I+2)+2>a)continue e;w=K}}for(var ne="",V=b;V<=w;V++){var ue=i[V];if(n.multiline){if(V===w){ne+=ue[S]+" ",S=(S+1)%ue.length;continue}if(V===b){ne+=ue[ue.length-1]+" ";continue}}ne+=ue[0]+" "}switch(ne=ne.substr(ne.length-1)==" "?ne.substr(0,ne.length-1):ne,d=rd(ne,n,s).width,n.textAlign){case"right":c=o-d-2;break;case"center":c=(o-d)/2;break;default:c=2}e+=Ct(c)+" "+Ct(h)+` Td
`,e+="("+Uo(ne)+`) Tj
`,e+=-Ct(c)+` 0 Td
`,h=-(s+2),d=0,b=P?w:w+1,I++,A=""}break}return r.text=e,r.fontSize=s,r},rd=function(n,e,t){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(n,{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:i}},o8={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},l8=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(r){return r.type===t.type&&r.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},c8=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(ps.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(o8)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");hm=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new H2,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];s.objId=void 0,s.hasAnnotation&&l8(s,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(r,i){var s=!r;for(var a in r||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(a)){var o=r[a],l=[],c=o.Rect;if(o.Rect&&(o.Rect=s8(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Ye.createDefaultAppearanceStream(o),un(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(l=o.getKeyValueListForStream()),o.Rect=c,o.hasAppearanceStream&&!o.appearanceStreamContent){var d=a8(o);l.push({key:"AP",value:"<</N "+d+">>"}),i.internal.acroformPlugin.xForms.push(d)}if(o.appearanceStreamContent){var m="";for(var p in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(p)){var h=o.appearanceStreamContent[p];if(m+="/"+p+" ",m+="<<",Object.keys(h).length>=1||Array.isArray(h)){for(var a in h)if(h.hasOwnProperty(a)){var b=h[a];typeof b=="function"&&(b=b.call(i,o)),m+="/"+a+" "+b+" ",i.internal.acroformPlugin.xForms.indexOf(b)>=0||i.internal.acroformPlugin.xForms.push(b)}}else typeof(b=h)=="function"&&(b=b.call(i,o)),m+="/"+a+" "+b,i.internal.acroformPlugin.xForms.indexOf(b)>=0||i.internal.acroformPlugin.xForms.push(b);m+=">>"}l.push({key:"AP",value:`<<
`+m+">>"})}i.internal.putStream({additionalKeyValues:l,objectId:o.objId}),i.internal.out("endobj")}s&&(function(w,S){for(var A in w)if(w.hasOwnProperty(A)){var I=A,O=w[A];S.internal.newObjectDeferredBegin(O.objId,!0),un(O)==="object"&&typeof O.putStream=="function"&&O.putStream(),delete w[I]}})(i.internal.acroformPlugin.xForms,i)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},U2=$n.__acroform__.arrayToPdfArray=function(n,e,t){var r=function(a){return a};if(Array.isArray(n)){for(var i="[",s=0;s<n.length;s++)switch(s!==0&&(i+=" "),un(n[s])){case"boolean":case"number":case"object":i+=n[s].toString();break;case"string":n[s].substr(0,1)==="/"?i+="/"+Co(n[s].substr(1)):(e!==void 0&&t&&(r=t.internal.getEncryptor(e)),i+="("+Uo(r(n[s].toString()))+")")}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},ff=function(n,e,t){var r=function(i){return i};return e!==void 0&&t&&(r=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+Uo(r(n))+")"},Ts=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Ts.prototype.toString=function(){return this.objId+" 0 R"},Ts.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},Ts.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var r=e[t],i=this[r];i&&(Array.isArray(i)?n.push({key:r,value:U2(i,this.objId,this.scope)}):i instanceof Ts?(i.scope=this.scope,n.push({key:r,value:i.objId+" 0 R"})):typeof i!="function"&&n.push({key:r,value:i}))}return n};var z2=function(){Ts.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};li(z2,Ts);var H2=function(){Ts.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(r){return r};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Uo(t(n))+")"}},set:function(t){n=t}})};li(H2,Ts);var ps=function n(){Ts.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(A){if(isNaN(A))throw new Error('Invalid value "'+A+'" for attribute F supplied.');e=A}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Vn(e,3)},set:function(A){A?this.F=Gn(e,3):this.F=Kn(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(A){if(isNaN(A))throw new Error('Invalid value "'+A+'" for attribute Ff supplied.');t=A}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(A){r=A!==void 0?A:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(A){r[0]=A}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(A){r[1]=A}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(A){r[2]=A}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(A){r[3]=A}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(A){switch(A){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=A;break;default:throw new Error('Invalid value "'+A+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof Rd)return;s="FieldObject"+n.FieldNum++}var A=function(I){return I};return this.scope&&(A=this.scope.internal.getEncryptor(this.objId)),"("+Uo(A(s))+")"},set:function(A){s=A.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(A){s=A}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(A){a=A}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(A){o=A}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(A){l=A}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return c===void 0?50/hm:c},set:function(A){c=A}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(A){d=A}});var m="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!m||this instanceof Rd||this instanceof Ao))return ff(m,this.objId,this.scope)},set:function(A){A=A.toString(),m=A}});var p=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof pr==0?ff(p,this.objId,this.scope):p},set:function(A){A=A.toString(),p=this instanceof pr==0?A.substr(0,1)==="("?el(A.substr(1,A.length-2)):el(A):A}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof pr==1?el(p.substr(1,p.length-1)):p},set:function(A){A=A.toString(),p=this instanceof pr==1?"/"+Co(A):A}});var h=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(h)return h},set:function(A){this.V=A}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof pr==0?ff(h,this.objId,this.scope):h},set:function(A){A=A.toString(),h=this instanceof pr==0?A.substr(0,1)==="("?el(A.substr(1,A.length-2)):el(A):A}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof pr==1?el(h.substr(1,h.length-1)):h},set:function(A){A=A.toString(),h=this instanceof pr==1?"/"+Co(A):A}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var b,w=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return w},set:function(A){A=!!A,w=A}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(b)return b},set:function(A){b=A}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,1)},set:function(A){A?this.Ff=Gn(this.Ff,1):this.Ff=Kn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,2)},set:function(A){A?this.Ff=Gn(this.Ff,2):this.Ff=Kn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,3)},set:function(A){A?this.Ff=Gn(this.Ff,3):this.Ff=Kn(this.Ff,3)}});var S=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(S!==null)return S},set:function(A){if([0,1,2].indexOf(A)===-1)throw new Error('Invalid value "'+A+'" for attribute Q supplied.');S=A}}),Object.defineProperty(this,"textAlign",{get:function(){var A;switch(S){case 0:default:A="left";break;case 1:A="center";break;case 2:A="right"}return A},configurable:!0,enumerable:!0,set:function(A){switch(A){case"right":case 2:S=2;break;case"center":case 1:S=1;break;default:S=0}}})};li(ps,Ts);var wl=function(){ps.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return U2(e,this.objId,this.scope)},set:function(t){var r,i;i=[],typeof(r=t)=="string"&&(i=(function(s,a,o){o||(o=1);for(var l,c=[];l=a.exec(s);)c.push(l[o]);return c})(r,/\((.*?)\)/g)),e=i}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,r){for(r=r||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,18)},set:function(t){t?this.Ff=Gn(this.Ff,18):this.Ff=Kn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Gn(this.Ff,19):this.Ff=Kn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,20)},set:function(t){t?(this.Ff=Gn(this.Ff,20),e.sort()):this.Ff=Kn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,22)},set:function(t){t?this.Ff=Gn(this.Ff,22):this.Ff=Kn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,23)},set:function(t){t?this.Ff=Gn(this.Ff,23):this.Ff=Kn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,27)},set:function(t){t?this.Ff=Gn(this.Ff,27):this.Ff=Kn(this.Ff,27)}}),this.hasAppearanceStream=!1};li(wl,ps);var _l=function(){wl.call(this),this.fontName="helvetica",this.combo=!1};li(_l,wl);var xl=function(){_l.call(this),this.combo=!0};li(xl,_l);var fd=function(){xl.call(this),this.edit=!0};li(fd,xl);var pr=function(){ps.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,15)},set:function(t){t?this.Ff=Gn(this.Ff,15):this.Ff=Kn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,16)},set:function(t){t?this.Ff=Gn(this.Ff,16):this.Ff=Kn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,17)},set:function(t){t?this.Ff=Gn(this.Ff,17):this.Ff=Kn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,26)},set:function(t){t?this.Ff=Gn(this.Ff,26):this.Ff=Kn(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(s){return s};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,i=[];for(r in i.push("<<"),e)i.push("/"+r+" ("+Uo(t(e[r]))+")");return i.push(">>"),i.join(`
`)}},set:function(t){un(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){var r=t==null?"":t.toString();r.substr(0,1)==="/"&&(r=r.substr(1)),n="/"+Co(r)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+Co(t)}})};li(pr,ps);var pd=function(){pr.call(this),this.pushButton=!0};li(pd,pr);var Al=function(){pr.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};li(Al,pr);var Rd=function(){var n,e;ps.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(i){n=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(i){e=i}});var t,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),r)a.push("/"+s+" ("+Uo(i(r[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){un(i)==="object"&&(r=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(i){typeof i=="string"&&(r.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(i){var s=i==null?"":i.toString();s.substr(0,1)==="/"&&(s=s.substr(1)),t="/"+Co(s)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(i){var s=i==null?"":i.toString();s.substr(0,1)==="/"&&(s=s.substr(1)),t="/"+Co(s)}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ye.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};li(Rd,ps),Al.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},Al.prototype.createOption=function(n){var e=new Rd;return e.Parent=this,e.optionName=n,this.Kids.push(e),u8.call(this.scope,e),e};var md=function(){pr.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ye.CheckBox.createAppearanceStream()};li(md,pr);var Ao=function(){ps.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,13)},set:function(e){e?this.Ff=Gn(this.Ff,13):this.Ff=Kn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,21)},set:function(e){e?this.Ff=Gn(this.Ff,21):this.Ff=Kn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,23)},set:function(e){e?this.Ff=Gn(this.Ff,23):this.Ff=Kn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,24)},set:function(e){e?this.Ff=Gn(this.Ff,24):this.Ff=Kn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,25)},set:function(e){e?this.Ff=Gn(this.Ff,25):this.Ff=Kn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,26)},set:function(e){e?this.Ff=Gn(this.Ff,26):this.Ff=Kn(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};li(Ao,ps);var gd=function(){Ao.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Vn(this.Ff,14)},set:function(n){n?this.Ff=Gn(this.Ff,14):this.Ff=Kn(this.Ff,14)}}),this.password=!0};li(gd,Ao);var Ye={CheckBox:{createAppearanceStream:function(){return{N:{On:Ye.CheckBox.YesNormal},D:{On:Ye.CheckBox.YesPushDown,Off:Ye.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=Es(n);e.scope=n.scope;var t=[],r=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),s=gp(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+Ct(Ye.internal.getWidth(n))+" "+Ct(Ye.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+r+" "+Ct(s.fontSize)+" Tf "+i),t.push("BT"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=Es(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,r=n.scope.__private__.encodeColorString(n.color),i=[],s=Ye.internal.getHeight(n),a=Ye.internal.getWidth(n),o=gp(n,n.caption);return i.push("1 g"),i.push("0 0 "+Ct(a)+" "+Ct(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Ct(a-1)+" "+Ct(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+t+" "+Ct(o.fontSize)+" Tf "+r),i.push(o.text),i.push("ET"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(n){var e=Es(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Ct(Ye.internal.getWidth(n))+" "+Ct(Ye.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:Ye.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=Ye.RadioButton.Circle.YesNormal,e.D[n]=Ye.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=Es(n);e.scope=n.scope;var t=[],r=Ye.internal.getWidth(n)<=Ye.internal.getHeight(n)?Ye.internal.getWidth(n)/4:Ye.internal.getHeight(n)/4;r=Number((.9*r).toFixed(5));var i=Ye.internal.Bezier_C,s=Number((r*i).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Pa(Ye.internal.getWidth(n)/2)+" "+Pa(Ye.internal.getHeight(n)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),t.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),t.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),t.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Es(n);e.scope=n.scope;var t=[],r=Ye.internal.getWidth(n)<=Ye.internal.getHeight(n)?Ye.internal.getWidth(n)/4:Ye.internal.getHeight(n)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),s=Number((i*Ye.internal.Bezier_C).toFixed(5)),a=Number((r*Ye.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Pa(Ye.internal.getWidth(n)/2)+" "+Pa(Ye.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Pa(Ye.internal.getWidth(n)/2)+" "+Pa(Ye.internal.getHeight(n)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),t.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),t.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),t.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=Es(n);e.scope=n.scope;var t=[],r=Ye.internal.getWidth(n)<=Ye.internal.getHeight(n)?Ye.internal.getWidth(n)/4:Ye.internal.getHeight(n)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),s=Number((i*Ye.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Pa(Ye.internal.getWidth(n)/2)+" "+Pa(Ye.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:Ye.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=Ye.RadioButton.Cross.YesNormal,e.D[n]=Ye.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=Es(n);e.scope=n.scope;var t=[],r=Ye.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+Ct(Ye.internal.getWidth(n)-2)+" "+Ct(Ye.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(Ct(r.x1.x)+" "+Ct(r.x1.y)+" m"),t.push(Ct(r.x2.x)+" "+Ct(r.x2.y)+" l"),t.push(Ct(r.x4.x)+" "+Ct(r.x4.y)+" m"),t.push(Ct(r.x3.x)+" "+Ct(r.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Es(n);e.scope=n.scope;var t=Ye.internal.calculateCross(n),r=[];return r.push("0.749023 g"),r.push("0 0 "+Ct(Ye.internal.getWidth(n))+" "+Ct(Ye.internal.getHeight(n))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Ct(Ye.internal.getWidth(n)-2)+" "+Ct(Ye.internal.getHeight(n)-2)+" re"),r.push("W"),r.push("n"),r.push(Ct(t.x1.x)+" "+Ct(t.x1.y)+" m"),r.push(Ct(t.x2.x)+" "+Ct(t.x2.y)+" l"),r.push(Ct(t.x4.x)+" "+Ct(t.x4.y)+" m"),r.push(Ct(t.x3.x)+" "+Ct(t.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(n){var e=Es(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Ct(Ye.internal.getWidth(n))+" "+Ct(Ye.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};Ye.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=Ye.internal.getWidth(n),t=Ye.internal.getHeight(n),r=Math.min(e,t);return{x1:{x:(e-r)/2,y:(t-r)/2+r},x2:{x:(e-r)/2+r,y:(t-r)/2},x3:{x:(e-r)/2,y:(t-r)/2},x4:{x:(e-r)/2+r,y:(t-r)/2+r}}}},Ye.internal.getWidth=function(n){var e=0;return un(n)==="object"&&(e=F0(n.Rect[2])),e},Ye.internal.getHeight=function(n){var e=0;return un(n)==="object"&&(e=F0(n.Rect[3])),e};var u8=$n.addField=function(n){if(c8(this,n),!(n instanceof ps))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};$n.AcroFormChoiceField=wl,$n.AcroFormListBox=_l,$n.AcroFormComboBox=xl,$n.AcroFormEditBox=fd,$n.AcroFormButton=pr,$n.AcroFormPushButton=pd,$n.AcroFormRadioButton=Al,$n.AcroFormCheckBox=md,$n.AcroFormTextField=Ao,$n.AcroFormPasswordField=gd,$n.AcroFormAppearance=Ye,$n.AcroForm={ChoiceField:wl,ListBox:_l,ComboBox:xl,EditBox:fd,Button:pr,PushButton:pd,RadioButton:Al,CheckBox:md,TextField:Ao,PasswordField:gd,Appearance:Ye},at.AcroForm={ChoiceField:wl,ListBox:_l,ComboBox:xl,EditBox:fd,Button:pr,PushButton:pd,RadioButton:Al,CheckBox:md,TextField:Ao,PasswordField:gd,Appearance:Ye};at.AcroForm;function W2(n){return n.reduce(function(e,t,r){return e[t]=r,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=n.__addimage__.getImageFileTypeByImageData=function(_,L){var C,M,Y,G,te,X=t;if((L=L||t)==="RGBA"||_.data!==void 0&&_.data instanceof Uint8ClampedArray&&"height"in _&&"width"in _)return"RGBA";if(le(_))for(te in r)for(Y=r[te],C=0;C<Y.length;C+=1){for(G=!0,M=0;M<Y[C].length;M+=1)if(Y[C][M]!==void 0&&Y[C][M]!==_[M]){G=!1;break}if(G===!0){X=te;break}}else for(te in r)for(Y=r[te],C=0;C<Y.length;C+=1){for(G=!0,M=0;M<Y[C].length;M+=1)if(Y[C][M]!==void 0&&Y[C][M]!==_.charCodeAt(M)){G=!1;break}if(G===!0){X=te;break}}return X===t&&L!==t&&(X=L),X},s=function _(L){for(var C=this.internal.write,M=this.internal.putStream,Y=(0,this.internal.getFilters)();Y.indexOf("FlateEncode")!==-1;)Y.splice(Y.indexOf("FlateEncode"),1);L.objectId=this.internal.newObject();var G=[];if(G.push({key:"Type",value:"/XObject"}),G.push({key:"Subtype",value:"/Image"}),G.push({key:"Width",value:L.width}),G.push({key:"Height",value:L.height}),L.colorSpace===A.INDEXED?G.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(L.palette.length/3-1)+" "+("sMask"in L&&L.sMask!==void 0?L.objectId+2:L.objectId+1)+" 0 R]"}):(G.push({key:"ColorSpace",value:"/"+L.colorSpace}),L.colorSpace===A.DEVICE_CMYK&&G.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),G.push({key:"BitsPerComponent",value:L.bitsPerComponent}),"decodeParameters"in L&&L.decodeParameters!==void 0&&G.push({key:"DecodeParms",value:"<<"+L.decodeParameters+">>"}),"transparency"in L&&Array.isArray(L.transparency)&&L.transparency.length>0){for(var te="",X=0,ae=L.transparency.length;X<ae;X++)te+=L.transparency[X]+" "+L.transparency[X]+" ";G.push({key:"Mask",value:"["+te+"]"})}L.sMask!==void 0&&G.push({key:"SMask",value:L.objectId+1+" 0 R"});var me=L.filter!==void 0?["/"+L.filter]:void 0;if(M({data:L.data,additionalKeyValues:G,alreadyAppliedFilters:me,objectId:L.objectId}),C("endobj"),"sMask"in L&&L.sMask!==void 0){var fe,k=(fe=L.sMaskBitsPerComponent)!==null&&fe!==void 0?fe:L.bitsPerComponent,q={width:L.width,height:L.height,colorSpace:"DeviceGray",bitsPerComponent:k,data:L.sMask};"filter"in L&&(q.decodeParameters="/Predictor ".concat(L.predictor," /Colors 1 /BitsPerComponent ").concat(k," /Columns ").concat(L.width),q.filter=L.filter),_.call(this,q)}if(L.colorSpace===A.INDEXED){var W=this.internal.newObject();M({data:ne(new Uint8Array(L.palette)),objectId:W}),C("endobj")}},a=function(){var _=this.internal.collections[e+"images"];for(var L in _)s.call(this,_[L])},o=function(){var _,L=this.internal.collections[e+"images"],C=this.internal.write;for(var M in L)C("/I"+(_=L[M]).index,_.objectId,"0","R")},l=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var _=this.internal.collections[e+"images"];return l.call(this),_},d=function(){return Object.keys(this.internal.collections[e+"images"]).length},m=function(_){return typeof n["process"+_.toUpperCase()]=="function"},p=function(_){return un(_)==="object"&&_.nodeType===1},h=function(_,L){if(_.nodeName==="IMG"&&_.hasAttribute("src")){var C=""+_.getAttribute("src");if(C.indexOf("data:image/")===0)return hd(unescape(C).split("base64,").pop());var M=n.loadFile(C,!0);if(M!==void 0)return M}if(_.nodeName==="CANVAS"){if(_.width===0||_.height===0)throw new Error("Given canvas must have data. Canvas width: "+_.width+", height: "+_.height);var Y;switch(L){case"PNG":Y="image/png";break;case"WEBP":Y="image/webp";break;default:Y="image/jpeg"}return hd(_.toDataURL(Y,1).split("base64,").pop())}},b=function(_){var L=this.internal.collections[e+"images"];if(L){for(var C in L)if(_===L[C].alias)return L[C]}},w=function(_,L,C){return _||L||(_=-96,L=-96),_<0&&(_=-1*C.width*72/_/this.internal.scaleFactor),L<0&&(L=-1*C.height*72/L/this.internal.scaleFactor),_===0&&(_=L*C.width/C.height),L===0&&(L=_*C.height/C.width),[_,L]},S=function(_,L,C,M,Y,G){var te=w.call(this,C,M,Y),X=this.internal.getCoordinateString,ae=this.internal.getVerticalCoordinateString,me=c.call(this);if(C=te[0],M=te[1],me[Y.index]=Y,G){G*=Math.PI/180;var fe=Math.cos(G),k=Math.sin(G),q=function(U){return U.toFixed(4)},W=[q(fe),q(k),q(-1*k),q(fe),0,0,"cm"]}this.internal.write("q"),G?(this.internal.write([1,"0","0",1,X(_),ae(L+M),"cm"].join(" ")),this.internal.write(W.join(" ")),this.internal.write([X(C),"0","0",X(M),"0","0","cm"].join(" "))):this.internal.write([X(C),"0","0",X(M),X(_),ae(L+M),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Y.index+" Do"),this.internal.write("Q")},A=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var I=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},O=n.__addimage__.sHashCode=function(_){var L,C,M=0;if(typeof _=="string")for(C=_.length,L=0;L<C;L++)M=(M<<5)-M+_.charCodeAt(L),M|=0;else if(le(_))for(C=_.byteLength/2,L=0;L<C;L++)M=(M<<5)-M+_[L],M|=0;return M},P=n.__addimage__.validateStringAsBase64=function(_){(_=_||"").toString().trim();var L=!0;return _.length===0&&(L=!1),_.length%4!=0&&(L=!1),/^[A-Za-z0-9+/]+$/.test(_.substr(0,_.length-2))===!1&&(L=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(_.substr(-2))===!1&&(L=!1),L},K=n.__addimage__.extractImageFromDataUrl=function(_){if(_==null||!(_=_.trim()).startsWith("data:"))return null;var L=_.indexOf(",");return L<0?null:_.substring(0,L).trim().endsWith("base64")?_.substring(L+1):null};n.__addimage__.isArrayBuffer=function(_){return _ instanceof ArrayBuffer};var le=n.__addimage__.isArrayBufferView=function(_){return _ instanceof Int8Array||_ instanceof Uint8Array||_ instanceof Uint8ClampedArray||_ instanceof Int16Array||_ instanceof Uint16Array||_ instanceof Int32Array||_ instanceof Uint32Array||_ instanceof Float32Array||_ instanceof Float64Array},he=n.__addimage__.binaryStringToUint8Array=function(_){for(var L=_.length,C=new Uint8Array(L),M=0;M<L;M++)C[M]=_.charCodeAt(M);return C},ne=n.__addimage__.arrayBufferToBinaryString=function(_){for(var L="",C=le(_)?_:new Uint8Array(_),M=0;M<C.length;M+=8192)L+=String.fromCharCode.apply(null,C.subarray(M,M+8192));return L};n.addImage=function(){var _,L,C,M,Y,G,te,X,ae;if(typeof arguments[1]=="number"?(L=t,C=arguments[1],M=arguments[2],Y=arguments[3],G=arguments[4],te=arguments[5],X=arguments[6],ae=arguments[7]):(L=arguments[1],C=arguments[2],M=arguments[3],Y=arguments[4],G=arguments[5],te=arguments[6],X=arguments[7],ae=arguments[8]),un(_=arguments[0])==="object"&&!p(_)&&"imageData"in _){var me=_;_=me.imageData,L=me.format||L||t,C=me.x||C||0,M=me.y||M||0,Y=me.w||me.width||Y,G=me.h||me.height||G,te=me.alias||te,X=me.compression||X,ae=me.rotation||me.angle||ae}var fe=this.internal.getFilters();if(X===void 0&&fe.indexOf("FlateEncode")!==-1&&(X="SLOW"),isNaN(C)||isNaN(M))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var k=V.call(this,_,L,te,X);return S.call(this,C,M,Y,G,k,ae),this};var V=function(_,L,C,M){var Y,G,te;if(typeof _=="string"&&i(_)===t){_=unescape(_);var X=ue(_,!1);(X!==""||(X=n.loadFile(_,!0))!==void 0)&&(_=X)}if(p(_)&&(_=h(_,L)),L=i(_,L),!m(L))throw new Error("addImage does not support files of type '"+L+"', please ensure that a plugin for '"+L+"' support is added.");if(((te=C)==null||te.length===0)&&(C=(function(ae){return typeof ae=="string"||le(ae)?O(ae):le(ae.data)?O(ae.data):null})(_)),(Y=b.call(this,C))||(_ instanceof Uint8Array||L==="RGBA"||(G=_,_=he(_)),Y=this["process"+L.toUpperCase()](_,d.call(this),C,(function(ae){return ae&&typeof ae=="string"&&(ae=ae.toUpperCase()),ae in n.image_compression?ae:I.NONE})(M),G)),!Y)throw new Error("An unknown error occurred whilst processing the image.");return Y},ue=n.__addimage__.convertBase64ToBinaryString=function(_,L){L=typeof L!="boolean"||L;var C,M="";if(typeof _=="string"){var Y;C=(Y=K(_))!==null&&Y!==void 0?Y:_;try{M=hd(C)}catch(G){if(L)throw P(C)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+G.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return M};n.getImageProperties=function(_){var L,C,M="";if(p(_)&&(_=h(_)),typeof _=="string"&&i(_)===t&&((M=ue(_,!1))===""&&(M=n.loadFile(_)||""),_=M),C=i(_),!m(C))throw new Error("addImage does not support files of type '"+C+"', please ensure that a plugin for '"+C+"' support is added.");if(_ instanceof Uint8Array||(_=he(_)),!(L=this["process"+C.toUpperCase()](_)))throw new Error("An unknown error occurred whilst processing the image");return L.fileType=C,L}})(at.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};at.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var r,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,l=this.internal.getPageInfoByObjId(t.objId),c=t.pageContext.annotations,d=!1,m=0;m<c.length&&!d;m++)switch((r=c[m]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(d=!0);break;case"reference":case"text":case"freetext":d=!0}if(d!=0){this.internal.write("/Annots [");for(var p=0;p<c.length;p++){r=c[p];var h=this.internal.pdfEscape,b=this.internal.getEncryptor(t.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var w=this.internal.newAdditionalObject(),S=this.internal.newAdditionalObject(),A=this.internal.getEncryptor(w.objId),I=r.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(r.bounds.x)+" "+o(r.bounds.y+r.bounds.h)+" "+a(r.bounds.x+r.bounds.w)+" "+o(r.bounds.y)+"] ")+"/Contents ("+h(A(r.contents))+")",s+=" /Popup "+S.objId+" 0 R",s+=" /P "+l.objId+" 0 R",s+=" /T ("+h(A(I))+") >>",w.content=s;var O=w.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(r.bounds.x+30)+" "+o(r.bounds.y+r.bounds.h)+" "+a(r.bounds.x+r.bounds.w+30)+" "+o(r.bounds.y)+"] ")+" /Parent "+O,r.open&&(s+=" /Open true"),s+=" >>",S.content=s,this.internal.write(w.objId,"0 R",S.objId,"0 R");break;case"freetext":i="/Rect ["+a(r.bounds.x)+" "+o(r.bounds.y)+" "+a(r.bounds.x+r.bounds.w)+" "+o(r.bounds.y+r.bounds.h)+"] ";var P=r.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+h(b(r.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+P+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(r.options.name){var K=this.annotations._nameMap[r.options.name];r.options.pageNumber=K.page,r.options.top=K.y}else r.options.top||(r.options.top=0);if(i="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",s="",r.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+h(b(r.options.url))+") >>";else if(r.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,s+=" /FitV "+r.options.left+"]";break;default:var le=o(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),s+=" /XYZ "+r.options.left+" "+le+" "+r.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var r=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":r.pageContext.annotations.push(t)}},n.link=function(t,r,i,s,a){var o=this.internal.getCurrentPageInfo(),l=this.internal.getCoordinateString,c=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:l(t),y:c(r),w:l(t+i),h:c(r+s)},options:a,type:"link"})},n.textWithLink=function(t,r,i,s){var a,o,l=this.getTextWidth(t),c=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var d=this.splitTextToSize(t,o).length;a=Math.ceil(c*d)}else o=l,a=c;return this.text(t,r,i,s),i+=.2*c,s.align==="center"&&(r-=l/2),s.align==="right"&&(r-=l),this.link(r,i-c,o,a,s),l},n.getTextWidth=function(t){var r=this.internal.getFontSize();return this.getStringUnitWidth(t)*r/this.internal.scaleFactor}})(at.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];n.__arabicParser__={};var s=n.__arabicParser__.isInArabicSubstitutionA=function(w){return e[w.charCodeAt(0)]!==void 0},a=n.__arabicParser__.isArabicLetter=function(w){return typeof w=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(w)},o=n.__arabicParser__.isArabicEndLetter=function(w){return a(w)&&s(w)&&e[w.charCodeAt(0)].length<=2},l=n.__arabicParser__.isArabicAlfLetter=function(w){return a(w)&&i.indexOf(w.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(w){return a(w)&&s(w)&&e[w.charCodeAt(0)].length>=1};var c=n.__arabicParser__.arabicLetterHasFinalForm=function(w){return a(w)&&s(w)&&e[w.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(w){return a(w)&&s(w)&&e[w.charCodeAt(0)].length>=3};var d=n.__arabicParser__.arabicLetterHasMedialForm=function(w){return a(w)&&s(w)&&e[w.charCodeAt(0)].length==4},m=n.__arabicParser__.resolveLigatures=function(w){var S=0,A=t,I="",O=0;for(S=0;S<w.length;S+=1)A[w.charCodeAt(S)]!==void 0?(O++,typeof(A=A[w.charCodeAt(S)])=="number"&&(I+=String.fromCharCode(A),A=t,O=0),S===w.length-1&&(A=t,I+=w.charAt(S-(O-1)),S-=O-1,O=0)):(A=t,I+=w.charAt(S-O),S-=O,O=0);return I};n.__arabicParser__.isArabicDiacritic=function(w){return w!==void 0&&r[w.charCodeAt(0)]!==void 0};var p=n.__arabicParser__.getCorrectForm=function(w,S,A){return a(w)?s(w)===!1?-1:!c(w)||!a(S)&&!a(A)||!a(A)&&o(S)||o(w)&&!a(S)||o(w)&&l(S)||o(w)&&o(S)?0:d(w)&&a(S)&&!o(S)&&a(A)&&c(A)?3:o(w)||!a(A)?1:2:-1},h=function(w){var S=0,A=0,I=0,O="",P="",K="",le=(w=w||"").split("\\s+"),he=[];for(S=0;S<le.length;S+=1){for(he.push(""),A=0;A<le[S].length;A+=1)O=le[S][A],P=le[S][A-1],K=le[S][A+1],a(O)?(I=p(O,P,K),he[S]+=I!==-1?String.fromCharCode(e[O.charCodeAt(0)][I]):O):he[S]+=O;he[S]=m(he[S])}return he.join(" ")},b=n.__arabicParser__.processArabic=n.processArabic=function(){var w,S=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,A=[];if(Array.isArray(S)){var I=0;for(A=[],I=0;I<S.length;I+=1)Array.isArray(S[I])?A.push([h(S[I][0]),S[I][1],S[I][2]]):A.push([h(S[I])]);w=A}else w=h(S);return typeof arguments[0]=="string"?w:(arguments[0].text=w,arguments[0])};n.events.push(["preProcessText",b])})(at.API),at.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(o){t=o}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(o){r=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,r){var i;if((t=t||"2d")!=="2d")return null;for(i in r)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=r[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(at.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var l=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return l},set:function(w){l=w}});var c=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return c},set:function(w){c=w}});var d=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return d},set:function(w){d=w}});var m=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return m},set:function(w){m=w}});var p=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return p},set:function(w){p=w}});var h=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return h},set:function(w){h=w}});var b=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return b},set:function(w){b=w}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(l){return r.call(this),this.internal.__cell__.headerFunction=typeof l=="function"?l:void 0,this},n.getTextDimensions=function(l,c){r.call(this);var d=(c=c||{}).fontSize||this.getFontSize(),m=c.font||this.getFont(),p=c.scaleFactor||this.internal.scaleFactor,h=0,b=0,w=0,S=this;if(!Array.isArray(l)&&typeof l!="string"){if(typeof l!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");l=String(l)}var A=c.maxWidth;A>0?typeof l=="string"?l=this.splitTextToSize(l,A):Object.prototype.toString.call(l)==="[object Array]"&&(l=l.reduce(function(O,P){return O.concat(S.splitTextToSize(P,A))},[])):l=Array.isArray(l)?l:[l];for(var I=0;I<l.length;I++)h<(w=this.getStringUnitWidth(l[I],{font:m})*d)&&(h=w);return h!==0&&(b=l.length),{w:h/=p,h:Math.max((b*d*this.getLineHeightFactor()-d*(this.getLineHeightFactor()-1))/p,0)}},n.cellAddPage=function(){r.call(this),this.addPage();var l=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(l.left,l.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=n.cell=function(){var l;l=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),r.call(this);var c=this.internal.__cell__.lastCell,d=this.internal.__cell__.padding,m=this.internal.__cell__.margins||e,p=this.internal.__cell__.tableHeaderRow,h=this.internal.__cell__.printHeaders;return c.lineNumber!==void 0&&(c.lineNumber===l.lineNumber?(l.x=(c.x||0)+(c.width||0),l.y=c.y||0):c.y+c.height+l.height+m.bottom>this.getPageHeight()?(this.cellAddPage(),l.y=m.top,h&&p&&(this.printHeaderRow(l.lineNumber,!0),l.y+=p[0].height)):l.y=c.y+c.height||l.y),l.text[0]!==void 0&&(this.rect(l.x,l.y,l.width,l.height,t===!0?"FD":void 0),l.align==="right"?this.text(l.text,l.x+l.width-d,l.y+d,{align:"right",baseline:"top"}):l.align==="center"?this.text(l.text,l.x+l.width/2,l.y+d,{align:"center",baseline:"top",maxWidth:l.width-d-d}):this.text(l.text,l.x+d,l.y+d,{align:"left",baseline:"top",maxWidth:l.width-d-d})),this.internal.__cell__.lastCell=l,this};n.table=function(l,c,d,m,p){if(r.call(this),!d)throw new Error("No data for PDF table.");var h,b,w,S,A=[],I=[],O=[],P={},K={},le=[],he=[],ne=(p=p||{}).autoSize||!1,V=p.printHeaders!==!1,ue=p.css&&p.css["font-size"]!==void 0?16*p.css["font-size"]:p.fontSize||12,_=p.margins||Object.assign({width:this.getPageWidth()},e),L=typeof p.padding=="number"?p.padding:3,C=p.headerBackgroundColor||"#c8c8c8",M=p.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=V,this.internal.__cell__.margins=_,this.internal.__cell__.table_font_size=ue,this.internal.__cell__.padding=L,this.internal.__cell__.headerBackgroundColor=C,this.internal.__cell__.headerTextColor=M,this.setFontSize(ue),m==null)I=A=Object.keys(d[0]),O=A.map(function(){return"left"});else if(Array.isArray(m)&&un(m[0])==="object")for(A=m.map(function(me){return me.name}),I=m.map(function(me){return me.prompt||me.name||""}),O=m.map(function(me){return me.align||"left"}),h=0;h<m.length;h+=1)K[m[h].name]=.7499990551181103*m[h].width;else Array.isArray(m)&&typeof m[0]=="string"&&(I=A=m,O=A.map(function(){return"left"}));if(ne||Array.isArray(m)&&typeof m[0]=="string")for(h=0;h<A.length;h+=1){for(P[S=A[h]]=d.map(function(me){return me[S]}),this.setFont(void 0,"bold"),le.push(this.getTextDimensions(I[h],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),b=P[S],this.setFont(void 0,"normal"),w=0;w<b.length;w+=1)le.push(this.getTextDimensions(b[w],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);K[S]=Math.max.apply(null,le)+L+L,le=[]}if(V){var Y={};for(h=0;h<A.length;h+=1)Y[A[h]]={},Y[A[h]].text=I[h],Y[A[h]].align=O[h];var G=o.call(this,Y,K);he=A.map(function(me){return new s(l,c,K[me],G,Y[me].text,void 0,Y[me].align)}),this.setTableHeaderRow(he),this.printHeaderRow(1,!1)}var te=m.reduce(function(me,fe){return me[fe.name]=fe.align,me},{});for(h=0;h<d.length;h+=1){"rowStart"in p&&p.rowStart instanceof Function&&p.rowStart({row:h,data:d[h]},this);var X=o.call(this,d[h],K);for(w=0;w<A.length;w+=1){var ae=d[h][A[w]];"cellStart"in p&&p.cellStart instanceof Function&&p.cellStart({row:h,col:w,data:ae},this),a.call(this,new s(l,c,K[A[w]],X,ae,h+2,te[A[w]]))}}return this.internal.__cell__.table_x=l,this.internal.__cell__.table_y=c,this};var o=function(l,c){var d=this.internal.__cell__.padding,m=this.internal.__cell__.table_font_size,p=this.internal.scaleFactor;return Object.keys(l).map(function(h){var b=l[h];return this.splitTextToSize(b.hasOwnProperty("text")?b.text:b,c[h]-d-d)},this).map(function(h){return this.getLineHeightFactor()*h.length*m/p+d+d},this).reduce(function(h,b){return Math.max(h,b)},0)};n.setTableHeaderRow=function(l){r.call(this),this.internal.__cell__.tableHeaderRow=l},n.printHeaderRow=function(l,c){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var d;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var m=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(m[0],m[1],m[2],m[3],void 0,-1)}this.setFont(void 0,"bold");for(var p=[],h=0;h<this.internal.__cell__.tableHeaderRow.length;h+=1){d=this.internal.__cell__.tableHeaderRow[h].clone(),c&&(d.y=this.internal.__cell__.margins.top||0,p.push(d)),d.lineNumber=l;var b=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,d),this.setTextColor(b)}p.length>0&&this.setTableHeaderRow(p),this.setFont(void 0,"normal"),t=!1}})(at.API);var V2={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},G2=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],vp=W2(G2),K2=[100,200,300,400,500,600,700,800,900],d8=W2(K2);function pf(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(s){return V2[s=s||"normal"]?s:"normal"})(n.style),r=(function(s){return s?typeof s=="number"?s>=100&&s<=900&&s%100==0?s:400:/^\d00$/.test(s)?parseInt(s):s==="bold"?700:400:400})(n.weight),i=(function(s){return typeof vp[s=s||"normal"]=="number"?s:"normal"})(n.stretch);return{family:e,style:t,weight:r,stretch:i,src:n.src||[],ref:n.ref||{name:e,style:[i,t,r].join(" ")}}}function U0(n,e,t,r){var i;for(i=t;i>=0&&i<e.length;i+=r)if(n[e[i]])return n[e[i]];for(i=t;i>=0&&i<e.length;i-=r)if(n[e[i]])return n[e[i]]}var h8={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},z0={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function H0(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function W0(n){return n.trimLeft()}function f8(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function p8(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var tl,id,V0,G0,K0,mf=["times"];function Y0(n,e,t,r,i){var s=4,a=X0;switch(i){case at.API.image_compression.FAST:s=1,a=J0;break;case at.API.image_compression.MEDIUM:s=6,a=Z0;break;case at.API.image_compression.SLOW:s=9,a=Q0}n=(function(l,c,d,m){for(var p,h=l.length/c,b=new Uint8Array(l.length+h),w=[m8,J0,X0,Z0,Q0],S=0;S<h;S+=1){var A=S*c,I=l.subarray(A,A+c);if(m)b.set(m(I,d,p),A+S);else{for(var O=w.length,P=[],K=0;K<O;K+=1)P[K]=w[K](I,d,p);var le=v8(P.concat());b.set(P[le],A+S)}p=I}return b})(n,e,Math.ceil(t*r/8),a);var o=up(n,{level:s});return at.API.__addimage__.arrayBufferToBinaryString(o)}function m8(n){var e=Array.apply([],n);return e.unshift(0),e}function J0(n,e){var t=n.length,r=[];r[0]=1;for(var i=0;i<t;i+=1){var s=n[i-e]||0;r[i+1]=n[i]-s+256&255}return r}function X0(n,e,t){var r=n.length,i=[];i[0]=2;for(var s=0;s<r;s+=1){var a=t&&t[s]||0;i[s+1]=n[s]-a+256&255}return i}function Z0(n,e,t){var r=n.length,i=[];i[0]=3;for(var s=0;s<r;s+=1){var a=n[s-e]||0,o=t&&t[s]||0;i[s+1]=n[s]+256-(a+o>>>1)&255}return i}function Q0(n,e,t){var r=n.length,i=[];i[0]=4;for(var s=0;s<r;s+=1){var a=g8(n[s-e]||0,t&&t[s]||0,t&&t[s-e]||0);i[s+1]=n[s]-a+256&255}return i}function g8(n,e,t){if(n===e&&e===t)return n;var r=Math.abs(e-t),i=Math.abs(n-t),s=Math.abs(n+e-t-t);return r<=i&&r<=s?n:i<=s?e:t}function v8(n){var e=n.map(function(t){return t.reduce(function(r,i){return r+Math.abs(i)},0)});return e.indexOf(Math.min.apply(null,e))}function gf(n,e,t){var r=e*t,i=Math.floor(r/8),s=16-(r-8*i+t),a=(1<<t)-1;return Y2(n,i)>>s&a}function ev(n,e,t,r){var i=t*r,s=Math.floor(i/8),a=16-(i-8*s+r),o=(1<<r)-1,l=(e&o)<<a;(function(c,d,m){if(d+1<c.byteLength)c.setUint16(d,m,!1);else{var p=m>>8&255;c.setUint8(d,p)}})(n,s,Y2(n,s)&~(o<<a)&65535|l)}function Y2(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function b8(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,r=n[e++]|n[e++]<<8,i=n[e++],s=i>>7,a=1<<1+(7&i);n[e++],n[e++];var o=null,l=null;s&&(o=e,l=a,e+=3*a);var c=!0,d=[],m=0,p=null,h=0,b=null;for(this.width=t,this.height=r;c&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,b=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!((_=n[e++])>=0))throw Error("Invalid block size");if(_===0)break;e+=_}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var w=n[e++];m=n[e++]|n[e++]<<8,p=n[e++],1&w||(p=null),h=w>>2&7,e++;break;case 254:for(;;){if(!((_=n[e++])>=0))throw Error("Invalid block size");if(_===0)break;e+=_}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var S=n[e++]|n[e++]<<8,A=n[e++]|n[e++]<<8,I=n[e++]|n[e++]<<8,O=n[e++]|n[e++]<<8,P=n[e++],K=P>>6&1,le=1<<1+(7&P),he=o,ne=l,V=!1;P>>7&&(V=!0,he=e,ne=le,e+=3*le);var ue=e;for(e++;;){var _;if(!((_=n[e++])>=0))throw Error("Invalid block size");if(_===0)break;e+=_}d.push({x:S,y:A,width:I,height:O,has_local_palette:V,palette_offset:he,palette_size:ne,data_offset:ue,data_length:e-ue,transparent_index:p,interlaced:!!K,delay:m,disposal:h});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return b},this.frameInfo=function(L){if(L<0||L>=d.length)throw new Error("Frame index out of range.");return d[L]},this.decodeAndBlitFrameBGRA=function(L,C){var M=this.frameInfo(L),Y=M.width*M.height;if(Y>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var G=new Uint8Array(Y);tv(n,M.data_offset,G,Y);var te=M.palette_offset,X=M.transparent_index;X===null&&(X=256);var ae=M.width,me=t-ae,fe=ae,k=4*(M.y*t+M.x),q=4*((M.y+M.height)*t+M.x),W=k,U=4*me;M.interlaced===!0&&(U+=4*t*7);for(var Q=8,se=0,oe=G.length;se<oe;++se){var pe=G[se];if(fe===0&&(fe=ae,(W+=U)>=q&&(U=4*me+4*t*(Q-1),W=k+(ae+me)*(Q<<1),Q>>=1)),pe===X)W+=4;else{var be=n[te+3*pe],xe=n[te+3*pe+1],Oe=n[te+3*pe+2];C[W++]=Oe,C[W++]=xe,C[W++]=be,C[W++]=255}--fe}},this.decodeAndBlitFrameRGBA=function(L,C){var M=this.frameInfo(L),Y=M.width*M.height;if(Y>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var G=new Uint8Array(Y);tv(n,M.data_offset,G,Y);var te=M.palette_offset,X=M.transparent_index;X===null&&(X=256);var ae=M.width,me=t-ae,fe=ae,k=4*(M.y*t+M.x),q=4*((M.y+M.height)*t+M.x),W=k,U=4*me;M.interlaced===!0&&(U+=4*t*7);for(var Q=8,se=0,oe=G.length;se<oe;++se){var pe=G[se];if(fe===0&&(fe=ae,(W+=U)>=q&&(U=4*me+4*t*(Q-1),W=k+(ae+me)*(Q<<1),Q>>=1)),pe===X)W+=4;else{var be=n[te+3*pe],xe=n[te+3*pe+1],Oe=n[te+3*pe+2];C[W++]=be,C[W++]=xe,C[W++]=Oe,C[W++]=255}--fe}}}function tv(n,e,t,r){for(var i=n[e++],s=1<<i,a=s+1,o=a+1,l=i+1,c=(1<<l)-1,d=0,m=0,p=0,h=n[e++],b=new Int32Array(4096),w=null;;){for(;d<16&&h!==0;)m|=n[e++]<<d,d+=8,h===1?h=n[e++]:--h;if(d<l)break;var S=m&c;if(m>>=l,d-=l,S!==s){if(S===a)break;for(var A=S<o?S:w,I=0,O=A;O>s;)O=b[O]>>8,++I;var P=O;if(p+I+(A!==S?1:0)>r)return void mn.log("Warning, gif stream longer than expected.");t[p++]=P;var K=p+=I;for(A!==S&&(t[p++]=P),O=A;I--;)O=b[O],t[--K]=255&O,O>>=8;w!==null&&o<4096&&(b[o++]=w<<8|P,o>=c+1&&l<12&&(++l,c=c<<1|1)),w=S}else o=a+1,c=(1<<(l=i+1))-1,w=null}return p!==r&&mn.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function vf(n){var e,t,r,i,s,a=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),d=new Array(64),m=new Array(65535),p=new Array(65535),h=new Array(64),b=new Array(64),w=[],S=0,A=7,I=new Array(64),O=new Array(64),P=new Array(64),K=new Array(256),le=new Array(2048),he=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ne=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],ue=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],_=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],L=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],M=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Y=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function G(k,q){for(var W=0,U=0,Q=new Array,se=1;se<=16;se++){for(var oe=1;oe<=k[se];oe++)Q[q[U]]=[],Q[q[U]][0]=W,Q[q[U]][1]=se,U++,W++;W*=2}return Q}function te(k){for(var q=k[0],W=k[1]-1;W>=0;)q&1<<W&&(S|=1<<A),W--,--A<0&&(S==255?(X(255),X(0)):X(S),A=7,S=0)}function X(k){w.push(k)}function ae(k){X(k>>8&255),X(255&k)}function me(k,q,W,U,Q){for(var se,oe=Q[0],pe=Q[240],be=(function(Le,Je){var $e,st,tt,Tt,At,mt,gt,Nt,Ue,ut,He=0;for(Ue=0;Ue<8;++Ue){$e=Le[He],st=Le[He+1],tt=Le[He+2],Tt=Le[He+3],At=Le[He+4],mt=Le[He+5],gt=Le[He+6];var sn=$e+(Nt=Le[He+7]),Ot=$e-Nt,wt=st+gt,ft=st-gt,Wt=tt+mt,Ke=tt-mt,$t=Tt+At,Xe=Tt-At,pt=sn+$t,Vt=sn-$t,St=wt+Wt,et=wt-Wt;Le[He]=pt+St,Le[He+4]=pt-St;var qt=.707106781*(et+Vt);Le[He+2]=Vt+qt,Le[He+6]=Vt-qt;var Mr=.382683433*((pt=Xe+Ke)-(et=ft+Ot)),Rt=.5411961*pt+Mr,Dn=1.306562965*et+Mr,Fn=.707106781*(St=Ke+ft),dt=Ot+Fn,Cn=Ot-Fn;Le[He+5]=Cn+Rt,Le[He+3]=Cn-Rt,Le[He+1]=dt+Dn,Le[He+7]=dt-Dn,He+=8}for(He=0,Ue=0;Ue<8;++Ue){$e=Le[He],st=Le[He+8],tt=Le[He+16],Tt=Le[He+24],At=Le[He+32],mt=Le[He+40],gt=Le[He+48];var Nr=$e+(Nt=Le[He+56]),er=$e-Nt,ur=st+gt,Mt=st-gt,Qt=tt+mt,Ft=tt-mt,Zr=Tt+At,kr=Tt-At,dr=Nr+Zr,kn=Nr-Zr,hr=ur+Qt,tn=ur-Qt;Le[He]=dr+hr,Le[He+32]=dr-hr;var tr=.707106781*(tn+kn);Le[He+16]=kn+tr,Le[He+48]=kn-tr;var Qr=.382683433*((dr=kr+Ft)-(tn=Mt+er)),Lr=.5411961*dr+Qr,ze=1.306562965*tn+Qr,ee=.707106781*(hr=Ft+Mt),ke=er+ee,Me=er-ee;Le[He+40]=Me+Lr,Le[He+24]=Me-Lr,Le[He+8]=ke+ze,Le[He+56]=ke-ze,He++}for(Ue=0;Ue<64;++Ue)ut=Le[Ue]*Je[Ue],h[Ue]=ut>0?ut+.5|0:ut-.5|0;return h})(k,q),xe=0;xe<64;++xe)b[he[xe]]=be[xe];var Oe=b[0]-W;W=b[0],Oe==0?te(U[0]):(te(U[p[se=32767+Oe]]),te(m[se]));for(var Te=63;Te>0&&b[Te]==0;)Te--;if(Te==0)return te(oe),W;for(var qe,j=1;j<=Te;){for(var Be=j;b[j]==0&&j<=Te;)++j;var xt=j-Be;if(xt>=16){qe=xt>>4;for(var Qe=1;Qe<=qe;++Qe)te(pe);xt&=15}se=32767+b[j],te(Q[(xt<<4)+p[se]]),te(m[se]),j++}return Te!=63&&te(oe),W}function fe(k){k=Math.min(Math.max(k,1),100),s!=k&&((function(q){for(var W=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],U=0;U<64;U++){var Q=a((W[U]*q+50)/100);Q=Math.min(Math.max(Q,1),255),o[he[U]]=Q}for(var se=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],oe=0;oe<64;oe++){var pe=a((se[oe]*q+50)/100);pe=Math.min(Math.max(pe,1),255),l[he[oe]]=pe}for(var be=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],xe=0,Oe=0;Oe<8;Oe++)for(var Te=0;Te<8;Te++)c[xe]=1/(o[he[xe]]*be[Oe]*be[Te]*8),d[xe]=1/(l[he[xe]]*be[Oe]*be[Te]*8),xe++})(k<50?Math.floor(5e3/k):Math.floor(200-2*k)),s=k)}this.encode=function(k,q){q&&fe(q),w=new Array,S=0,A=7,ae(65496),ae(65504),ae(16),X(74),X(70),X(73),X(70),X(0),X(1),X(1),X(0),ae(1),ae(1),X(0),X(0),(function(){ae(65499),ae(132),X(0);for(var st=0;st<64;st++)X(o[st]);X(1);for(var tt=0;tt<64;tt++)X(l[tt])})(),(function(st,tt){ae(65472),ae(17),X(8),ae(tt),ae(st),X(3),X(1),X(17),X(0),X(2),X(17),X(1),X(3),X(17),X(1)})(k.width,k.height),(function(){ae(65476),ae(418),X(0);for(var st=0;st<16;st++)X(ne[st+1]);for(var tt=0;tt<=11;tt++)X(V[tt]);X(16);for(var Tt=0;Tt<16;Tt++)X(ue[Tt+1]);for(var At=0;At<=161;At++)X(_[At]);X(1);for(var mt=0;mt<16;mt++)X(L[mt+1]);for(var gt=0;gt<=11;gt++)X(C[gt]);X(17);for(var Nt=0;Nt<16;Nt++)X(M[Nt+1]);for(var Ue=0;Ue<=161;Ue++)X(Y[Ue])})(),ae(65498),ae(12),X(3),X(1),X(0),X(2),X(17),X(3),X(17),X(0),X(63),X(0);var W=0,U=0,Q=0;S=0,A=7,this.encode.displayName="_encode_";for(var se,oe,pe,be,xe,Oe,Te,qe,j,Be=k.data,xt=k.width,Qe=k.height,Le=4*xt,Je=0;Je<Qe;){for(se=0;se<Le;){for(xe=Le*Je+se,Te=-1,qe=0,j=0;j<64;j++)Oe=xe+(qe=j>>3)*Le+(Te=4*(7&j)),Je+qe>=Qe&&(Oe-=Le*(Je+1+qe-Qe)),se+Te>=Le&&(Oe-=se+Te-Le+4),oe=Be[Oe++],pe=Be[Oe++],be=Be[Oe++],I[j]=(le[oe]+le[pe+256|0]+le[be+512|0]>>16)-128,O[j]=(le[oe+768|0]+le[pe+1024|0]+le[be+1280|0]>>16)-128,P[j]=(le[oe+1280|0]+le[pe+1536|0]+le[be+1792|0]>>16)-128;W=me(I,c,W,e,r),U=me(O,d,U,t,i),Q=me(P,d,Q,t,i),se+=32}Je+=8}if(A>=0){var $e=[];$e[1]=A+1,$e[0]=(1<<A+1)-1,te($e)}return ae(65497),new Uint8Array(w)},n=n||50,(function(){for(var k=String.fromCharCode,q=0;q<256;q++)K[q]=k(q)})(),e=G(ne,V),t=G(L,C),r=G(ue,_),i=G(M,Y),(function(){for(var k=1,q=2,W=1;W<=15;W++){for(var U=k;U<q;U++)p[32767+U]=W,m[32767+U]=[],m[32767+U][1]=W,m[32767+U][0]=U;for(var Q=-(q-1);Q<=-k;Q++)p[32767+Q]=W,m[32767+Q]=[],m[32767+Q][1]=W,m[32767+Q][0]=q-1+Q;k<<=1,q<<=1}})(),(function(){for(var k=0;k<256;k++)le[k]=19595*k,le[k+256|0]=38470*k,le[k+512|0]=7471*k+32768,le[k+768|0]=-11059*k,le[k+1024|0]=-21709*k,le[k+1280|0]=32768*k+8421375,le[k+1536|0]=-27439*k,le[k+1792|0]=-5329*k})(),fe(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Ji(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function nv(n){function e(V){if(!V)throw Error("assert :P")}function t(V,ue,_){for(var L=0;4>L;L++)if(V[ue+L]!=_.charCodeAt(L))return!0;return!1}function r(V,ue,_,L,C){for(var M=0;M<C;M++)V[ue+M]=_[L+M]}function i(V,ue,_,L){for(var C=0;C<L;C++)V[ue+C]=_}function s(V){return new Int32Array(V)}function a(V,ue){for(var _=[],L=0;L<V;L++)_.push(new ue);return _}function o(V,ue){var _=[];return(function L(C,M,Y){for(var G=Y[M],te=0;te<G&&(C.push(Y.length>M+1?[]:new ue),!(Y.length<M+1));te++)L(C[te],M+1,Y)})(_,0,V),_}var l=function(){var V=this;function ue(u,f){for(var v=1<<f-1>>>0;u&v;)v>>>=1;return v?(u&v-1)+v:u}function _(u,f,v,x,N){e(!(x%v));do u[f+(x-=v)]=N;while(0<x)}function L(u,f,v,x,N){if(e(2328>=N),512>=N)var T=s(512);else if((T=s(N))==null)return 0;return(function(R,B,$,z,re,ve){var H,ie,de=B,_e=1<<$,ge=s(16),Ae=s(16);for(e(re!=0),e(z!=null),e(R!=null),e(0<$),ie=0;ie<re;++ie){if(15<z[ie])return 0;++ge[z[ie]]}if(ge[0]==re)return 0;for(Ae[1]=0,H=1;15>H;++H){if(ge[H]>1<<H)return 0;Ae[H+1]=Ae[H]+ge[H]}for(ie=0;ie<re;++ie)H=z[ie],0<z[ie]&&(ve[Ae[H]++]=ie);if(Ae[15]==1)return(z=new C).g=0,z.value=ve[0],_(R,de,1,_e,z),_e;var Ee,Pe=-1,Ie=_e-1,ht=0,Ve=1,Dt=1,nt=1<<$;for(ie=0,H=1,re=2;H<=$;++H,re<<=1){if(Ve+=Dt<<=1,0>(Dt-=ge[H]))return 0;for(;0<ge[H];--ge[H])(z=new C).g=H,z.value=ve[ie++],_(R,de+ht,re,nt,z),ht=ue(ht,H)}for(H=$+1,re=2;15>=H;++H,re<<=1){if(Ve+=Dt<<=1,0>(Dt-=ge[H]))return 0;for(;0<ge[H];--ge[H]){if(z=new C,(ht&Ie)!=Pe){for(de+=nt,Ee=1<<(Pe=H)-$;15>Pe&&!(0>=(Ee-=ge[Pe]));)++Pe,Ee<<=1;_e+=nt=1<<(Ee=Pe-$),R[B+(Pe=ht&Ie)].g=Ee+$,R[B+Pe].value=de-B-Pe}z.g=H-$,z.value=ve[ie++],_(R,de+(ht>>$),re,nt,z),ht=ue(ht,H)}}return Ve!=2*Ae[15]-1?0:_e})(u,f,v,x,N,T)}function C(){this.value=this.g=0}function M(){this.value=this.g=0}function Y(){this.G=a(5,C),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(ao,M)}function G(u,f,v,x){e(u!=null),e(f!=null),e(2147483648>x),u.Ca=254,u.I=0,u.b=-8,u.Ka=0,u.oa=f,u.pa=v,u.Jd=f,u.Yc=v+x,u.Zc=4<=x?v+x-4+1:v,oe(u)}function te(u,f){for(var v=0;0<f--;)v|=be(u,128)<<f;return v}function X(u,f){var v=te(u,f);return pe(u)?-v:v}function ae(u,f,v,x){var N,T=0;for(e(u!=null),e(f!=null),e(4294967288>x),u.Sb=x,u.Ra=0,u.u=0,u.h=0,4<x&&(x=4),N=0;N<x;++N)T+=f[v+N]<<8*N;u.Ra=T,u.bb=x,u.oa=f,u.pa=v}function me(u){for(;8<=u.u&&u.bb<u.Sb;)u.Ra>>>=8,u.Ra+=u.oa[u.pa+u.bb]<<_a-8>>>0,++u.bb,u.u-=8;U(u)&&(u.h=1,u.u=0)}function fe(u,f){if(e(0<=f),!u.h&&f<=fi){var v=W(u)&hi[f];return u.u+=f,me(u),v}return u.h=1,u.u=0}function k(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function q(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function W(u){return u.Ra>>>(u.u&_a-1)>>>0}function U(u){return e(u.bb<=u.Sb),u.h||u.bb==u.Sb&&u.u>_a}function Q(u,f){u.u=f,u.h=U(u)}function se(u){u.u>=Ws&&(e(u.u>=Ws),me(u))}function oe(u){e(u!=null&&u.oa!=null),u.pa<u.Zc?(u.I=(u.oa[u.pa++]|u.I<<8)>>>0,u.b+=8):(e(u!=null&&u.oa!=null),u.pa<u.Yc?(u.b+=8,u.I=u.oa[u.pa++]|u.I<<8):u.Ka?u.b=0:(u.I<<=8,u.b+=8,u.Ka=1))}function pe(u){return te(u,1)}function be(u,f){var v=u.Ca;0>u.b&&oe(u);var x=u.b,N=v*f>>>8,T=(u.I>>>x>N)+0;for(T?(v-=N,u.I-=N+1<<x>>>0):v=N+1,x=v,N=0;256<=x;)N+=8,x>>=8;return x=7^N+xa[x],u.b-=x,u.Ca=(v<<x)-1,T}function xe(u,f,v){u[f+0]=v>>24&255,u[f+1]=v>>16&255,u[f+2]=v>>8&255,u[f+3]=255&v}function Oe(u,f){return u[f+0]|u[f+1]<<8}function Te(u,f){return Oe(u,f)|u[f+2]<<16}function qe(u,f){return Oe(u,f)|Oe(u,f+2)<<16}function j(u,f){var v=1<<f;return e(u!=null),e(0<f),u.X=s(v),u.X==null?0:(u.Mb=32-f,u.Xa=f,1)}function Be(u,f){e(u!=null),e(f!=null),e(u.Xa==f.Xa),r(f.X,0,u.X,0,1<<f.Xa)}function xt(){this.X=[],this.Xa=this.Mb=0}function Qe(u,f,v,x){e(v!=null),e(x!=null);var N=v[0],T=x[0];return N==0&&(N=(u*T+f/2)/f),T==0&&(T=(f*N+u/2)/u),0>=N||0>=T?0:(v[0]=N,x[0]=T,1)}function Le(u,f){return u+(1<<f)-1>>>f}function Je(u,f){return((4278255360&u)+(4278255360&f)>>>0&4278255360)+((16711935&u)+(16711935&f)>>>0&16711935)>>>0}function $e(u,f){V[f]=function(v,x,N,T,R,B,$){var z;for(z=0;z<R;++z){var re=V[u](B[$+z-1],N,T+z);B[$+z]=Je(v[x+z],re)}}}function st(){this.ud=this.hd=this.jd=0}function tt(u,f){return((4278124286&(u^f))>>>1)+(u&f)>>>0}function Tt(u){return 0<=u&&256>u?u:0>u?0:255<u?255:void 0}function At(u,f){return Tt(u+(u-f+.5>>1))}function mt(u,f,v){return Math.abs(f-v)-Math.abs(u-v)}function gt(u,f,v,x,N,T,R){for(x=T[R-1],v=0;v<N;++v)T[R+v]=x=Je(u[f+v],x)}function Nt(u,f,v,x,N){var T;for(T=0;T<v;++T){var R=u[f+T],B=R>>8&255,$=16711935&($=($=16711935&R)+((B<<16)+B));x[N+T]=(4278255360&R)+$>>>0}}function Ue(u,f){f.jd=255&u,f.hd=u>>8&255,f.ud=u>>16&255}function ut(u,f,v,x,N,T){var R;for(R=0;R<x;++R){var B=f[v+R],$=B>>>8,z=B,re=255&(re=(re=B>>>16)+((u.jd<<24>>24)*($<<24>>24)>>>5));z=255&(z=(z+=(u.hd<<24>>24)*($<<24>>24)>>>5)+((u.ud<<24>>24)*(re<<24>>24)>>>5)),N[T+R]=(4278255360&B)+(re<<16)+z}}function He(u,f,v,x,N){V[f]=function(T,R,B,$,z,re,ve,H,ie){for($=ve;$<H;++$)for(ve=0;ve<ie;++ve)z[re++]=N(B[x(T[R++])])},V[u]=function(T,R,B,$,z,re,ve){var H=8>>T.b,ie=T.Ea,de=T.K[0],_e=T.w;if(8>H)for(T=(1<<T.b)-1,_e=(1<<H)-1;R<B;++R){var ge,Ae=0;for(ge=0;ge<ie;++ge)ge&T||(Ae=x($[z++])),re[ve++]=N(de[Ae&_e]),Ae>>=H}else V["VP8LMapColor"+v]($,z,de,_e,re,ve,R,B,ie)}}function sn(u,f,v,x,N){for(v=f+v;f<v;){var T=u[f++];x[N++]=T>>16&255,x[N++]=T>>8&255,x[N++]=255&T}}function Ot(u,f,v,x,N){for(v=f+v;f<v;){var T=u[f++];x[N++]=T>>16&255,x[N++]=T>>8&255,x[N++]=255&T,x[N++]=T>>24&255}}function wt(u,f,v,x,N){for(v=f+v;f<v;){var T=(R=u[f++])>>16&240|R>>12&15,R=240&R|R>>28&15;x[N++]=T,x[N++]=R}}function ft(u,f,v,x,N){for(v=f+v;f<v;){var T=(R=u[f++])>>16&248|R>>13&7,R=R>>5&224|R>>3&31;x[N++]=T,x[N++]=R}}function Wt(u,f,v,x,N){for(v=f+v;f<v;){var T=u[f++];x[N++]=255&T,x[N++]=T>>8&255,x[N++]=T>>16&255}}function Ke(u,f,v,x,N,T){if(T==0)for(v=f+v;f<v;)xe(x,((T=u[f++])[0]>>24|T[1]>>8&65280|T[2]<<8&16711680|T[3]<<24)>>>0),N+=32;else r(x,N,u,f,v)}function $t(u,f){V[f][0]=V[u+"0"],V[f][1]=V[u+"1"],V[f][2]=V[u+"2"],V[f][3]=V[u+"3"],V[f][4]=V[u+"4"],V[f][5]=V[u+"5"],V[f][6]=V[u+"6"],V[f][7]=V[u+"7"],V[f][8]=V[u+"8"],V[f][9]=V[u+"9"],V[f][10]=V[u+"10"],V[f][11]=V[u+"11"],V[f][12]=V[u+"12"],V[f][13]=V[u+"13"],V[f][14]=V[u+"0"],V[f][15]=V[u+"0"]}function Xe(u){return u==ah||u==oh||u==_u||u==lh}function pt(){this.eb=[],this.size=this.A=this.fb=0}function Vt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function St(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new pt,this.f.kb=new Vt,this.sd=null}function et(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function qt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Mr(u){return alert("todo:WebPSamplerProcessPlane"),u.T}function Rt(u,f){var v=u.T,x=f.ba.f.RGBA,N=x.eb,T=x.fb+u.ka*x.A,R=Ii[f.ba.S],B=u.y,$=u.O,z=u.f,re=u.N,ve=u.ea,H=u.W,ie=f.cc,de=f.dc,_e=f.Mc,ge=f.Nc,Ae=u.ka,Ee=u.ka+u.T,Pe=u.U,Ie=Pe+1>>1;for(Ae==0?R(B,$,null,null,z,re,ve,H,z,re,ve,H,N,T,null,null,Pe):(R(f.ec,f.fc,B,$,ie,de,_e,ge,z,re,ve,H,N,T-x.A,N,T,Pe),++v);Ae+2<Ee;Ae+=2)ie=z,de=re,_e=ve,ge=H,re+=u.Rc,H+=u.Rc,T+=2*x.A,R(B,($+=2*u.fa)-u.fa,B,$,ie,de,_e,ge,z,re,ve,H,N,T-x.A,N,T,Pe);return $+=u.fa,u.j+Ee<u.o?(r(f.ec,f.fc,B,$,Pe),r(f.cc,f.dc,z,re,Ie),r(f.Mc,f.Nc,ve,H,Ie),v--):1&Ee||R(B,$,null,null,z,re,ve,H,z,re,ve,H,N,T+x.A,null,null,Pe),v}function Dn(u,f,v){var x=u.F,N=[u.J];if(x!=null){var T=u.U,R=f.ba.S,B=R==wu||R==_u;f=f.ba.f.RGBA;var $=[0],z=u.ka;$[0]=u.T,u.Kb&&(z==0?--$[0]:(--z,N[0]-=u.width),u.j+u.ka+u.T==u.o&&($[0]=u.o-u.j-z));var re=f.eb;z=f.fb+z*f.A,u=Cm(x,N[0],u.width,T,$,re,z+(B?0:3),f.A),e(v==$),u&&Xe(R)&&Jl(re,z,B,T,$,f.A)}return 0}function Fn(u){var f=u.ma,v=f.ba.S,x=11>v,N=v==bu||v==yu||v==wu||v==sh||v==12||Xe(v);if(f.memory=null,f.Ib=null,f.Jb=null,f.Nd=null,!Ul(f.Oa,u,N?11:12))return 0;if(N&&Xe(v)&&$l(),u.da)alert("todo:use_scaling");else{if(x){if(f.Ib=Mr,u.Kb){if(v=u.U+1>>1,f.memory=s(u.U+2*v),f.memory==null)return 0;f.ec=f.memory,f.fc=0,f.cc=f.ec,f.dc=f.fc+u.U,f.Mc=f.cc,f.Nc=f.dc+v,f.Ib=Rt,$l()}}else alert("todo:EmitYUV");N&&(f.Jb=Dn,x&&Wi())}if(x&&!Vm){for(u=0;256>u;++u)Ny[u]=89858*(u-128)+Au>>xu,Ty[u]=-22014*(u-128)+Au,Ly[u]=-45773*(u-128),ky[u]=113618*(u-128)+Au>>xu;for(u=Zl;u<dh;++u)f=76283*(u-16)+Au>>xu,Cy[u-Zl]=ei(f,255),Iy[u-Zl]=ei(f+8>>4,15);Vm=1}return 1}function dt(u){var f=u.ma,v=u.U,x=u.T;return e(!(1&u.ka)),0>=v||0>=x?0:(v=f.Ib(u,f),f.Jb!=null&&f.Jb(u,f,v),f.Dc+=v,1)}function Cn(u){u.ma.memory=null}function Nr(u,f,v,x){return fe(u,8)!=47?0:(f[0]=fe(u,14)+1,v[0]=fe(u,14)+1,x[0]=fe(u,1),fe(u,3)!=0?0:!u.h)}function er(u,f){if(4>u)return u+1;var v=u-2>>1;return(2+(1&u)<<v)+fe(f,v)+1}function ur(u,f){return 120<f?f-120:1<=(v=((v=hy[f-1])>>4)*u+(8-(15&v)))?v:1;var v}function Mt(u,f,v){var x=W(v),N=u[f+=255&x].g-8;return 0<N&&(Q(v,v.u+8),x=W(v),f+=u[f].value,f+=x&(1<<N)-1),Q(v,v.u+u[f].g),u[f].value}function Qt(u,f,v){return v.g+=u.g,v.value+=u.value<<f>>>0,e(8>=v.g),u.g}function Ft(u,f,v){var x=u.xc;return e((f=x==0?0:u.vc[u.md*(v>>x)+(f>>x)])<u.Wb),u.Ya[f]}function Zr(u,f,v,x){var N=u.ab,T=u.c*f,R=u.C;f=R+f;var B=v,$=x;for(x=u.Ta,v=u.Ua;0<N--;){var z=u.gc[N],re=R,ve=f,H=B,ie=$,de=($=x,B=v,z.Ea);switch(e(re<ve),e(ve<=z.nc),z.hc){case 2:Un(H,ie,(ve-re)*de,$,B);break;case 0:var _e=re,ge=ve,Ae=$,Ee=B,Pe=(nt=z).Ea;_e==0&&(Hl(H,ie,null,null,1,Ae,Ee),gt(H,ie+1,0,0,Pe-1,Ae,Ee+1),ie+=Pe,Ee+=Pe,++_e);for(var Ie=1<<nt.b,ht=Ie-1,Ve=Le(Pe,nt.b),Dt=nt.K,nt=nt.w+(_e>>nt.b)*Ve;_e<ge;){var Gt=Dt,sr=nt,Bt=1;for(Wo(H,ie,Ae,Ee-Pe,1,Ae,Ee);Bt<Pe;){var rt=(Bt&~ht)+Ie;rt>Pe&&(rt=Pe),(0,Vl[Gt[sr++]>>8&15])(H,ie+ +Bt,Ae,Ee+Bt-Pe,rt-Bt,Ae,Ee+Bt),Bt=rt}ie+=Pe,Ee+=Pe,++_e&ht||(nt+=Ve)}ve!=z.nc&&r($,B-de,$,B+(ve-re-1)*de,de);break;case 1:for(de=H,ge=ie,Pe=(H=z.Ea)-(Ee=H&~(Ae=(ie=1<<z.b)-1)),_e=Le(H,z.b),Ie=z.K,z=z.w+(re>>z.b)*_e;re<ve;){for(ht=Ie,Ve=z,Dt=new st,nt=ge+Ee,Gt=ge+H;ge<nt;)Ue(ht[Ve++],Dt),Gl(Dt,de,ge,ie,$,B),ge+=ie,B+=ie;ge<Gt&&(Ue(ht[Ve++],Dt),Gl(Dt,de,ge,Pe,$,B),ge+=Pe,B+=Pe),++re&Ae||(z+=_e)}break;case 3:if(H==$&&ie==B&&0<z.b){for(ge=$,H=de=B+(ve-re)*de-(Ee=(ve-re)*Le(z.Ea,z.b)),ie=$,Ae=B,_e=[],Ee=(Pe=Ee)-1;0<=Ee;--Ee)_e[Ee]=ie[Ae+Ee];for(Ee=Pe-1;0<=Ee;--Ee)ge[H+Ee]=_e[Ee];pu(z,re,ve,$,de,$,B)}else pu(z,re,ve,H,ie,$,B)}B=x,$=v}$!=v&&r(x,v,B,$,T)}function kr(u,f){var v=u.V,x=u.Ba+u.c*u.C,N=f-u.C;if(e(f<=u.l.o),e(16>=N),0<N){var T=u.l,R=u.Ta,B=u.Ua,$=T.width;if(Zr(u,N,v,x),N=B=[B],e((v=u.C)<(x=f)),e(T.v<T.va),x>T.o&&(x=T.o),v<T.j){var z=T.j-v;v=T.j,N[0]+=z*$}if(v>=x?v=0:(N[0]+=4*T.v,T.ka=v-T.j,T.U=T.va-T.v,T.T=x-v,v=1),v){if(B=B[0],11>(v=u.ca).S){var re=v.f.RGBA,ve=(x=v.S,N=T.U,T=T.T,z=re.eb,re.A),H=T;for(re=re.fb+u.Ma*re.A;0<H--;){var ie=R,de=B,_e=N,ge=z,Ae=re;switch(x){case vu:Kl(ie,de,_e,ge,Ae);break;case bu:Aa(ie,de,_e,ge,Ae);break;case ah:Aa(ie,de,_e,ge,Ae),Jl(ge,Ae,0,_e,1,0);break;case qm:oo(ie,de,_e,ge,Ae);break;case yu:Ke(ie,de,_e,ge,Ae,1);break;case oh:Ke(ie,de,_e,ge,Ae,1),Jl(ge,Ae,0,_e,1,0);break;case wu:Ke(ie,de,_e,ge,Ae,0);break;case _u:Ke(ie,de,_e,ge,Ae,0),Jl(ge,Ae,1,_e,1,0);break;case sh:Sa(ie,de,_e,ge,Ae);break;case lh:Sa(ie,de,_e,ge,Ae),Tm(ge,Ae,_e,1,0);break;case jm:Ea(ie,de,_e,ge,Ae);break;default:e(0)}B+=$,re+=ve}u.Ma+=T}else alert("todo:EmitRescaledRowsYUVA");e(u.Ma<=v.height)}}u.C=f,e(u.C<=u.i)}function dr(u){var f;if(0<u.ua)return 0;for(f=0;f<u.Wb;++f){var v=u.Ya[f].G,x=u.Ya[f].H;if(0<v[1][x[1]+0].g||0<v[2][x[2]+0].g||0<v[3][x[3]+0].g)return 0}return 1}function kn(u,f,v,x,N,T){if(u.Z!=0){var R=u.qd,B=u.rd;for(e(La[u.Z]!=null);f<v;++f)La[u.Z](R,B,x,N,x,N,T),R=x,B=N,N+=T;u.qd=R,u.rd=B}}function hr(u,f){var v=u.l.ma,x=v.Z==0||v.Z==1?u.l.j:u.C;if(x=u.C<x?x:u.C,e(f<=u.l.o),f>x){var N=u.l.width,T=v.ca,R=v.tb+N*x,B=u.V,$=u.Ba+u.c*x,z=u.gc;e(u.ab==1),e(z[0].hc==3),_s(z[0],x,f,B,$,T,R),kn(v,x,f,T,R,N)}u.C=u.Ma=f}function tn(u,f,v,x,N,T,R){var B=u.$/x,$=u.$%x,z=u.m,re=u.s,ve=v+u.$,H=ve;N=v+x*N;var ie=v+x*T,de=280+re.ua,_e=u.Pb?B:16777216,ge=0<re.ua?re.Wa:null,Ae=re.wc,Ee=ve<ie?Ft(re,$,B):null;e(u.C<T),e(ie<=N);var Pe=!1;e:for(;;){for(;Pe||ve<ie;){var Ie=0;if(B>=_e){var ht=ve-v;e((_e=u).Pb),_e.wd=_e.m,_e.xd=ht,0<_e.s.ua&&Be(_e.s.Wa,_e.s.vb),_e=B+py}if($&Ae||(Ee=Ft(re,$,B)),e(Ee!=null),Ee.Qb&&(f[ve]=Ee.qb,Pe=!0),!Pe)if(se(z),Ee.jc){Ie=z,ht=f;var Ve=ve,Dt=Ee.pd[W(Ie)&ao-1];e(Ee.jc),256>Dt.g?(Q(Ie,Ie.u+Dt.g),ht[Ve]=Dt.value,Ie=0):(Q(Ie,Ie.u+Dt.g-256),e(256<=Dt.value),Ie=Dt.value),Ie==0&&(Pe=!0)}else Ie=Mt(Ee.G[0],Ee.H[0],z);if(z.h)break;if(Pe||256>Ie){if(!Pe)if(Ee.nd)f[ve]=(Ee.qb|Ie<<8)>>>0;else{if(se(z),Pe=Mt(Ee.G[1],Ee.H[1],z),se(z),ht=Mt(Ee.G[2],Ee.H[2],z),Ve=Mt(Ee.G[3],Ee.H[3],z),z.h)break;f[ve]=(Ve<<24|Pe<<16|Ie<<8|ht)>>>0}if(Pe=!1,++ve,++$>=x&&($=0,++B,R!=null&&B<=T&&!(B%16)&&R(u,B),ge!=null))for(;H<ve;)Ie=f[H++],ge.X[(506832829*Ie&4294967295)>>>ge.Mb]=Ie}else if(280>Ie){if(Ie=er(Ie-256,z),ht=Mt(Ee.G[4],Ee.H[4],z),se(z),ht=ur(x,ht=er(ht,z)),z.h)break;if(ve-v<ht||N-ve<Ie)break e;for(Ve=0;Ve<Ie;++Ve)f[ve+Ve]=f[ve+Ve-ht];for(ve+=Ie,$+=Ie;$>=x;)$-=x,++B,R!=null&&B<=T&&!(B%16)&&R(u,B);if(e(ve<=N),$&Ae&&(Ee=Ft(re,$,B)),ge!=null)for(;H<ve;)Ie=f[H++],ge.X[(506832829*Ie&4294967295)>>>ge.Mb]=Ie}else{if(!(Ie<de))break e;for(Pe=Ie-280,e(ge!=null);H<ve;)Ie=f[H++],ge.X[(506832829*Ie&4294967295)>>>ge.Mb]=Ie;Ie=ve,e(!(Pe>>>(ht=ge).Xa)),f[Ie]=ht.X[Pe],Pe=!0}Pe||e(z.h==U(z))}if(u.Pb&&z.h&&ve<N)e(u.m.h),u.a=5,u.m=u.wd,u.$=u.xd,0<u.s.ua&&Be(u.s.vb,u.s.Wa);else{if(z.h)break e;R!=null&&R(u,B>T?T:B),u.a=0,u.$=ve-v}return 1}return u.a=3,0}function tr(u){e(u!=null),u.vc=null,u.yc=null,u.Ya=null;var f=u.Wa;f!=null&&(f.X=null),u.vb=null,e(u!=null)}function Qr(){var u=new Lt;return u==null?null:(u.a=0,u.xb=Fm,$t("Predictor","VP8LPredictors"),$t("Predictor","VP8LPredictors_C"),$t("PredictorAdd","VP8LPredictorsAdd"),$t("PredictorAdd","VP8LPredictorsAdd_C"),Un=Nt,Gl=ut,Kl=sn,Aa=Ot,Sa=wt,Ea=ft,oo=Wt,V.VP8LMapColor32b=ws,V.VP8LMapColor8b=Wl,u)}function Lr(u,f,v,x,N){var T=1,R=[u],B=[f],$=x.m,z=x.s,re=null,ve=0;e:for(;;){if(v)for(;T&&fe($,1);){var H=R,ie=B,de=x,_e=1,ge=de.m,Ae=de.gc[de.ab],Ee=fe(ge,2);if(de.Oc&1<<Ee)T=0;else{switch(de.Oc|=1<<Ee,Ae.hc=Ee,Ae.Ea=H[0],Ae.nc=ie[0],Ae.K=[null],++de.ab,e(4>=de.ab),Ee){case 0:case 1:Ae.b=fe(ge,3)+2,_e=Lr(Le(Ae.Ea,Ae.b),Le(Ae.nc,Ae.b),0,de,Ae.K),Ae.K=Ae.K[0];break;case 3:var Pe,Ie=fe(ge,8)+1,ht=16<Ie?0:4<Ie?1:2<Ie?2:3;if(H[0]=Le(Ae.Ea,ht),Ae.b=ht,Pe=_e=Lr(Ie,1,0,de,Ae.K)){var Ve,Dt=Ie,nt=Ae,Gt=1<<(8>>nt.b),sr=s(Gt);if(sr==null)Pe=0;else{var Bt=nt.K[0],rt=nt.w;for(sr[0]=nt.K[0][0],Ve=1;Ve<1*Dt;++Ve)sr[Ve]=Je(Bt[rt+Ve],sr[Ve-1]);for(;Ve<4*Gt;++Ve)sr[Ve]=0;nt.K[0]=null,nt.K[0]=sr,Pe=1}}_e=Pe;break;case 2:break;default:e(0)}T=_e}}if(R=R[0],B=B[0],T&&fe($,1)&&!(T=1<=(ve=fe($,4))&&11>=ve)){x.a=3;break e}var je;if(je=T)t:{var Hn,It,Yt,Sn=x,wr=R,Wr=B,qn=ve,Or=v,Vr=Sn.m,ar=Sn.s,Zt=[null],ln=1,jn=0,cn=fy[qn];n:for(;;){if(Or&&fe(Vr,1)){var _r=fe(Vr,3)+2,Gi=Le(wr,_r),Wn=Le(Wr,_r),si=Gi*Wn;if(!Lr(Gi,Wn,0,Sn,Zt))break n;for(Zt=Zt[0],ar.xc=_r,Hn=0;Hn<si;++Hn){var pn=Zt[Hn]>>8&65535;Zt[Hn]=pn,pn>=ln&&(ln=pn+1)}}if(Vr.h)break n;for(It=0;5>It;++It){var or=$m[It];!It&&0<qn&&(or+=1<<qn),jn<or&&(jn=or)}var mi=a(ln*cn,C),Gr=ln,gi=a(Gr,Y);if(gi==null)var vi=null;else e(65536>=Gr),vi=gi;var ai=s(jn);if(vi==null||ai==null||mi==null){Sn.a=1;break n}var bi=mi;for(Hn=Yt=0;Hn<ln;++Hn){var _n=vi[Hn],yi=_n.G,Ki=_n.H,co=0,Ks=1,xr=0;for(It=0;5>It;++It){or=$m[It],yi[It]=bi,Ki[It]=Yt,!It&&0<qn&&(or+=1<<qn);i:{var Eu,hh=or,Nu=Sn,Ql=ai,Py=bi,Dy=Yt,fh=0,Ta=Nu.m,By=fe(Ta,1);if(i(Ql,0,0,hh),By){var qy=fe(Ta,1)+1,jy=fe(Ta,1),Ym=fe(Ta,jy==0?1:8);Ql[Ym]=1,qy==2&&(Ql[Ym=fe(Ta,8)]=1);var ku=1}else{var Jm=s(19),Xm=fe(Ta,4)+4;if(19<Xm){Nu.a=3;var Lu=0;break i}for(Eu=0;Eu<Xm;++Eu)Jm[dy[Eu]]=fe(Ta,3);var ph=void 0,ec=void 0,Zm=Nu,$y=Jm,Tu=hh,Qm=Ql,mh=0,Ca=Zm.m,eg=8,tg=a(128,C);r:for(;L(tg,0,7,$y,19);){if(fe(Ca,1)){var My=2+2*fe(Ca,3);if((ph=2+fe(Ca,My))>Tu)break r}else ph=Tu;for(ec=0;ec<Tu&&ph--;){se(Ca);var ng=tg[0+(127&W(Ca))];Q(Ca,Ca.u+ng.g);var Go=ng.value;if(16>Go)Qm[ec++]=Go,Go!=0&&(eg=Go);else{var Fy=Go==16,rg=Go-16,Uy=cy[rg],ig=fe(Ca,ly[rg])+Uy;if(ec+ig>Tu)break r;for(var zy=Fy?eg:0;0<ig--;)Qm[ec++]=zy}}mh=1;break r}mh||(Zm.a=3),ku=mh}(ku=ku&&!Ta.h)&&(fh=L(Py,Dy,8,Ql,hh)),ku&&fh!=0?Lu=fh:(Nu.a=3,Lu=0)}if(Lu==0)break n;if(Ks&&uy[It]==1&&(Ks=bi[Yt].g==0),co+=bi[Yt].g,Yt+=Lu,3>=It){var tc,gh=ai[0];for(tc=1;tc<or;++tc)ai[tc]>gh&&(gh=ai[tc]);xr+=gh}}if(_n.nd=Ks,_n.Qb=0,Ks&&(_n.qb=(yi[3][Ki[3]+0].value<<24|yi[1][Ki[1]+0].value<<16|yi[2][Ki[2]+0].value)>>>0,co==0&&256>yi[0][Ki[0]+0].value&&(_n.Qb=1,_n.qb+=yi[0][Ki[0]+0].value<<8)),_n.jc=!_n.Qb&&6>xr,_n.jc){var Cu,Ys=_n;for(Cu=0;Cu<ao;++Cu){var Ia=Cu,Oa=Ys.pd[Ia],Iu=Ys.G[0][Ys.H[0]+Ia];256<=Iu.value?(Oa.g=Iu.g+256,Oa.value=Iu.value):(Oa.g=0,Oa.value=0,Ia>>=Qt(Iu,8,Oa),Ia>>=Qt(Ys.G[1][Ys.H[1]+Ia],16,Oa),Ia>>=Qt(Ys.G[2][Ys.H[2]+Ia],0,Oa),Qt(Ys.G[3][Ys.H[3]+Ia],24,Oa))}}}ar.vc=Zt,ar.Wb=ln,ar.Ya=vi,ar.yc=mi,je=1;break t}je=0}if(!(T=je)){x.a=3;break e}if(0<ve){if(z.ua=1<<ve,!j(z.Wa,ve)){x.a=1,T=0;break e}}else z.ua=0;var vh=x,sg=R,Hy=B,bh=vh.s,yh=bh.xc;if(vh.c=sg,vh.i=Hy,bh.md=Le(sg,yh),bh.wc=yh==0?-1:(1<<yh)-1,v){x.xb=_y;break e}if((re=s(R*B))==null){x.a=1,T=0;break e}T=(T=tn(x,re,0,R,B,B,null))&&!$.h;break e}return T?(N!=null?N[0]=re:(e(re==null),e(v)),x.$=0,v||tr(z)):tr(z),T}function ze(u,f){var v=u.c*u.i,x=v+f+16*f;return e(u.c<=f),u.V=s(x),u.V==null?(u.Ta=null,u.Ua=0,u.a=1,0):(u.Ta=u.V,u.Ua=u.Ba+v+f,1)}function ee(u,f){var v=u.C,x=f-v,N=u.V,T=u.Ba+u.c*v;for(e(f<=u.l.o);0<x;){var R=16<x?16:x,B=u.l.ma,$=u.l.width,z=$*R,re=B.ca,ve=B.tb+$*v,H=u.Ta,ie=u.Ua;Zr(u,R,N,T),Im(H,ie,re,ve,z),kn(B,v,v+R,re,ve,$),x-=R,N+=R*u.c,v+=R}e(v==f),u.C=u.Ma=f}function ke(){this.ub=this.yd=this.td=this.Rb=0}function Me(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function en(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function vn(){this.Yb=(function(){var u=[];return(function f(v,x,N){for(var T=N[x],R=0;R<T&&(v.push(N.length>x+1?[]:0),!(N.length<x+1));R++)f(v[R],x+1,N)})(u,0,[3,11]),u})()}function an(){this.jb=s(3),this.Wc=o([4,8],vn),this.Xc=o([4,17],vn)}function In(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function on(){this.ld=this.La=this.dd=this.tc=0}function mr(){this.Na=this.la=0}function Fr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Kt(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ci(){this.uc=this.M=this.Nb=0,this.wa=Array(new on),this.Y=0,this.ya=Array(new Kt),this.aa=0,this.l=new gs}function Mi(){this.y=s(16),this.f=s(8),this.ea=s(8)}function ha(){this.cb=this.a=0,this.sc="",this.m=new k,this.Od=new ke,this.Kc=new Me,this.ed=new In,this.Qa=new en,this.Ic=this.$c=this.Aa=0,this.D=new ci,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,k),this.ia=0,this.pb=a(4,Fr),this.Pa=new an,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Mi),this.Hd=0,this.rb=Array(new mr),this.sb=0,this.wa=Array(new on),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Kt),this.L=this.aa=0,this.gd=o([4,2],on),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function ei(u,f){return 0>u?0:u>f?f:u}function gs(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ya(){var u=new ha;return u!=null&&(u.a=0,u.sc="OK",u.cb=0,u.Xb=0,Xl||(Xl=Fi)),u}function dn(u,f,v){return u.a==0&&(u.a=f,u.sc=v,u.cb=0),0}function vs(u,f,v){return 3<=v&&u[f+0]==157&&u[f+1]==1&&u[f+2]==42}function fr(u,f){if(u==null)return 0;if(u.a=0,u.sc="OK",f==null)return dn(u,2,"null VP8Io passed to VP8GetHeaders()");var v=f.data,x=f.w,N=f.ha;if(4>N)return dn(u,7,"Truncated header.");var T=v[x+0]|v[x+1]<<8|v[x+2]<<16,R=u.Od;if(R.Rb=!(1&T),R.td=T>>1&7,R.yd=T>>4&1,R.ub=T>>5,3<R.td)return dn(u,3,"Incorrect keyframe parameters.");if(!R.yd)return dn(u,4,"Frame not displayable.");x+=3,N-=3;var B=u.Kc;if(R.Rb){if(7>N)return dn(u,7,"cannot parse picture header");if(!vs(v,x,N))return dn(u,3,"Bad code word");B.c=16383&(v[x+4]<<8|v[x+3]),B.Td=v[x+4]>>6,B.i=16383&(v[x+6]<<8|v[x+5]),B.Ud=v[x+6]>>6,x+=7,N-=7,u.za=B.c+15>>4,u.Ub=B.i+15>>4,f.width=B.c,f.height=B.i,f.Da=0,f.j=0,f.v=0,f.va=f.width,f.o=f.height,f.da=0,f.ib=f.width,f.hb=f.height,f.U=f.width,f.T=f.height,i((T=u.Pa).jb,0,255,T.jb.length),e((T=u.Qa)!=null),T.Cb=0,T.Bb=0,T.Fb=1,i(T.Zb,0,0,T.Zb.length),i(T.Lb,0,0,T.Lb)}if(R.ub>N)return dn(u,7,"bad partition length");G(T=u.m,v,x,R.ub),x+=R.ub,N-=R.ub,R.Rb&&(B.Ld=pe(T),B.Kd=pe(T)),B=u.Qa;var $,z=u.Pa;if(e(T!=null),e(B!=null),B.Cb=pe(T),B.Cb){if(B.Bb=pe(T),pe(T)){for(B.Fb=pe(T),$=0;4>$;++$)B.Zb[$]=pe(T)?X(T,7):0;for($=0;4>$;++$)B.Lb[$]=pe(T)?X(T,6):0}if(B.Bb)for($=0;3>$;++$)z.jb[$]=pe(T)?te(T,8):255}else B.Bb=0;if(T.Ka)return dn(u,3,"cannot parse segment header");if((B=u.ed).zd=pe(T),B.Tb=te(T,6),B.wb=te(T,3),B.Pc=pe(T),B.Pc&&pe(T)){for(z=0;4>z;++z)pe(T)&&(B.vd[z]=X(T,6));for(z=0;4>z;++z)pe(T)&&(B.od[z]=X(T,6))}if(u.L=B.Tb==0?0:B.zd?1:2,T.Ka)return dn(u,3,"cannot parse filter header");var re=N;if(N=$=x,x=$+re,B=re,u.Xb=(1<<te(u.m,2))-1,re<3*(z=u.Xb))v=7;else{for($+=3*z,B-=3*z,re=0;re<z;++re){var ve=v[N+0]|v[N+1]<<8|v[N+2]<<16;ve>B&&(ve=B),G(u.Jc[+re],v,$,ve),$+=ve,B-=ve,N+=3}G(u.Jc[+z],v,$,B),v=$<x?0:5}if(v!=0)return dn(u,v,"cannot parse partitions");for(v=te($=u.m,7),N=pe($)?X($,4):0,x=pe($)?X($,4):0,B=pe($)?X($,4):0,z=pe($)?X($,4):0,$=pe($)?X($,4):0,re=u.Qa,ve=0;4>ve;++ve){if(re.Cb){var H=re.Zb[ve];re.Fb||(H+=v)}else{if(0<ve){u.pb[ve]=u.pb[0];continue}H=v}var ie=u.pb[ve];ie.Sc[0]=ch[ei(H+N,127)],ie.Sc[1]=uh[ei(H+0,127)],ie.Eb[0]=2*ch[ei(H+x,127)],ie.Eb[1]=101581*uh[ei(H+B,127)]>>16,8>ie.Eb[1]&&(ie.Eb[1]=8),ie.Qc[0]=ch[ei(H+z,117)],ie.Qc[1]=uh[ei(H+$,127)],ie.lc=H+$}if(!R.Rb)return dn(u,4,"Not a key frame.");for(pe(T),R=u.Pa,v=0;4>v;++v){for(N=0;8>N;++N)for(x=0;3>x;++x)for(B=0;11>B;++B)z=be(T,yy[v][N][x][B])?te(T,8):vy[v][N][x][B],R.Wc[v][N].Yb[x][B]=z;for(N=0;17>N;++N)R.Xc[v][N]=R.Wc[v][wy[N]]}return u.kc=pe(T),u.kc&&(u.Bd=te(T,8)),u.cb=1}function Fi(u,f,v,x,N,T,R){var B=f[N].Yb[v];for(v=0;16>N;++N){if(!be(u,B[v+0]))return N;for(;!be(u,B[v+1]);)if(B=f[++N].Yb[0],v=0,N==16)return 16;var $=f[N+1].Yb;if(be(u,B[v+2])){var z=u,re=0;if(be(z,(H=B)[(ve=v)+3]))if(be(z,H[ve+6])){for(B=0,ve=2*(re=be(z,H[ve+8]))+(H=be(z,H[ve+9+re])),re=0,H=my[ve];H[B];++B)re+=re+be(z,H[B]);re+=3+(8<<ve)}else be(z,H[ve+7])?(re=7+2*be(z,165),re+=be(z,145)):re=5+be(z,159);else re=be(z,H[ve+4])?3+be(z,H[ve+5]):2;B=$[2]}else re=1,B=$[1];$=R+gy[N],0>(z=u).b&&oe(z);var ve,H=z.b,ie=(ve=z.Ca>>1)-(z.I>>H)>>31;--z.b,z.Ca+=ie,z.Ca|=1,z.I-=(ve+1&ie)<<H,T[$]=((re^ie)-ie)*x[(0<N)+0]}return 16}function js(u){var f=u.rb[u.sb-1];f.la=0,f.Na=0,i(u.zc,0,0,u.zc.length),u.ja=0}function Tr(u,f,v,x,N){N=u[f+v+32*x]+(N>>3),u[f+v+32*x]=-256&N?0>N?0:255:N}function On(u,f,v,x,N,T){Tr(u,f,0,v,x+N),Tr(u,f,1,v,x+T),Tr(u,f,2,v,x-T),Tr(u,f,3,v,x-N)}function ui(u){return(20091*u>>16)+u}function fa(u,f,v,x){var N,T=0,R=s(16);for(N=0;4>N;++N){var B=u[f+0]+u[f+8],$=u[f+0]-u[f+8],z=(35468*u[f+4]>>16)-ui(u[f+12]),re=ui(u[f+4])+(35468*u[f+12]>>16);R[T+0]=B+re,R[T+1]=$+z,R[T+2]=$-z,R[T+3]=B-re,T+=4,f++}for(N=T=0;4>N;++N)B=(u=R[T+0]+4)+R[T+8],$=u-R[T+8],z=(35468*R[T+4]>>16)-ui(R[T+12]),Tr(v,x,0,0,B+(re=ui(R[T+4])+(35468*R[T+12]>>16))),Tr(v,x,1,0,$+z),Tr(v,x,2,0,$-z),Tr(v,x,3,0,B-re),T++,x+=32}function $s(u,f,v,x){var N=u[f+0]+4,T=35468*u[f+4]>>16,R=ui(u[f+4]),B=35468*u[f+1]>>16;On(v,x,0,N+R,u=ui(u[f+1]),B),On(v,x,1,N+T,u,B),On(v,x,2,N-T,u,B),On(v,x,3,N-R,u,B)}function Ja(u,f,v,x,N){fa(u,f,v,x),N&&fa(u,f+16,v,x+4)}function ti(u,f,v,x){lo(u,f+0,v,x,1),lo(u,f+32,v,x+128,1)}function Ni(u,f,v,x){var N;for(u=u[f+0]+4,N=0;4>N;++N)for(f=0;4>f;++f)Tr(v,x,f,N,u)}function Cr(u,f,v,x){u[f+0]&&nn(u,f+0,v,x),u[f+16]&&nn(u,f+16,v,x+4),u[f+32]&&nn(u,f+32,v,x+128),u[f+48]&&nn(u,f+48,v,x+128+4)}function Ir(u,f,v,x){var N,T=s(16);for(N=0;4>N;++N){var R=u[f+0+N]+u[f+12+N],B=u[f+4+N]+u[f+8+N],$=u[f+4+N]-u[f+8+N],z=u[f+0+N]-u[f+12+N];T[0+N]=R+B,T[8+N]=R-B,T[4+N]=z+$,T[12+N]=z-$}for(N=0;4>N;++N)R=(u=T[0+4*N]+3)+T[3+4*N],B=T[1+4*N]+T[2+4*N],$=T[1+4*N]-T[2+4*N],z=u-T[3+4*N],v[x+0]=R+B>>3,v[x+16]=z+$>>3,v[x+32]=R-B>>3,v[x+48]=z-$>>3,x+=64}function gr(u,f,v){var x,N=f-32,T=pi,R=255-u[N-1];for(x=0;x<v;++x){var B,$=T,z=R+u[f-1];for(B=0;B<v;++B)u[f+B]=$[z+u[N+B]];f+=32}}function Xa(u,f){gr(u,f,4)}function ni(u,f){gr(u,f,8)}function Za(u,f){gr(u,f,16)}function Ms(u,f){var v;for(v=0;16>v;++v)r(u,f+32*v,u,f-32,16)}function pa(u,f){var v;for(v=16;0<v;--v)i(u,f,u[f-1],16),f+=32}function Ur(u,f,v){var x;for(x=0;16>x;++x)i(f,v+32*x,u,16)}function ma(u,f){var v,x=16;for(v=0;16>v;++v)x+=u[f-1+32*v]+u[f+v-32];Ur(x>>5,u,f)}function Rn(u,f){var v,x=8;for(v=0;16>v;++v)x+=u[f-1+32*v];Ur(x>>4,u,f)}function bs(u,f){var v,x=8;for(v=0;16>v;++v)x+=u[f+v-32];Ur(x>>4,u,f)}function ga(u,f){Ur(128,u,f)}function vt(u,f,v){return u+2*f+v+2>>2}function Fs(u,f){var v,x=f-32;for(x=new Uint8Array([vt(u[x-1],u[x+0],u[x+1]),vt(u[x+0],u[x+1],u[x+2]),vt(u[x+1],u[x+2],u[x+3]),vt(u[x+2],u[x+3],u[x+4])]),v=0;4>v;++v)r(u,f+32*v,x,0,x.length)}function ys(u,f){var v=u[f-1],x=u[f-1+32],N=u[f-1+64],T=u[f-1+96];xe(u,f+0,16843009*vt(u[f-1-32],v,x)),xe(u,f+32,16843009*vt(v,x,N)),xe(u,f+64,16843009*vt(x,N,T)),xe(u,f+96,16843009*vt(N,T,T))}function Qa(u,f){var v,x=4;for(v=0;4>v;++v)x+=u[f+v-32]+u[f-1+32*v];for(x>>=3,v=0;4>v;++v)i(u,f+32*v,x,4)}function ri(u,f){var v=u[f-1+0],x=u[f-1+32],N=u[f-1+64],T=u[f-1-32],R=u[f+0-32],B=u[f+1-32],$=u[f+2-32],z=u[f+3-32];u[f+0+96]=vt(x,N,u[f-1+96]),u[f+1+96]=u[f+0+64]=vt(v,x,N),u[f+2+96]=u[f+1+64]=u[f+0+32]=vt(T,v,x),u[f+3+96]=u[f+2+64]=u[f+1+32]=u[f+0+0]=vt(R,T,v),u[f+3+64]=u[f+2+32]=u[f+1+0]=vt(B,R,T),u[f+3+32]=u[f+2+0]=vt($,B,R),u[f+3+0]=vt(z,$,B)}function zr(u,f){var v=u[f+1-32],x=u[f+2-32],N=u[f+3-32],T=u[f+4-32],R=u[f+5-32],B=u[f+6-32],$=u[f+7-32];u[f+0+0]=vt(u[f+0-32],v,x),u[f+1+0]=u[f+0+32]=vt(v,x,N),u[f+2+0]=u[f+1+32]=u[f+0+64]=vt(x,N,T),u[f+3+0]=u[f+2+32]=u[f+1+64]=u[f+0+96]=vt(N,T,R),u[f+3+32]=u[f+2+64]=u[f+1+96]=vt(T,R,B),u[f+3+64]=u[f+2+96]=vt(R,B,$),u[f+3+96]=vt(B,$,$)}function va(u,f){var v=u[f-1+0],x=u[f-1+32],N=u[f-1+64],T=u[f-1-32],R=u[f+0-32],B=u[f+1-32],$=u[f+2-32],z=u[f+3-32];u[f+0+0]=u[f+1+64]=T+R+1>>1,u[f+1+0]=u[f+2+64]=R+B+1>>1,u[f+2+0]=u[f+3+64]=B+$+1>>1,u[f+3+0]=$+z+1>>1,u[f+0+96]=vt(N,x,v),u[f+0+64]=vt(x,v,T),u[f+0+32]=u[f+1+96]=vt(v,T,R),u[f+1+32]=u[f+2+96]=vt(T,R,B),u[f+2+32]=u[f+3+96]=vt(R,B,$),u[f+3+32]=vt(B,$,z)}function ii(u,f){var v=u[f+0-32],x=u[f+1-32],N=u[f+2-32],T=u[f+3-32],R=u[f+4-32],B=u[f+5-32],$=u[f+6-32],z=u[f+7-32];u[f+0+0]=v+x+1>>1,u[f+1+0]=u[f+0+64]=x+N+1>>1,u[f+2+0]=u[f+1+64]=N+T+1>>1,u[f+3+0]=u[f+2+64]=T+R+1>>1,u[f+0+32]=vt(v,x,N),u[f+1+32]=u[f+0+96]=vt(x,N,T),u[f+2+32]=u[f+1+96]=vt(N,T,R),u[f+3+32]=u[f+2+96]=vt(T,R,B),u[f+3+64]=vt(R,B,$),u[f+3+96]=vt(B,$,z)}function Ui(u,f){var v=u[f-1+0],x=u[f-1+32],N=u[f-1+64],T=u[f-1+96];u[f+0+0]=v+x+1>>1,u[f+2+0]=u[f+0+32]=x+N+1>>1,u[f+2+32]=u[f+0+64]=N+T+1>>1,u[f+1+0]=vt(v,x,N),u[f+3+0]=u[f+1+32]=vt(x,N,T),u[f+3+32]=u[f+1+64]=vt(N,T,T),u[f+3+64]=u[f+2+64]=u[f+0+96]=u[f+1+96]=u[f+2+96]=u[f+3+96]=T}function zi(u,f){var v=u[f-1+0],x=u[f-1+32],N=u[f-1+64],T=u[f-1+96],R=u[f-1-32],B=u[f+0-32],$=u[f+1-32],z=u[f+2-32];u[f+0+0]=u[f+2+32]=v+R+1>>1,u[f+0+32]=u[f+2+64]=x+v+1>>1,u[f+0+64]=u[f+2+96]=N+x+1>>1,u[f+0+96]=T+N+1>>1,u[f+3+0]=vt(B,$,z),u[f+2+0]=vt(R,B,$),u[f+1+0]=u[f+3+32]=vt(v,R,B),u[f+1+32]=u[f+3+64]=vt(x,v,R),u[f+1+64]=u[f+3+96]=vt(N,x,v),u[f+1+96]=vt(T,N,x)}function Hi(u,f){var v;for(v=0;8>v;++v)r(u,f+32*v,u,f-32,8)}function eo(u,f){var v;for(v=0;8>v;++v)i(u,f,u[f-1],8),f+=32}function y(u,f,v){var x;for(x=0;8>x;++x)i(f,v+32*x,u,8)}function D(u,f){var v,x=8;for(v=0;8>v;++v)x+=u[f+v-32]+u[f-1+32*v];y(x>>4,u,f)}function J(u,f){var v,x=4;for(v=0;8>v;++v)x+=u[f+v-32];y(x>>3,u,f)}function we(u,f){var v,x=4;for(v=0;8>v;++v)x+=u[f-1+32*v];y(x>>3,u,f)}function Et(u,f){y(128,u,f)}function We(u,f,v){var x=u[f-v],N=u[f+0],T=3*(N-x)+ih[1020+u[f-2*v]-u[f+v]],R=gu[112+(T+4>>3)];u[f-v]=pi[255+x+gu[112+(T+3>>3)]],u[f+0]=pi[255+N-R]}function Ut(u,f,v,x){var N=u[f+0],T=u[f+v];return Ci[255+u[f-2*v]-u[f-v]]>x||Ci[255+T-N]>x}function jt(u,f,v,x){return 4*Ci[255+u[f-v]-u[f+0]]+Ci[255+u[f-2*v]-u[f+v]]<=x}function bn(u,f,v,x,N){var T=u[f-3*v],R=u[f-2*v],B=u[f-v],$=u[f+0],z=u[f+v],re=u[f+2*v],ve=u[f+3*v];return 4*Ci[255+B-$]+Ci[255+R-z]>x?0:Ci[255+u[f-4*v]-T]<=N&&Ci[255+T-R]<=N&&Ci[255+R-B]<=N&&Ci[255+ve-re]<=N&&Ci[255+re-z]<=N&&Ci[255+z-$]<=N}function zt(u,f,v,x){var N=2*x+1;for(x=0;16>x;++x)jt(u,f+x,v,N)&&We(u,f+x,v)}function Bn(u,f,v,x){var N=2*x+1;for(x=0;16>x;++x)jt(u,f+x*v,1,N)&&We(u,f+x*v,1)}function nr(u,f,v,x){var N;for(N=3;0<N;--N)zt(u,f+=4*v,v,x)}function Ln(u,f,v,x){var N;for(N=3;0<N;--N)Bn(u,f+=4,v,x)}function yn(u,f,v,x,N,T,R,B){for(T=2*T+1;0<N--;){if(bn(u,f,v,T,R))if(Ut(u,f,v,B))We(u,f,v);else{var $=u,z=f,re=v,ve=$[z-2*re],H=$[z-re],ie=$[z+0],de=$[z+re],_e=$[z+2*re],ge=27*(Ee=ih[1020+3*(ie-H)+ih[1020+ve-de]])+63>>7,Ae=18*Ee+63>>7,Ee=9*Ee+63>>7;$[z-3*re]=pi[255+$[z-3*re]+Ee],$[z-2*re]=pi[255+ve+Ae],$[z-re]=pi[255+H+ge],$[z+0]=pi[255+ie-ge],$[z+re]=pi[255+de-Ae],$[z+2*re]=pi[255+_e-Ee]}f+=x}}function hn(u,f,v,x,N,T,R,B){for(T=2*T+1;0<N--;){if(bn(u,f,v,T,R))if(Ut(u,f,v,B))We(u,f,v);else{var $=u,z=f,re=v,ve=$[z-re],H=$[z+0],ie=$[z+re],de=gu[112+(4+(_e=3*(H-ve))>>3)],_e=gu[112+(_e+3>>3)],ge=de+1>>1;$[z-2*re]=pi[255+$[z-2*re]+ge],$[z-re]=pi[255+ve+_e],$[z+0]=pi[255+H-de],$[z+re]=pi[255+ie-ge]}f+=x}}function di(u,f,v,x,N,T){yn(u,f,v,1,16,x,N,T)}function vr(u,f,v,x,N,T){yn(u,f,1,v,16,x,N,T)}function ki(u,f,v,x,N,T){var R;for(R=3;0<R;--R)hn(u,f+=4*v,v,1,16,x,N,T)}function g(u,f,v,x,N,T){var R;for(R=3;0<R;--R)hn(u,f+=4,1,v,16,x,N,T)}function E(u,f,v,x,N,T,R,B){yn(u,f,N,1,8,T,R,B),yn(v,x,N,1,8,T,R,B)}function F(u,f,v,x,N,T,R,B){yn(u,f,1,N,8,T,R,B),yn(v,x,1,N,8,T,R,B)}function Z(u,f,v,x,N,T,R,B){hn(u,f+4*N,N,1,8,T,R,B),hn(v,x+4*N,N,1,8,T,R,B)}function ce(u,f,v,x,N,T,R,B){hn(u,f+4,1,N,8,T,R,B),hn(v,x+4,1,N,8,T,R,B)}function Se(){this.ba=new St,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new qt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ce(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Ze(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function lt(){this.ua=0,this.Wa=new xt,this.vb=new xt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Y,this.yc=new C}function Lt(){this.xb=this.a=0,this.l=new gs,this.ca=new St,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new q,this.Pb=0,this.wd=new q,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new lt,this.ab=0,this.gc=a(4,Ze),this.Oc=0}function Pt(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new gs,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Xt(u,f,v,x,N,T,R){for(u=u==null?0:u[f+0],f=0;f<R;++f)N[T+f]=u+v[x+f]&255,u=N[T+f]}function Pn(u,f,v,x,N,T,R){var B;if(u==null)Xt(null,null,v,x,N,T,R);else for(B=0;B<R;++B)N[T+B]=u[f+B]+v[x+B]&255}function Yn(u,f,v,x,N,T,R){if(u==null)Xt(null,null,v,x,N,T,R);else{var B,$=u[f+0],z=$,re=$;for(B=0;B<R;++B)z=re+($=u[f+B])-z,re=v[x+B]+(-256&z?0>z?0:255:z)&255,z=$,N[T+B]=re}}function wn(u,f,v,x){var N=f.width,T=f.o;if(e(u!=null&&f!=null),0>v||0>=x||v+x>T)return null;if(!u.Cc){if(u.ga==null){var R;if(u.ga=new Pt,(R=u.ga==null)||(R=f.width*f.o,e(u.Gb.length==0),u.Gb=s(R),u.Uc=0,u.Gb==null?R=0:(u.mb=u.Gb,u.nb=u.Uc,u.rc=null,R=1),R=!R),!R){R=u.ga;var B=u.Fa,$=u.P,z=u.qc,re=u.mb,ve=u.nb,H=$+1,ie=z-1,de=R.l;if(e(B!=null&&re!=null&&f!=null),La[0]=null,La[1]=Xt,La[2]=Pn,La[3]=Yn,R.ca=re,R.tb=ve,R.c=f.width,R.i=f.height,e(0<R.c&&0<R.i),1>=z)f=0;else if(R.$a=3&B[$+0],R.Z=B[$+0]>>2&3,R.Lc=B[$+0]>>4&3,$=B[$+0]>>6&3,0>R.$a||1<R.$a||4<=R.Z||1<R.Lc||$)f=0;else if(de.put=dt,de.ac=Fn,de.bc=Cn,de.ma=R,de.width=f.width,de.height=f.height,de.Da=f.Da,de.v=f.v,de.va=f.va,de.j=f.j,de.o=f.o,R.$a)e:{e(R.$a==1),f=Qr();t:for(;;){if(f==null){f=0;break e}if(e(R!=null),R.mc=f,f.c=R.c,f.i=R.i,f.l=R.l,f.l.ma=R,f.l.width=R.c,f.l.height=R.i,f.a=0,ae(f.m,B,H,ie),!Lr(R.c,R.i,1,f,null)||(f.ab==1&&f.gc[0].hc==3&&dr(f.s)?(R.ic=1,B=f.c*f.i,f.Ta=null,f.Ua=0,f.V=s(B),f.Ba=0,f.V==null?(f.a=1,f=0):f=1):(R.ic=0,f=ze(f,R.c)),!f))break t;f=1;break e}R.mc=null,f=0}else f=ie>=R.c*R.i;R=!f}if(R)return null;u.ga.Lc!=1?u.Ga=0:x=T-v}e(u.ga!=null),e(v+x<=T);e:{if(f=(B=u.ga).c,T=B.l.o,B.$a==0){if(H=u.rc,ie=u.Vc,de=u.Fa,$=u.P+1+v*f,z=u.mb,re=u.nb+v*f,e($<=u.P+u.qc),B.Z!=0)for(e(La[B.Z]!=null),R=0;R<x;++R)La[B.Z](H,ie,de,$,z,re,f),H=z,ie=re,re+=f,$+=f;else for(R=0;R<x;++R)r(z,re,de,$,f),H=z,ie=re,re+=f,$+=f;u.rc=H,u.Vc=ie}else{if(e(B.mc!=null),f=v+x,e((R=B.mc)!=null),e(f<=R.i),R.C>=f)f=1;else if(B.ic||Wi(),B.ic){B=R.V,H=R.Ba,ie=R.c;var _e=R.i,ge=(de=1,$=R.$/ie,z=R.$%ie,re=R.m,ve=R.s,R.$),Ae=ie*_e,Ee=ie*f,Pe=ve.wc,Ie=ge<Ee?Ft(ve,z,$):null;e(ge<=Ae),e(f<=_e),e(dr(ve));t:for(;;){for(;!re.h&&ge<Ee;){if(z&Pe||(Ie=Ft(ve,z,$)),e(Ie!=null),se(re),256>(_e=Mt(Ie.G[0],Ie.H[0],re)))B[H+ge]=_e,++ge,++z>=ie&&(z=0,++$<=f&&!($%16)&&hr(R,$));else{if(!(280>_e)){de=0;break t}_e=er(_e-256,re);var ht,Ve=Mt(Ie.G[4],Ie.H[4],re);if(se(re),!(ge>=(Ve=ur(ie,Ve=er(Ve,re)))&&Ae-ge>=_e)){de=0;break t}for(ht=0;ht<_e;++ht)B[H+ge+ht]=B[H+ge+ht-Ve];for(ge+=_e,z+=_e;z>=ie;)z-=ie,++$<=f&&!($%16)&&hr(R,$);ge<Ee&&z&Pe&&(Ie=Ft(ve,z,$))}e(re.h==U(re))}hr(R,$>f?f:$);break t}!de||re.h&&ge<Ae?(de=0,R.a=re.h?5:3):R.$=ge,f=de}else f=tn(R,R.V,R.Ba,R.c,R.i,f,ee);if(!f){x=0;break e}}v+x>=T&&(u.Cc=1),x=1}if(!x)return null;if(u.Cc&&((x=u.ga)!=null&&(x.mc=null),u.ga=null,0<u.Ga))return alert("todo:WebPDequantizeLevels"),null}return u.nb+v*N}function rr(u,f,v,x,N,T){for(;0<N--;){var R,B=u,$=f+(v?1:0),z=u,re=f+(v?0:3);for(R=0;R<x;++R){var ve=z[re+4*R];ve!=255&&(ve*=32897,B[$+4*R+0]=B[$+4*R+0]*ve>>23,B[$+4*R+1]=B[$+4*R+1]*ve>>23,B[$+4*R+2]=B[$+4*R+2]*ve>>23)}f+=T}}function Jn(u,f,v,x,N){for(;0<x--;){var T;for(T=0;T<v;++T){var R=u[f+2*T+0],B=15&(z=u[f+2*T+1]),$=4369*B,z=(240&z|z>>4)*$>>16;u[f+2*T+0]=(240&R|R>>4)*$>>16&240|(15&R|R<<4)*$>>16>>4&15,u[f+2*T+1]=240&z|B}f+=N}}function br(u,f,v,x,N,T,R,B){var $,z,re=255;for(z=0;z<N;++z){for($=0;$<x;++$){var ve=u[f+$];T[R+4*$]=ve,re&=ve}f+=v,R+=B}return re!=255}function Us(u,f,v,x,N){var T;for(T=0;T<N;++T)v[x+T]=u[f+T]>>8}function Wi(){Jl=rr,Tm=Jn,Cm=br,Im=Us}function zs(u,f,v){V[u]=function(x,N,T,R,B,$,z,re,ve,H,ie,de,_e,ge,Ae,Ee,Pe){var Ie,ht=Pe-1>>1,Ve=B[$+0]|z[re+0]<<16,Dt=ve[H+0]|ie[de+0]<<16;e(x!=null);var nt=3*Ve+Dt+131074>>2;for(f(x[N+0],255&nt,nt>>16,_e,ge),T!=null&&(nt=3*Dt+Ve+131074>>2,f(T[R+0],255&nt,nt>>16,Ae,Ee)),Ie=1;Ie<=ht;++Ie){var Gt=B[$+Ie]|z[re+Ie]<<16,sr=ve[H+Ie]|ie[de+Ie]<<16,Bt=Ve+Gt+Dt+sr+524296,rt=Bt+2*(Gt+Dt)>>3;nt=rt+Ve>>1,Ve=(Bt=Bt+2*(Ve+sr)>>3)+Gt>>1,f(x[N+2*Ie-1],255&nt,nt>>16,_e,ge+(2*Ie-1)*v),f(x[N+2*Ie-0],255&Ve,Ve>>16,_e,ge+(2*Ie-0)*v),T!=null&&(nt=Bt+Dt>>1,Ve=rt+sr>>1,f(T[R+2*Ie-1],255&nt,nt>>16,Ae,Ee+(2*Ie-1)*v),f(T[R+2*Ie+0],255&Ve,Ve>>16,Ae,Ee+(2*Ie+0)*v)),Ve=Gt,Dt=sr}1&Pe||(nt=3*Ve+Dt+131074>>2,f(x[N+Pe-1],255&nt,nt>>16,_e,ge+(Pe-1)*v),T!=null&&(nt=3*Dt+Ve+131074>>2,f(T[R+Pe-1],255&nt,nt>>16,Ae,Ee+(Pe-1)*v)))}}function $l(){Ii[vu]=xy,Ii[bu]=Um,Ii[qm]=Ay,Ii[yu]=zm,Ii[wu]=Hm,Ii[sh]=Wm,Ii[jm]=Sy,Ii[ah]=Um,Ii[oh]=zm,Ii[_u]=Hm,Ii[lh]=Wm}function zo(u){return u&-16384?0>u?0:255:u>>Ey}function ba(u,f){return zo((19077*u>>8)+(26149*f>>8)-14234)}function to(u,f,v){return zo((19077*u>>8)-(6419*f>>8)-(13320*v>>8)+8708)}function no(u,f){return zo((19077*u>>8)+(33050*f>>8)-17685)}function ya(u,f,v,x,N){x[N+0]=ba(u,v),x[N+1]=to(u,f,v),x[N+2]=no(u,f)}function yr(u,f,v,x,N){x[N+0]=no(u,f),x[N+1]=to(u,f,v),x[N+2]=ba(u,v)}function ro(u,f,v,x,N){var T=to(u,f,v);f=T<<3&224|no(u,f)>>3,x[N+0]=248&ba(u,v)|T>>5,x[N+1]=f}function io(u,f,v,x,N){var T=240&no(u,f)|15;x[N+0]=240&ba(u,v)|to(u,f,v)>>4,x[N+1]=T}function Ml(u,f,v,x,N){x[N+0]=255,ya(u,f,v,x,N+1)}function Fl(u,f,v,x,N){yr(u,f,v,x,N),x[N+3]=255}function Hr(u,f,v,x,N){ya(u,f,v,x,N),x[N+3]=255}function Hs(u,f,v){V[u]=function(x,N,T,R,B,$,z,re,ve){for(var H=re+(-2&ve)*v;re!=H;)f(x[N+0],T[R+0],B[$+0],z,re),f(x[N+1],T[R+0],B[$+0],z,re+v),N+=2,++R,++$,re+=2*v;1&ve&&f(x[N+0],T[R+0],B[$+0],z,re)}}function Ho(u,f,v){return v==0?u==0?f==0?6:5:f==0?4:0:v}function fu(u,f,v,x,N){switch(u>>>30){case 3:lo(f,v,x,N,0);break;case 2:Ti(f,v,x,N);break;case 1:nn(f,v,x,N)}}function Li(u,f){var v,x,N=f.M,T=f.Nb,R=u.oc,B=u.pc+40,$=u.oc,z=u.pc+584,re=u.oc,ve=u.pc+600;for(v=0;16>v;++v)R[B+32*v-1]=129;for(v=0;8>v;++v)$[z+32*v-1]=129,re[ve+32*v-1]=129;for(0<N?R[B-1-32]=$[z-1-32]=re[ve-1-32]=129:(i(R,B-32-1,127,21),i($,z-32-1,127,9),i(re,ve-32-1,127,9)),x=0;x<u.za;++x){var H=f.ya[f.aa+x];if(0<x){for(v=-1;16>v;++v)r(R,B+32*v-4,R,B+32*v+12,4);for(v=-1;8>v;++v)r($,z+32*v-4,$,z+32*v+4,4),r(re,ve+32*v-4,re,ve+32*v+4,4)}var ie=u.Gd,de=u.Hd+x,_e=H.ad,ge=H.Hc;if(0<N&&(r(R,B-32,ie[de].y,0,16),r($,z-32,ie[de].f,0,8),r(re,ve-32,ie[de].ea,0,8)),H.Za){var Ae=R,Ee=B-32+16;for(0<N&&(x>=u.za-1?i(Ae,Ee,ie[de].y[15],4):r(Ae,Ee,ie[de+1].y,0,4)),v=0;4>v;v++)Ae[Ee+128+v]=Ae[Ee+256+v]=Ae[Ee+384+v]=Ae[Ee+0+v];for(v=0;16>v;++v,ge<<=2)Ae=R,Ee=B+Gm[v],Vi[H.Ob[v]](Ae,Ee),fu(ge,_e,16*+v,Ae,Ee)}else if(Ae=Ho(x,N,H.Ob[0]),ka[Ae](R,B),ge!=0)for(v=0;16>v;++v,ge<<=2)fu(ge,_e,16*+v,R,B+Gm[v]);for(v=H.Gc,Ae=Ho(x,N,H.Dd),Gs[Ae]($,z),Gs[Ae](re,ve),ge=_e,Ae=$,Ee=z,255&(H=0|v)&&(170&H?xs(ge,256,Ae,Ee):fn(ge,256,Ae,Ee)),H=re,ge=ve,255&(v>>=8)&&(170&v?xs(_e,320,H,ge):fn(_e,320,H,ge)),N<u.Ub-1&&(r(ie[de].y,0,R,B+480,16),r(ie[de].f,0,$,z+224,8),r(ie[de].ea,0,re,ve+224,8)),v=8*T*u.B,ie=u.sa,de=u.ta+16*x+16*T*u.R,_e=u.qa,H=u.ra+8*x+v,ge=u.Ha,Ae=u.Ia+8*x+v,v=0;16>v;++v)r(ie,de+v*u.R,R,B+32*v,16);for(v=0;8>v;++v)r(_e,H+v*u.B,$,z+32*v,8),r(ge,Ae+v*u.B,re,ve+32*v,8)}}function so(u,f,v,x,N,T,R,B,$){var z=[0],re=[0],ve=0,H=$!=null?$.kd:0,ie=$??new Ce;if(u==null||12>v)return 7;ie.data=u,ie.w=f,ie.ha=v,f=[f],v=[v],ie.gb=[ie.gb];e:{var de=f,_e=v,ge=ie.gb;if(e(u!=null),e(_e!=null),e(ge!=null),ge[0]=0,12<=_e[0]&&!t(u,de[0],"RIFF")){if(t(u,de[0]+8,"WEBP")){ge=3;break e}var Ae=qe(u,de[0]+4);if(12>Ae||4294967286<Ae){ge=3;break e}if(H&&Ae>_e[0]-8){ge=7;break e}ge[0]=Ae,de[0]+=12,_e[0]-=12}ge=0}if(ge!=0)return ge;for(Ae=0<ie.gb[0],v=v[0];;){e:{var Ee=u;_e=f,ge=v;var Pe=z,Ie=re,ht=de=[0];if((nt=ve=[ve])[0]=0,8>ge[0])ge=7;else{if(!t(Ee,_e[0],"VP8X")){if(qe(Ee,_e[0]+4)!=10){ge=3;break e}if(18>ge[0]){ge=7;break e}var Ve=qe(Ee,_e[0]+8),Dt=1+Te(Ee,_e[0]+12);if(2147483648<=Dt*(Ee=1+Te(Ee,_e[0]+15))){ge=3;break e}ht!=null&&(ht[0]=Ve),Pe!=null&&(Pe[0]=Dt),Ie!=null&&(Ie[0]=Ee),_e[0]+=18,ge[0]-=18,nt[0]=1}ge=0}}if(ve=ve[0],de=de[0],ge!=0)return ge;if(_e=!!(2&de),!Ae&&ve)return 3;if(T!=null&&(T[0]=!!(16&de)),R!=null&&(R[0]=_e),B!=null&&(B[0]=0),R=z[0],de=re[0],ve&&_e&&$==null){ge=0;break}if(4>v){ge=7;break}if(Ae&&ve||!Ae&&!ve&&!t(u,f[0],"ALPH")){v=[v],ie.na=[ie.na],ie.P=[ie.P],ie.Sa=[ie.Sa];e:{Ve=u,ge=f,Ae=v;var nt=ie.gb;Pe=ie.na,Ie=ie.P,ht=ie.Sa,Dt=22,e(Ve!=null),e(Ae!=null),Ee=ge[0];var Gt=Ae[0];for(e(Pe!=null),e(ht!=null),Pe[0]=null,Ie[0]=null,ht[0]=0;;){if(ge[0]=Ee,Ae[0]=Gt,8>Gt){ge=7;break e}var sr=qe(Ve,Ee+4);if(4294967286<sr){ge=3;break e}var Bt=8+sr+1&-2;if(Dt+=Bt,0<nt&&Dt>nt){ge=3;break e}if(!t(Ve,Ee,"VP8 ")||!t(Ve,Ee,"VP8L")){ge=0;break e}if(Gt[0]<Bt){ge=7;break e}t(Ve,Ee,"ALPH")||(Pe[0]=Ve,Ie[0]=Ee+8,ht[0]=sr),Ee+=Bt,Gt-=Bt}}if(v=v[0],ie.na=ie.na[0],ie.P=ie.P[0],ie.Sa=ie.Sa[0],ge!=0)break}v=[v],ie.Ja=[ie.Ja],ie.xa=[ie.xa];e:if(nt=u,ge=f,Ae=v,Pe=ie.gb[0],Ie=ie.Ja,ht=ie.xa,Ve=ge[0],Ee=!t(nt,Ve,"VP8 "),Dt=!t(nt,Ve,"VP8L"),e(nt!=null),e(Ae!=null),e(Ie!=null),e(ht!=null),8>Ae[0])ge=7;else{if(Ee||Dt){if(nt=qe(nt,Ve+4),12<=Pe&&nt>Pe-12){ge=3;break e}if(H&&nt>Ae[0]-8){ge=7;break e}Ie[0]=nt,ge[0]+=8,Ae[0]-=8,ht[0]=Dt}else ht[0]=5<=Ae[0]&&nt[Ve+0]==47&&!(nt[Ve+4]>>5),Ie[0]=Ae[0];ge=0}if(v=v[0],ie.Ja=ie.Ja[0],ie.xa=ie.xa[0],f=f[0],ge!=0)break;if(4294967286<ie.Ja)return 3;if(B==null||_e||(B[0]=ie.xa?2:1),R=[R],de=[de],ie.xa){if(5>v){ge=7;break}B=R,H=de,_e=T,u==null||5>v?u=0:5<=v&&u[f+0]==47&&!(u[f+4]>>5)?(Ae=[0],nt=[0],Pe=[0],ae(Ie=new q,u,f,v),Nr(Ie,Ae,nt,Pe)?(B!=null&&(B[0]=Ae[0]),H!=null&&(H[0]=nt[0]),_e!=null&&(_e[0]=Pe[0]),u=1):u=0):u=0}else{if(10>v){ge=7;break}B=de,u==null||10>v||!vs(u,f+3,v-3)?u=0:(H=u[f+0]|u[f+1]<<8|u[f+2]<<16,_e=16383&(u[f+7]<<8|u[f+6]),u=16383&(u[f+9]<<8|u[f+8]),1&H||3<(H>>1&7)||!(H>>4&1)||H>>5>=ie.Ja||!_e||!u?u=0:(R&&(R[0]=_e),B&&(B[0]=u),u=1))}if(!u||(R=R[0],de=de[0],ve&&(z[0]!=R||re[0]!=de)))return 3;$!=null&&($[0]=ie,$.offset=f-$.w,e(4294967286>f-$.w),e($.offset==$.ha-v));break}return ge==0||ge==7&&ve&&$==null?(T!=null&&(T[0]|=ie.na!=null&&0<ie.na.length),x!=null&&(x[0]=R),N!=null&&(N[0]=de),0):ge}function Ul(u,f,v){var x=f.width,N=f.height,T=0,R=0,B=x,$=N;if(f.Da=u!=null&&0<u.Da,f.Da&&(B=u.cd,$=u.bd,T=u.v,R=u.j,11>v||(T&=-2,R&=-2),0>T||0>R||0>=B||0>=$||T+B>x||R+$>N))return 0;if(f.v=T,f.j=R,f.va=T+B,f.o=R+$,f.U=B,f.T=$,f.da=u!=null&&0<u.da,f.da){if(!Qe(B,$,v=[u.ib],T=[u.hb]))return 0;f.ib=v[0],f.hb=T[0]}return f.ob=u!=null&&u.ob,f.Kb=u==null||!u.Sd,f.da&&(f.ob=f.ib<3*x/4&&f.hb<3*N/4,f.Kb=0),1}function zl(u){if(u==null)return 2;if(11>u.S){var f=u.f.RGBA;f.fb+=(u.height-1)*f.A,f.A=-f.A}else f=u.f.kb,u=u.height,f.O+=(u-1)*f.fa,f.fa=-f.fa,f.N+=(u-1>>1)*f.Ab,f.Ab=-f.Ab,f.W+=(u-1>>1)*f.Db,f.Db=-f.Db,f.F!=null&&(f.J+=(u-1)*f.lb,f.lb=-f.lb);return 0}function wa(u,f,v,x){if(x==null||0>=u||0>=f)return 2;if(v!=null){if(v.Da){var N=v.cd,T=v.bd,R=-2&v.v,B=-2&v.j;if(0>R||0>B||0>=N||0>=T||R+N>u||B+T>f)return 2;u=N,f=T}if(v.da){if(!Qe(u,f,N=[v.ib],T=[v.hb]))return 2;u=N[0],f=T[0]}}x.width=u,x.height=f;e:{var $=x.width,z=x.height;if(u=x.S,0>=$||0>=z||!(u>=vu&&13>u))u=2;else{if(0>=x.Rd&&x.sd==null){R=T=N=f=0;var re=(B=$*Km[u])*z;if(11>u||(T=(z+1)/2*(f=($+1)/2),u==12&&(R=(N=$)*z)),(z=s(re+2*T+R))==null){u=1;break e}x.sd=z,11>u?(($=x.f.RGBA).eb=z,$.fb=0,$.A=B,$.size=re):(($=x.f.kb).y=z,$.O=0,$.fa=B,$.Fd=re,$.f=z,$.N=0+re,$.Ab=f,$.Cd=T,$.ea=z,$.W=0+re+T,$.Db=f,$.Ed=T,u==12&&($.F=z,$.J=0+re+2*T),$.Tc=R,$.lb=N)}if(f=1,N=x.S,T=x.width,R=x.height,N>=vu&&13>N)if(11>N)u=x.f.RGBA,f&=(B=Math.abs(u.A))*(R-1)+T<=u.size,f&=B>=T*Km[N],f&=u.eb!=null;else{u=x.f.kb,B=(T+1)/2,re=(R+1)/2,$=Math.abs(u.fa),z=Math.abs(u.Ab);var ve=Math.abs(u.Db),H=Math.abs(u.lb),ie=H*(R-1)+T;f&=$*(R-1)+T<=u.Fd,f&=z*(re-1)+B<=u.Cd,f=(f&=ve*(re-1)+B<=u.Ed)&$>=T&z>=B&ve>=B,f&=u.y!=null,f&=u.f!=null,f&=u.ea!=null,N==12&&(f&=H>=T,f&=ie<=u.Tc,f&=u.F!=null)}else f=0;u=f?0:2}}return u!=0||v!=null&&v.fd&&(u=zl(x)),u}var ao=64,hi=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],fi=24,_a=32,Ws=8,xa=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];$e("Predictor0","PredictorAdd0"),V.Predictor0=function(){return 4278190080},V.Predictor1=function(u){return u},V.Predictor2=function(u,f,v){return f[v+0]},V.Predictor3=function(u,f,v){return f[v+1]},V.Predictor4=function(u,f,v){return f[v-1]},V.Predictor5=function(u,f,v){return tt(tt(u,f[v+1]),f[v+0])},V.Predictor6=function(u,f,v){return tt(u,f[v-1])},V.Predictor7=function(u,f,v){return tt(u,f[v+0])},V.Predictor8=function(u,f,v){return tt(f[v-1],f[v+0])},V.Predictor9=function(u,f,v){return tt(f[v+0],f[v+1])},V.Predictor10=function(u,f,v){return tt(tt(u,f[v-1]),tt(f[v+0],f[v+1]))},V.Predictor11=function(u,f,v){var x=f[v+0];return 0>=mt(x>>24&255,u>>24&255,(f=f[v-1])>>24&255)+mt(x>>16&255,u>>16&255,f>>16&255)+mt(x>>8&255,u>>8&255,f>>8&255)+mt(255&x,255&u,255&f)?x:u},V.Predictor12=function(u,f,v){var x=f[v+0];return(Tt((u>>24&255)+(x>>24&255)-((f=f[v-1])>>24&255))<<24|Tt((u>>16&255)+(x>>16&255)-(f>>16&255))<<16|Tt((u>>8&255)+(x>>8&255)-(f>>8&255))<<8|Tt((255&u)+(255&x)-(255&f)))>>>0},V.Predictor13=function(u,f,v){var x=f[v-1];return(At((u=tt(u,f[v+0]))>>24&255,x>>24&255)<<24|At(u>>16&255,x>>16&255)<<16|At(u>>8&255,x>>8&255)<<8|At(255&u,255&x))>>>0};var Hl=V.PredictorAdd0;V.PredictorAdd1=gt,$e("Predictor2","PredictorAdd2"),$e("Predictor3","PredictorAdd3"),$e("Predictor4","PredictorAdd4"),$e("Predictor5","PredictorAdd5"),$e("Predictor6","PredictorAdd6"),$e("Predictor7","PredictorAdd7"),$e("Predictor8","PredictorAdd8"),$e("Predictor9","PredictorAdd9"),$e("Predictor10","PredictorAdd10"),$e("Predictor11","PredictorAdd11"),$e("Predictor12","PredictorAdd12"),$e("Predictor13","PredictorAdd13");var Wo=V.PredictorAdd2;He("ColorIndexInverseTransform","MapARGB","32b",function(u){return u>>8&255},function(u){return u}),He("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(u){return u},function(u){return u>>8&255});var Un,pu=V.ColorIndexInverseTransform,ws=V.MapARGB,_s=V.VP8LColorIndexInverseTransformAlpha,Wl=V.MapAlpha,Vl=V.VP8LPredictorsAdd=[];Vl.length=16,(V.VP8LPredictors=[]).length=16,(V.VP8LPredictorsAdd_C=[]).length=16,(V.VP8LPredictors_C=[]).length=16;var Gl,Kl,Aa,Sa,Ea,oo,Na,lo,Ti,xs,nn,fn,zn,ir,Vs,Yl,Vo,mu,Am,Sm,Em,Nm,km,Lm,Jl,Tm,Cm,Im,Om=s(511),Rm=s(2041),Pm=s(225),Dm=s(767),Bm=0,ih=Rm,gu=Pm,pi=Dm,Ci=Om,vu=0,bu=1,qm=2,yu=3,wu=4,sh=5,jm=6,ah=7,oh=8,_u=9,lh=10,ly=[2,3,7],cy=[3,3,11],$m=[280,256,256,256,40],uy=[0,1,1,1,0],dy=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],hy=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],fy=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],py=8,ch=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],uh=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Xl=null,my=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],gy=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Mm=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],vy=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],by=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],yy=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],wy=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ka=[],Vi=[],Gs=[],_y=1,Fm=2,La=[],Ii=[];zs("UpsampleRgbLinePair",ya,3),zs("UpsampleBgrLinePair",yr,3),zs("UpsampleRgbaLinePair",Hr,4),zs("UpsampleBgraLinePair",Fl,4),zs("UpsampleArgbLinePair",Ml,4),zs("UpsampleRgba4444LinePair",io,2),zs("UpsampleRgb565LinePair",ro,2);var xy=V.UpsampleRgbLinePair,Ay=V.UpsampleBgrLinePair,Um=V.UpsampleRgbaLinePair,zm=V.UpsampleBgraLinePair,Hm=V.UpsampleArgbLinePair,Wm=V.UpsampleRgba4444LinePair,Sy=V.UpsampleRgb565LinePair,xu=16,Au=1<<xu-1,Zl=-227,dh=482,Ey=6,Vm=0,Ny=s(256),ky=s(256),Ly=s(256),Ty=s(256),Cy=s(dh-Zl),Iy=s(dh-Zl);Hs("YuvToRgbRow",ya,3),Hs("YuvToBgrRow",yr,3),Hs("YuvToRgbaRow",Hr,4),Hs("YuvToBgraRow",Fl,4),Hs("YuvToArgbRow",Ml,4),Hs("YuvToRgba4444Row",io,2),Hs("YuvToRgb565Row",ro,2);var Gm=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Su=[0,2,8],Oy=[8,7,6,4,4,2,2,2,1,1,1,1],Ry=1;this.WebPDecodeRGBA=function(u,f,v,x,N){var T=bu,R=new Se,B=new St;R.ba=B,B.S=T,B.width=[B.width],B.height=[B.height];var $=B.width,z=B.height,re=new et;if(re==null||u==null)var ve=2;else e(re!=null),ve=so(u,f,v,re.width,re.height,re.Pd,re.Qd,re.format,null);if(ve!=0?$=0:($!=null&&($[0]=re.width[0]),z!=null&&(z[0]=re.height[0]),$=1),$){B.width=B.width[0],B.height=B.height[0],x!=null&&(x[0]=B.width),N!=null&&(N[0]=B.height);e:{if(x=new gs,(N=new Ce).data=u,N.w=f,N.ha=v,N.kd=1,f=[0],e(N!=null),((u=so(N.data,N.w,N.ha,null,null,null,f,null,N))==0||u==7)&&f[0]&&(u=4),(f=u)==0){if(e(R!=null),x.data=N.data,x.w=N.w+N.offset,x.ha=N.ha-N.offset,x.put=dt,x.ac=Fn,x.bc=Cn,x.ma=R,N.xa){if((u=Qr())==null){R=1;break e}if((function(H,ie){var de=[0],_e=[0],ge=[0];t:for(;;){if(H==null)return 0;if(ie==null)return H.a=2,0;if(H.l=ie,H.a=0,ae(H.m,ie.data,ie.w,ie.ha),!Nr(H.m,de,_e,ge)){H.a=3;break t}if(H.xb=Fm,ie.width=de[0],ie.height=_e[0],!Lr(de[0],_e[0],1,H,null))break t;return 1}return e(H.a!=0),0})(u,x)){if(x=(f=wa(x.width,x.height,R.Oa,R.ba))==0){t:{x=u;n:for(;;){if(x==null){x=0;break t}if(e(x.s.yc!=null),e(x.s.Ya!=null),e(0<x.s.Wb),e((v=x.l)!=null),e((N=v.ma)!=null),x.xb!=0){if(x.ca=N.ba,x.tb=N.tb,e(x.ca!=null),!Ul(N.Oa,v,yu)){x.a=2;break n}if(!ze(x,v.width)||v.da)break n;if((v.da||Xe(x.ca.S))&&Wi(),11>x.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),x.ca.f.kb.F!=null&&Wi()),x.Pb&&0<x.s.ua&&x.s.vb.X==null&&!j(x.s.vb,x.s.Wa.Xa)){x.a=1;break n}x.xb=0}if(!tn(x,x.V,x.Ba,x.c,x.i,v.o,kr))break n;N.Dc=x.Ma,x=1;break t}e(x.a!=0),x=0}x=!x}x&&(f=u.a)}else f=u.a}else{if((u=new Ya)==null){R=1;break e}if(u.Fa=N.na,u.P=N.P,u.qc=N.Sa,fr(u,x)){if((f=wa(x.width,x.height,R.Oa,R.ba))==0){if(u.Aa=0,v=R.Oa,e((N=u)!=null),v!=null){if(0<($=0>($=v.Md)?0:100<$?255:255*$/100)){for(z=re=0;4>z;++z)12>(ve=N.pb[z]).lc&&(ve.ia=$*Oy[0>ve.lc?0:ve.lc]>>3),re|=ve.ia;re&&(alert("todo:VP8InitRandom"),N.ia=1)}N.Ga=v.Id,100<N.Ga?N.Ga=100:0>N.Ga&&(N.Ga=0)}(function(H,ie){if(H==null)return 0;if(ie==null)return dn(H,2,"NULL VP8Io parameter in VP8Decode().");if(!H.cb&&!fr(H,ie))return 0;if(e(H.cb),ie.ac==null||ie.ac(ie)){ie.ob&&(H.L=0);var de=Su[H.L];if(H.L==2?(H.yb=0,H.zb=0):(H.yb=ie.v-de>>4,H.zb=ie.j-de>>4,0>H.yb&&(H.yb=0),0>H.zb&&(H.zb=0)),H.Va=ie.o+15+de>>4,H.Hb=ie.va+15+de>>4,H.Hb>H.za&&(H.Hb=H.za),H.Va>H.Ub&&(H.Va=H.Ub),0<H.L){var _e=H.ed;for(de=0;4>de;++de){var ge;if(H.Qa.Cb){var Ae=H.Qa.Lb[de];H.Qa.Fb||(Ae+=_e.Tb)}else Ae=_e.Tb;for(ge=0;1>=ge;++ge){var Ee=H.gd[de][ge],Pe=Ae;if(_e.Pc&&(Pe+=_e.vd[0],ge&&(Pe+=_e.od[0])),0<(Pe=0>Pe?0:63<Pe?63:Pe)){var Ie=Pe;0<_e.wb&&(Ie=4<_e.wb?Ie>>2:Ie>>1)>9-_e.wb&&(Ie=9-_e.wb),1>Ie&&(Ie=1),Ee.dd=Ie,Ee.tc=2*Pe+Ie,Ee.ld=40<=Pe?2:15<=Pe?1:0}else Ee.tc=0;Ee.La=ge}}}de=0}else dn(H,6,"Frame setup failed"),de=H.a;if(de=de==0){if(de){H.$c=0,0<H.Aa||(H.Ic=Ry);t:{de=H.Ic,_e=4*(Ie=H.za);var ht=32*Ie,Ve=Ie+1,Dt=0<H.L?Ie*(0<H.Aa?2:1):0,nt=(H.Aa==2?2:1)*Ie;if((Ee=_e+832+(ge=3*(16*de+Su[H.L])/2*ht)+(Ae=H.Fa!=null&&0<H.Fa.length?H.Kc.c*H.Kc.i:0))!=Ee)de=0;else{if(Ee>H.Vb){if(H.Vb=0,H.Ec=s(Ee),H.Fc=0,H.Ec==null){de=dn(H,1,"no memory during frame initialization.");break t}H.Vb=Ee}Ee=H.Ec,Pe=H.Fc,H.Ac=Ee,H.Bc=Pe,Pe+=_e,H.Gd=a(ht,Mi),H.Hd=0,H.rb=a(Ve+1,mr),H.sb=1,H.wa=Dt?a(Dt,on):null,H.Y=0,H.D.Nb=0,H.D.wa=H.wa,H.D.Y=H.Y,0<H.Aa&&(H.D.Y+=Ie),e(!0),H.oc=Ee,H.pc=Pe,Pe+=832,H.ya=a(nt,Kt),H.aa=0,H.D.ya=H.ya,H.D.aa=H.aa,H.Aa==2&&(H.D.aa+=Ie),H.R=16*Ie,H.B=8*Ie,Ie=(ht=Su[H.L])*H.R,ht=ht/2*H.B,H.sa=Ee,H.ta=Pe+Ie,H.qa=H.sa,H.ra=H.ta+16*de*H.R+ht,H.Ha=H.qa,H.Ia=H.ra+8*de*H.B+ht,H.$c=0,Pe+=ge,H.mb=Ae?Ee:null,H.nb=Ae?Pe:null,e(Pe+Ae<=H.Fc+H.Vb),js(H),i(H.Ac,H.Bc,0,_e),de=1}}if(de){if(ie.ka=0,ie.y=H.sa,ie.O=H.ta,ie.f=H.qa,ie.N=H.ra,ie.ea=H.Ha,ie.Vd=H.Ia,ie.fa=H.R,ie.Rc=H.B,ie.F=null,ie.J=0,!Bm){for(de=-255;255>=de;++de)Om[255+de]=0>de?-de:de;for(de=-1020;1020>=de;++de)Rm[1020+de]=-128>de?-128:127<de?127:de;for(de=-112;112>=de;++de)Pm[112+de]=-16>de?-16:15<de?15:de;for(de=-255;510>=de;++de)Dm[255+de]=0>de?0:255<de?255:de;Bm=1}Na=Ir,lo=Ja,xs=ti,nn=Ni,fn=Cr,Ti=$s,zn=di,ir=vr,Vs=E,Yl=F,Vo=ki,mu=g,Am=Z,Sm=ce,Em=zt,Nm=Bn,km=nr,Lm=Ln,Vi[0]=Qa,Vi[1]=Xa,Vi[2]=Fs,Vi[3]=ys,Vi[4]=ri,Vi[5]=va,Vi[6]=zr,Vi[7]=ii,Vi[8]=zi,Vi[9]=Ui,ka[0]=ma,ka[1]=Za,ka[2]=Ms,ka[3]=pa,ka[4]=Rn,ka[5]=bs,ka[6]=ga,Gs[0]=D,Gs[1]=ni,Gs[2]=Hi,Gs[3]=eo,Gs[4]=we,Gs[5]=J,Gs[6]=Et,de=1}else de=0}de&&(de=(function(Gt,sr){for(Gt.M=0;Gt.M<Gt.Va;++Gt.M){var Bt,rt=Gt.Jc[Gt.M&Gt.Xb],je=Gt.m,Hn=Gt;for(Bt=0;Bt<Hn.za;++Bt){var It=je,Yt=Hn,Sn=Yt.Ac,wr=Yt.Bc+4*Bt,Wr=Yt.zc,qn=Yt.ya[Yt.aa+Bt];if(Yt.Qa.Bb?qn.$b=be(It,Yt.Pa.jb[0])?2+be(It,Yt.Pa.jb[2]):be(It,Yt.Pa.jb[1]):qn.$b=0,Yt.kc&&(qn.Ad=be(It,Yt.Bd)),qn.Za=!be(It,145)+0,qn.Za){var Or=qn.Ob,Vr=0;for(Yt=0;4>Yt;++Yt){var ar,Zt=Wr[0+Yt];for(ar=0;4>ar;++ar){Zt=by[Sn[wr+ar]][Zt];for(var ln=Mm[be(It,Zt[0])];0<ln;)ln=Mm[2*ln+be(It,Zt[ln])];Zt=-ln,Sn[wr+ar]=Zt}r(Or,Vr,Sn,wr,4),Vr+=4,Wr[0+Yt]=Zt}}else Zt=be(It,156)?be(It,128)?1:3:be(It,163)?2:0,qn.Ob[0]=Zt,i(Sn,wr,Zt,4),i(Wr,0,Zt,4);qn.Dd=be(It,142)?be(It,114)?be(It,183)?1:3:2:0}if(Hn.m.Ka)return dn(Gt,7,"Premature end-of-partition0 encountered.");for(;Gt.ja<Gt.za;++Gt.ja){if(Hn=rt,It=(je=Gt).rb[je.sb-1],Sn=je.rb[je.sb+je.ja],Bt=je.ya[je.aa+je.ja],wr=je.kc?Bt.Ad:0)It.la=Sn.la=0,Bt.Za||(It.Na=Sn.Na=0),Bt.Hc=0,Bt.Gc=0,Bt.ia=0;else{var jn,cn;if(It=Sn,Sn=Hn,wr=je.Pa.Xc,Wr=je.ya[je.aa+je.ja],qn=je.pb[Wr.$b],Yt=Wr.ad,Or=0,Vr=je.rb[je.sb-1],Zt=ar=0,i(Yt,Or,0,384),Wr.Za)var _r=0,Gi=wr[3];else{ln=s(16);var Wn=It.Na+Vr.Na;if(Wn=Xl(Sn,wr[1],Wn,qn.Eb,0,ln,0),It.Na=Vr.Na=(0<Wn)+0,1<Wn)Na(ln,0,Yt,Or);else{var si=ln[0]+3>>3;for(ln=0;256>ln;ln+=16)Yt[Or+ln]=si}_r=1,Gi=wr[0]}var pn=15&It.la,or=15&Vr.la;for(ln=0;4>ln;++ln){var mi=1&or;for(si=cn=0;4>si;++si)pn=pn>>1|(mi=(Wn=Xl(Sn,Gi,Wn=mi+(1&pn),qn.Sc,_r,Yt,Or))>_r)<<7,cn=cn<<2|(3<Wn?3:1<Wn?2:Yt[Or+0]!=0),Or+=16;pn>>=4,or=or>>1|mi<<7,ar=(ar<<8|cn)>>>0}for(Gi=pn,_r=or>>4,jn=0;4>jn;jn+=2){for(cn=0,pn=It.la>>4+jn,or=Vr.la>>4+jn,ln=0;2>ln;++ln){for(mi=1&or,si=0;2>si;++si)Wn=mi+(1&pn),pn=pn>>1|(mi=0<(Wn=Xl(Sn,wr[2],Wn,qn.Qc,0,Yt,Or)))<<3,cn=cn<<2|(3<Wn?3:1<Wn?2:Yt[Or+0]!=0),Or+=16;pn>>=2,or=or>>1|mi<<5}Zt|=cn<<4*jn,Gi|=pn<<4<<jn,_r|=(240&or)<<jn}It.la=Gi,Vr.la=_r,Wr.Hc=ar,Wr.Gc=Zt,Wr.ia=43690&Zt?0:qn.ia,wr=!(ar|Zt)}if(0<je.L&&(je.wa[je.Y+je.ja]=je.gd[Bt.$b][Bt.Za],je.wa[je.Y+je.ja].La|=!wr),Hn.Ka)return dn(Gt,7,"Premature end-of-file encountered.")}if(js(Gt),je=sr,Hn=1,Bt=(rt=Gt).D,It=0<rt.L&&rt.M>=rt.zb&&rt.M<=rt.Va,rt.Aa==0)t:{if(Bt.M=rt.M,Bt.uc=It,Li(rt,Bt),Hn=1,Bt=(cn=rt.D).Nb,It=(Zt=Su[rt.L])*rt.R,Sn=Zt/2*rt.B,ln=16*Bt*rt.R,si=8*Bt*rt.B,wr=rt.sa,Wr=rt.ta-It+ln,qn=rt.qa,Yt=rt.ra-Sn+si,Or=rt.Ha,Vr=rt.Ia-Sn+si,or=(pn=cn.M)==0,ar=pn>=rt.Va-1,rt.Aa==2&&Li(rt,cn),cn.uc)for(mi=(Wn=rt).D.M,e(Wn.D.uc),cn=Wn.yb;cn<Wn.Hb;++cn){_r=cn,Gi=mi;var Gr=(gi=(xr=Wn).D).Nb;jn=xr.R;var gi=gi.wa[gi.Y+_r],vi=xr.sa,ai=xr.ta+16*Gr*jn+16*_r,bi=gi.dd,_n=gi.tc;if(_n!=0)if(e(3<=_n),xr.L==1)0<_r&&Nm(vi,ai,jn,_n+4),gi.La&&Lm(vi,ai,jn,_n),0<Gi&&Em(vi,ai,jn,_n+4),gi.La&&km(vi,ai,jn,_n);else{var yi=xr.B,Ki=xr.qa,co=xr.ra+8*Gr*yi+8*_r,Ks=xr.Ha,xr=xr.Ia+8*Gr*yi+8*_r;Gr=gi.ld,0<_r&&(ir(vi,ai,jn,_n+4,bi,Gr),Yl(Ki,co,Ks,xr,yi,_n+4,bi,Gr)),gi.La&&(mu(vi,ai,jn,_n,bi,Gr),Sm(Ki,co,Ks,xr,yi,_n,bi,Gr)),0<Gi&&(zn(vi,ai,jn,_n+4,bi,Gr),Vs(Ki,co,Ks,xr,yi,_n+4,bi,Gr)),gi.La&&(Vo(vi,ai,jn,_n,bi,Gr),Am(Ki,co,Ks,xr,yi,_n,bi,Gr))}}if(rt.ia&&alert("todo:DitherRow"),je.put!=null){if(cn=16*pn,pn=16*(pn+1),or?(je.y=rt.sa,je.O=rt.ta+ln,je.f=rt.qa,je.N=rt.ra+si,je.ea=rt.Ha,je.W=rt.Ia+si):(cn-=Zt,je.y=wr,je.O=Wr,je.f=qn,je.N=Yt,je.ea=Or,je.W=Vr),ar||(pn-=Zt),pn>je.o&&(pn=je.o),je.F=null,je.J=null,rt.Fa!=null&&0<rt.Fa.length&&cn<pn&&(je.J=wn(rt,je,cn,pn-cn),je.F=rt.mb,je.F==null&&je.F.length==0)){Hn=dn(rt,3,"Could not decode alpha data.");break t}cn<je.j&&(Zt=je.j-cn,cn=je.j,e(!(1&Zt)),je.O+=rt.R*Zt,je.N+=rt.B*(Zt>>1),je.W+=rt.B*(Zt>>1),je.F!=null&&(je.J+=je.width*Zt)),cn<pn&&(je.O+=je.v,je.N+=je.v>>1,je.W+=je.v>>1,je.F!=null&&(je.J+=je.v),je.ka=cn-je.j,je.U=je.va-je.v,je.T=pn-cn,Hn=je.put(je))}Bt+1!=rt.Ic||ar||(r(rt.sa,rt.ta-It,wr,Wr+16*rt.R,It),r(rt.qa,rt.ra-Sn,qn,Yt+8*rt.B,Sn),r(rt.Ha,rt.Ia-Sn,Or,Vr+8*rt.B,Sn))}if(!Hn)return dn(Gt,6,"Output aborted.")}return 1})(H,ie)),ie.bc!=null&&ie.bc(ie),de&=1}return de?(H.cb=0,de):0})(u,x)||(f=u.a)}}else f=u.a}f==0&&R.Oa!=null&&R.Oa.fd&&(f=zl(R.ba))}R=f}T=R!=0?null:11>T?B.f.RGBA.eb:B.f.kb.y}else T=null;return T};var Km=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(V,ue){for(var _="",L=0;L<4;L++)_+=String.fromCharCode(V[ue++]);return _}function d(V,ue){return V[ue+0]|V[ue+1]<<8}function m(V,ue){return(V[ue+0]|V[ue+1]<<8|V[ue+2]<<16)>>>0}function p(V,ue){return(V[ue+0]|V[ue+1]<<8|V[ue+2]<<16|V[ue+3]<<24)>>>0}new l;var h=[0],b=[0],w=[],S=new l,A=n,I=(function(V,ue){var _={},L=0,C=!1,M=0,Y=0;if(_.frames=[],!(function(k,q){for(var W=0;W<4;W++)if(k[q+W]!="RIFF".charCodeAt(W))return!0;return!1})(V,ue)){for(p(V,ue+=4),ue+=8;ue<V.length;){var G=c(V,ue),te=p(V,ue+=4);ue+=4;var X=te+(1&te);switch(G){case"VP8 ":case"VP8L":_.frames[L]===void 0&&(_.frames[L]={}),(fe=_.frames[L]).src_off=C?Y:ue-8,fe.src_size=M+te+8,L++,C&&(C=!1,M=0,Y=0);break;case"VP8X":(fe=_.header={}).feature_flags=V[ue];var ae=ue+4;fe.canvas_width=1+m(V,ae),ae+=3,fe.canvas_height=1+m(V,ae),ae+=3;break;case"ALPH":C=!0,M=X+8,Y=ue-8;break;case"ANIM":(fe=_.header).bgcolor=p(V,ue),ae=ue+4,fe.loop_count=d(V,ae),ae+=2;break;case"ANMF":var me,fe;(fe=_.frames[L]={}).offset_x=2*m(V,ue),ue+=3,fe.offset_y=2*m(V,ue),ue+=3,fe.width=1+m(V,ue),ue+=3,fe.height=1+m(V,ue),ue+=3,fe.duration=m(V,ue),ue+=3,me=V[ue++],fe.dispose=1&me,fe.blend=me>>1&1}G!="ANMF"&&(ue+=X)}return _}})(A,0);I.response=A,I.rgbaoutput=!0,I.dataurl=!1;var O=I.header?I.header:null,P=I.frames?I.frames:null;if(O){O.loop_counter=O.loop_count,h=[O.canvas_height],b=[O.canvas_width];for(var K=0;K<P.length&&P[K].blend!=0;K++);}var le=P[0],he=S.WebPDecodeRGBA(A,le.src_off,le.src_size,b,h);le.rgba=he,le.imgwidth=b[0],le.imgheight=h[0];for(var ne=0;ne<b[0]*h[0]*4;ne++)w[ne]=he[ne];return this.width=b,this.height=h,this.data=w,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function y8(){var n,e=this.internal.__metadata__.metadata,t=unescape(encodeURIComponent(e));n=this.internal.__metadata__.rawXml?t:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+n.length+" >>"),this.internal.write("stream"),this.internal.write(n),this.internal.write("endstream"),this.internal.write("endobj")}function w8(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(n){var e,t,r,i,s,a,o,l,c,d=function(k){return k=k||{},this.isStrokeTransparent=k.isStrokeTransparent||!1,this.strokeOpacity=k.strokeOpacity||1,this.strokeStyle=k.strokeStyle||"#000000",this.fillStyle=k.fillStyle||"#000000",this.isFillTransparent=k.isFillTransparent||!1,this.fillOpacity=k.fillOpacity||1,this.font=k.font||"10px sans-serif",this.textBaseline=k.textBaseline||"alphabetic",this.textAlign=k.textAlign||"left",this.lineWidth=k.lineWidth||1,this.lineJoin=k.lineJoin||"miter",this.lineCap=k.lineCap||"butt",this.path=k.path||[],this.transform=k.transform!==void 0?k.transform.clone():new l,this.globalCompositeOperation=k.globalCompositeOperation||"normal",this.globalAlpha=k.globalAlpha||1,this.clip_path=k.clip_path||[],this.currentPoint=k.currentPoint||new a,this.miterLimit=k.miterLimit||10,this.lastPoint=k.lastPoint||new a,this.lineDashOffset=k.lineDashOffset||0,this.lineDash=k.lineDash||[],this.margin=k.margin||[0,0,0,0],this.prevPageLastElemOffset=k.prevPageLastElemOffset||0,this.ignoreClearRect=typeof k.ignoreClearRect!="boolean"||k.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new m(this),e=this.internal.f2,t=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new d}]);var m=function(k){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var q=k;Object.defineProperty(this,"pdf",{get:function(){return q}});var W=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return W},set:function(j){W=!!j}});var U=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return U},set:function(j){U=!!j}});var Q=0;Object.defineProperty(this,"posX",{get:function(){return Q},set:function(j){isNaN(j)||(Q=j)}});var se=0;Object.defineProperty(this,"posY",{get:function(){return se},set:function(j){isNaN(j)||(se=j)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(j){var Be;typeof j=="number"?Be=[j,j,j,j]:((Be=new Array(4))[0]=j[0],Be[1]=j.length>=2?j[1]:Be[0],Be[2]=j.length>=3?j[2]:Be[0],Be[3]=j.length>=4?j[3]:Be[1]),c.margin=Be}});var oe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return oe},set:function(j){oe=j}});var pe=0;Object.defineProperty(this,"lastBreak",{get:function(){return pe},set:function(j){pe=j}});var be=[];Object.defineProperty(this,"pageBreaks",{get:function(){return be},set:function(j){be=j}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(j){j instanceof d&&(c=j)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(j){c.path=j}});var xe=[];Object.defineProperty(this,"ctxStack",{get:function(){return xe},set:function(j){xe=j}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(j){var Be;Be=p(j),this.ctx.fillStyle=Be.style,this.ctx.isFillTransparent=Be.a===0,this.ctx.fillOpacity=Be.a,this.pdf.setFillColor(Be.r,Be.g,Be.b,{a:Be.a}),this.pdf.setTextColor(Be.r,Be.g,Be.b,{a:Be.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(j){var Be=p(j);this.ctx.strokeStyle=Be.style,this.ctx.isStrokeTransparent=Be.a===0,this.ctx.strokeOpacity=Be.a,Be.a===0?this.pdf.setDrawColor(255,255,255):(Be.a,this.pdf.setDrawColor(Be.r,Be.g,Be.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(j){["butt","round","square"].indexOf(j)!==-1&&(this.ctx.lineCap=j,this.pdf.setLineCap(j))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(j){isNaN(j)||(this.ctx.lineWidth=j,this.pdf.setLineWidth(j))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(j){["bevel","round","miter"].indexOf(j)!==-1&&(this.ctx.lineJoin=j,this.pdf.setLineJoin(j))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(j){isNaN(j)||(this.ctx.miterLimit=j,this.pdf.setMiterLimit(j))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(j){this.ctx.textBaseline=j}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(j){["right","end","center","left","start"].indexOf(j)!==-1&&(this.ctx.textAlign=j)}});var Oe=null,Te=null,qe=null;Object.defineProperty(this,"fontFaces",{get:function(){return qe},set:function(j){Oe=null,Te=null,qe=j}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(j){var Be;if(this.ctx.font=j,(Be=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(j))!==null){var xt=Be[1];Be[2];var Qe=Be[3],Le=Be[4];Be[5];var Je=Be[6],$e=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Le)[2];Le=Math.floor($e==="px"?parseFloat(Le)*this.pdf.internal.scaleFactor:$e==="em"?parseFloat(Le)*this.pdf.getFontSize():parseFloat(Le)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Le);var st=(function(He){var sn,Ot,wt=[],ft=He.trim();if(ft==="")return mf;if(ft in z0)return[z0[ft]];for(;ft!=="";){switch(Ot=null,sn=(ft=W0(ft)).charAt(0)){case'"':case"'":Ot=f8(ft.substring(1),sn);break;default:Ot=p8(ft)}if(Ot===null||(wt.push(Ot[0]),(ft=W0(Ot[1]))!==""&&ft.charAt(0)!==","))return mf;ft=ft.replace(/^,/,"")}return wt})(Je);if(this.fontFaces){var tt=(function(He,sn){var Ot=He.getFontList(),wt=JSON.stringify(Ot);if(Oe===null||Te!==wt){var ft=(function(Wt){var Ke=[];return Object.keys(Wt).forEach(function($t){Wt[$t].forEach(function(Xe){var pt=null;switch(Xe){case"bold":pt={family:$t,weight:"bold"};break;case"italic":pt={family:$t,style:"italic"};break;case"bolditalic":pt={family:$t,weight:"bold",style:"italic"};break;case"":case"normal":pt={family:$t}}pt!==null&&(pt.ref={name:$t,style:Xe},Ke.push(pt))})}),Ke})(Ot);Oe=(function(Wt){for(var Ke={},$t=0;$t<Wt.length;++$t){var Xe=pf(Wt[$t]),pt=Xe.family,Vt=Xe.stretch,St=Xe.style,et=Xe.weight;Ke[pt]=Ke[pt]||{},Ke[pt][Vt]=Ke[pt][Vt]||{},Ke[pt][Vt][St]=Ke[pt][Vt][St]||{},Ke[pt][Vt][St][et]=Xe}return Ke})(ft.concat(sn)),Te=wt}return Oe})(this.pdf,this.fontFaces),Tt=st.map(function(He){return{family:He,stretch:"normal",weight:Qe,style:xt}}),At=(function(He,sn,Ot){for(var wt=(Ot=Ot||{}).defaultFontFamily||"times",ft=Object.assign({},h8,Ot.genericFontFamilies||{}),Wt=null,Ke=null,$t=0;$t<sn.length;++$t)if(ft[(Wt=pf(sn[$t])).family]&&(Wt.family=ft[Wt.family]),He.hasOwnProperty(Wt.family)){Ke=He[Wt.family];break}if(!(Ke=Ke||He[wt]))throw new Error("Could not find a font-family for the rule '"+H0(Wt)+"' and default family '"+wt+"'.");if(Ke=(function(Xe,pt){if(pt[Xe])return pt[Xe];var Vt=vp[Xe],St=Vt<=vp.normal?-1:1,et=U0(pt,G2,Vt,St);if(!et)throw new Error("Could not find a matching font-stretch value for "+Xe);return et})(Wt.stretch,Ke),Ke=(function(Xe,pt){if(pt[Xe])return pt[Xe];for(var Vt=V2[Xe],St=0;St<Vt.length;++St)if(pt[Vt[St]])return pt[Vt[St]];throw new Error("Could not find a matching font-style for "+Xe)})(Wt.style,Ke),!(Ke=(function(Xe,pt){if(pt[Xe])return pt[Xe];if(Xe===400&&pt[500])return pt[500];if(Xe===500&&pt[400])return pt[400];var Vt=d8[Xe],St=U0(pt,K2,Vt,Xe<400?-1:1);if(!St)throw new Error("Could not find a matching font-weight for value "+Xe);return St})(Wt.weight,Ke)))throw new Error("Failed to resolve a font for the rule '"+H0(Wt)+"'.");return Ke})(tt,Tt);this.pdf.setFont(At.ref.name,At.ref.style)}else{var mt="";(Qe==="bold"||parseInt(Qe,10)>=700||xt==="bold")&&(mt="bold"),xt==="italic"&&(mt+="italic"),mt.length===0&&(mt="normal");for(var gt="",Nt={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Ue=0;Ue<st.length;Ue++){if(this.pdf.internal.getFont(st[Ue],mt,{noFallback:!0,disableWarning:!0})!==void 0){gt=st[Ue];break}if(mt==="bolditalic"&&this.pdf.internal.getFont(st[Ue],"bold",{noFallback:!0,disableWarning:!0})!==void 0)gt=st[Ue],mt="bold";else if(this.pdf.internal.getFont(st[Ue],"normal",{noFallback:!0,disableWarning:!0})!==void 0){gt=st[Ue],mt="normal";break}}if(gt===""){for(var ut=0;ut<st.length;ut++)if(Nt[st[ut]]){gt=Nt[st[ut]];break}}gt=gt===""?"Times":gt,this.pdf.setFont(gt,mt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(j){this.ctx.globalCompositeOperation=j}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(j){this.ctx.globalAlpha=j}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(j){this.ctx.lineDashOffset=j,fe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(j){this.ctx.lineDash=j,fe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(j){this.ctx.ignoreClearRect=!!j}})};m.prototype.setLineDash=function(k){this.lineDash=k},m.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},m.prototype.fill=function(){P.call(this,"fill",!1)},m.prototype.stroke=function(){P.call(this,"stroke",!1)},m.prototype.beginPath=function(){this.path=[{type:"begin"}]},m.prototype.moveTo=function(k,q){if(isNaN(k)||isNaN(q))throw mn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var W=this.ctx.transform.applyToPoint(new a(k,q));this.path.push({type:"mt",x:W.x,y:W.y}),this.ctx.lastPoint=new a(k,q)},m.prototype.closePath=function(){var k=new a(0,0),q=0;for(q=this.path.length-1;q!==-1;q--)if(this.path[q].type==="begin"&&un(this.path[q+1])==="object"&&typeof this.path[q+1].x=="number"){k=new a(this.path[q+1].x,this.path[q+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(k.x,k.y)},m.prototype.lineTo=function(k,q){if(isNaN(k)||isNaN(q))throw mn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var W=this.ctx.transform.applyToPoint(new a(k,q));this.path.push({type:"lt",x:W.x,y:W.y}),this.ctx.lastPoint=new a(W.x,W.y)},m.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),P.call(this,null,!0)},m.prototype.quadraticCurveTo=function(k,q,W,U){if(isNaN(W)||isNaN(U)||isNaN(k)||isNaN(q))throw mn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Q=this.ctx.transform.applyToPoint(new a(W,U)),se=this.ctx.transform.applyToPoint(new a(k,q));this.path.push({type:"qct",x1:se.x,y1:se.y,x:Q.x,y:Q.y}),this.ctx.lastPoint=new a(Q.x,Q.y)},m.prototype.bezierCurveTo=function(k,q,W,U,Q,se){if(isNaN(Q)||isNaN(se)||isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U))throw mn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var oe=this.ctx.transform.applyToPoint(new a(Q,se)),pe=this.ctx.transform.applyToPoint(new a(k,q)),be=this.ctx.transform.applyToPoint(new a(W,U));this.path.push({type:"bct",x1:pe.x,y1:pe.y,x2:be.x,y2:be.y,x:oe.x,y:oe.y}),this.ctx.lastPoint=new a(oe.x,oe.y)},m.prototype.arc=function(k,q,W,U,Q,se){if(isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U)||isNaN(Q))throw mn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(se=!!se,!this.ctx.transform.isIdentity){var oe=this.ctx.transform.applyToPoint(new a(k,q));k=oe.x,q=oe.y;var pe=this.ctx.transform.applyToPoint(new a(0,W)),be=this.ctx.transform.applyToPoint(new a(0,0));W=Math.sqrt(Math.pow(pe.x-be.x,2)+Math.pow(pe.y-be.y,2))}Math.abs(Q-U)>=2*Math.PI&&(U=0,Q=2*Math.PI),this.path.push({type:"arc",x:k,y:q,radius:W,startAngle:U,endAngle:Q,counterclockwise:se})},m.prototype.arcTo=function(k,q,W,U,Q){throw new Error("arcTo not implemented.")},m.prototype.rect=function(k,q,W,U){if(isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U))throw mn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(k,q),this.lineTo(k+W,q),this.lineTo(k+W,q+U),this.lineTo(k,q+U),this.lineTo(k,q),this.lineTo(k+W,q),this.lineTo(k,q)},m.prototype.fillRect=function(k,q,W,U){if(isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U))throw mn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!h.call(this)){var Q={};this.lineCap!=="butt"&&(Q.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Q.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(k,q,W,U),this.fill(),Q.hasOwnProperty("lineCap")&&(this.lineCap=Q.lineCap),Q.hasOwnProperty("lineJoin")&&(this.lineJoin=Q.lineJoin)}},m.prototype.strokeRect=function(k,q,W,U){if(isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U))throw mn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");b.call(this)||(this.beginPath(),this.rect(k,q,W,U),this.stroke())},m.prototype.clearRect=function(k,q,W,U){if(isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U))throw mn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(k,q,W,U))},m.prototype.save=function(k){k=typeof k!="boolean"||k;for(var q=this.pdf.internal.getCurrentPageInfo().pageNumber,W=0;W<this.pdf.internal.getNumberOfPages();W++)this.pdf.setPage(W+1),this.pdf.internal.out("q");if(this.pdf.setPage(q),k){this.ctx.fontSize=this.pdf.internal.getFontSize();var U=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=U}},m.prototype.restore=function(k){k=typeof k!="boolean"||k;for(var q=this.pdf.internal.getCurrentPageInfo().pageNumber,W=0;W<this.pdf.internal.getNumberOfPages();W++)this.pdf.setPage(W+1),this.pdf.internal.out("Q");this.pdf.setPage(q),k&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},m.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var p=function(k){var q,W,U,Q;if(k.isCanvasGradient===!0&&(k=k.getColor()),!k)return{r:0,g:0,b:0,a:0,style:k};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(k))q=0,W=0,U=0,Q=0;else{var se=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(k);if(se!==null)q=parseInt(se[1]),W=parseInt(se[2]),U=parseInt(se[3]),Q=1;else if((se=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(k))!==null)q=parseInt(se[1]),W=parseInt(se[2]),U=parseInt(se[3]),Q=parseFloat(se[4]);else{if(Q=1,typeof k=="string"&&k.charAt(0)!=="#"){var oe=new $2(k);k=oe.ok?oe.toHex():"#000000"}k.length===4?(q=k.substring(1,2),q+=q,W=k.substring(2,3),W+=W,U=k.substring(3,4),U+=U):(q=k.substring(1,3),W=k.substring(3,5),U=k.substring(5,7)),q=parseInt(q,16),W=parseInt(W,16),U=parseInt(U,16)}}return{r:q,g:W,b:U,a:Q,style:k}},h=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},b=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};m.prototype.fillText=function(k,q,W,U){if(isNaN(q)||isNaN(W)||typeof k!="string")throw mn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(U=isNaN(U)?void 0:U,!h.call(this)){var Q=X(this.ctx.transform.rotation),se=this.ctx.transform.scaleX;L.call(this,{text:k,x:q,y:W,scale:se,angle:Q,align:this.textAlign,maxWidth:U})}},m.prototype.strokeText=function(k,q,W,U){if(isNaN(q)||isNaN(W)||typeof k!="string")throw mn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!b.call(this)){U=isNaN(U)?void 0:U;var Q=X(this.ctx.transform.rotation),se=this.ctx.transform.scaleX;L.call(this,{text:k,x:q,y:W,scale:se,renderingMode:"stroke",angle:Q,align:this.textAlign,maxWidth:U})}},m.prototype.measureText=function(k){if(typeof k!="string")throw mn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var q=this.pdf,W=this.pdf.internal.scaleFactor,U=q.internal.getFontSize(),Q=q.getStringUnitWidth(k)*U/q.internal.scaleFactor;return new function(se){var oe=(se=se||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return oe}}),this}({width:Q*=Math.round(96*W/72*1e4)/1e4})},m.prototype.scale=function(k,q){if(isNaN(k)||isNaN(q))throw mn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var W=new l(k,0,0,q,0,0);this.ctx.transform=this.ctx.transform.multiply(W)},m.prototype.rotate=function(k){if(isNaN(k))throw mn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var q=new l(Math.cos(k),Math.sin(k),-Math.sin(k),Math.cos(k),0,0);this.ctx.transform=this.ctx.transform.multiply(q)},m.prototype.translate=function(k,q){if(isNaN(k)||isNaN(q))throw mn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var W=new l(1,0,0,1,k,q);this.ctx.transform=this.ctx.transform.multiply(W)},m.prototype.transform=function(k,q,W,U,Q,se){if(isNaN(k)||isNaN(q)||isNaN(W)||isNaN(U)||isNaN(Q)||isNaN(se))throw mn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var oe=new l(k,q,W,U,Q,se);this.ctx.transform=this.ctx.transform.multiply(oe)},m.prototype.setTransform=function(k,q,W,U,Q,se){k=isNaN(k)?1:k,q=isNaN(q)?0:q,W=isNaN(W)?0:W,U=isNaN(U)?1:U,Q=isNaN(Q)?0:Q,se=isNaN(se)?0:se,this.ctx.transform=new l(k,q,W,U,Q,se)};var w=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};m.prototype.drawImage=function(k,q,W,U,Q,se,oe,pe,be){var xe=this.pdf.getImageProperties(k),Oe=1,Te=1,qe=1,j=1;U!==void 0&&pe!==void 0&&(qe=pe/U,j=be/Q,Oe=xe.width/U*pe/U,Te=xe.height/Q*be/Q),se===void 0&&(se=q,oe=W,q=0,W=0),U!==void 0&&pe===void 0&&(pe=U,be=Q),U===void 0&&pe===void 0&&(pe=xe.width,be=xe.height);var Be=this.ctx.transform.decompose(),xt=X(Be.rotate.shx),Qe=new l,Le=(Qe=(Qe=(Qe=Qe.multiply(Be.translate)).multiply(Be.skew)).multiply(Be.scale)).applyToRectangle(new o(se-q*qe,oe-W*j,U*Oe,Q*Te));if(this.autoPaging){for(var Je,$e=S.call(this,Le),st=[],tt=0;tt<$e.length;tt+=1)st.indexOf($e[tt])===-1&&st.push($e[tt]);O(st);for(var Tt=st[0],At=st[st.length-1],mt=Tt;mt<At+1;mt++){this.pdf.setPage(mt);var gt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Nt=mt===1?this.posY+this.margin[0]:this.margin[0],Ue=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ut=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],He=mt===1?0:Ue+(mt-2)*ut;if(this.ctx.clip_path.length!==0){var sn=this.path;Je=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=I(Je,this.posX+this.margin[3],-He+Nt+this.ctx.prevPageLastElemOffset),K.call(this,"fill",!0),this.path=sn}var Ot=JSON.parse(JSON.stringify(Le));Ot=I([Ot],this.posX+this.margin[3],-He+Nt+this.ctx.prevPageLastElemOffset)[0];var wt=(mt>Tt||mt<At)&&w.call(this);wt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],gt,ut,null).clip().discardPath()),this.pdf.addImage(k,"JPEG",Ot.x,Ot.y,Ot.w,Ot.h,null,null,xt),wt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(k,"JPEG",Le.x,Le.y,Le.w,Le.h,null,null,xt)};var S=function(k,q,W){var U=[];q=q||this.pdf.internal.pageSize.width,W=W||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Q=this.posY+this.ctx.prevPageLastElemOffset;switch(k.type){default:case"mt":case"lt":U.push(Math.floor((k.y+Q)/W)+1);break;case"arc":U.push(Math.floor((k.y+Q-k.radius)/W)+1),U.push(Math.floor((k.y+Q+k.radius)/W)+1);break;case"qct":var se=ae(this.ctx.lastPoint.x,this.ctx.lastPoint.y,k.x1,k.y1,k.x,k.y);U.push(Math.floor((se.y+Q)/W)+1),U.push(Math.floor((se.y+se.h+Q)/W)+1);break;case"bct":var oe=me(this.ctx.lastPoint.x,this.ctx.lastPoint.y,k.x1,k.y1,k.x2,k.y2,k.x,k.y);U.push(Math.floor((oe.y+Q)/W)+1),U.push(Math.floor((oe.y+oe.h+Q)/W)+1);break;case"rect":U.push(Math.floor((k.y+Q)/W)+1),U.push(Math.floor((k.y+k.h+Q)/W)+1)}for(var pe=0;pe<U.length;pe+=1)for(;this.pdf.internal.getNumberOfPages()<U[pe];)A.call(this);return U},A=function(){var k=this.fillStyle,q=this.strokeStyle,W=this.font,U=this.lineCap,Q=this.lineWidth,se=this.lineJoin;this.pdf.addPage(),this.fillStyle=k,this.strokeStyle=q,this.font=W,this.lineCap=U,this.lineWidth=Q,this.lineJoin=se},I=function(k,q,W){for(var U=0;U<k.length;U++)switch(k[U].type){case"bct":k[U].x2+=q,k[U].y2+=W;case"qct":k[U].x1+=q,k[U].y1+=W;default:k[U].x+=q,k[U].y+=W}return k},O=function(k){return k.sort(function(q,W){return q-W})},P=function(k,q){var W=this.fillStyle,U=this.strokeStyle,Q=this.lineCap,se=this.lineWidth,oe=Math.abs(se*this.ctx.transform.scaleX),pe=this.lineJoin;if(this.autoPaging){for(var be,xe,Oe=JSON.parse(JSON.stringify(this.path)),Te=JSON.parse(JSON.stringify(this.path)),qe=[],j=0;j<Te.length;j++)if(Te[j].x!==void 0)for(var Be=S.call(this,Te[j]),xt=0;xt<Be.length;xt+=1)qe.indexOf(Be[xt])===-1&&qe.push(Be[xt]);for(var Qe=0;Qe<qe.length;Qe++)for(;this.pdf.internal.getNumberOfPages()<qe[Qe];)A.call(this);O(qe);for(var Le=qe[0],Je=qe[qe.length-1],$e=Le;$e<Je+1;$e++){this.pdf.setPage($e),this.fillStyle=W,this.strokeStyle=U,this.lineCap=Q,this.lineWidth=oe,this.lineJoin=pe;var st=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],tt=$e===1?this.posY+this.margin[0]:this.margin[0],Tt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],At=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],mt=$e===1?0:Tt+($e-2)*At;if(this.ctx.clip_path.length!==0){var gt=this.path;be=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=I(be,this.posX+this.margin[3],-mt+tt+this.ctx.prevPageLastElemOffset),K.call(this,k,!0),this.path=gt}if(xe=JSON.parse(JSON.stringify(Oe)),this.path=I(xe,this.posX+this.margin[3],-mt+tt+this.ctx.prevPageLastElemOffset),q===!1||$e===0){var Nt=($e>Le||$e<Je)&&w.call(this);Nt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],st,At,null).clip().discardPath()),K.call(this,k,q),Nt&&this.pdf.restoreGraphicsState()}this.lineWidth=se}this.path=Oe}else this.lineWidth=oe,K.call(this,k,q),this.lineWidth=se},K=function(k,q){if((k!=="stroke"||q||!b.call(this))&&(k==="stroke"||q||!h.call(this))){for(var W,U,Q=[],se=this.path,oe=0;oe<se.length;oe++){var pe=se[oe];switch(pe.type){case"begin":Q.push({begin:!0});break;case"close":Q.push({close:!0});break;case"mt":Q.push({start:pe,deltas:[],abs:[]});break;case"lt":var be=Q.length;if(se[oe-1]&&!isNaN(se[oe-1].x)&&(W=[pe.x-se[oe-1].x,pe.y-se[oe-1].y],be>0)){for(;be>=0;be--)if(Q[be-1].close!==!0&&Q[be-1].begin!==!0){Q[be-1].deltas.push(W),Q[be-1].abs.push(pe);break}}break;case"bct":W=[pe.x1-se[oe-1].x,pe.y1-se[oe-1].y,pe.x2-se[oe-1].x,pe.y2-se[oe-1].y,pe.x-se[oe-1].x,pe.y-se[oe-1].y],Q[Q.length-1].deltas.push(W);break;case"qct":var xe=se[oe-1].x+2/3*(pe.x1-se[oe-1].x),Oe=se[oe-1].y+2/3*(pe.y1-se[oe-1].y),Te=pe.x+2/3*(pe.x1-pe.x),qe=pe.y+2/3*(pe.y1-pe.y),j=pe.x,Be=pe.y;W=[xe-se[oe-1].x,Oe-se[oe-1].y,Te-se[oe-1].x,qe-se[oe-1].y,j-se[oe-1].x,Be-se[oe-1].y],Q[Q.length-1].deltas.push(W);break;case"arc":Q.push({deltas:[],abs:[],arc:!0}),Array.isArray(Q[Q.length-1].abs)&&Q[Q.length-1].abs.push(pe)}}U=q?null:k==="stroke"?"stroke":"fill";for(var xt=!1,Qe=0;Qe<Q.length;Qe++)if(Q[Qe].arc)for(var Le=Q[Qe].abs,Je=0;Je<Le.length;Je++){var $e=Le[Je];$e.type==="arc"?ne.call(this,$e.x,$e.y,$e.radius,$e.startAngle,$e.endAngle,$e.counterclockwise,void 0,q,!xt):C.call(this,$e.x,$e.y),xt=!0}else if(Q[Qe].close===!0)this.pdf.internal.out("h"),xt=!1;else if(Q[Qe].begin!==!0){var st=Q[Qe].start.x,tt=Q[Qe].start.y;M.call(this,Q[Qe].deltas,st,tt),xt=!0}U&&V.call(this,U),q&&ue.call(this)}},le=function(k){var q=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,W=q*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return k-W;case"top":return k+q-W;case"hanging":return k+q-2*W;case"middle":return k+q/2-W;default:return k}},he=function(k){return k+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};m.prototype.createLinearGradient=function(){var k=function(){};return k.colorStops=[],k.addColorStop=function(q,W){this.colorStops.push([q,W])},k.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},k.isCanvasGradient=!0,k},m.prototype.createPattern=function(){return this.createLinearGradient()},m.prototype.createRadialGradient=function(){return this.createLinearGradient()};var ne=function(k,q,W,U,Q,se,oe,pe,be){for(var xe=G.call(this,W,U,Q,se),Oe=0;Oe<xe.length;Oe++){var Te=xe[Oe];Oe===0&&(be?_.call(this,Te.x1+k,Te.y1+q):C.call(this,Te.x1+k,Te.y1+q)),Y.call(this,k,q,Te.x2,Te.y2,Te.x3,Te.y3,Te.x4,Te.y4)}pe?ue.call(this):V.call(this,oe)},V=function(k){switch(k){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},ue=function(){this.pdf.clip(),this.pdf.discardPath()},_=function(k,q){this.pdf.internal.out(t(k)+" "+r(q)+" m")},L=function(k){var q;switch(k.align){case"right":case"end":q="right";break;case"center":q="center";break;default:q="left"}var W,U,Q,se=this.pdf.getTextDimensions(k.text),oe=le.call(this,k.y),pe=he.call(this,oe)-se.h,be=this.ctx.transform.applyToPoint(new a(k.x,oe));if(this.autoPaging){var xe=this.ctx.transform.decompose(),Oe=new l;Oe=(Oe=(Oe=Oe.multiply(xe.translate)).multiply(xe.skew)).multiply(xe.scale);for(var Te=this.ctx.transform.applyToRectangle(new o(k.x,oe,se.w,se.h)),qe=Oe.applyToRectangle(new o(k.x,pe,se.w,se.h)),j=S.call(this,qe),Be=[],xt=0;xt<j.length;xt+=1)Be.indexOf(j[xt])===-1&&Be.push(j[xt]);O(Be);for(var Qe=Be[0],Le=Be[Be.length-1],Je=Qe;Je<Le+1;Je++){this.pdf.setPage(Je);var $e=Je===1?this.posY+this.margin[0]:this.margin[0],st=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],tt=this.pdf.internal.pageSize.height-this.margin[2],Tt=tt-this.margin[0],At=this.pdf.internal.pageSize.width-this.margin[1],mt=At-this.margin[3],gt=Je===1?0:st+(Je-2)*Tt;if(this.ctx.clip_path.length!==0){var Nt=this.path;W=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=I(W,this.posX+this.margin[3],-1*gt+$e),K.call(this,"fill",!0),this.path=Nt}var Ue=I([JSON.parse(JSON.stringify(qe))],this.posX+this.margin[3],-gt+$e+this.ctx.prevPageLastElemOffset)[0];k.scale>=.01&&(U=this.pdf.internal.getFontSize(),this.pdf.setFontSize(U*k.scale),Q=this.lineWidth,this.lineWidth=Q*k.scale);var ut=this.autoPaging!=="text";if(ut||Ue.y+Ue.h<=tt){if(ut||Ue.y>=$e&&Ue.x<=At){var He=ut?k.text:this.pdf.splitTextToSize(k.text,k.maxWidth||At-Ue.x)[0],sn=I([JSON.parse(JSON.stringify(Te))],this.posX+this.margin[3],-gt+$e+this.ctx.prevPageLastElemOffset)[0],Ot=ut&&(Je>Qe||Je<Le)&&w.call(this);Ot&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],mt,Tt,null).clip().discardPath()),this.pdf.text(He,sn.x,sn.y,{angle:k.angle,align:q,renderingMode:k.renderingMode}),Ot&&this.pdf.restoreGraphicsState()}}else Ue.y<tt&&(this.ctx.prevPageLastElemOffset+=tt-Ue.y);k.scale>=.01&&(this.pdf.setFontSize(U),this.lineWidth=Q)}}else k.scale>=.01&&(U=this.pdf.internal.getFontSize(),this.pdf.setFontSize(U*k.scale),Q=this.lineWidth,this.lineWidth=Q*k.scale),this.pdf.text(k.text,be.x+this.posX,be.y+this.posY,{angle:k.angle,align:q,renderingMode:k.renderingMode,maxWidth:k.maxWidth}),k.scale>=.01&&(this.pdf.setFontSize(U),this.lineWidth=Q)},C=function(k,q,W,U){W=W||0,U=U||0,this.pdf.internal.out(t(k+W)+" "+r(q+U)+" l")},M=function(k,q,W){return this.pdf.lines(k,q,W,null,null)},Y=function(k,q,W,U,Q,se,oe,pe){this.pdf.internal.out([e(i(W+k)),e(s(U+q)),e(i(Q+k)),e(s(se+q)),e(i(oe+k)),e(s(pe+q)),"c"].join(" "))},G=function(k,q,W,U){for(var Q=2*Math.PI,se=Math.PI/2;q>W;)q-=Q;var oe=Math.abs(W-q);oe<Q&&U&&(oe=Q-oe);for(var pe=[],be=U?-1:1,xe=q;oe>1e-5;){var Oe=xe+be*Math.min(oe,se);pe.push(te.call(this,k,xe,Oe)),oe-=Math.abs(Oe-xe),xe=Oe}return pe},te=function(k,q,W){var U=(W-q)/2,Q=k*Math.cos(U),se=k*Math.sin(U),oe=Q,pe=-se,be=oe*oe+pe*pe,xe=be+oe*Q+pe*se,Oe=4/3*(Math.sqrt(2*be*xe)-xe)/(oe*se-pe*Q),Te=oe-Oe*pe,qe=pe+Oe*oe,j=Te,Be=-qe,xt=U+q,Qe=Math.cos(xt),Le=Math.sin(xt);return{x1:k*Math.cos(q),y1:k*Math.sin(q),x2:Te*Qe-qe*Le,y2:Te*Le+qe*Qe,x3:j*Qe-Be*Le,y3:j*Le+Be*Qe,x4:k*Math.cos(W),y4:k*Math.sin(W)}},X=function(k){return 180*k/Math.PI},ae=function(k,q,W,U,Q,se){var oe=k+.5*(W-k),pe=q+.5*(U-q),be=Q+.5*(W-Q),xe=se+.5*(U-se),Oe=Math.min(k,Q,oe,be),Te=Math.max(k,Q,oe,be),qe=Math.min(q,se,pe,xe),j=Math.max(q,se,pe,xe);return new o(Oe,qe,Te-Oe,j-qe)},me=function(k,q,W,U,Q,se,oe,pe){var be,xe,Oe,Te,qe,j,Be,xt,Qe,Le,Je,$e,st,tt,Tt=W-k,At=U-q,mt=Q-W,gt=se-U,Nt=oe-Q,Ue=pe-se;for(xe=0;xe<41;xe++)Qe=(Be=(Oe=k+(be=xe/40)*Tt)+be*((qe=W+be*mt)-Oe))+be*(qe+be*(Q+be*Nt-qe)-Be),Le=(xt=(Te=q+be*At)+be*((j=U+be*gt)-Te))+be*(j+be*(se+be*Ue-j)-xt),xe==0?(Je=Qe,$e=Le,st=Qe,tt=Le):(Je=Math.min(Je,Qe),$e=Math.min($e,Le),st=Math.max(st,Qe),tt=Math.max(tt,Le));return new o(Math.round(Je),Math.round($e),Math.round(st-Je),Math.round(tt-$e))},fe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var k,q,W=(k=this.ctx.lineDash,q=this.ctx.lineDashOffset,JSON.stringify({lineDash:k,lineDashOffset:q}));this.prevLineDash!==W&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=W)}}})(at.API),(function(n){var e=function(a){var o,l,c,d,m,p,h,b,w,S;for(l=[],c=0,d=(a+=o="\0\0\0\0".slice(a.length%4||4)).length;d>c;c+=4)(m=(a.charCodeAt(c)<<24)+(a.charCodeAt(c+1)<<16)+(a.charCodeAt(c+2)<<8)+a.charCodeAt(c+3))!==0?(p=(m=((m=((m=((m=(m-(S=m%85))/85)-(w=m%85))/85)-(b=m%85))/85)-(h=m%85))/85)%85,l.push(p+33,h+33,b+33,w+33,S+33)):l.push(122);return(function(A,I){for(var O=I;O>0;O--)A.pop()})(l,o.length),String.fromCharCode.apply(String,l)+"~>"},t=function(a){var o,l,c,d,m,p=String,h="length",b=255,w="charCodeAt",S="slice",A="replace";for(a[S](-2),a=a[S](0,-2)[A](/\s/g,"")[A]("z","!!!!!"),c=[],d=0,m=(a+=o="uuuuu"[S](a[h]%5||5))[h];m>d;d+=5)l=52200625*(a[w](d)-33)+614125*(a[w](d+1)-33)+7225*(a[w](d+2)-33)+85*(a[w](d+3)-33)+(a[w](d+4)-33),c.push(b&l>>24,b&l>>16,b&l>>8,b&l);return(function(I,O){for(var P=O;P>0;P--)I.pop()})(c,o[h]),p.fromCharCode.apply(p,c)},r=function(a){return a.split("").map(function(o){return("0"+o.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(a){var o=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((a=a.replace(/\s/g,"")).indexOf(">")!==-1&&(a=a.substr(0,a.indexOf(">"))),a.length%2&&(a+="0"),o.test(a)===!1)return"";for(var l="",c=0;c<a.length;c+=2)l+=String.fromCharCode("0x"+(a[c]+a[c+1]));return l},s=function(a){for(var o=new Uint8Array(a.length),l=a.length;l--;)o[l]=a.charCodeAt(l);return(o=up(o)).reduce(function(c,d){return c+String.fromCharCode(d)},"")};n.processDataByFilters=function(a,o){var l=0,c=a||"",d=[];for(typeof(o=o||[])=="string"&&(o=[o]),l=0;l<o.length;l+=1)switch(o[l]){case"ASCII85Decode":case"/ASCII85Decode":c=t(c),d.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":c=e(c),d.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":c=i(c),d.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":c=r(c),d.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":c=s(c),d.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[l]+'" is not implemented')}return{data:c,reverseChain:d.reverse().join(" ")}}})(at.API),(function(n){n.loadFile=function(e,t,r){return(function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=(function(l,c,d){var m=new XMLHttpRequest,p=0,h=function(b){var w=b.length,S=[],A=String.fromCharCode;for(p=0;p<w;p+=1)S.push(A(255&b.charCodeAt(p)));return S.join("")};if(m.open("GET",l,!c),m.overrideMimeType("text/plain; charset=x-user-defined"),c===!1&&(m.onload=function(){m.status===200?d(h(this.responseText)):d(void 0)}),m.send(null),c&&m.status===200)return h(m.responseText)})(i,s,a)}catch{}return o})(e,t,r)},n.allowFsRead=void 0,n.loadImageFile=n.loadFile})(at.API),(function(n){function e(){return(kt.html2canvas?Promise.resolve(kt.html2canvas):Yh(()=>import("./html2canvas.esm-QH1iLAAe.js"),[],import.meta.url)).catch(function(o){return Promise.reject(new Error("Could not load html2canvas: "+o))}).then(function(o){return o.default?o.default:o})}function t(){return(kt.DOMPurify?Promise.resolve(kt.DOMPurify):Yh(()=>Promise.resolve().then(()=>rA),void 0,import.meta.url)).catch(function(o){return Promise.reject(new Error("Could not load dompurify: "+o))}).then(function(o){return o.default?o.default:o})}var r=function(o){var l=un(o);return l==="undefined"?"undefined":l==="string"||o instanceof String?"string":l==="number"||o instanceof Number?"number":l==="function"||o instanceof Function?"function":o&&o.constructor===Array?"array":o&&o.nodeType===1?"element":l==="object"?"object":"unknown"},i=function(o,l){var c=document.createElement(o);for(var d in l.className&&(c.className=l.className),l.innerHTML&&l.dompurify&&(c.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)c.style[d]=l.style[d];return c},s=function o(l,c){for(var d=l.nodeType===3?document.createTextNode(l.nodeValue):l.cloneNode(!1),m=l.firstChild;m;m=m.nextSibling)c!==!0&&m.nodeType===1&&m.nodeName==="SCRIPT"||d.appendChild(o(m,c));return l.nodeType===1&&(l.nodeName==="CANVAS"?(d.width=l.width,d.height=l.height,d.getContext("2d").drawImage(l,0,0)):l.nodeName!=="TEXTAREA"&&l.nodeName!=="SELECT"||(d.value=l.value),d.addEventListener("load",function(){d.scrollTop=l.scrollTop,d.scrollLeft=l.scrollLeft},!0)),d},a=function o(l){var c=Object.assign(o.convert(Promise.resolve()),JSON.parse(JSON.stringify(o.template))),d=o.convert(Promise.resolve(),c);return(d=d.setProgress(1,o,1,[o])).set(l)};(a.prototype=Object.create(Promise.prototype)).constructor=a,a.convert=function(o,l){return o.__proto__=l||a.prototype,o},a.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},a.prototype.from=function(o,l){return this.then(function(){switch(l=l||(function(c){switch(r(c)){case"string":return"string";case"element":return c.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(o),l){case"string":return this.then(t).then(function(c){return this.set({src:i("div",{innerHTML:o,dompurify:c})})});case"element":return this.set({src:o});case"canvas":return this.set({canvas:o});case"img":return this.set({img:o});default:return this.error("Unknown source type.")}})},a.prototype.to=function(o){switch(o){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},a.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var o={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(o.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:o}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},a.prototype.toCanvas=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(e).then(function(l){var c=Object.assign({},this.opt.html2canvas);return delete c.onrendered,l(this.prop.container,c)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},a.prototype.toContext2d=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(e).then(function(l){var c=this.opt.jsPDF,d=this.opt.fontFaces,m=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,p=Object.assign({async:!0,allowTaint:!0,scale:m,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete p.onrendered,c.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,c.context2d.posX=this.opt.x,c.context2d.posY=this.opt.y,c.context2d.margin=this.opt.margin,c.context2d.fontFaces=d,d)for(var h=0;h<d.length;++h){var b=d[h],w=b.src.find(function(S){return S.format==="truetype"});w&&c.addFont(w.url,b.ref.name,b.ref.style)}return p.windowHeight=p.windowHeight||0,p.windowHeight=p.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):p.windowHeight,c.context2d.save(!0),l(this.prop.container,p)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},a.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var o=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=o})},a.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},a.prototype.output=function(o,l,c){return(c=c||"pdf").toLowerCase()==="img"||c.toLowerCase()==="image"?this.outputImg(o,l):this.outputPdf(o,l)},a.prototype.outputPdf=function(o,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(o,l)})},a.prototype.outputImg=function(o){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(o){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+o+'" is not supported.'}})},a.prototype.save=function(o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(o?{filename:o}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},a.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},a.prototype.set=function(o){if(r(o)!=="object")return this;var l=Object.keys(o||{}).map(function(c){if(c in a.template.prop)return function(){this.prop[c]=o[c]};switch(c){case"margin":return this.setMargin.bind(this,o.margin);case"jsPDF":return function(){return this.opt.jsPDF=o.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,o.pageSize);default:return function(){this.opt[c]=o[c]}}},this);return this.then(function(){return this.thenList(l)})},a.prototype.get=function(o,l){return this.then(function(){var c=o in a.template.prop?this.prop[o]:this.opt[o];return l?l(c):c})},a.prototype.setMargin=function(o){return this.then(function(){switch(r(o)){case"number":o=[o,o,o,o];case"array":if(o.length===2&&(o=[o[0],o[1],o[0],o[1]]),o.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=o}).then(this.setPageSize)},a.prototype.setPageSize=function(o){function l(c,d){return Math.floor(c*d/72*96)}return this.then(function(){(o=o||at.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(o.inner={width:o.width-this.opt.margin[1]-this.opt.margin[3],height:o.height-this.opt.margin[0]-this.opt.margin[2]},o.inner.px={width:l(o.inner.width,o.k),height:l(o.inner.height,o.k)},o.inner.ratio=o.inner.height/o.inner.width),this.prop.pageSize=o})},a.prototype.setProgress=function(o,l,c,d){return o!=null&&(this.progress.val=o),l!=null&&(this.progress.state=l),c!=null&&(this.progress.n=c),d!=null&&(this.progress.stack=d),this.progress.ratio=this.progress.val/this.progress.state,this},a.prototype.updateProgress=function(o,l,c,d){return this.setProgress(o?this.progress.val+o:null,l||null,c?this.progress.n+c:null,d?this.progress.stack.concat(d):null)},a.prototype.then=function(o,l){var c=this;return this.thenCore(o,l,function(d,m){return c.updateProgress(null,null,1,[d]),Promise.prototype.then.call(this,function(p){return c.updateProgress(null,d),p}).then(d,m).then(function(p){return c.updateProgress(1),p})})},a.prototype.thenCore=function(o,l,c){c=c||Promise.prototype.then;var d=this;o&&(o=o.bind(d)),l&&(l=l.bind(d));var m=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?d:a.convert(Object.assign({},d),Promise.prototype),p=c.call(m,o,l);return a.convert(p,d.__proto__)},a.prototype.thenExternal=function(o,l){return Promise.prototype.then.call(this,o,l)},a.prototype.thenList=function(o){var l=this;return o.forEach(function(c){l=l.thenCore(c)}),l},a.prototype.catch=function(o){o&&(o=o.bind(this));var l=Promise.prototype.catch.call(this,o);return a.convert(l,this)},a.prototype.catchExternal=function(o){return Promise.prototype.catch.call(this,o)},a.prototype.error=function(o){return this.then(function(){throw new Error(o)})},a.prototype.using=a.prototype.set,a.prototype.saveAs=a.prototype.save,a.prototype.export=a.prototype.output,a.prototype.run=a.prototype.then,at.getPageSize=function(o,l,c){if(un(o)==="object"){var d=o;o=d.orientation,l=d.unit||l,c=d.format||c}l=l||"mm",c=c||"a4",o=(""+(o||"P")).toLowerCase();var m,p=(""+c).toLowerCase(),h={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":m=1;break;case"mm":m=72/25.4;break;case"cm":m=72/2.54;break;case"in":m=72;break;case"px":m=.75;break;case"pc":case"em":m=12;break;case"ex":m=6;break;default:throw"Invalid unit: "+l}var b,w=0,S=0;if(h.hasOwnProperty(p))w=h[p][1]/m,S=h[p][0]/m;else try{w=c[1],S=c[0]}catch{throw new Error("Invalid format: "+c)}if(o==="p"||o==="portrait")o="p",S>w&&(b=S,S=w,w=b);else{if(o!=="l"&&o!=="landscape")throw"Invalid orientation: "+o;o="l",w>S&&(b=S,S=w,w=b)}return{width:S,height:w,unit:l,k:m,orientation:o}},n.html=function(o,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(pf):null;var c=new a(l);return l.worker?c:c.from(o).doCallback()}})(at.API),at.API.addJS=function(n){var e,t,r=(function(i){for(var s="",a=0;a<i.length;a++){var o=i[a];if(o==="("||o===")"){for(var l=0,c=a-1;c>=0&&i[c]==="\\";c--)l++;s+=l%2==0?"\\"+o:o}else s+=o}return s})(n);return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+r+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){e!==void 0&&t!==void 0&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=t.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=r.exec(a);if(o!=null){var l=o[1];t.internal.newObjectDeferredBegin(l,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var c=this.internal.pages.length,d=[];for(s=0;s<c;s++){var m=t.internal.newObject();d.push(m);var p=t.internal.getPageInfo(s+1);t.internal.write("<< /D["+p.objId+" 0 R /XYZ null null null]>> endobj")}var h=t.internal.newObject();for(t.internal.write("<< /Names [ "),s=0;s<d.length;s++)t.internal.write("(page_"+(s+1)+")"+d[s]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+h+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(r,i,s){var a={title:i,options:s,children:[]};return r==null&&(r=this.root),r.children.push(a),a},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(r){r.id=t.internal.newObjectDeferred();for(var i=0;i<r.children.length;i++)this.genIds_r(r.children[i])},t.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},t.outline.renderItems=function(r){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<r.children.length;s++){var a=r.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(r)),s>0&&this.line("/Prev "+this.makeRef(r.children[s-1])),s<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var l=t.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+l.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var c=0;c<r.children.length;c++)this.renderItems(r.children[c])},t.outline.line=function(r){this.ctx.val+=r+`\r
`},t.outline.makeRef=function(r){return r.id+" 0 R"},t.outline.makeString=function(r){return"("+t.internal.pdfEscape(r)+")"},t.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(r,i){for(var s=0;s<i.children.length;s++)r.count++,this.count_r(r,i.children[s]);return r.count}}])})(at.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,r,i,s,a,o){var l,c=this.decode.DCT_DECODE,d=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,l=(function(m){for(var p,h=256*m.charCodeAt(4)+m.charCodeAt(5),b=m.length,w={width:0,height:0,numcomponents:1},S=4;S<b;S+=2){if(S+=h,e.indexOf(m.charCodeAt(S+1))!==-1){p=256*m.charCodeAt(S+5)+m.charCodeAt(S+6),w={width:256*m.charCodeAt(S+7)+m.charCodeAt(S+8),height:p,numcomponents:m.charCodeAt(S+9)};break}h=256*m.charCodeAt(S+2)+m.charCodeAt(S+3)}return w})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),l.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}d={data:t,width:l.width,height:l.height,colorSpace:o,bitsPerComponent:8,filter:c,index:r,alias:i}}return d}})(at.API),at.API.processPNG=function(n,e,t,r){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var i,s=XT(n,{checkCrc:!0}),a=s.width,o=s.height,l=s.channels,c=s.palette,d=s.depth;i=c&&l===1?(function(ne){for(var V=ne.width,ue=ne.height,_=ne.data,L=ne.palette,C=ne.depth,M=!1,Y=[],G=[],te=void 0,X=!1,ae=0,me=0;me<L.length;me++){var fe=X1(L[me],4),k=fe[0],q=fe[1],W=fe[2],U=fe[3];Y.push(k,q,W),U!=null&&(U===0?(ae++,G.length<1&&G.push(me)):U<255&&(X=!0))}if(X||ae>1){M=!0,G=void 0;var Q=V*ue;te=new Uint8Array(Q);for(var se=new DataView(_.buffer),oe=0;oe<Q;oe++){var pe=gf(se,oe,C),be=X1(L[pe],4)[3];te[oe]=be}}else ae===0&&(G=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:M?8:void 0,colorBytes:_,alphaBytes:te,needSMask:M,palette:Y,mask:G}})(s):l===2||l===4?(function(ne){for(var V=ne.data,ue=ne.width,_=ne.height,L=ne.channels,C=ne.depth,M=L===2?"DeviceGray":"DeviceRGB",Y=L-1,G=ue*_,te=Y,X=G*te,ae=1*G,me=Math.ceil(X*C/8),fe=Math.ceil(ae*C/8),k=new Uint8Array(me),q=new Uint8Array(fe),W=new DataView(V.buffer),U=new DataView(k.buffer),Q=new DataView(q.buffer),se=!1,oe=0;oe<G;oe++){for(var pe=oe*L,be=0;be<te;be++)ev(U,gf(W,pe+be,C),oe*te+be,C);var xe=gf(W,pe+te,C);xe<(1<<C)-1&&(se=!0),ev(Q,xe,1*oe,C)}return{colorSpace:M,colorsPerPixel:Y,sMaskBitsPerComponent:se?C:void 0,colorBytes:k,alphaBytes:q,needSMask:se}})(s):(function(ne){var V=ne.data,ue=ne.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:ue,colorsPerPixel:ue==="DeviceGray"?1:3,colorBytes:V instanceof Uint16Array?(function(_){for(var L=_.length,C=new Uint8Array(2*L),M=new DataView(C.buffer,C.byteOffset,C.byteLength),Y=0;Y<L;Y++)M.setUint16(2*Y,_[Y],!1);return C})(V):V,needSMask:!1}})(s);var m,p,h,b=i,w=b.colorSpace,S=b.colorsPerPixel,A=b.sMaskBitsPerComponent,I=b.colorBytes,O=b.alphaBytes,P=b.needSMask,K=b.palette,le=b.mask,he=null;return r!==at.API.image_compression.NONE&&typeof up=="function"?(he=(function(ne){var V;switch(ne){case at.API.image_compression.FAST:V=11;break;case at.API.image_compression.MEDIUM:V=13;break;case at.API.image_compression.SLOW:V=14;break;default:V=12}return V})(r),m=this.decode.FLATE_DECODE,p="/Predictor ".concat(he," /Colors ").concat(S," /BitsPerComponent ").concat(d," /Columns ").concat(a),n=Y0(I,Math.ceil(a*S*d/8),S,d,r),P&&(h=Y0(O,Math.ceil(a*A/8),1,A,r))):(m=void 0,p=void 0,n=I,P&&(h=O)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(h&&this.__addimage__.isArrayBuffer(h)||this.__addimage__.isArrayBufferView(h))&&(h=this.__addimage__.arrayBufferToBinaryString(h)),{alias:t,data:n,index:e,filter:m,decodeParameters:p,transparency:le,palette:K,sMask:h,predictor:he,width:a,height:o,bitsPerComponent:d,sMaskBitsPerComponent:A,colorSpace:w}}},(function(n){n.processGIF89A=function(e,t,r,i){var s=new b8(e),a=s.width,o=s.height,l=[];s.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:a,height:o},d=new vf(100).encode(c,100);return n.processJPEG.call(this,d,t,r,i)},n.processGIF87A=n.processGIF89A})(at.API),Ji.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:r,blue:t,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Ji.prototype.parseBGR=function(){this.pos=this.offset;var n="bit"+this.bitPP,e=this.width*this.height*4;if(e>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(e);try{this[n]()}catch(t){mn.log("bit decode error:"+t)}},Ji.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<e;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=r*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var l=this.palette[s>>7-o&1];this.data[a+4*o]=l.blue,this.data[a+4*o+1]=l.green,this.data[a+4*o+2]=l.red,this.data[a+4*o+3]=255}t!==0&&(this.pos+=4-t)}},Ji.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,i=0;i<n;i++){var s=this.datav.getUint8(this.pos++,!0),a=r*this.width*4+2*i*4,o=s>>4,l=15&s,c=this.palette[o];if(this.data[a]=c.blue,this.data[a+1]=c.green,this.data[a+2]=c.red,this.data[a+3]=255,2*i+1>=this.width)break;c=this.palette[l],this.data[a+4]=c.blue,this.data[a+4+1]=c.green,this.data[a+4+2]=c.red,this.data[a+4+3]=255}e!==0&&(this.pos+=4-e)}},Ji.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*r;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}n!==0&&(this.pos+=4-n)}},Ji.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&e)/e*255|0,o=(s>>5&e)/e*255|0,l=(s>>10&e)/e*255|0,c=s>>15?255:0,d=r*this.width*4+4*i;this.data[d]=l,this.data[d+1]=o,this.data[d+2]=a,this.data[d+3]=c}this.pos+=n}},Ji.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,l=(a>>5&t)/t*255|0,c=(a>>11)/e*255|0,d=i*this.width*4+4*s;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=o,this.data[d+3]=255}this.pos+=n}},Ji.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*t;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=r,this.data[a+3]=255}this.pos+=this.width%4}},Ji.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*t;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=r,this.data[o+3]=a}},Ji.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,r,i){var s=new Ji(e,!1),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},c=new vf(100).encode(l,100);return n.processJPEG.call(this,c,t,r,i)}})(at.API),nv.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,r,i){var s=new nv(e),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},c=new vf(100).encode(l,100);return n.processJPEG.call(this,c,t,r,i)}})(at.API),at.API.processRGBA=function(n,e,t){for(var r=n.data,i=r.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,l=0,c=0;c<i;c+=4){var d=r[c],m=r[c+1],p=r[c+2],h=r[c+3];s[o++]=d,s[o++]=m,s[o++]=p,a[l++]=h}var b=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:b,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},at.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},tl=at.API,id=tl.getCharWidthsArray=function(n,e){var t,r,i=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),a=e.charSpace||this.internal.getCharSpace(),o=e.widths?e.widths:i.metadata.Unicode.widths,l=o.fof?o.fof:1,c=e.kerning?e.kerning:i.metadata.Unicode.kerning,d=c.fof?c.fof:1,m=e.doKerning!==!1,p=0,h=n.length,b=0,w=o[0]||l,S=[];for(t=0;t<h;t++)r=n.charCodeAt(t),typeof i.metadata.widthOfString=="function"?S.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(r))+a*(1e3/s)||0)/1e3):(p=m&&un(c[r])==="object"&&!isNaN(parseInt(c[r][b],10))?c[r][b]/d:0,S.push((o[r]||w)/l+p)),b=r;return S},V0=tl.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return tl.processArabic&&(n=tl.processArabic(n)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(n,t,i)/t:id.apply(this,arguments).reduce(function(s,a){return s+a},0)},G0=function(n,e,t,r){for(var i=[],s=0,a=n.length,o=0;s!==a&&o+e[s]<t;)o+=e[s],s++;i.push(n.slice(0,s));var l=s;for(o=0;s!==a;)o+e[s]>r&&(i.push(n.slice(l,s)),o=0,l=s),o+=e[s],s++;return l!==s&&i.push(n.slice(l,s)),i},K0=function(n,e,t){t||(t={});var r,i,s,a,o,l,c,d=[],m=[d],p=t.textIndent||0,h=0,b=0,w=n.split(" "),S=id.apply(this,[" ",t])[0];if(l=t.lineIndent===-1?w[0].length+2:t.lineIndent||0){var A=Array(l).join(" "),I=[];w.map(function(P){(P=P.split(/\s*\n/)).length>1?I=I.concat(P.map(function(K,le){return(le&&K.length?`
`:"")+K})):I.push(P[0])}),w=I,l=V0.apply(this,[A,t])}for(s=0,a=w.length;s<a;s++){var O=0;if(r=w[s],l&&r[0]==`
`&&(r=r.substr(1),O=1),p+h+(b=(i=id.apply(this,[r,t])).reduce(function(P,K){return P+K},0))>e||O){if(b>e){for(o=G0.apply(this,[r,i,e-(p+h),e]),d.push(o.shift()),d=[o.pop()];o.length;)m.push([o.shift()]);b=i.slice(r.length-(d[0]?d[0].length:0)).reduce(function(P,K){return P+K},0)}else d=[r];m.push(d),p=b+l,h=S}else d.push(r),p+=h+b,h=S}return c=l?function(P,K){return(K?A:"")+P.join(" ")}:function(P){return P.join(" ")},m.map(c)},tl.splitTextToSize=function(n,e,t){var r,i=(t=t||{}).fontSize||this.internal.getFontSize(),s=(function(d){if(d.widths&&d.kerning)return{widths:d.widths,kerning:d.kerning};var m=this.internal.getFont(d.fontName,d.fontStyle),p="Unicode";return m.metadata[p]?{widths:m.metadata[p].widths||{0:1},kerning:m.metadata[p].kerning||{}}:{font:m.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);r=Array.isArray(n)?n:String(n).split(/\r?\n/);var a=1*this.internal.scaleFactor*e/i;s.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=t.lineIndent;var o,l,c=[];for(o=0,l=r.length;o<l;o++)c=c.concat(K0.apply(this,[r[o],a,s]));return c},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",r={},i={},s=0;s<16;s++)r[t[s]]=e[s],i[e[s]]=t[s];var a=function(p){return"0x"+parseInt(p,10).toString(16)},o=n.__fontmetrics__.compress=function(p){var h,b,w,S,A=["{"];for(var I in p){if(h=p[I],isNaN(parseInt(I,10))?b="'"+I+"'":(I=parseInt(I,10),b=(b=a(I).slice(2)).slice(0,-1)+i[b.slice(-1)]),typeof h=="number")h<0?(w=a(h).slice(3),S="-"):(w=a(h).slice(2),S=""),w=S+w.slice(0,-1)+i[w.slice(-1)];else{if(un(h)!=="object")throw new Error("Don't know what to do with value type "+un(h)+".");w=o(h)}A.push(b+w)}return A.push("}"),A.join("")},l=n.__fontmetrics__.uncompress=function(p){if(typeof p!="string")throw new Error("Invalid argument passed to uncompress.");for(var h,b,w,S,A={},I=1,O=A,P=[],K="",le="",he=p.length-1,ne=1;ne<he;ne+=1)(S=p[ne])=="'"?h?(w=h.join(""),h=void 0):h=[]:h?h.push(S):S=="{"?(P.push([O,w]),O={},w=void 0):S=="}"?((b=P.pop())[0][b[1]]=O,w=void 0,O=b[0]):S=="-"?I=-1:w===void 0?r.hasOwnProperty(S)?(K+=r[S],w=parseInt(K,16)*I,I=1,K=""):K+=S:r.hasOwnProperty(S)?(le+=r[S],O[w]=parseInt(le,16)*I,I=1,w=void 0,le=""):le+=S;return A},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},m={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(p){var h=p.font,b=m.Unicode[h.postScriptName];b&&(h.metadata.Unicode={},h.metadata.Unicode.widths=b.widths,h.metadata.Unicode.kerning=b.kerning);var w=d.Unicode[h.postScriptName];w&&(h.metadata.Unicode.encoding=w,h.encoding=w.codePages[0])}])})(at.API),(function(n){var e=function(t){for(var r=t.length,i=new Uint8Array(r),s=0;s<r;s++)i[s]=t.charCodeAt(s);return i};n.API.events.push(["addFont",function(t){var r=void 0,i=t.font,s=t.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(r=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?e(o):e(hd(o)),a.metadata=n.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,r)}}])})(at),at.API.addSvgAsImage=function(n,e,t,r,i,s,a,o){if(isNaN(e)||isNaN(t))throw mn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(r)||isNaN(i))throw mn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var l=document.createElement("canvas");l.width=r,l.height=i;var c=l.getContext("2d");c.fillStyle="#fff",c.fillRect(0,0,l.width,l.height);var d={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},m=this;return(kt.canvg?Promise.resolve(kt.canvg):Yh(()=>import("./index.es-COhtjbUY.js"),[],import.meta.url)).catch(function(p){return Promise.reject(new Error("Could not load canvg: "+p))}).then(function(p){return p.default?p.default:p}).then(function(p){return p.fromString(c,n,d)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(p){return p.render(d)}).then(function(){m.addImage(l.toDataURL("image/jpeg",1),e,t,r,i,a,o)})},at.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var i=0;i<this.internal.pages[r].length;i++)this.internal.pages[r][i]=this.internal.pages[r][i].replace(e,t);return this},at.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var r,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),l=[],c=0,d=0,m=0;function p(b,w){var S,A=!1;for(S=0;S<b.length;S+=1)b[S]===w&&(A=!0);return A}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var h=o.length;for(m=0;m<h;m+=1)t[o[m]].value=t[o[m]].defaultValue,t[o[m]].explicitSet=!1}if(un(n)==="object"){for(i in n)if(s=n[i],p(o,i)&&s!==void 0){if(t[i].type==="boolean"&&typeof s=="boolean")t[i].value=s;else if(t[i].type==="name"&&p(t[i].valueSet,s))t[i].value=s;else if(t[i].type==="integer"&&Number.isInteger(s))t[i].value=s;else if(t[i].type==="array"){for(c=0;c<s.length;c+=1)if(r=!0,s[c].length===1&&typeof s[c][0]=="number")l.push(String(s[c]-1));else if(s[c].length>1){for(d=0;d<s[c].length;d+=1)typeof s[c][d]!="number"&&(r=!1);r===!0&&l.push([s[c][0]-1,s[c][1]-1].join(" "))}t[i].value="["+l.join(" ")+"]"}else t[i].value=t[i].defaultValue;t[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var b,w=[];for(b in t)t[b].explicitSet===!0&&(t[b].type==="name"?w.push("/"+b+" /"+t[b].value):w.push("/"+b+" "+t[b].value));w.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+w.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},at.API.addMetadata=function(n,e){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceUri:e??"http://jspdf.default.namespaceuri/",rawXml:typeof e=="boolean"&&e},this.internal.events.subscribe("putCatalog",w8),this.internal.events.subscribe("postPutResources",y8)),this},(function(n){var e=n.API,t=e.pdfEscape16=function(s,a){for(var o,l=a.metadata.Unicode.widths,c=["","0","00","000","0000"],d=[""],m=0,p=s.length;m<p;++m){if(o=a.metadata.characterToGlyph(s.charCodeAt(m)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(m),l.indexOf(o)==-1&&(l.push(o),l.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return d.join("");o=o.toString(16),d.push(c[4-o.length],o)}return d.join("")},r=function(s){var a,o,l,c,d,m,p;for(d=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,l=[],m=0,p=(o=Object.keys(s).sort(function(h,b){return h-b})).length;m<p;m++)a=o[m],l.length>=100&&(d+=`
`+l.length+` beginbfchar
`+l.join(`
`)+`
endbfchar`,l=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(c=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),l.push("<"+a+"><"+c+">"));return l.length&&(d+=`
`+l.length+` beginbfchar
`+l.join(`
`)+`
endbfchar
`),d+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(s){(function(a){var o=a.font,l=a.out,c=a.newObject,d=a.putStream;if(o.metadata instanceof n.API.TTFFont&&o.encoding==="Identity-H"){for(var m=o.metadata.Unicode.widths,p=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),h="",b=0;b<p.length;b++)h+=String.fromCharCode(p[b]);var w=c();d({data:h,addLength1:!0,objectId:w}),l("endobj");var S=c();d({data:r(o.metadata.toUnicode),addLength1:!0,objectId:S}),l("endobj");var A=c();l("<<"),l("/Type /FontDescriptor"),l("/FontName /"+hl(o.fontName)),l("/FontFile2 "+w+" 0 R"),l("/FontBBox "+n.API.PDFObject.convert(o.metadata.bbox)),l("/Flags "+o.metadata.flags),l("/StemV "+o.metadata.stemV),l("/ItalicAngle "+o.metadata.italicAngle),l("/Ascent "+o.metadata.ascender),l("/Descent "+o.metadata.decender),l("/CapHeight "+o.metadata.capHeight),l(">>"),l("endobj");var I=c();l("<<"),l("/Type /Font"),l("/BaseFont /"+hl(o.fontName)),l("/FontDescriptor "+A+" 0 R"),l("/W "+n.API.PDFObject.convert(m)),l("/CIDToGIDMap /Identity"),l("/DW 1000"),l("/Subtype /CIDFontType2"),l("/CIDSystemInfo"),l("<<"),l("/Supplement 0"),l("/Registry (Adobe)"),l("/Ordering ("+o.encoding+")"),l(">>"),l(">>"),l("endobj"),o.objectNumber=c(),l("<<"),l("/Type /Font"),l("/Subtype /Type0"),l("/ToUnicode "+S+" 0 R"),l("/BaseFont /"+hl(o.fontName)),l("/Encoding /"+o.encoding),l("/DescendantFonts ["+I+" 0 R]"),l(">>"),l("endobj"),o.isAlreadyPutted=!0}})(s)}]),e.events.push(["putFont",function(s){(function(a){var o=a.font,l=a.out,c=a.newObject,d=a.putStream;if(o.metadata instanceof n.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var m=o.metadata.rawData,p="",h=0;h<m.length;h++)p+=String.fromCharCode(m[h]);var b=c();d({data:p,addLength1:!0,objectId:b}),l("endobj");var w=c();d({data:r(o.metadata.toUnicode),addLength1:!0,objectId:w}),l("endobj");var S=c();l("<<"),l("/Descent "+o.metadata.decender),l("/CapHeight "+o.metadata.capHeight),l("/StemV "+o.metadata.stemV),l("/Type /FontDescriptor"),l("/FontFile2 "+b+" 0 R"),l("/Flags 96"),l("/FontBBox "+n.API.PDFObject.convert(o.metadata.bbox)),l("/FontName /"+hl(o.fontName)),l("/ItalicAngle "+o.metadata.italicAngle),l("/Ascent "+o.metadata.ascender),l(">>"),l("endobj"),o.objectNumber=c();for(var A=0;A<o.metadata.hmtx.widths.length;A++)o.metadata.hmtx.widths[A]=parseInt(o.metadata.hmtx.widths[A]*(1e3/o.metadata.head.unitsPerEm));l("<</Subtype/TrueType/Type/Font/ToUnicode "+w+" 0 R/BaseFont/"+hl(o.fontName)+"/FontDescriptor "+S+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),l("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",l=s.x,c=s.y,d=s.options||{},m=s.mutex||{},p=m.pdfEscape,h=m.activeFontKey,b=m.fonts,w=h,S="",A=0,I="",O=b[w].encoding;if(b[w].encoding!=="Identity-H")return{text:o,x:l,y:c,options:d,mutex:m};for(I=o,w=h,Array.isArray(o)&&(I=o[0]),A=0;A<I.length;A+=1)b[w].metadata.hasOwnProperty("cmap")&&(a=b[w].metadata.cmap.unicode.codeMap[I[A].charCodeAt(0)]),a||I[A].charCodeAt(0)<256&&b[w].metadata.hasOwnProperty("Unicode")?S+=I[A]:S+="";var P="";return parseInt(w.slice(1))<14||O==="WinAnsiEncoding"?P=p(S,w).split("").map(function(K){return K.charCodeAt(0).toString(16)}).join(""):O==="Identity-H"&&(P=t(S,b[w])),m.isHex=!0,{text:P,x:l,y:c,options:d,mutex:m}};e.events.push(["postProcessText",function(s){var a=s.text||"",o=[],l={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var c=0;for(c=0;c<a.length;c+=1)Array.isArray(a[c])&&a[c].length===3?o.push([i(Object.assign({},l,{text:a[c][0]})).text,a[c][1],a[c][2]]):o.push(i(Object.assign({},l,{text:a[c]})).text);s.text=o}else s.text=i(Object.assign({},l,{text:a})).text}])})(at),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,r){return e.call(this),this.internal.vFS[t]=r,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(at.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(r){var i,s,a,o,l,c,d,m=e,p=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],b={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},w={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},S=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],A=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),I=!1,O=0;this.__bidiEngine__={};var P=function(_){var L=_.charCodeAt(),C=L>>8,M=w[C];return M!==void 0?m[256*M+(255&L)]:C===252||C===253?"AL":A.test(C)?"L":C===8?"R":"N"},K=function(_){for(var L,C=0;C<_.length;C++){if((L=P(_.charAt(C)))==="L")return!1;if(L==="R")return!0}return!1},le=function(_,L,C,M){var Y,G,te,X,ae=L[M];switch(ae){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":I=!1;break;case"N":case"AN":break;case"EN":I&&(ae="AN");break;case"AL":I=!0,ae="R";break;case"WS":case"BN":ae="N";break;case"CS":M<1||M+1>=L.length||(Y=C[M-1])!=="EN"&&Y!=="AN"||(G=L[M+1])!=="EN"&&G!=="AN"?ae="N":I&&(G="AN"),ae=G===Y?G:"N";break;case"ES":ae=(Y=M>0?C[M-1]:"B")==="EN"&&M+1<L.length&&L[M+1]==="EN"?"EN":"N";break;case"ET":if(M>0&&C[M-1]==="EN"){ae="EN";break}if(I){ae="N";break}for(te=M+1,X=L.length;te<X&&L[te]==="ET";)te++;ae=te<X&&L[te]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(X=L.length,te=M+1;te<X&&L[te]==="NSM";)te++;if(te<X){var me=_[M],fe=me>=1425&&me<=2303||me===64286;if(Y=L[te],fe&&(Y==="R"||Y==="AL")){ae="R";break}}}ae=M<1||(Y=L[M-1])==="B"?"N":C[M-1];break;case"B":I=!1,i=!0,ae=O;break;case"S":s=!0,ae="N"}return ae},he=function(_,L,C){var M=_.split("");return C&&ne(M,C,{hiLevel:O}),M.reverse(),L&&L.reverse(),M.join("")},ne=function(_,L,C){var M,Y,G,te,X,ae=-1,me=_.length,fe=0,k=[],q=O?h:p,W=[];for(I=!1,i=!1,s=!1,Y=0;Y<me;Y++)W[Y]=P(_[Y]);for(G=0;G<me;G++){if(X=fe,k[G]=le(_,W,k,G),M=240&(fe=q[X][b[k[G]]]),fe&=15,L[G]=te=q[fe][5],M>0)if(M===16){for(Y=ae;Y<G;Y++)L[Y]=1;ae=-1}else ae=-1;if(q[fe][6])ae===-1&&(ae=G);else if(ae>-1){for(Y=ae;Y<G;Y++)L[Y]=te;ae=-1}W[G]==="B"&&(L[G]=0),C.hiLevel|=te}s&&(function(U,Q,se){for(var oe=0;oe<se;oe++)if(U[oe]==="S"){Q[oe]=O;for(var pe=oe-1;pe>=0&&U[pe]==="WS";pe--)Q[pe]=O}})(W,L,me)},V=function(_,L,C,M,Y){if(!(Y.hiLevel<_)){if(_===1&&O===1&&!i)return L.reverse(),void(C&&C.reverse());for(var G,te,X,ae,me=L.length,fe=0;fe<me;){if(M[fe]>=_){for(X=fe+1;X<me&&M[X]>=_;)X++;for(ae=fe,te=X-1;ae<te;ae++,te--)G=L[ae],L[ae]=L[te],L[te]=G,C&&(G=C[ae],C[ae]=C[te],C[te]=G);fe=X}fe++}}},ue=function(_,L,C){var M=_.split(""),Y={hiLevel:O};return C||(C=[]),ne(M,C,Y),(function(G,te,X){if(X.hiLevel!==0&&d)for(var ae,me=0;me<G.length;me++)te[me]===1&&(ae=S.indexOf(G[me]))>=0&&(G[me]=S[ae+1])})(M,C,Y),V(2,M,L,C,Y),V(1,M,L,C,Y),M.join("")};return this.__bidiEngine__.doBidiReorder=function(_,L,C){if((function(Y,G){if(G)for(var te=0;te<Y.length;te++)G[te]=te;o===void 0&&(o=K(Y)),c===void 0&&(c=K(Y))})(_,L),a||!l||c)if(a&&l&&o^c)O=o?1:0,_=he(_,L,C);else if(!a&&l&&c)O=o?1:0,_=ue(_,L,C),_=he(_,L);else if(!a||o||l||c){if(a&&!l&&o^c)_=he(_,L),o?(O=0,_=ue(_,L,C)):(O=1,_=ue(_,L,C),_=he(_,L));else if(a&&o&&!l&&c)O=1,_=ue(_,L,C),_=he(_,L);else if(!a&&!l&&o^c){var M=d;o?(O=1,_=ue(_,L,C),O=0,d=!1,_=ue(_,L,C),d=M):(O=0,_=ue(_,L,C),_=he(_,L),O=1,d=!1,_=ue(_,L,C),d=M,_=he(_,L))}}else O=0,_=ue(_,L,C);else O=o?1:0,_=ue(_,L,C);return _},this.__bidiEngine__.setOptions=function(_){_&&(a=_.isInputVisual,l=_.isOutputVisual,o=_.isInputRtl,c=_.isOutputRtl,d=_.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(r){var i=r.text;r.x,r.y;var s=r.options||{};r.mutex,s.lang;var a=[];if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,t.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([t.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([t.doBidiReorder(i[o])]);r.text=a}else r.text=t.doBidiReorder(i);t.setOptions({isInputVisual:!0})}])})(at),at.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new Wa(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new D8(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new _8(this.contents),this.head=new A8(this),this.name=new L8(this),this.cmap=new J2(this),this.toUnicode={},this.hhea=new S8(this),this.maxp=new T8(this),this.hmtx=new C8(this),this.post=new N8(this),this.os2=new E8(this),this.loca=new P8(this),this.glyf=new I8(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,r,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,l,c;for(c=[],a=0,o=(l=this.bbox).length;a<o;a++)e=l[a],c.push(Math.round(e*this.scaleFactor));return c}).call(this),this.stemV=0,this.post.exists?(r=255&(i=this.post.italic_angle),32768&(t=i>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,r){var i,s,a,o;for(a=0,s=0,o=(e=""+e).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=e.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+r*(1e3/t)||0;return a*(t/1e3)},n.prototype.lineHeight=function(e,t){var r;return t==null&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},n})();var ms,Wa=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},n.prototype.writeString=function(e){var t,r,i;for(i=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)i.push(this.writeByte(e.charCodeAt(t)));return i},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,r,i,s,a,o,l;return e=this.readByte(),t=this.readByte(),r=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),l=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^l)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*i+16777216*s+65536*a+256*o+l},n.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},n.prototype.write=function(e){var t,r,i,s;for(s=[],r=0,i=e.length;r<i;r++)t=e[r],s.push(this.writeByte(t));return s},n})(),_8=(function(){var n;function e(t){var r,i,s;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)r={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(t){var r,i,s,a,o,l,c,d,m,p,h,b,w;for(w in h=Object.keys(t).length,l=Math.log(2),m=16*Math.floor(Math.log(h)/l),a=Math.floor(m/l),d=16*h-m,(i=new Wa).writeInt(this.scalarType),i.writeShort(h),i.writeShort(m),i.writeShort(a),i.writeShort(d),s=16*h,c=i.pos+s,o=null,b=[],t)for(p=t[w],i.writeString(w),i.writeInt(n(p)),i.writeInt(c),i.writeInt(p.length),b=b.concat(p),w==="head"&&(o=c),c+=p.length;c%4;)b.push(0),c++;return i.write(b),r=2981146554-n(i.data),i.pos=o+8,i.writeUInt32(r),i.data},n=function(t){var r,i,s,a;for(t=X2.call(t);t.length%4;)t.push(0);for(s=new Wa(t),i=0,r=0,a=t.length;r<a;r=r+=4)i+=s.readUInt32();return 4294967295&i},e})(),x8={}.hasOwnProperty,qs=function(n,e){for(var t in e)x8.call(e,t)&&(n[t]=e[t]);function r(){this.constructor=n}return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};ms=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var A8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new Wa).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),rv=(function(){function n(e,t){var r,i,s,a,o,l,c,d,m,p,h,b,w,S,A,I,O;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),m=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(l=0;l<256;++l)this.codeMap[l]=e.readByte();break;case 4:for(h=e.readUInt16(),p=h/2,e.pos+=6,s=(function(){var P,K;for(K=[],l=P=0;0<=p?P<p:P>p;l=0<=p?++P:--P)K.push(e.readUInt16());return K})(),e.pos+=2,w=(function(){var P,K;for(K=[],l=P=0;0<=p?P<p:P>p;l=0<=p?++P:--P)K.push(e.readUInt16());return K})(),c=(function(){var P,K;for(K=[],l=P=0;0<=p?P<p:P>p;l=0<=p?++P:--P)K.push(e.readUInt16());return K})(),d=(function(){var P,K;for(K=[],l=P=0;0<=p?P<p:P>p;l=0<=p?++P:--P)K.push(e.readUInt16());return K})(),i=(this.length-e.pos+this.offset)/2,o=(function(){var P,K;for(K=[],l=P=0;0<=i?P<i:P>i;l=0<=i?++P:--P)K.push(e.readUInt16());return K})(),l=A=0,O=s.length;A<O;l=++A)for(S=s[l],r=I=b=w[l];b<=S?I<=S:I>=S;r=b<=S?++I:--I)d[l]===0?a=r+c[l]:(a=o[d[l]/2+(r-b)-(p-l)]||0)!==0&&(a+=c[l]),this.codeMap[r]=65535&a}e.pos=m}return n.encode=function(e,t){var r,i,s,a,o,l,c,d,m,p,h,b,w,S,A,I,O,P,K,le,he,ne,V,ue,_,L,C,M,Y,G,te,X,ae,me,fe,k,q,W,U,Q,se,oe,pe,be,xe,Oe;switch(M=new Wa,a=Object.keys(e).sort(function(Te,qe){return Te-qe}),t){case"macroman":for(w=0,S=(function(){var Te=[];for(b=0;b<256;++b)Te.push(0);return Te})(),I={0:0},s={},Y=0,ae=a.length;Y<ae;Y++)I[pe=e[i=a[Y]]]==null&&(I[pe]=++w),s[i]={old:e[i],new:I[e[i]]},S[i]=I[e[i]];return M.writeUInt16(1),M.writeUInt16(0),M.writeUInt32(12),M.writeUInt16(0),M.writeUInt16(262),M.writeUInt16(0),M.write(S),{charMap:s,subtable:M.data,maxGlyphID:w+1};case"unicode":for(L=[],m=[],O=0,I={},r={},A=c=null,G=0,me=a.length;G<me;G++)I[K=e[i=a[G]]]==null&&(I[K]=++O),r[i]={old:K,new:I[K]},o=I[K]-i,A!=null&&o===c||(A&&m.push(A),L.push(i),c=o),A=i;for(A&&m.push(A),m.push(65535),L.push(65535),ue=2*(V=L.length),ne=2*Math.pow(Math.log(V)/Math.LN2,2),p=Math.log(ne/2)/Math.LN2,he=2*V-ne,l=[],le=[],h=[],b=te=0,fe=L.length;te<fe;b=++te){if(_=L[b],d=m[b],_===65535){l.push(0),le.push(0);break}if(_-(C=r[_].new)>=32768)for(l.push(0),le.push(2*(h.length+V-b)),i=X=_;_<=d?X<=d:X>=d;i=_<=d?++X:--X)h.push(r[i].new);else l.push(C-_),le.push(0)}for(M.writeUInt16(3),M.writeUInt16(1),M.writeUInt32(12),M.writeUInt16(4),M.writeUInt16(16+8*V+2*h.length),M.writeUInt16(0),M.writeUInt16(ue),M.writeUInt16(ne),M.writeUInt16(p),M.writeUInt16(he),se=0,k=m.length;se<k;se++)i=m[se],M.writeUInt16(i);for(M.writeUInt16(0),oe=0,q=L.length;oe<q;oe++)i=L[oe],M.writeUInt16(i);for(be=0,W=l.length;be<W;be++)o=l[be],M.writeUInt16(o);for(xe=0,U=le.length;xe<U;xe++)P=le[xe],M.writeUInt16(P);for(Oe=0,Q=h.length;Oe<Q;Oe++)w=h[Oe],M.writeUInt16(w);return{charMap:r,subtable:M.data,maxGlyphID:O+1}}},n})(),J2=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,r,i;for(e.pos=this.offset,this.version=e.readUInt16(),i=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=i?r<i:r>i;r=0<=i?++r:--r)t=new rv(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var r,i;return t==null&&(t="macroman"),r=rv.encode(e,t),(i=new Wa).writeUInt16(0),i.writeUInt16(1),r.table=i.data.concat(r.subtable),r},n})(),S8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),E8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,r;for(r=[],t=0;t<10;++t)r.push(e.readByte());return r})(),this.charRange=(function(){var t,r;for(r=[],t=0;t<4;++t)r.push(e.readInt());return r})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,r;for(r=[],t=0;t<2;t=++t)r.push(e.readInt());return r})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),N8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="post",n.prototype.parse=function(e){var t,r,i;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(r=e.readUInt16(),this.glyphNameIndex=[],s=0;0<=r?s<r:s>r;s=0<=r?++s:--s)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],i=[];e.pos<this.offset+this.length;)t=e.readByte(),i.push(this.names.push(e.readString(t)));return i;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 262144:return this.map=(function(){var a,o,l;for(l=[],s=a=0,o=this.file.maxp.numGlyphs;0<=o?a<o:a>o;s=0<=o?++a:--a)l.push(e.readUInt32());return l}).call(this)}},n})(),k8=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},L8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="name",n.prototype.parse=function(e){var t,r,i,s,a,o,l,c,d,m,p;for(e.pos=this.offset,e.readShort(),t=e.readShort(),o=e.readShort(),r=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+o+e.readShort()});for(l={},s=d=0,m=r.length;d<m;s=++d)i=r[s],e.pos=i.offset,c=e.readString(i.length),a=new k8(c,i),l[p=i.nameID]==null&&(l[p]=[]),l[i.nameID].push(a);this.strings=l,this.copyright=l[0],this.fontFamily=l[1],this.fontSubfamily=l[2],this.uniqueSubfamily=l[3],this.fontName=l[4],this.version=l[5];try{this.postscriptName=l[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=l[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=l[7],this.manufacturer=l[8],this.designer=l[9],this.description=l[10],this.vendorUrl=l[11],this.designerUrl=l[12],this.license=l[13],this.licenseUrl=l[14],this.preferredFamily=l[15],this.preferredSubfamily=l[17],this.compatibleFull=l[18],this.sampleText=l[19]},n})(),T8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),C8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,r,i,s,a,o,l;for(e.pos=this.offset,this.metrics=[],t=0,o=this.file.hhea.numberOfMetrics;0<=o?t<o:t>o;t=0<=o?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var c,d;for(d=[],t=c=0;0<=i?c<i:c>i;t=0<=i?++c:--c)d.push(e.readInt16());return d})(),this.widths=(function(){var c,d,m,p;for(p=[],c=0,d=(m=this.metrics).length;c<d;c++)s=m[c],p.push(s.advance);return p}).call(this),r=this.widths[this.widths.length-1],l=[],t=a=0;0<=i?a<i:a>i;t=0<=i?++a:--a)l.push(this.widths.push(r));return l},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),X2=[].slice,I8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,r,i,s,a,o,l,c,d,m;return e in this.cache?this.cache[e]:(s=this.file.loca,t=this.file.contents,r=s.indexOf(e),(i=s.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+r,a=(o=new Wa(t.read(i))).readShort(),c=o.readShort(),m=o.readShort(),l=o.readShort(),d=o.readShort(),this.cache[e]=a===-1?new R8(o,c,m,l,d):new O8(o,a,c,m,l,d),this.cache[e]))},n.prototype.encode=function(e,t,r){var i,s,a,o,l;for(a=[],s=[],o=0,l=t.length;o<l;o++)i=e[t[o]],s.push(a.length),i&&(a=a.concat(i.encode(r)));return s.push(a.length),{table:a,offsets:s}},n})(),O8=(function(){function n(e,t,r,i,s,a){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),R8=(function(){function n(e,t,r,i,s){var a,o;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return n.prototype.encode=function(){var e,t,r;for(t=new Wa(X2.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),P8=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return qs(n,ms),n.prototype.tag="loca",n.prototype.parse=function(e){var t,r;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var i,s;for(s=[],r=0,i=this.length;r<i;r+=2)s.push(2*e.readUInt16());return s}).call(this):(function(){var i,s;for(s=[],r=0,i=this.length;r<i;r+=4)s.push(e.readUInt32());return s}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var r=new Uint32Array(this.offsets.length),i=0,s=0,a=0;a<r.length;++a)if(r[a]=i,s<t.length&&t[s]==a){++s,r[a]=i;var o=this.offsets[a],l=this.offsets[a+1]-o;l>0&&(i+=l)}for(var c=new Array(4*r.length),d=0;d<r.length;++d)c[4*d+3]=255&r[d],c[4*d+2]=(65280&r[d])>>8,c[4*d+1]=(16711680&r[d])>>16,c[4*d]=(4278190080&r[d])>>24;return c},n})(),D8=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,r,i,s;for(t in i=this.font.cmap.tables[0].codeMap,e={},s=this.subset)r=s[t],e[t]=i[r];return e},n.prototype.glyphsFor=function(e){var t,r,i,s,a,o,l;for(i={},a=0,o=e.length;a<o;a++)i[s=e[a]]=this.font.glyf.glyphFor(s);for(s in t=[],i)(r=i[s])!=null&&r.compound&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(s in l=this.glyphsFor(t))r=l[s],i[s]=r;return i},n.prototype.encode=function(e,t){var r,i,s,a,o,l,c,d,m,p,h,b,w,S,A;for(i in r=J2.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),h={0:0},A=r.charMap)h[(l=A[i]).old]=l.new;for(b in p=r.maxGlyphID,a)b in h||(h[b]=p++);return d=(function(I){var O,P;for(O in P={},I)P[I[O]]=O;return P})(h),m=Object.keys(d).sort(function(I,O){return I-O}),w=(function(){var I,O,P;for(P=[],I=0,O=m.length;I<O;I++)o=m[I],P.push(d[o]);return P})(),s=this.font.glyf.encode(a,w,h),c=this.font.loca.encode(s.offsets,w),S={cmap:this.font.cmap.raw(),glyf:s.table,loca:c,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(S["OS/2"]=this.font.os2.raw()),this.font.directory.encode(S)},n})();at.API.PDFObject=(function(){var n;function e(){}return n=function(t,r){return(Array(r+1).join("0")+t).slice(-r)},e.convert=function(t){var r,i,s,a;if(Array.isArray(t))return"["+(function(){var o,l,c;for(c=[],o=0,l=t.length;o<l;o++)r=t[o],c.push(e.convert(r));return c})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(i in s=["<<"],t)a=t[i],s.push("/"+i+" "+e.convert(a));return s.push(">>"),s.join(`
`)}return""+t},e})();const Pd=210,B8=297,gn=15,q8=Pd-2*gn,fm=B8-10,sd=30;async function j8(n){try{const e=await fetch(n);if(!e.ok)return null;const t=await e.blob();return new Promise(r=>{const i=new FileReader;i.onload=()=>r(i.result),i.onerror=()=>r(null),i.readAsDataURL(t)})}catch{return null}}function Qc(n,e){n.setFontSize(14),n.setFont(void 0,"bold"),n.text(`BATB Audition Pack  ${e}`,gn,gn+5),n.setDrawColor(0),n.line(gn,gn+8,Pd-gn,gn+8),n.setFontSize(7),n.setFont(void 0,"normal"),n.setTextColor(128),n.text(F6(),gn,fm),n.setTextColor(0)}function pm(n,e,t){const{photoDataUrl:r,participation:i,evaluations:s,title:a}=t;let o=t.startY;const c=55+((e.parent2_first_name||e.parent2_email?6:0)+(e.sings_own_disney_song?6:0))+(i?10:0)+Math.max(s.length*8,5)+25+10;o+c>fm-10&&(n.addPage(),Qc(n,a),o=gn+15);const d=gn+(r?sd+5:0);if(r)try{n.addImage(r,"JPEG",gn,o,sd,sd)}catch{}if(n.setFontSize(11),n.setFont(void 0,"bold"),n.text(`${e.first_name||""} ${e.last_name||""}`,d,o+5),n.setFontSize(9),n.setFont(void 0,"normal"),n.text(`Grade: ${e.grade||"N/A"}`,d,o+11),e.parent_first_name||e.parent_email){const p=`Parent: ${e.parent_first_name||""} ${e.parent_last_name||""} | ${e.parent_email||""} | ${e.parent_phone||""}`;n.text(p,d,o+17)}let m=0;if(e.parent2_first_name||e.parent2_email){const p=`Parent 2: ${e.parent2_first_name||""} ${e.parent2_last_name||""} | ${e.parent2_email||""} | ${e.parent2_phone||""}`;n.text(p,d,o+23+m),m+=6}if(e.sings_own_disney_song&&(n.text(`Song: ${e.song_name||"N/A"}`,d,o+23+m),m+=6),o+=Math.max(sd+2,22+m),i&&(n.setFontSize(9),n.setFont(void 0,"italic"),n.text(`${i.label}: ${i.detail}`,gn,o),o+=6),s.length>0){n.setFontSize(8),n.setFont(void 0,"bold"),n.text("Evaluation Notes:",gn,o),o+=5,n.setFont(void 0,"normal");for(const p of s){const h=`[${p.track}] ${p.notes}  ${p.staffName}`,b=n.splitTextToSize(h,q8);n.text(b,gn,o),o+=b.length*4}}o+=3,n.setFontSize(8),n.setFont(void 0,"bold"),n.text("Notes:",gn,o),o+=4,n.setFont(void 0,"normal");for(let p=0;p<3;p++)n.setDrawColor(200),n.line(gn,o,Pd-gn,o),o+=6;return o+=3,n.setDrawColor(180),n.setLineDashPattern([2,2],0),n.line(gn,o,Pd-gn,o),n.setLineDashPattern([],0),o+=5,o}function mm(n,e){return(n||[]).filter(t=>!e||t.track===e||t.track==="general").map(t=>{var r;return{track:t.track,notes:t.notes,staffName:((r=t.staff_profiles)==null?void 0:r.display_name)||"Staff"}})}function $8(n,e){const{role:t}=Jt(),{allowed:r}=uu(t);if(!r)throw new Error("Not authorized");const i=new at({unit:"mm",format:"a4"}),s="Dance Sessions";let a=!0;for(const o of n){a||i.addPage(),a=!1,Qc(i,s);let l=gn+15;i.setFontSize(12),i.setFont(void 0,"bold");const c=o.session.start_time||o.session.dance_start_time,d=o.session.end_time||o.session.dance_end_time,m=o.session.label||`${bt(c)}  ${bt(d)}`;i.text(`${o.session.audition_date}  ${m}`,gn,l),l+=8,i.setFontSize(9),i.setFont(void 0,"normal"),i.text(`${o.students.length} student(s)`,gn,l),l+=8;for(const p of o.students){const h=e.get(p.id)||{};l=pm(i,h.student||p,{photoDataUrl:h.photoDataUrl||null,participation:{label:"Dance Session",detail:`${o.session.audition_date} ${m}`},evaluations:mm(h.evaluations,"dance"),startY:l,title:s})}}return i}function M8(n,e){const{role:t}=Jt(),{allowed:r}=uu(t);if(!r)throw new Error("Not authorized");const i=new at({unit:"mm",format:"a4"}),s="Vocal Slots";let a=!0;for(const o of n){a||i.addPage(),a=!1,Qc(i,s);let l=gn+15;i.setFontSize(12),i.setFont(void 0,"bold");const c=`${bt(o.slot.start_time)}  ${bt(o.slot.end_time)}`;i.text(`${o.slot.audition_date}  ${c}`,gn,l),l+=8,i.setFontSize(9),i.setFont(void 0,"normal"),i.text(`${o.students.length} student(s)`,gn,l),l+=8;for(const d of o.students){const m=e.get(d.id)||{};l=pm(i,m.student||d,{photoDataUrl:m.photoDataUrl||null,participation:{label:"Vocal Slot",detail:`${o.slot.audition_date} ${c}`},evaluations:mm(m.evaluations,"vocal"),startY:l,title:s})}}return i}function F8(n,e,t,r){var p,h;const{role:i}=Jt(),{allowed:s}=uu(i);if(!s)throw new Error("Not authorized");const a=new at({unit:"mm",format:"a4"}),o="Full Audition Pack";Qc(a,o);let l=gn+15,c=!0;const d=new Map;for(const b of e){const w=(p=b.students)==null?void 0:p.id;w&&(d.has(w)||d.set(w,b.dance_window||b.dance_sessions||null))}const m=new Map;for(const b of t)(h=b.students)!=null&&h.id&&m.set(b.students.id,b.audition_slots);for(const b of n){!c&&l>fm-80&&(a.addPage(),Qc(a,o),l=gn+15),c=!1;const w=r.get(b.id)||{},S=d.get(b.id),A=m.get(b.id),I=[];if(S){const O=S.label||`${bt(S.start_time)}-${bt(S.end_time)}`;I.push(`Dance: ${S.audition_date} ${O}`)}A&&I.push(`Vocal: ${A.audition_date} ${bt(A.start_time)}-${bt(A.end_time)}`),b.callback_invited&&I.push("Callbacks: Invited"),l=pm(a,w.student||b,{photoDataUrl:w.photoDataUrl||null,participation:I.length>0?{label:"Tracks",detail:I.join(" | ")}:null,evaluations:mm(w.evaluations,null),startY:l,title:o})}return a}function gm(n,e){n.save(e)}async function vm(n){const e=[...new Set(n)],t=new Map;return await Promise.all(e.map(async r=>{const[i,s]=await Promise.all([Iv(r),am(r)]),a=i.data;let o=null;if(a!=null&&a.photo_storage_path){const{url:l}=await Zp(a.photo_storage_path);l&&(o=await j8(l))}t.set(r,{student:a,photoDataUrl:o,evaluations:s.data||[]})})),t}function ql(){const{role:n}=Jt(),{allowed:e,reason:t}=uu(n);if(!e)throw new Error(t)}async function U8(){ql();const{data:n}=await rm(),{headers:e,rows:t}=j6(n||[]),r=im(e,t);return om(r,"dance-roster.csv")}async function z8(){ql();const{data:n}=await zd(),{headers:e,rows:t}=$6(n||[]),r=im(e,t);return om(r,"vocal-roster.csv")}async function H8(){ql();const{data:n}=await sm(),{headers:e,rows:t}=M6(n||[]),r=im(e,t);return om(r,"callbacks-roster.csv")}async function W8(){ql();const[{data:n},{data:e}]=await Promise.all([rm(),nm()]),t=B6(n||[],e||[]),r=(n||[]).map(a=>{var o;return(o=a.students)==null?void 0:o.id}).filter(Boolean),i=await vm(r),s=$8(t,i);gm(s,"dance-session-pack.pdf")}async function V8(){ql();const[{data:n},{data:e}]=await Promise.all([zd(),kp()]),t=q6(n||[],e||[]),r=(n||[]).map(a=>{var o;return(o=a.students)==null?void 0:o.id}).filter(Boolean),i=await vm(r),s=M8(t,i);gm(s,"vocal-slot-pack.pdf")}async function G8(){ql();const[{data:n},{data:e},{data:t}]=await Promise.all([sm(),rm(),zd()]),r=n||[],i=r.map(o=>o.id),s=await vm(i),a=F8(r,e||[],t||[],s);gm(a,"full-audition-pack.pdf")}const K8=1e3;function jl(n,e=K8){let t=!1,r=0;return async(...i)=>{const s=Date.now();if(!(t||s-r<e)){t=!0,r=s;try{return await n(...i)}finally{t=!1}}}}const Y8=jl(W8),J8=jl(U8);let wc=[],bp=[],vd="";function X8(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <h1>Dance Roster </h1>
    <div id="dance-roster-actions" style="margin-bottom:var(--space-md)"></div>
    <div class="form-message" id="roster-msg" aria-live="polite"></div>
    <div id="dance-roster-content"><p>Loading</p></div>
  `,setTimeout(()=>Z8(),0),n}async function Z8(){const[n,e]=await Promise.all([nm(),s2()]);wc=n.data||[],bp=e.data||[],Q8(),Z2()}function Q8(){var e,t;const n=document.getElementById("dance-roster-actions");n&&(n.innerHTML=`
    <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);align-items:center">
      <button class="btn-small" id="export-dance-pdf-btn"> PDF</button>
      <button class="btn-small btn-secondary" id="export-dance-csv-btn"> CSV</button>
      <span style="font-size:var(--text-xs);color:var(--color-text-muted)">Dance roster is auto-assigned from scheduling config.</span>
    </div>
  `,(e=document.getElementById("export-dance-pdf-btn"))==null||e.addEventListener("click",async r=>{const i=r.target,s=document.getElementById("roster-msg");i.disabled=!0,i.textContent="Generating",s&&(s.className="form-message",s.textContent="");try{await Y8(),s&&(s.className="form-message success",s.textContent="PDF downloaded.")}catch(a){s&&(s.className="form-message error",s.textContent=a.message||"Export failed.")}i.disabled=!1,i.textContent=" PDF"}),(t=document.getElementById("export-dance-csv-btn"))==null||t.addEventListener("click",async r=>{const i=r.target,s=document.getElementById("roster-msg");i.disabled=!0,i.textContent="Exporting";try{await J8(),s&&(s.className="form-message success",s.textContent="CSV downloaded.")}catch(a){s&&(s.className="form-message error",s.textContent=a.message||"Export failed.")}i.disabled=!1,i.textContent=" CSV"}))}function Z2(){const n=document.getElementById("dance-roster-content");if(!n)return;if(wc.length===0){n.innerHTML='<div class="placeholder-notice">No dance windows configured yet. Set dance times in Scheduling.</div>';return}const e=[...new Set(wc.map(i=>i.audition_date))].sort();let t='<div style="margin-bottom:var(--space-md)"><label for="dance-date-filter" style="margin-right:var(--space-sm);font-weight:600;font-size:var(--text-small)">Filter by date:</label>';t+='<select id="dance-date-filter" style="padding:0.5rem 0.75rem;border:1px solid var(--color-border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:var(--text-small)">',t+='<option value="">All dates</option>',e.forEach(i=>{t+=`<option value="${i}" ${vd===i?"selected":""}>${rn(i)}</option>`}),t+="</select></div>";const r=vd?wc.filter(i=>i.audition_date===vd):wc;t+=`
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Dance Window</th>
          <th>Assigned Students</th>
        </tr>
      </thead>
      <tbody>
  `,r.forEach(i=>{const s=bp.filter(a=>a.dance_window_id===i.id);t+=`
      <tr>
        <td>${rn(i.audition_date)}</td>
        <td>${bt(i.start_time)}  ${bt(i.end_time)}</td>
        <td>${s.length}</td>
      </tr>
    `}),t+="</tbody></table></div>",t+='<h2 style="margin-top:var(--space-xl)">Attendees by Dance Window</h2>',r.forEach(i=>{const s=bp.filter(a=>a.dance_window_id===i.id);t+=`<h3 style="margin-top:var(--space-md)">${rn(i.audition_date)}  ${bt(i.start_time)}  ${bt(i.end_time)}</h3>`,s.length===0?t+='<p style="font-size:var(--text-small);color:var(--color-text-muted);margin-bottom:var(--space-sm)">No assigned students yet.</p>':(t+='<table class="data-table"><thead><tr><th>#</th><th>Student</th><th>Grade</th></tr></thead><tbody>',s.forEach((a,o)=>{const l=a.students,c=`#/staff/student-profile?id=${(l==null?void 0:l.id)||""}`;t+=`<tr><td>${o+1}</td><td><a href="${c}">${ye((l==null?void 0:l.first_name)||"")} ${ye((l==null?void 0:l.last_name)||"")}</a></td><td>${ye((l==null?void 0:l.grade)||"")}</td></tr>`}),t+="</tbody></table>")}),n.innerHTML=t,eC()}function eC(n){const e=document.getElementById("dance-date-filter");e&&e.addEventListener("change",()=>{vd=e.value,Z2()})}let Lc={},Ls={};function tC(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <p><a href="#/family"> Back to Dashboard</a></p>
    <h1>Vocal Booking </h1>
    <p style="margin-bottom:var(--space-md)"><a href="#/family/dance" class="link-btn">View dance schedule </a></p>
    <div id="vocal-content"><p>Loading</p></div>
  `,setTimeout(async()=>{const{user:e}=Jt();if(!e)return;const t=document.getElementById("vocal-content");if(!t)return;const[r,i]=await Promise.all([Ol(e.id),Rl()]),s=r.data||[],a=i.data;if(s.length===0){t.innerHTML='<div class="placeholder-notice">No students registered yet. <a href="#/family/register">Start registration</a>.</div>';return}if(Va(a)){const p={};await Promise.all(s.map(async h=>{const{data:b}=await Tp(h.id);b&&(p[h.id]=b)})),t.innerHTML=s.map(h=>{const b=p[h.id],w=b?`<div class="success-box" style="margin:var(--space-sm) 0;padding:var(--space-sm) var(--space-md);border-radius:var(--radius-sm)">
              <p style="font-size:var(--text-small)">Your vocal audition day: <strong>${rn(b.audition_date)}</strong></p>
            </div>`:`<div class="placeholder-notice" style="margin:var(--space-sm) 0">
              Awaiting day assignment from the director. You'll be notified by email once assigned.
            </div>`;return`
          <div class="card" style="margin-bottom:var(--space-md)">
            <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-sm)">
              <div class="avatar">${(h.first_name||"?")[0]}${(h.last_name||"?")[0]}</div>
              <h3 style="margin:0">${ye(h.first_name||"Unnamed")} ${ye(h.last_name||"Student")}</h3>
            </div>
            ${w}
          </div>
        `}).join("");return}const[o,l]=await Promise.all([kp(),Lp()]),c=o.data||[],d=l.data||{};if(c.length===0){t.innerHTML='<div class="placeholder-notice">No vocal slots are available yet. Please check back later.</div>';return}const m={};await Promise.all(s.map(async p=>{const{data:h}=await Ud(p.id);h&&(m[p.id]=h)})),Lc={},Tc(t,s,c,d,m)},0),n}function Tc(n,e,t,r,i){const s=new Date,a=e.map(o=>{var p,h,b,w;const l=Q_(o),c=i[o.id],d=c==null?void 0:c.audition_slots,m=d?Dv(d.audition_date,s):!1;return`
        <div class="card" style="margin-bottom:var(--space-md)">
          <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-sm)">
            <div class="avatar">${(o.first_name||"?")[0]}${(o.last_name||"?")[0]}</div>
            <h3 style="margin:0">${ye(o.first_name||"Unnamed")} ${ye(o.last_name||"Student")}</h3>
          </div>
          ${nC(l,d,m)}
          <div class="${((p=Ls[o.id])==null?void 0:p.type)==="error"?"warning-box":((h=Ls[o.id])==null?void 0:h.type)==="success"?"success-box":"form-message"}" id="vocal-msg-${o.id}" aria-live="polite" style="${(b=Ls[o.id])!=null&&b.text?"margin:var(--space-sm) 0;padding:var(--space-sm) var(--space-md);border-radius:var(--radius-sm)":""}">${((w=Ls[o.id])==null?void 0:w.text)||""}</div>
          ${l.eligible?rC(o,t,r,c,s):""}
        </div>
      `}).join("");n.innerHTML=`
    ${a}
    <p class="lock-time-notice">
      Changes are locked at <strong>${Pv}</strong>. After that, only an admin can make changes.
    </p>
  `,sC(n,e,t,r,i)}function nC(n,e,t){return n.eligible?t?'<div class="locked-notice"> Bookings are locked for this audition date. Contact an admin for changes.</div>':e?`
      <div class="success-box" style="margin:var(--space-sm) 0;padding:var(--space-sm) var(--space-md);border-radius:var(--radius-sm)">
        <p style="font-size:var(--text-small)"> Booked: <strong>${rn(e.audition_date)}</strong>
         ${bt(e.start_time)}  ${bt(e.end_time)}</p>
      </div>
    `:'<div class="placeholder-notice" style="margin:var(--space-sm) 0">Select a time slot below to book.</div>':`<div class="warning-box" style="margin:var(--space-sm) 0;padding:var(--space-sm) var(--space-md);border-radius:var(--radius-sm)"><p style="font-size:var(--text-small)">${n.reason}</p></div>`}function rC(n,e,t,r,i){const s=r==null?void 0:r.audition_slot_id,a=!!r,o=Lc[n.id],l={};e.forEach(d=>{l[d.audition_date]||(l[d.audition_date]=[]),l[d.audition_date].push(d)});let c="";for(const[d,m]of Object.entries(l)){const p=Dv(d,i);c+=`<h4 style="margin-top:var(--space-md);font-size:var(--text-small);color:var(--color-text-secondary)">${rn(d)}${p?' <span style="color:var(--color-error)"> Locked</span>':""}</h4>`,m.forEach(h=>{const b=t[h.id]||0,w=ex(b),S=h.id===s,A=h.id===o,I=!p&&(w.available||S),O=Math.min(b/Fc*100,100);let P="green";O>=100?P="full":O>=80?P="red":O>=60&&(P="amber");const K=`${w.spotsLeft}/${Fc} spots left`;let le="session-card";S||A?le="session-card selected":I||(le="session-card full"),c+=`
        <div class="${le}">
          <div class="session-info">
            <strong>${bt(h.start_time)}  ${bt(h.end_time)}</strong>
            <div class="capacity-bar" style="margin-top:var(--space-xs);max-width:200px"><div class="capacity-bar__fill capacity-bar__fill--${P}" style="width:${O}%"></div></div>
            <span style="font-size:var(--text-xs);color:var(--color-text-muted)">${K}</span>
          </div>
          <div class="session-actions">
            ${S?`<button class="btn-small btn-secondary cancel-btn" data-student="${n.id}" ${p?"disabled":""}>Cancel</button>`:`<button class="btn-small ${a?"reschedule-btn":"book-btn"}" data-student="${n.id}" data-slot="${h.id}" ${I?"":"disabled"}>${A?" Selected":a?"Move Here":"Book"}</button>`}
          </div>
        </div>
      `})}if(o){const d=e.find(h=>h.id===o),m=`${bt(d==null?void 0:d.start_time)}  ${bt(d==null?void 0:d.end_time)}`,p=a?"Confirm Move":"Confirm Booking";c+=`
      <div class="booking-footer" style="margin-top:var(--space-md);border-radius:var(--radius-sm);position:relative">
        <div class="booking-footer__info">${a?"Move":"Book"} <strong>${ye(n.first_name)}</strong> to <strong>${ye(m)}</strong></div>
        <button class="btn-accent confirm-booking-btn" data-student="${n.id}" data-slot="${o}" data-action="${a?"reschedule":"book"}">${p}</button>
      </div>
    `}return c}function iC(n,e){return new Promise(t=>{const r=document.createElement("div");r.className="confirm-dialog-backdrop",r.innerHTML=`
      <div class="confirm-dialog" role="alertdialog" aria-modal="true">
        <div class="confirm-dialog__title">${n}</div>
        <div class="confirm-dialog__message">${e}</div>
        <div class="confirm-dialog__actions">
          <button class="btn-ghost" data-action="cancel">Go Back</button>
          <button class="btn-primary" data-action="confirm">Confirm</button>
        </div>
      </div>
    `,r.querySelector('[data-action="confirm"]').addEventListener("click",()=>{r.remove(),t(!0)}),r.querySelector('[data-action="cancel"]').addEventListener("click",()=>{r.remove(),t(!1)}),r.addEventListener("click",i=>{i.target===r&&(r.remove(),t(!1))}),document.body.appendChild(r),r.querySelector('[data-action="confirm"]').focus()})}function sC(n,e,t,r,i){n.querySelectorAll(".book-btn, .reschedule-btn").forEach(s=>{s.addEventListener("click",()=>{const a=s.dataset.student,o=s.dataset.slot;Lc[a]=o,Tc(n,e,t,r,i)})}),n.querySelectorAll(".confirm-booking-btn").forEach(s=>{s.addEventListener("click",async()=>{const a=s.dataset.student,o=s.dataset.slot,l=s.dataset.action;function c(d){Ls[a]={type:"error",text:d},delete Lc[a],Tc(n,e,t,r,i);const m=document.getElementById(`vocal-msg-${a}`);m&&m.scrollIntoView({behavior:"smooth",block:"nearest"})}delete Ls[a],s.disabled=!0,s.textContent=l==="reschedule"?"Moving":"Booking";try{const{error:d}=l==="reschedule"?await ix(a,o):await rx(a,o);if(d){c(d.message||"Booking failed. Please try again.");return}delete Lc[a],Ls[a]={type:"success",text:l==="reschedule"?"Rescheduled successfully.":"Booked successfully."},await iv(n,e,t,i)}catch(d){c(d.message||"An unexpected error occurred. Please try again.")}})}),n.querySelectorAll(".cancel-btn").forEach(s=>{s.addEventListener("click",async()=>{if(!await iC("Cancel Booking","Cancel this vocal booking? You may lose your spot."))return;const o=s.dataset.student;function l(c){Ls[o]={type:"error",text:c},Tc(n,e,t,r,i);const d=document.getElementById(`vocal-msg-${o}`);d&&d.scrollIntoView({behavior:"smooth",block:"nearest"})}delete Ls[o],s.disabled=!0,s.textContent="Cancelling";try{const{error:c}=await sx(o);if(c){l(c.message||"Failed to cancel. Please try again.");return}delete i[o],Ls[o]={type:"success",text:"Booking canceled."},await iv(n,e,t,i)}catch(c){l(c.message||"An unexpected error occurred. Please try again.")}})})}async function iv(n,e,t,r){await Promise.all(e.map(async s=>{const{data:a}=await Ud(s.id);a?r[s.id]=a:delete r[s.id]}));const{data:i}=await Lp();Tc(n,e,t,i||{},r)}const aC=jl(V8),oC=jl(z8);let Cs=[],Q2=[],yp={},ia="",eu=null,tu=[],bd=[],Yr=new Set;function lC(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <h1>Vocal Roster </h1>
    <div id="vocal-roster-mode-banner"></div>
    <div id="vocal-roster-actions" style="margin-bottom:var(--space-md)"></div>
    <div class="form-message" id="vocal-roster-msg" aria-live="polite"></div>
    <div id="vocal-roster-content"><p>Loading</p></div>
  `,setTimeout(()=>Cc(),0),n}async function Cc(){const[n,e,t,r,i,s]=await Promise.all([kp(),zd(),Lp(),Rl(),Po(),Bv()]);Cs=n.data||[],Q2=e.data||[],yp=t.data||{},eu=r.data||null,tu=[...new Set((i.data||[]).map(o=>o.audition_date))].sort(),bd=s.data||[],Yr=new Set([...Yr].filter(o=>Cs.some(l=>l.id===o)));const a=document.getElementById("vocal-roster-mode-banner");a&&Va(eu)?a.innerHTML=`
      <div class="warning-box" style="padding:var(--space-md);border-radius:var(--radius-sm);margin-bottom:var(--space-md)">
        <strong>Day Assignment Mode Active</strong>
        <p style="font-size:var(--text-small);margin:var(--space-xs) 0 0">
          Vocal auditions are using day assignment mode. Families cannot self-book timeslots.
          <a href="#/staff/vocal-assignments">Manage day assignments </a>
        </p>
      </div>
    `:a&&(a.innerHTML=""),cC(),yd()}function cC(){var r,i,s;const n=document.getElementById("vocal-roster-actions");if(!n)return;const{role:e}=Jt();if(Va(eu)){n.innerHTML=`
    <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);align-items:center">
      <a href="#/staff/vocal-assignments" class="btn-primary" style="display:inline-flex;align-items:center;justify-content:center;text-decoration:none">Manage Vocal Day Assignments</a>
      <span style="font-size:var(--text-xs);color:var(--color-text-muted)">Day mode roster groups students by assigned audition date.</span>
    </div>
  `;return}n.innerHTML=`
    <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);align-items:center">
      <button class="btn-primary" id="generate-slots-btn">Generate Slots</button>
      <button class="btn-small" id="export-vocal-pdf-btn"> PDF</button>
      <button class="btn-small btn-secondary" id="export-vocal-csv-btn"> CSV</button>
      ${Ro(e)?'<span style="font-size:var(--text-xs);color:var(--color-text-muted)">(Admin: delete slots and override bookings below)</span>':""}
    </div>
  `,(r=document.getElementById("generate-slots-btn"))==null||r.addEventListener("click",async a=>{const o=a.target,l=document.getElementById("vocal-roster-msg");o.disabled=!0,o.textContent="Generating",l&&(l.className="form-message",l.textContent="");const{user:c}=Jt(),{data:d,error:m}=await nx(c.id);if(m){o.disabled=!1,o.textContent="Generate Slots",l&&(l.className="form-message error",l.textContent=m.message||"Failed to generate slots.");return}const p=(d==null?void 0:d.length)||0;l&&(l.className="form-message success",l.textContent=p>0?`Generated ${p} slot(s).`:"No new slots to generate (all time blocks already exist)."),o.disabled=!1,o.textContent="Generate Slots",await Cc()}),(i=document.getElementById("export-vocal-pdf-btn"))==null||i.addEventListener("click",async a=>{const o=a.target,l=document.getElementById("vocal-roster-msg");o.disabled=!0,o.textContent="Generating",l&&(l.className="form-message",l.textContent="");try{await aC(),l&&(l.className="form-message success",l.textContent="PDF downloaded.")}catch(c){l&&(l.className="form-message error",l.textContent=c.message||"Export failed.")}o.disabled=!1,o.textContent=" PDF"}),(s=document.getElementById("export-vocal-csv-btn"))==null||s.addEventListener("click",async a=>{const o=a.target,l=document.getElementById("vocal-roster-msg");o.disabled=!0,o.textContent="Exporting";try{await oC(),l&&(l.className="form-message success",l.textContent="CSV downloaded.")}catch(c){l&&(l.className="form-message error",l.textContent=c.message||"Export failed.")}o.disabled=!1,o.textContent=" CSV"})}function yd(){const n=document.getElementById("vocal-roster-content");if(!n)return;const{role:e}=Jt(),t=Ro(e),r=Va(eu);if(r){n.innerHTML=uC(t),bf(n);return}if(Cs.length===0){let c='<div class="placeholder-notice">No vocal slots exist yet. Click "Generate Slots" to create them.</div>';t&&(c+=Dd(r)),n.innerHTML=c,bf(n);return}const i=[...new Set(Cs.map(c=>c.audition_date))].sort();let s='<div style="margin-bottom:var(--space-md)"><label for="vocal-date-filter" style="margin-right:var(--space-sm);font-weight:600;font-size:var(--text-small)">Filter by date:</label>';s+='<select id="vocal-date-filter" style="padding:0.5rem 0.75rem;border:1px solid var(--color-border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:var(--text-small)">',s+='<option value="">All dates</option>',i.forEach(c=>{s+=`<option value="${c}" ${ia===c?"selected":""}>${rn(c)}</option>`}),s+="</select></div>";const a=ia?Cs.filter(c=>c.audition_date===ia):Cs,o=a.length>0&&a.every(c=>Yr.has(c.id)),l={};a.forEach(c=>{l[c.audition_date]||(l[c.audition_date]=[]),l[c.audition_date].push(c)}),s+=`
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          ${t?`<th class="checkbox-cell"><input type="checkbox" id="select-all-slots-cb" ${o?"checked":""} /></th>`:""}
          <th>Date</th>
          <th>Time</th>
          <th>Booked</th>
          ${t?"<th>Actions</th>":""}
        </tr>
      </thead>
      <tbody>
  `,a.forEach(c=>{const d=yp[c.id]||0;s+=`
      <tr>
        ${t?`<td class="checkbox-cell"><input type="checkbox" class="slot-select-cb" data-id="${c.id}" ${Yr.has(c.id)?"checked":""} /></td>`:""}
        <td>${rn(c.audition_date)}</td>
        <td>${bt(c.start_time)}  ${bt(c.end_time)}</td>
        <td>${d} / ${Fc}</td>
        ${t?`<td><button class="btn-small btn-secondary delete-slot-btn" data-id="${c.id}">Delete</button></td>`:""}
      </tr>
    `}),s+="</tbody></table></div>",t&&Yr.size>0&&(s+=`
      <div class="bulk-action-bar" style="margin-top:var(--space-sm)">
        <span class="bulk-action-bar__count">${Yr.size} slot(s) selected</span>
        <div class="bulk-action-bar__actions">
          <button class="btn-small btn-secondary" id="bulk-delete-slots-btn">Delete Selected Slots</button>
        </div>
      </div>
    `),s+='<h2 style="margin-top:var(--space-xl)">Attendees by Slot</h2>';for(const[c,d]of Object.entries(l))s+=`<h3 style="margin-top:var(--space-md)">${rn(c)}</h3>`,d.forEach(m=>{const p=Q2.filter(b=>b.audition_slot_id===m.id),h=yp[m.id]||0;s+=`<h4 style="margin-top:var(--space-sm);font-size:var(--text-small)">${bt(m.start_time)}  ${bt(m.end_time)} (${h}/${Fc})</h4>`,p.length===0?s+='<p style="font-size:var(--text-small);color:var(--color-text-muted);margin-bottom:var(--space-sm)">No bookings yet.</p>':(s+='<table class="data-table"><thead><tr><th>#</th><th>Student</th><th>Grade</th></tr></thead><tbody>',p.forEach((b,w)=>{const S=b.students,A=`#/staff/student-profile?id=${(S==null?void 0:S.id)||""}`;s+=`<tr><td>${w+1}</td><td><a href="${A}">${ye((S==null?void 0:S.first_name)||"")} ${ye((S==null?void 0:S.last_name)||"")}</a></td><td>${ye((S==null?void 0:S.grade)||"")}</td></tr>`}),s+="</tbody></table>")});t&&(s+=Dd(r)),n.innerHTML=s,bf(n)}function uC(n){const e=tu.length>0?tu:[...new Set(bd.map(a=>a.audition_date))].sort();if(e.length===0){let a='<div class="placeholder-notice">No audition dates configured yet. Use Scheduling to add dates.</div>';return n&&(a+=Dd(!0)),a}let t='<div style="margin-bottom:var(--space-md)"><label for="vocal-date-filter" style="margin-right:var(--space-sm);font-weight:600;font-size:var(--text-small)">Filter by date:</label>';t+='<select id="vocal-date-filter" style="padding:0.5rem 0.75rem;border:1px solid var(--color-border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:var(--text-small)">',t+='<option value="">All dates</option>',e.forEach(a=>{t+=`<option value="${a}" ${ia===a?"selected":""}>${rn(a)}</option>`}),t+="</select></div>";const r=ia?e.filter(a=>a===ia):e,i=new Map;r.forEach(a=>i.set(a,[])),bd.forEach(a=>{i.has(a.audition_date)&&i.get(a.audition_date).push(a)}),t+='<h2 style="margin-top:var(--space-sm)">Students by Vocal Day</h2>',r.forEach(a=>{const o=i.get(a)||[];if(t+=`
      <h3 style="margin-top:var(--space-md)">${rn(a)} (${o.length})</h3>
    `,o.length===0){t+='<p style="font-size:var(--text-small);color:var(--color-text-muted);margin-bottom:var(--space-sm)">No students assigned to this day.</p>';return}t+='<table class="data-table"><thead><tr><th>#</th><th>Student</th><th>Grade</th></tr></thead><tbody>',o.forEach((l,c)=>{const d=l.students,m=`#/staff/student-profile?id=${(d==null?void 0:d.id)||""}`;t+=`<tr><td>${c+1}</td><td><a href="${m}">${ye((d==null?void 0:d.first_name)||"")} ${ye((d==null?void 0:d.last_name)||"")}</a></td><td>${ye((d==null?void 0:d.grade)||"")}</td></tr>`}),t+="</tbody></table>"});const s=bd.filter(a=>!a.audition_date).length;return s>0&&(t+=`<p style="margin-top:var(--space-sm);font-size:var(--text-small);color:var(--color-text-muted)">${s} assignment(s) missing a date.</p>`),n&&(t+=Dd(!0)),t}function Dd(n){const e=Cs.map(s=>`<option value="${s.id}">${rn(s.audition_date)}  ${bt(s.start_time)}${bt(s.end_time)}</option>`).join(""),t=[...new Set(Cs.map(s=>s.audition_date))].sort(),i=(tu.length>0?tu:t).map(s=>`<option value="${s}">${rn(s)}</option>`).join("");return`
    <hr>
    <h2>Admin Override</h2>
    <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">${n?"Assign or change a student's vocal audition day.":"Assign or change a student's vocal slot (bypasses lock time and capacity)."}</p>
    <div class="login-form" style="max-width:500px">
      <label for="vocal-override-student-id">Student ID</label>
      <input type="text" id="vocal-override-student-id" placeholder="Paste student UUID" />
      ${n?`<label for="vocal-override-day">Vocal Day</label>
      <select id="vocal-override-day" style="padding:0.5rem 0.75rem;border:1px solid var(--color-border);border-radius:var(--radius-sm);font-family:var(--font-body)">
        <option value="">Select a day</option>
        ${i}
      </select>`:`<label for="vocal-override-slot">Vocal Slot</label>
      <select id="vocal-override-slot" style="padding:0.5rem 0.75rem;border:1px solid var(--color-border);border-radius:var(--radius-sm);font-family:var(--font-body)">
        <option value="">Select a slot</option>
        ${e}
      </select>`}
      <button id="vocal-override-btn" class="btn-primary">${n?"Assign Day":"Assign Slot"}</button>
      <div class="form-message" id="vocal-override-msg" aria-live="polite"></div>
    </div>
  `}function bf(n){const e=document.getElementById("vocal-date-filter");e&&e.addEventListener("change",()=>{ia=e.value,yd()});const t=document.getElementById("select-all-slots-cb");t&&t.addEventListener("change",()=>{const s=ia?Cs.filter(a=>a.audition_date===ia):Cs;t.checked?s.forEach(a=>Yr.add(a.id)):s.forEach(a=>Yr.delete(a.id)),yd()}),n.querySelectorAll(".slot-select-cb").forEach(s=>{s.addEventListener("change",()=>{s.checked?Yr.add(s.dataset.id):Yr.delete(s.dataset.id),yd()})}),n.querySelectorAll(".delete-slot-btn").forEach(s=>{s.addEventListener("click",async()=>{if(!window.confirm("Delete this vocal slot? Any existing bookings will be removed."))return;const a=s.dataset.id;s.disabled=!0,s.textContent="Deleting";const{error:o}=await Og(a),l=document.getElementById("vocal-roster-msg");if(o){s.disabled=!1,s.textContent="Delete",l&&(l.className="form-message error",l.textContent=o.message||"Failed to delete slot.");return}l&&(l.className="form-message success",l.textContent="Slot deleted."),Yr.delete(a),await Cc()})});const r=document.getElementById("bulk-delete-slots-btn");r&&r.addEventListener("click",async()=>{if(Yr.size===0||!window.confirm(`Delete ${Yr.size} selected vocal slot(s)? Any existing bookings will be removed.`))return;const s=document.getElementById("vocal-roster-msg");r.disabled=!0,r.textContent="Deleting";let a=0,o=0;for(const l of Yr){const{error:c}=await Og(l);c?o++:a++}r.disabled=!1,r.textContent="Delete Selected Slots",Yr.clear(),s&&(o===0?(s.className="form-message success",s.textContent=`Deleted ${a} slot(s).`):(s.className="form-message error",s.textContent=`Deleted ${a} slot(s), ${o} failed.`)),await Cc()});const i=document.getElementById("vocal-override-btn");i&&i.addEventListener("click",async()=>{var m,p,h,b;const s=Va(eu),a=(p=(m=document.getElementById("vocal-override-student-id"))==null?void 0:m.value)==null?void 0:p.trim(),o=(h=document.getElementById("vocal-override-slot"))==null?void 0:h.value,l=(b=document.getElementById("vocal-override-day"))==null?void 0:b.value,c=document.getElementById("vocal-override-msg");if(!a||!s&&!o||s&&!l){c&&(c.className="form-message error",c.textContent=s?"Both student ID and day are required.":"Both student ID and slot are required.");return}i.disabled=!0,i.textContent="Assigning",c&&(c.className="form-message",c.textContent="");const{error:d}=s?await mc(a,l):await ax(a,o);if(d){i.disabled=!1,i.textContent=s?"Assign Day":"Assign Slot",c&&(c.className="form-message error",c.textContent=d.message||"Override failed.");return}c&&(c.className="form-message success",c.textContent=s?"Student assigned to day.":"Student assigned to slot."),i.disabled=!1,i.textContent=s?"Assign Day":"Assign Slot",await Cc()})}const dC=jl(G8),hC=jl(H8);let Rs=[],rh=[],nu=[],xi=new Set;function fC(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <h1>Callback Management </h1>
    <div id="callback-actions" style="margin-bottom:var(--space-md)"></div>
    <div class="form-message" id="callback-msg" aria-live="polite"></div>
    <div id="callback-content"><p>Loading</p></div>
  `,setTimeout(()=>wd(),0),n}async function wd(){const[n,e,t]=await Promise.all([sm(),Po(),du()]);Rs=n.data||[],rh=e.data||[],nu=t.data||[],pC(),Ic()}function pC(){var r,i,s;const n=document.getElementById("callback-actions");if(!n)return;const e=Rs.filter(a=>Qd(a)).length,t=Rs.length;n.innerHTML=`
    <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);align-items:center;margin-bottom:var(--space-sm)">
      <button class="btn-primary" id="send-all-btn">Send Notifications</button>
      <button class="btn-small" id="export-callbacks-pdf-btn"> Full Pack PDF</button>
      <button class="btn-small btn-secondary" id="export-callbacks-csv-btn"> CSV</button>
    </div>
    <p style="font-size:var(--text-small);color:var(--color-text-secondary)">
      <strong>${e}</strong> of <strong>${t}</strong> students invited to callbacks.
      <span style="color:var(--color-text-muted)">(Real email delivery via Resend)</span>
    </p>
  `,(r=document.getElementById("send-all-btn"))==null||r.addEventListener("click",mC),(i=document.getElementById("export-callbacks-pdf-btn"))==null||i.addEventListener("click",async a=>{const o=a.target,l=document.getElementById("callback-msg");o.disabled=!0,o.textContent="Generating",l&&(l.className="form-message",l.textContent="");try{await dC(),l&&(l.className="form-message success",l.textContent="PDF downloaded.")}catch(c){l&&(l.className="form-message error",l.textContent=c.message||"Export failed.")}o.disabled=!1,o.textContent=" Full Pack PDF"}),(s=document.getElementById("export-callbacks-csv-btn"))==null||s.addEventListener("click",async a=>{const o=a.target,l=document.getElementById("callback-msg");o.disabled=!0,o.textContent="Exporting";try{await hC(),l&&(l.className="form-message success",l.textContent="CSV downloaded.")}catch(c){l&&(l.className="form-message error",l.textContent=c.message||"Export failed.")}o.disabled=!1,o.textContent=" CSV"})}async function mC(){const n=document.getElementById("send-all-btn"),e=document.getElementById("callback-msg");if(!n)return;const t=Rs.filter(o=>Qd(o)&&eh(o).valid);if(t.length===0){e&&(e.className="form-message error",e.textContent="No invited students with parent email on file.");return}n.disabled=!0,n.textContent="Sending",e&&(e.className="form-message",e.textContent="");const r=await Promise.allSettled(t.map(async o=>{const{subject:l,body:c,bodyPreview:d}=r2(o,rh),{error:m}=await Qp({to:o.parent_email,subject:l,text:c});if(m)throw m;const{error:p}=await a2(o.id,o.parent_email,l,d);if(p)throw p;return o.id})),i=r.filter(o=>o.status==="fulfilled").length,s=r.filter(o=>o.status==="rejected").length;n.disabled=!1,n.textContent="Send Notifications",e&&(s===0?(e.className="form-message success",e.textContent=`Sent ${i} notification(s) successfully.`):(e.className="form-message error",e.textContent=`Sent ${i}, failed ${s}. Check console for details.`));const{data:a}=await du();nu=a||[],Ic()}function Ic(){const n=document.getElementById("callback-content");if(!n)return;if(Rs.length===0){n.innerHTML='<div class="placeholder-notice">No students registered yet.</div>';return}let e=gC();e+=vC(),e+=bC(),e+=yC(),n.innerHTML=e,wC(n)}function gC(){let e=`
    <h2>Students</h2>
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th class="checkbox-cell"><input type="checkbox" id="select-all-cb" ${Rs.length>0&&xi.size===Rs.length?"checked":""} /></th>
          <th>#</th>
          <th>Name</th>
          <th>Grade</th>
          <th>Registration</th>
          <th>Invited</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
  `;return Rs.forEach((t,r)=>{const i=Qd(t),s=eh(t),a=t.registration_complete?" Complete":" Incomplete",o=t.registration_complete?"color:var(--color-success)":"color:var(--color-error)",l=xi.has(t.id)?"checked":"";e+=`
      <tr>
        <td class="checkbox-cell"><input type="checkbox" class="student-cb" data-id="${t.id}" ${l} /></td>
        <td>${r+1}</td>
        <td><a href="#/staff/student-profile?id=${t.id}">${ye(t.first_name||"")} ${ye(t.last_name||"")}</a></td>
        <td>${ye(t.grade||"")}</td>
        <td style="${o};font-size:var(--text-small)">${a}</td>
        <td>
          <button class="btn-small ${i?"btn-secondary":""} invite-toggle-btn"
                  data-id="${t.id}" data-invited="${i}">
            ${i?"Uninvite":"Invite"}
          </button>
        </td>
        <td>
          <button class="btn-small send-one-btn"
                  data-id="${t.id}"
                  ${!i||!s.valid?"disabled":""}
                  title="${i?s.valid?"Send notification":s.reason:"Not invited"}">
            Send
          </button>
        </td>
      </tr>
    `}),e+="</tbody></table></div>",e}function vC(){return xi.size===0?"":`
    <div class="bulk-action-bar">
      <span class="bulk-action-bar__count">${xi.size} selected</span>
      <div class="bulk-action-bar__actions">
        <button class="btn-accent" id="bulk-invite-btn">Invite Selected (${xi.size})</button>
        <button class="btn-ghost" id="bulk-uninvite-btn" style="color:var(--color-surface);border-color:hsla(0,0%,100%,0.3)">Uninvite Selected</button>
      </div>
    </div>
  `}function bC(){const n=rh.filter(t=>t.callback_start_time&&t.callback_end_time);if(n.length===0)return'<p style="margin-top:var(--space-lg);font-size:var(--text-small);color:var(--color-text-muted)">No callback windows configured yet. Set them in <a href="#/staff/scheduling">Scheduling</a>.</p>';let e='<h2 style="margin-top:var(--space-xl)">Callback Windows</h2>';return e+='<table class="data-table"><thead><tr><th>Date</th><th>Start</th><th>End</th></tr></thead><tbody>',n.forEach(t=>{e+=`<tr><td>${rn(t.audition_date)}</td><td>${bt(t.callback_start_time)}</td><td>${bt(t.callback_end_time)}</td></tr>`}),e+="</tbody></table>",e}function yC(){let n='<h2 style="margin-top:var(--space-xl)">Notification History</h2>';return nu.length===0?(n+='<p style="font-size:var(--text-small);color:var(--color-text-muted)">No notifications sent yet.</p>',n):(n+=`
    <table class="data-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Student</th>
          <th>Recipient</th>
          <th>Subject</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
  `,nu.forEach(e=>{const t=e.students,r=new Date(e.created_at).toLocaleString();n+=`
      <tr>
        <td style="font-size:var(--text-xs)">${ye(r)}</td>
        <td>${ye((t==null?void 0:t.first_name)||"")} ${ye((t==null?void 0:t.last_name)||"")}</td>
        <td>${ye(e.recipient_email)}</td>
        <td>${ye(e.subject)}</td>
        <td><span class="status-badge--complete">${ye(e.status)}</span></td>
      </tr>
    `}),n+="</tbody></table>",n)}function wC(n){const e=document.getElementById("select-all-cb");e&&e.addEventListener("change",()=>{e.checked?Rs.forEach(i=>xi.add(i.id)):xi.clear(),Ic()}),n.querySelectorAll(".student-cb").forEach(i=>{i.addEventListener("change",()=>{i.checked?xi.add(i.dataset.id):xi.delete(i.dataset.id),Ic()})});const t=document.getElementById("bulk-invite-btn");t&&t.addEventListener("click",async()=>{const i=document.getElementById("callback-msg");t.disabled=!0,t.textContent="Inviting";for(const s of xi)await Kh(s,!0);xi.clear(),i&&(i.className="form-message success",i.textContent="Selected students invited."),await wd()});const r=document.getElementById("bulk-uninvite-btn");r&&r.addEventListener("click",async()=>{const i=document.getElementById("callback-msg");r.disabled=!0,r.textContent="Removing";for(const s of xi)await Kh(s,!1);xi.clear(),i&&(i.className="form-message success",i.textContent="Invites removed for selected students."),await wd()}),n.querySelectorAll(".invite-toggle-btn").forEach(i=>{i.addEventListener("click",async()=>{const s=i.dataset.id,a=i.dataset.invited==="true",o=!a;if(a&&!window.confirm("Remove this student's callback invite?"))return;const l=document.getElementById("callback-msg");i.disabled=!0,i.textContent=o?"Inviting":"Removing";const{error:c}=await Kh(s,o);if(c){i.disabled=!1,i.textContent=a?"Uninvite":"Invite",l&&(l.className="form-message error",l.textContent=c.message||"Failed to update invite.");return}l&&(l.className="form-message success",l.textContent=o?"Student invited.":"Invite removed."),await wd()})}),n.querySelectorAll(".send-one-btn").forEach(i=>{i.addEventListener("click",async()=>{const s=i.dataset.id,a=Rs.find(b=>b.id===s);if(!a)return;const o=document.getElementById("callback-msg");i.disabled=!0,i.textContent="Sending";const{subject:l,body:c,bodyPreview:d}=r2(a,rh),{error:m}=await Qp({to:a.parent_email,subject:l,text:c});if(m){i.disabled=!1,i.textContent="Send",o&&(o.className="form-message error",o.textContent=m.message||"Failed to send notification.");return}const{error:p}=await a2(a.id,a.parent_email,l,d);if(p){i.disabled=!1,i.textContent="Send",o&&(o.className="form-message error",o.textContent=p.message||"Failed to log notification.");return}o&&(o.className="form-message success",o.textContent=`Notification sent to ${ye(a.parent_email)}.`);const{data:h}=await du();nu=h||[],Ic()})})}const sv=["dance","vocal","callbacks","general"];function _C(n,e,t,r){if(!n)return{student:null,dance:null,vocal:null,callbackInvited:!1,evaluations:[],missingFields:["Student not found"]};const i=[];return n.first_name||i.push("first_name"),n.last_name||i.push("last_name"),n.grade||i.push("grade"),n.photo_storage_path||i.push("photo"),n.parent_first_name||i.push("parent_first_name"),n.parent_last_name||i.push("parent_last_name"),n.parent_email||i.push("parent_email"),n.parent_phone||i.push("parent_phone"),{student:n,dance:e||null,vocal:t||null,callbackInvited:n.callback_invited===!0,evaluations:r||[],missingFields:i}}function xC(n,e){const t=[];return(!n||!n.trim())&&t.push("Notes cannot be empty."),(!e||!sv.includes(e))&&t.push(`Track must be one of: ${sv.join(", ")}.`),{valid:t.length===0,errors:t}}let cr=null,Bd=null,ts=null,ks=null;function AC(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Student Profile</h1>
      <button class="btn-ghost" onclick="history.back()" style="min-height:auto;width:auto"> Back</button>
    </div>
    <div class="form-message" id="profile-msg" aria-live="polite"></div>
    <div id="profile-content"><p>Loading</p></div>
  `,setTimeout(()=>SC(),0),n}async function SC(){var a;const e=Yy().id;if(!e){av("No student ID provided. Use a link from a roster page.");return}const[t,r,i,s]=await Promise.all([Iv(e),nm(),Ud(e),am(e)]);if(t.error||!t.data){av(((a=t.error)==null?void 0:a.message)||"Student not found.");return}if(cr=_C(t.data,{dance_windows:r.data||[]},i.data,s.data||[]),Bd=null,cr.student.photo_storage_path){const{url:o}=await Zp(cr.student.photo_storage_path);Bd=o}ts=null,ks=null,_d()}function av(n){const e=document.getElementById("profile-content");e&&(e.innerHTML=`<div class="placeholder-notice">${ye(n)}</div>`)}function _d(){const n=document.getElementById("profile-content");if(!n||!cr||!cr.student)return;const e=cr.student,t=e.registration_complete?'<span class="status-badge--complete"> Complete</span>':'<span class="status-badge--pending"> Incomplete</span>';let r="";r+='<div class="card" style="margin-bottom:var(--space-lg)">',r+='<div style="display:flex;gap:var(--space-lg);align-items:flex-start;flex-wrap:wrap">',Bd?r+=`<img src="${ye(Bd)}" alt="Student photo" style="width:120px;height:120px;object-fit:cover;border-radius:var(--radius-md);border:2px solid var(--color-border-light)" />`:r+=`<div class="avatar avatar--lg" style="width:120px;height:120px;font-size:2rem">${(e.first_name||"?")[0]}${(e.last_name||"?")[0]}</div>`,r+='<div style="flex:1">',r+=`<h2 style="margin:0 0 var(--space-xs)">${ye(e.first_name||"")} ${ye(e.last_name||"")}</h2>`,r+=`<p style="margin:0 0 var(--space-xs);font-size:var(--text-small)">Grade ${ye(e.grade||"")}</p>`,e.student_email&&(r+=`<p style="margin:0 0 var(--space-xs);font-size:var(--text-small)"><strong>Student Email:</strong> ${ye(e.student_email)}</p>`),r+=`<div style="display:flex;flex-wrap:wrap;gap:var(--space-xs);margin-bottom:var(--space-xs)">${t}`,r+=cr.callbackInvited?' <span class="status-badge--complete"> Callback Invited</span>':"",r+="</div>",r+="</div></div>",r+='<div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">',r+='<h3 style="font-size:var(--text-small);font-family:var(--font-body);text-transform:uppercase;letter-spacing:0.05em;color:var(--color-text-muted);margin-bottom:var(--space-sm)">Parent / Guardian</h3>',r+=`<p style="font-size:var(--text-small)">${ye(e.parent_first_name||"")} ${ye(e.parent_last_name||"")}</p>`,r+=`<p style="font-size:var(--text-small)"><strong>Email:</strong> ${ye(e.parent_email||"")}</p>`,r+=`<p style="font-size:var(--text-small)"><strong>Phone:</strong> ${ye(e.parent_phone||"")}</p>`,r+="</div>",(e.parent2_first_name||e.parent2_last_name||e.parent2_email||e.parent2_phone)&&(r+='<div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">',r+='<h3 style="font-size:var(--text-small);font-family:var(--font-body);text-transform:uppercase;letter-spacing:0.05em;color:var(--color-text-muted);margin-bottom:var(--space-sm)">Parent / Guardian 2</h3>',r+=`<p style="font-size:var(--text-small)">${ye(e.parent2_first_name||"")} ${ye(e.parent2_last_name||"")}</p>`,r+=`<p style="font-size:var(--text-small)"><strong>Email:</strong> ${ye(e.parent2_email||"")}</p>`,r+=`<p style="font-size:var(--text-small)"><strong>Phone:</strong> ${ye(e.parent2_phone||"")}</p>`,r+="</div>"),e.sings_own_disney_song&&(r+='<div style="margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-border-light)">',r+=`<span class="status-badge--complete">Own Disney Song: ${ye(e.song_name||"")}</span>`,r+="</div>"),r+="</div>",r+='<div class="card" style="margin-bottom:var(--space-lg)">',r+='<h3 style="margin-bottom:var(--space-md)">Participation</h3>',r+=EC(),r+="</div>",r+='<div class="card">',r+='<h3 style="margin-bottom:var(--space-md)">Evaluation Notes</h3>',r+=NC(),r+=kC(),r+="</div>",n.innerHTML=r,LC(n)}function EC(){var e,t;let n='<table class="data-table"><thead><tr><th>Track</th><th>Status</th><th>Details</th></tr></thead><tbody>';if((t=(e=cr.dance)==null?void 0:e.dance_windows)!=null&&t.length){const r=cr.dance.dance_windows.map(i=>`${rn(i.audition_date)} ${bt(i.start_time)}  ${bt(i.end_time)}`).join("; ");n+=`<tr><td> Dance</td><td style="color:var(--color-success)">Assigned</td><td>${ye(r)}</td></tr>`}else n+='<tr><td> Dance</td><td style="color:var(--color-text-muted)">Not configured</td><td></td></tr>';if(cr.vocal&&cr.vocal.audition_slots){const r=cr.vocal.audition_slots;n+=`<tr><td> Vocal</td><td style="color:var(--color-success)">Booked</td><td>${rn(r.audition_date)} ${bt(r.start_time)}  ${bt(r.end_time)}</td></tr>`}else n+='<tr><td> Vocal</td><td style="color:var(--color-text-muted)">Not booked</td><td></td></tr>';return n+=`<tr><td> Callbacks</td><td>${cr.callbackInvited?'<span style="color:var(--color-success)">Invited</span>':'<span style="color:var(--color-text-muted)">Not invited</span>'}</td><td></td></tr>`,n+="</tbody></table>",n}function NC(){if(cr.evaluations.length===0)return'<p style="font-size:var(--text-small);color:var(--color-text-muted);margin-bottom:var(--space-md)">No evaluation notes yet.</p>';const{user:n}=Jt();let e='<table class="data-table"><thead><tr><th>Track</th><th>Notes</th><th>By</th><th>Date</th><th>Actions</th></tr></thead><tbody>';return cr.evaluations.forEach(t=>{var a;const r=((a=t.staff_profiles)==null?void 0:a.display_name)||"Unknown",i=new Date(t.created_at).toLocaleString(),s=t.staff_user_id===(n==null?void 0:n.id);e+=`<tr>
      <td>${ye(t.track)}</td>
      <td>${ye(t.notes)}</td>
      <td>${ye(r)}</td>
      <td style="font-size:var(--text-xs)">${ye(i)}</td>
      <td>${s?`<button class="btn-small edit-eval-btn" data-id="${t.id}" data-notes="${ye(t.notes)}" data-track="${ye(t.track)}">Edit</button>`:""}</td>
    </tr>`}),e+="</tbody></table>",e}function kC(){const n=ts!==null,e=n?cr.evaluations.find(t=>t.id===ts):null;return`
    <div style="margin-top:var(--space-lg);max-width:500px">
      <h4>${n?"Edit Note":"Add Note"}</h4>
      <div class="login-form" style="max-width:100%">
        <label for="eval-track">Track</label>
        <select id="eval-track" ${n?"disabled":""}>
          <option value="general" ${!e||e.track==="general"?"selected":""}>General</option>
          <option value="dance" ${(e==null?void 0:e.track)==="dance"?"selected":""}>Dance</option>
          <option value="vocal" ${(e==null?void 0:e.track)==="vocal"?"selected":""}>Vocal</option>
          <option value="callbacks" ${(e==null?void 0:e.track)==="callbacks"?"selected":""}>Callbacks</option>
        </select>
        <label for="eval-notes">Notes</label>
        <textarea id="eval-notes" rows="3">${e?ye(e.notes):""}</textarea>
        <div style="display:flex;gap:var(--space-sm)">
          <button id="eval-submit-btn" class="btn-accent">${n?"Update Note":"Add Note"}</button>
          ${n?'<button id="eval-cancel-btn" class="btn-ghost">Cancel</button>':""}
        </div>
        <div class="form-message${ks!=null&&ks.type?` ${ks.type}`:""}" id="eval-msg" aria-live="polite">${(ks==null?void 0:ks.text)||""}</div>
      </div>
    </div>
  `}function LC(n){n.querySelectorAll(".edit-eval-btn").forEach(r=>{r.addEventListener("click",()=>{ts=r.dataset.id,_d()})});const e=document.getElementById("eval-cancel-btn");e&&e.addEventListener("click",()=>{ts=null,_d()});const t=document.getElementById("eval-submit-btn");t&&t.addEventListener("click",async()=>{var c,d,m;const r=(c=document.getElementById("eval-track"))==null?void 0:c.value,i=(m=(d=document.getElementById("eval-notes"))==null?void 0:d.value)==null?void 0:m.trim(),s=document.getElementById("eval-msg"),a=xC(i,r);if(!a.valid){s&&(s.className="form-message error",s.textContent=a.errors.join(" "));return}t.disabled=!0,t.textContent=ts?"Updating":"Adding",ks=null,s&&(s.className="form-message",s.textContent="");let o;if(ts)({error:o}=await z6(ts,i));else{const{user:p}=Jt();({error:o}=await U6(cr.student.id,p.id,r,i))}if(o){t.disabled=!1,t.textContent=ts?"Update Note":"Add Note",s&&(s.className="form-message error",s.textContent=o.message||"Failed to save note.");return}ks={type:"success",text:ts?"Note updated.":"Note added."},ts=null;const{data:l}=await am(cr.student.id);cr.evaluations=l||[],_d()})}let na=null,Io=[],bm=null;const ey={show_title:"Beauty and the Beast",subject_template:"{{Title of the Show}} Audition Details - Please Review",body_template:`Hi {{Student Name}} and Family,

We're excited to get auditions underway for {{Title of the Show}} - thank you for signing up!

Please review the required audition materials for:
- Belle
- Lumiere
- Mrs. Potts
- Gaston
- Le Feu

All songs, tracks, and instructions are here:
https://practice-batb.adcatheatre.com/

Each student will be assigned:
- Dance Day: {{Dance Day Date}} ({{Dance Start Time}}-{{Dance End Time}})
- Vocal Day: {{Vocal Day Date}} ({{Vocal Start Time}}-{{Vocal End Time}})

Please also keep callback date(s) - {{Callback Date(s)}} ({{Callback Start Time}}-{{Callback End Time}}) - open in case your student is invited back.

Students should come prepared and comfortable with the posted materials. The more prepared they are, the more confident and focused they'll feel in the room.

We're looking forward to a strong, fun start to the season. Thank you for being part of it!

Warmly,
[Your Name]
[Production Team / Organization Name]`};async function TC(){const[n,e,t]=await Promise.all([Rl(),Hd(),yx()]);n.data&&(na=n.data),e.data&&(Io=e.data),bm=t.data||{...ey}}function ty(){const n=(na==null?void 0:na.vocal_mode)||"timeslot";return`
    <div class="card" style="margin-bottom:var(--space-lg)">
      <h2 style="margin-top:0">Vocal Audition Mode</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Choose how families sign up for vocal auditions.
      </p>
      <div style="display:flex;gap:var(--space-md);flex-wrap:wrap">
        <label class="mode-option ${n==="timeslot"?"mode-option--active":""}" style="cursor:pointer;display:flex;align-items:flex-start;gap:var(--space-sm);padding:var(--space-md);border:2px solid ${n==="timeslot"?"var(--color-accent)":"var(--color-border)"};border-radius:var(--radius-md);flex:1;min-width:200px">
          <input type="radio" name="vocal-mode" value="timeslot" ${n==="timeslot"?"checked":""} />
          <div>
            <strong>Timeslot Mode</strong>
            <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin:var(--space-xs) 0 0">
              Families pick their own 15-minute vocal audition time slot.
            </p>
          </div>
        </label>
        <label class="mode-option ${n==="day_assignment"?"mode-option--active":""}" style="cursor:pointer;display:flex;align-items:flex-start;gap:var(--space-sm);padding:var(--space-md);border:2px solid ${n==="day_assignment"?"var(--color-accent)":"var(--color-border)"};border-radius:var(--radius-md);flex:1;min-width:200px">
          <input type="radio" name="vocal-mode" value="day_assignment" ${n==="day_assignment"?"checked":""} />
          <div>
            <strong>Day Assignment Mode</strong>
            <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin:var(--space-xs) 0 0">
              Students select role preferences during registration. Director assigns students to audition days.
            </p>
          </div>
        </label>
      </div>
      <div id="mode-msg" class="form-message" aria-live="polite" style="margin-top:var(--space-sm)"></div>
    </div>
  `}function CC(){const{role:n}=Jt();return Io.length===0?'<p style="color:var(--color-text-secondary)">No audition roles defined yet. Add one below.</p>':`
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>Order</th>
          <th>Role Name</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${Io.map(e=>`
          <tr>
            <td>${e.display_order}</td>
            <td>${ye(e.name)}</td>
            <td>
              <button class="btn-small" data-edit-role="${e.id}">Edit</button>
              ${Ro(n)?`<button class="btn-small btn-secondary" data-delete-role="${e.id}">Delete</button>`:""}
            </td>
          </tr>`).join("")}
      </tbody>
    </table>
    </div>
  `}function ym(n){const e=n||{},t=!!n,r=Io.length>0?Math.max(...Io.map(i=>i.display_order))+1:1;return`
    <form id="role-form" class="login-form" style="margin-top:var(--space-md)">
      <h3>${t?"Edit":"Add"} Audition Role</h3>
      ${t?`<input type="hidden" id="role-id" value="${e.id}" />`:""}
      <label for="role-name">Role Name *</label>
      <input type="text" id="role-name" required value="${ye(e.name||"")}" placeholder="e.g. Belle, Beast, Ensemble" />
      <label for="role-order">Display Order</label>
      <input type="number" id="role-order" value="${e.display_order??r}" min="0" />
      <button type="submit">${t?"Update":"Add"} Role</button>
      ${t?'<button type="button" id="cancel-role-edit" class="btn-small btn-secondary" style="margin-top:0.25rem">Cancel</button>':""}
      <div id="role-form-msg" class="form-message" aria-live="polite"></div>
    </form>
  `}function IC(){const n=bm||ey;return`
    <div class="card" style="margin-bottom:var(--space-lg)">
      <h2 style="margin-top:0">Registration Schedule Email Template</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        This email is sent automatically when a student completes registration.
      </p>
      <form id="registration-email-template-form" class="login-form" style="max-width:100%">
        <label for="registration-show-title">Title of the Show</label>
        <input type="text" id="registration-show-title" value="${ye(n.show_title||"")}" placeholder="Beauty and the Beast" />

        <label for="registration-email-subject">Subject Template</label>
        <input type="text" id="registration-email-subject" value="${ye(n.subject_template||"")}" />

        <label for="registration-email-body">Body Template</label>
        <textarea id="registration-email-body" rows="16" style="width:100%;font-family:var(--font-mono);padding:0.75rem">${ye(n.body_template||"")}</textarea>

        <p style="font-size:var(--text-xs);color:var(--color-text-muted);margin:0">
          Available placeholders: {{Title of the Show}}, {{Student Name}}, {{Dance Day Date}}, {{Dance Start Time}}, {{Dance End Time}},
          {{Vocal Day Date}}, {{Vocal Start Time}}, {{Vocal End Time}}, {{Callback Date(s)}}, {{Callback Start Time}}, {{Callback End Time}}
        </p>

        <button type="submit">Save Email Template</button>
        <div id="registration-email-template-msg" class="form-message" aria-live="polite"></div>
      </form>
    </div>
  `}function ny(n){document.querySelectorAll('input[name="vocal-mode"]').forEach(t=>{t.addEventListener("change",async()=>{const{user:r}=Jt(),i=document.getElementById("mode-msg"),s=t.value;i&&(i.textContent="Saving",i.className="form-message");const{data:a,error:o}=await ox({vocal_mode:s},r.id);if(o){i&&(i.textContent="Error: "+o.message,i.className="form-message error");return}const l=(a==null?void 0:a.id)||(na==null?void 0:na.id)||null;So("update_vocal_mode","audition_settings",l,{vocal_mode:s}),i&&(i.textContent=`Switched to ${s==="timeslot"?"Timeslot":"Day Assignment"} mode.`,i.className="form-message success"),na=a||{...na||{},vocal_mode:s};const c=document.getElementById("mode-toggle-container");c&&(c.innerHTML=ty(),ny(n))})}),document.querySelectorAll("[data-edit-role]").forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("data-edit-role"),i=Io.find(s=>s.id===r);if(i){const s=document.getElementById("role-form-container");s&&(s.innerHTML=ym(i),wp(n))}})}),document.querySelectorAll("[data-delete-role]").forEach(t=>{t.addEventListener("click",async()=>{const r=t.getAttribute("data-delete-role"),i=Io.find(a=>a.id===r);if(!window.confirm(`Delete role "${(i==null?void 0:i.name)||""}"? This will also remove all student preferences for this role.`))return;t.disabled=!0;const{error:s}=await fx(r);if(s){alert("Failed to delete: "+s.message),t.disabled=!1;return}n()})}),wp(n);const e=document.getElementById("registration-email-template-form");e&&e.addEventListener("submit",async t=>{var m,p,h,b,w,S;t.preventDefault();const{user:r}=Jt(),i=document.getElementById("registration-email-template-msg"),s=e.querySelector('button[type="submit"]'),a=((p=(m=document.getElementById("registration-show-title"))==null?void 0:m.value)==null?void 0:p.trim())||"",o=((b=(h=document.getElementById("registration-email-subject"))==null?void 0:h.value)==null?void 0:b.trim())||"",l=((S=(w=document.getElementById("registration-email-body"))==null?void 0:w.value)==null?void 0:S.trim())||"";if(!a||!o||!l){i&&(i.textContent="Show title, subject, and body are required.",i.className="form-message error");return}s.disabled=!0,s.textContent="Saving",i&&(i.textContent="",i.className="form-message");const{data:c,error:d}=await wx({show_title:a,subject_template:o,body_template:l},r.id);if(s.disabled=!1,s.textContent="Save Email Template",d){i&&(i.textContent="Error: "+d.message,i.className="form-message error");return}bm=c||{show_title:a,subject_template:o,body_template:l},So("update_registration_email_template","registration_email_templates",(c==null?void 0:c.id)||null,{show_title:a}),i&&(i.textContent="Template saved.",i.className="form-message success")})}function wp(n){const e=document.getElementById("role-form");if(!e)return;const t=document.getElementById("cancel-role-edit");t&&t.addEventListener("click",()=>{const r=document.getElementById("role-form-container");r&&(r.innerHTML=ym(null),wp(n))}),e.addEventListener("submit",async r=>{r.preventDefault();const{user:i}=Jt(),s=document.getElementById("role-form-msg"),a=e.querySelector('button[type="submit"]'),o=document.getElementById("role-id"),l=!!o,c=document.getElementById("role-name").value.trim(),d=parseInt(document.getElementById("role-order").value,10)||0;if(!c){s&&(s.textContent="Role name is required.",s.className="form-message error");return}a.disabled=!0,a.textContent="Saving",s&&(s.textContent="");let m;if(l?m=await hx(o.value,{name:c,display_order:d},i.id):m=await dx(c,d,i.id),m.error){s&&(s.textContent="Error: "+m.error.message,s.className="form-message error"),a.disabled=!1,a.textContent=l?"Update Role":"Add Role";return}l?So("update_role","audition_roles",o.value,{name:c,display_order:d}):m.data&&So("create_role","audition_roles",m.data.id,{name:c,display_order:d}),s&&(s.textContent=l?"Updated!":"Added!",s.className="form-message success"),setTimeout(()=>n(),300)})}function OC(){const n=document.createElement("div");n.className="page",n.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Audition Roles</h1>
      <button class="btn-ghost" onclick="location.hash='#/staff'" style="min-height:auto;width:auto"> Dashboard</button>
    </div>
    <div id="mode-toggle-container"></div>
    <div id="registration-email-template-container"></div>
    <div class="card" style="margin-bottom:var(--space-lg)">
      <h2 style="margin-top:0">Roles</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Define the roles students can audition for. Students will rank these during registration when Day Assignment mode is active.
      </p>
      <div id="roles-table"><p>Loading</p></div>
    </div>
    <div class="card" id="role-form-container"></div>
  `;async function e(){await TC();const t=document.getElementById("mode-toggle-container"),r=document.getElementById("registration-email-template-container"),i=document.getElementById("roles-table"),s=document.getElementById("role-form-container");t&&(t.innerHTML=ty()),r&&(r.innerHTML=IC()),i&&(i.innerHTML=CC()),s&&(s.innerHTML=ym(null)),ny(e)}return setTimeout(e,0),n}let Oo=[],qi=[],ov=[],wm=[],_m=[],xm=[],rs=new Set,ru="";function RC(){const n=document.createElement("div");return n.className="page",n.innerHTML=`
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md)">
      <h1 style="margin:0">Vocal Day Assignments</h1>
      <button class="btn-ghost" onclick="location.hash='#/staff'" style="min-height:auto;width:auto"> Dashboard</button>
    </div>
    <div class="form-message" id="assign-msg" aria-live="polite"></div>
    <div id="assign-content"><p>Loading</p></div>
  `,setTimeout(()=>go(),0),n}async function go(){const[n,e,t,r,i,s]=await Promise.all([Hd(),lx(),gx(),Bv(),Po(),du()]);Oo=n.data||[],xm=e.data||[],qi=t.data||[],ov=r.data||[],wm=i.data||[],_m=s.data||[];const a=document.getElementById("assign-msg"),o=n.error||e.error||t.error||r.error||i.error||s.error;a&&o&&(a.className="form-message error",a.textContent=o.message||"Failed to load assignment data.");const l=new Map(ov.map(c=>[c.student_id,c]));qi=qi.map(c=>({...c,day_assignment:l.get(c.id)||null})),_c()}function _c(){const n=document.getElementById("assign-content");if(!n)return;if(Oo.length===0){n.innerHTML=`
      <div class="placeholder-notice">
        No audition roles defined yet. <a href="#/staff/roles">Configure roles first</a>.
      </div>
    `;return}if(qi.length===0){n.innerHTML='<div class="placeholder-notice">No registered students found.</div>';return}const e=wm.map(r=>r.audition_date);if(e.length===0){n.innerHTML=`
      <div class="placeholder-notice">
        No audition dates configured. <a href="#/staff/scheduling">Set up scheduling first</a>.
      </div>
    `;return}let t="";t+=PC(e),t+=DC(),t+=BC(e),t+=qC(e),t+=jC(e),t+=$C(),t+=MC(),n.innerHTML=t,FC(n)}function ry(n){var e;return((e=xm.find(t=>t.audition_role_id===n))==null?void 0:e.audition_date)||""}function PC(n){const e=n.map(r=>`<option value="${r}">${rn(r)}</option>`).join("");return`
    <div class="card" style="margin-bottom:var(--space-md);padding:var(--space-md)">
      <h2 style="margin-top:0">Role Day Mapping</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-sm)">
        Assign each role to an audition day. Then auto-assign students by their #1 role preference.
      </p>
      <div id="role-day-mapping-list">${Oo.map(r=>(ry(r.id),`
      <div style="display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-xs) 0;border-bottom:1px solid var(--color-border-light)">
        <div style="min-width:180px"><strong>${ye(r.name)}</strong></div>
        <select class="role-day-map-select" data-role-id="${r.id}" style="max-width:240px">
          <option value="">No day assigned</option>
          ${e}
        </select>
      </div>
    `)).join("")}</div>
      <div style="display:flex;gap:var(--space-sm);margin-top:var(--space-sm);flex-wrap:wrap">
        <button class="btn-small" id="save-role-day-mappings-btn">Save Role Days</button>
        <button class="btn-accent" id="auto-assign-role-days-btn">Auto-Assign by #1 Role</button>
      </div>
    </div>
  `}function DC(){return`
    <div style="display:flex;flex-wrap:wrap;gap:var(--space-sm);align-items:center;margin-bottom:var(--space-md)">
      <label for="filter-role" style="font-size:var(--text-small);font-weight:600">Filter by #1 role:</label>
      <select id="filter-role" style="max-width:200px">
        <option value="">All Students</option>
        ${Oo.map(e=>`<option value="${e.id}" ${ru===e.id?"selected":""}>${ye(e.name)}</option>`).join("")}
        <option value="__none__" ${ru==="__none__"?"selected":""}>No Preference</option>
      </select>
    </div>
  `}function iy(){if(!ru)return qi;const e=xx(qi,Oo).get(ru);return e?e.students:[]}function BC(n){const e=iy(),t=n.map(s=>`<option value="${s}">${rn(s)}</option>`).join(""),r=e.length>0&&e.every(s=>rs.has(s.id));let i=`
    <h2>Students (${e.length})</h2>
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th class="checkbox-cell"><input type="checkbox" id="select-all-cb" ${r?"checked":""} /></th>
          <th>Name</th>
          <th>Grade</th>
          <th>#1 Role</th>
          <th>All Preferences</th>
          <th>Assigned Day</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
  `;return e.forEach(s=>{const a=Pl(s.role_preferences||[]),o=a[0],l=o?Oo.find(h=>h.id===o.audition_role_id):null,c=a.map(h=>{const b=Oo.find(w=>w.id===h.audition_role_id);return`${h.rank_order}. ${ye((b==null?void 0:b.name)||"?")}`}).join(", ")||"",d=s.day_assignment,m=d==null?void 0:d.audition_date,p=rs.has(s.id)?"checked":"";i+=`
      <tr>
        <td class="checkbox-cell"><input type="checkbox" class="student-cb" data-id="${s.id}" ${p} /></td>
        <td><a href="#/staff/student-profile?id=${s.id}">${ye(s.first_name||"")} ${ye(s.last_name||"")}</a></td>
        <td>${ye(s.grade||"")}</td>
        <td>${l?ye(l.name):'<span style="color:var(--color-text-muted)"></span>'}</td>
        <td style="font-size:var(--text-xs)">${c}</td>
        <td>
          ${m?`<span class="badge active">${rn(m)}</span>`:'<span style="color:var(--color-text-muted)">Unassigned</span>'}
        </td>
        <td>
          ${m?`<select class="reassign-select" data-student="${s.id}" style="width:auto;font-size:var(--text-xs)">
                <option value=""> Change </option>
                ${t}
              </select>
              <button class="btn-small btn-secondary unassign-btn" data-student="${s.id}" style="margin-left:4px">Remove</button>`:`<select class="assign-select" data-student="${s.id}" style="width:auto;font-size:var(--text-xs)">
                <option value=""> Assign </option>
                ${t}
              </select>`}
        </td>
      </tr>
    `}),i+="</tbody></table></div>",i}function qC(n){if(rs.size===0)return"";const e=n.map(t=>`<option value="${t}">${rn(t)}</option>`).join("");return`
    <div class="bulk-action-bar">
      <span class="bulk-action-bar__count">${rs.size} selected</span>
      <div class="bulk-action-bar__actions" style="display:flex;align-items:center;gap:var(--space-sm)">
        <select id="bulk-date-select" style="width:auto;font-size:var(--text-xs)">
          <option value=""> Select Date </option>
          ${e}
        </select>
        <button class="btn-accent" id="bulk-assign-btn">Assign Selected</button>
      </div>
    </div>
  `}function jC(n){let e='<h2 style="margin-top:var(--space-xl)">Assignment Summary</h2>';const t=qi.filter(i=>i.day_assignment),r=qi.filter(i=>!i.day_assignment);e+=`<p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
    <strong>${t.length}</strong> assigned, <strong>${r.length}</strong> unassigned of <strong>${qi.length}</strong> total.
  </p>`,e+='<div style="display:grid;gap:var(--space-md);grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">';for(const i of n){const s=t.filter(a=>{var o;return((o=a.day_assignment)==null?void 0:o.audition_date)===i});e+=`
      <div class="card" style="padding:var(--space-md)">
        <strong>${rn(i)}</strong>
        <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin:var(--space-xs) 0">${s.length} student${s.length!==1?"s":""}</p>
        ${s.length>0?`<ul style="margin:0;padding-left:1rem;font-size:var(--text-xs)">${s.map(a=>`<li>${ye(a.first_name||"")} ${ye(a.last_name||"")}</li>`).join("")}</ul>`:'<p style="font-size:var(--text-xs);color:var(--color-text-muted)">No students assigned</p>'}
      </div>
    `}return e+="</div>",e}function $C(){const n=qi.filter(t=>t.day_assignment),e=n.filter(t=>eh(t).valid);return`
    <div style="margin-top:var(--space-xl)">
      <h2>Send Notifications</h2>
      <p style="font-size:var(--text-small);color:var(--color-text-secondary);margin-bottom:var(--space-md)">
        Send day assignment emails to all assigned families with a parent email on file.
        <strong>${e.length}</strong> of <strong>${n.length}</strong> assigned students have email.
        <span style="color:var(--color-text-muted)">(Real email delivery via Resend)</span>
      </p>
      <button class="btn-primary" id="send-notifications-btn" ${e.length===0?"disabled":""}>
        Send All Notifications (${e.length})
      </button>
    </div>
  `}function MC(){const n=_m.filter(t=>t.subject&&t.subject.includes("Vocal Audition Day"));let e='<h2 style="margin-top:var(--space-xl)">Notification History</h2>';return n.length===0?(e+='<p style="font-size:var(--text-small);color:var(--color-text-muted)">No day assignment notifications sent yet.</p>',e):(e+=`
    <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>Date Sent</th>
          <th>Student</th>
          <th>Recipient</th>
          <th>Subject</th>
        </tr>
      </thead>
      <tbody>
  `,n.forEach(t=>{const r=t.students,i=new Date(t.created_at).toLocaleString();e+=`
      <tr>
        <td style="font-size:var(--text-xs)">${ye(i)}</td>
        <td>${ye((r==null?void 0:r.first_name)||"")} ${ye((r==null?void 0:r.last_name)||"")}</td>
        <td>${ye(t.recipient_email)}</td>
        <td>${ye(t.subject)}</td>
      </tr>
    `}),e+="</tbody></table></div>",e)}function FC(n,e){n.querySelectorAll(".role-day-map-select").forEach(l=>{const c=l.dataset.roleId;l.value=ry(c)});const t=document.getElementById("save-role-day-mappings-btn");t&&t.addEventListener("click",async()=>{const{user:l}=Jt(),c=document.getElementById("assign-msg");if(!l)return;t.disabled=!0,t.textContent="Saving";const d=[...document.querySelectorAll(".role-day-map-select")].map(async w=>{const S=w.dataset.roleId,A=w.value;return A?cx(S,A,l.id):ux(S)}),m=await Promise.allSettled(d),p=[];m.forEach(w=>{var S;if(w.status==="rejected"){p.push(w.reason);return}(S=w.value)!=null&&S.error&&p.push(w.value.error)});const h=p.length,b=p[0];t.disabled=!1,t.textContent="Save Role Days",c&&(h===0?(c.className="form-message success",c.textContent="Role day mappings saved."):(c.className="form-message error",c.textContent=b!=null&&b.message?`Failed to save role day mappings: ${b.message}`:`Saved with ${h} error(s).`)),await go()});const r=document.getElementById("auto-assign-role-days-btn");r&&r.addEventListener("click",async()=>{var h;const l=document.getElementById("assign-msg"),c=new Map(xm.map(b=>[b.audition_role_id,b.audition_date]));if(c.size===0){l&&(l.className="form-message error",l.textContent="Set at least one role day mapping first.");return}r.disabled=!0,r.textContent="Assigning";let d=0,m=0,p=0;for(const b of qi){const S=(h=Pl(b.role_preferences||[])[0])==null?void 0:h.audition_role_id,A=S?c.get(S):null;if(!A){m++;continue}const{error:I}=await mc(b.id,A);I?p++:d++}r.disabled=!1,r.textContent="Auto-Assign by #1 Role",l&&(p===0?(l.className="form-message success",l.textContent=`Auto-assigned ${d} student(s). Skipped ${m}.`):(l.className="form-message error",l.textContent=`Assigned ${d}, skipped ${m}, failed ${p}.`)),await go()});const i=document.getElementById("filter-role");i&&i.addEventListener("change",()=>{ru=i.value,rs.clear(),_c()});const s=document.getElementById("select-all-cb");s&&s.addEventListener("change",()=>{const l=iy();s.checked?l.forEach(c=>rs.add(c.id)):l.forEach(c=>rs.delete(c.id)),_c()}),n.querySelectorAll(".student-cb").forEach(l=>{l.addEventListener("change",()=>{l.checked?rs.add(l.dataset.id):rs.delete(l.dataset.id),_c()})}),n.querySelectorAll(".assign-select").forEach(l=>{l.addEventListener("change",async()=>{const c=l.dataset.student,d=l.value;if(!d)return;const m=document.getElementById("assign-msg");l.disabled=!0;const{error:p}=await mc(c,d);if(p){m&&(m.className="form-message error",m.textContent=p.message||"Assignment failed."),l.disabled=!1,l.value="";return}m&&(m.className="form-message success",m.textContent="Student assigned."),await go()})}),n.querySelectorAll(".reassign-select").forEach(l=>{l.addEventListener("change",async()=>{const c=l.dataset.student,d=l.value;if(!d)return;const m=document.getElementById("assign-msg");l.disabled=!0;const{error:p}=await mc(c,d);if(p){m&&(m.className="form-message error",m.textContent=p.message||"Reassignment failed."),l.disabled=!1,l.value="";return}m&&(m.className="form-message success",m.textContent="Student reassigned."),await go()})}),n.querySelectorAll(".unassign-btn").forEach(l=>{l.addEventListener("click",async()=>{const c=l.dataset.student;if(!window.confirm("Remove this student's day assignment?"))return;const d=document.getElementById("assign-msg");l.disabled=!0,l.textContent="Removing";const{error:m}=await vx(c);if(m){d&&(d.className="form-message error",d.textContent=m.message||"Failed to remove."),l.disabled=!1,l.textContent="Remove";return}d&&(d.className="form-message success",d.textContent="Assignment removed."),await go()})});const a=document.getElementById("bulk-assign-btn");a&&a.addEventListener("click",async()=>{const l=document.getElementById("bulk-date-select"),c=l==null?void 0:l.value;if(!c){const b=document.getElementById("assign-msg");b&&(b.className="form-message error",b.textContent="Please select a date first.");return}const d=document.getElementById("assign-msg");a.disabled=!0,a.textContent="Assigning";const m=await Promise.allSettled([...rs].map(b=>mc(b,c))),p=m.filter(b=>b.status==="fulfilled"&&!b.value.error).length,h=m.length-p;rs.clear(),d&&(h===0?(d.className="form-message success",d.textContent=`Assigned ${p} student(s) to ${rn(c)}.`):(d.className="form-message error",d.textContent=`Assigned ${p}, failed ${h}. Check console.`)),await go()});const o=document.getElementById("send-notifications-btn");o&&o.addEventListener("click",async()=>{const l=document.getElementById("assign-msg"),d=qi.filter(w=>w.day_assignment).filter(w=>eh(w).valid);if(d.length===0){l&&(l.className="form-message error",l.textContent="No assigned students with email.");return}o.disabled=!0,o.textContent="Sending",l&&(l.className="form-message",l.textContent="");const m=await Promise.allSettled(d.map(async w=>{const{subject:S,body:A,bodyPreview:I}=Ax(w,w.day_assignment.audition_date,wm),{error:O}=await Qp({to:w.parent_email,subject:S,text:A});if(O)throw O;const{error:P}=await bx(w.id,w.parent_email,S,I);if(P)throw P;return w.id})),p=m.filter(w=>w.status==="fulfilled").length,h=m.filter(w=>w.status==="rejected").length;o.disabled=!1,o.textContent=`Send All Notifications (${d.length})`,l&&(h===0?(l.className="form-message success",l.textContent=`Sent ${p} notification(s) successfully.`):(l.className="form-message error",l.textContent=`Sent ${p}, failed ${h}. Check console.`));const{data:b}=await du();_m=b||[],_c()})}const qr={rose:"",theater:"",dance:"",vocal:"",callback:"",calendar:"",clipboard:"",ticket:"",people:"",chart:"",menu:"",home:""};function UC(n){const e=document.createElement("div");e.innerHTML=`
    <div class="top-bar">
      <a href="#/" class="top-bar__brand">${qr.rose} Beauty and the Beast <span>Auditions</span></a>
      <div class="top-bar__actions">
        <span class="top-bar__user">${n||""}</span>
        <button class="top-bar__logout" id="layout-logout-btn">Sign Out</button>
      </div>
    </div>
    <div class="layout-family">
      <main id="route-content"></main>
    </div>
    <nav class="bottom-tabs" aria-label="Family navigation">
      <div class="bottom-tabs__list">
        <a href="#/family" class="bottom-tabs__item" data-tab="/family">
          <span class="icon">${qr.home}</span>
          Home
        </a>
        <a href="#/family/register" class="bottom-tabs__item" data-tab="/family/register">
          <span class="icon">${qr.clipboard}</span>
          Register
        </a>
        <a href="#/family/schedule" class="bottom-tabs__item" data-tab="/family/schedule">
          <span class="icon">${qr.calendar}</span>
          Schedule
        </a>
        <a href="#/family/dance" class="bottom-tabs__item" data-tab="/family/dance">
          <span class="icon">${qr.ticket}</span>
          Dance
        </a>
        <a href="#/family/vocal" class="bottom-tabs__item" data-tab="/family/vocal">
          <span class="icon">${qr.vocal}</span>
          Vocal
        </a>
      </div>
    </nav>
  `;const t=e.querySelector("#route-content");function r(i){e.querySelectorAll(".bottom-tabs__item").forEach(s=>{s.classList.toggle("active",s.dataset.tab===i)})}return{element:e,content:t,updateActiveTab:r}}function zC(n,e,t){const r=document.createElement("div"),i=t?`
    <div class="sidebar__section">
      <div class="sidebar__label">Admin</div>
    </div>
    <a href="#/admin" class="sidebar__link" data-nav="/admin">
      <span class="icon">${qr.chart}</span> Admin Dashboard
    </a>
    <a href="#/admin/contracts" class="sidebar__link" data-nav="/admin/contracts">
      <span class="icon">${qr.clipboard}</span> Contracts
    </a>
    <a href="#/admin/registrations" class="sidebar__link" data-nav="/admin/registrations">
      <span class="icon">${qr.people}</span> Registrations
    </a>
  `:"";r.innerHTML=`
    <div class="top-bar">
      <div style="display:flex;align-items:center;gap:0.75rem">
        <button class="hamburger-btn" id="sidebar-toggle" aria-label="Toggle menu">${qr.menu}</button>
        <a href="#/staff" class="top-bar__brand">${qr.theater} BATB Staff</a>
      </div>
      <div class="top-bar__actions">
        <span class="top-bar__user">${n||""} <span class="badge active" style="font-size:0.7rem">${e||""}</span></span>
        <button class="top-bar__logout" id="layout-logout-btn">Sign Out</button>
      </div>
    </div>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <aside class="sidebar" id="staff-sidebar">
      <div class="sidebar__section">
        <div class="sidebar__label">Management</div>
      </div>
      <a href="#/staff" class="sidebar__link" data-nav="/staff">
        <span class="icon">${qr.home}</span> Dashboard
      </a>
      <a href="#/staff/scheduling" class="sidebar__link" data-nav="/staff/scheduling">
        <span class="icon">${qr.calendar}</span> Scheduling
      </a>
      <a href="#/staff/dance-roster" class="sidebar__link" data-nav="/staff/dance-roster">
        <span class="icon">${qr.dance}</span> Dance Roster
      </a>
      <a href="#/staff/vocal-roster" class="sidebar__link" data-nav="/staff/vocal-roster">
        <span class="icon">${qr.vocal}</span> Vocal Roster
      </a>
      <a href="#/staff/callbacks" class="sidebar__link" data-nav="/staff/callbacks">
        <span class="icon">${qr.callback}</span> Callbacks
      </a>
      <a href="#/staff/roles" class="sidebar__link" data-nav="/staff/roles">
        <span class="icon"></span> Audition Roles
      </a>
      <a href="#/staff/vocal-assignments" class="sidebar__link" data-nav="/staff/vocal-assignments">
        <span class="icon"></span> Vocal Assignments
      </a>
      ${i}
    </aside>
    <div class="layout-staff">
      <main id="route-content"></main>
    </div>
  `;const s=r.querySelector("#route-content"),a=r.querySelector("#staff-sidebar"),o=r.querySelector("#sidebar-overlay"),l=r.querySelector("#sidebar-toggle");l&&l.addEventListener("click",()=>{a.classList.toggle("sidebar--open"),o.classList.toggle("sidebar-overlay--visible")}),o&&o.addEventListener("click",()=>{a.classList.remove("sidebar--open"),o.classList.remove("sidebar-overlay--visible")}),r.querySelectorAll(".sidebar__link").forEach(d=>{d.addEventListener("click",()=>{a.classList.remove("sidebar--open"),o.classList.remove("sidebar-overlay--visible")})});function c(d){r.querySelectorAll(".sidebar__link").forEach(m=>{m.classList.toggle("active",m.dataset.nav===d)})}return{element:r,content:s,updateActiveLink:c}}function HC(){const n=document.createElement("div");return n.innerHTML=`
    <div class="layout-public">
      <main id="route-content"></main>
    </div>
  `,{element:n,content:n.querySelector("#route-content")}}let _p=null,qa=null;function sy(n){const{session:e,role:t}=Jt();return e?n.startsWith("/staff")||n.startsWith("/admin")?Ep(t)?"staff":"public":n.startsWith("/family")?"family":"public":"public"}function ay(n){var i,s;const{session:e,role:t,staffProfile:r}=Jt();switch(n){case"family":return UC(((i=e==null?void 0:e.user)==null?void 0:i.email)||"");case"staff":{const a=(r==null?void 0:r.display_name)||((s=e==null?void 0:e.user)==null?void 0:s.email)||"";return zC(a,t,Ro(t))}default:return HC()}}function oy(){const n=document.getElementById("layout-logout-btn");n&&n.addEventListener("click",async()=>{try{await C_()}finally{xp("/")}})}function lv(){const n=dv(),e=sy(n),t=document.getElementById("app");t&&(e!==_p&&(_p=e,qa=ay(e),t.innerHTML="",t.appendChild(qa.element),oy()),e==="family"&&qa.updateActiveTab?qa.updateActiveTab(n):e==="staff"&&qa.updateActiveLink&&qa.updateActiveLink(n))}function WC(){return`
    <div class="page">
      <h1>404  Page Not Found</h1>
      <p>The page you're looking for doesn't exist.</p>
      <a href="#/">Return to Home</a>
    </div>
  `}async function VC(){var a;const n=document.getElementById("app");if(!n)return;n.innerHTML='<main id="route-content"></main>',Xn("/",j_),Xn("/family/login",M_),Xn("/staff/login",F_),Xn("/family",Ox),Xn("/staff",Rx),Xn("/admin",Px),Xn("/admin/contracts",Jk),Xn("/admin/registrations",Xk),Xn("/family/contract",l6),Xn("/family/register",L6),Xn("/family/schedule",R6),Xn("/family/dance",D6),Xn("/family/vocal",tC),Xn("/staff/scheduling",O6),Xn("/staff/dance-roster",X8),Xn("/staff/vocal-roster",lC),Xn("/staff/callbacks",fC),Xn("/staff/student-profile",AC),Xn("/staff/roles",OC),Xn("/staff/vocal-assignments",RC),Gy(WC),await q_(),Ky(o=>{const{session:l,role:c}=Jt();return D_(o,l,c)});const e=(window.location.hash||"#/").slice(1).split("?")[0]||"/",t=sy(e);_p=t,qa=ay(t),n.innerHTML="",n.appendChild(qa.element),oy();const{rerender:r}=Jy("#route-content");window.addEventListener("hashchange",()=>{lv()});let i=((a=Jt().user)==null?void 0:a.id)??null,s=Jt().role;B_(()=>{const{user:o,role:l}=Jt(),c=(o==null?void 0:o.id)??null;c===i&&l===s||(i=c,s=l,lv(),r())}),window.location.hash||xp("/")}document.addEventListener("DOMContentLoaded",VC);export{un as _,$a as c,wb as g};
