import{d as n}from"./index-Bv59R015.js";import{b as m}from"./scheduling-DSZ8OVmG.js";const g=7,p=15;function k(t){return t?t.registration_complete?{eligible:!0,reason:null}:{eligible:!1,reason:"Registration must be complete before booking a vocal slot."}:{eligible:!1,reason:"Student not found."}}function v(t,a){if(!t)return!1;const o=new Date(`${t}T${String(m).padStart(2,"0")}:00:00`);return a>=o}function w(t,a=g){const o=Math.max(0,a-t);return{available:o>0,spotsLeft:o}}function S(t,a,o=p){if(!t||!a)return[];if(o<=0)return[];const[e,d]=t.split(":").map(Number),[s,_]=a.split(":").map(Number),c=e*60+d,r=s*60+_;if(c>=r)return[];const l=[];let i=c;for(;i+o<=r;){const u=`${String(Math.floor(i/60)).padStart(2,"0")}:${String(i%60).padStart(2,"0")}`,f=`${String(Math.floor((i+o)/60)).padStart(2,"0")}:${String((i+o)%60).padStart(2,"0")}`;l.push({start:u,end:f}),i+=o}return l}async function y(){const{data:t,error:a}=await n.from("audition_slots").select("*").order("audition_date",{ascending:!0}).order("start_time",{ascending:!0});return{data:t||[],error:a}}async function V(t){const{data:a,error:o}=await n.from("audition_window_config").select("audition_date, vocal_start_time, vocal_end_time").not("vocal_start_time","is",null).not("vocal_end_time","is",null).order("audition_date",{ascending:!0});if(o)return{data:null,error:o};if(!a||a.length===0)return{data:[],error:null};const{data:e}=await n.from("audition_slots").select("audition_date, start_time"),d=new Set((e||[]).map(r=>`${r.audition_date}_${r.start_time}`)),s=[];for(const r of a){const l=S(r.vocal_start_time,r.vocal_end_time);for(const i of l){const u=`${r.audition_date}_${i.start}`;d.has(u)||s.push({audition_date:r.audition_date,start_time:i.start,end_time:i.end,created_by_staff_user_id:t})}}if(s.length===0)return{data:[],error:null};const{data:_,error:c}=await n.from("audition_slots").insert(s).select();return{data:_||[],error:c}}async function $(t){const{error:a}=await n.rpc("admin_delete_vocal_slot",{p_slot_id:t});return{error:a}}async function C(t){const{data:a,error:o}=await n.from("vocal_bookings").select("*, audition_slots(*)").eq("student_id",t).maybeSingle();return{data:a,error:o}}async function O(t,a){const{data:o,error:e}=await n.rpc("book_vocal_slot",{p_student_id:t,p_slot_id:a});return{data:o,error:e}}async function L(t,a){const{data:o,error:e}=await n.rpc("reschedule_vocal_slot",{p_student_id:t,p_new_slot_id:a});return{data:o,error:e}}async function T(t){const{data:a,error:o}=await n.rpc("cancel_vocal_booking",{p_student_id:t});return{data:a,error:o}}async function A(t,a){const{data:o,error:e}=await n.rpc("admin_override_vocal_booking",{p_student_id:t,p_slot_id:a});return{data:o,error:e}}async function B(){const{data:t,error:a}=await n.from("vocal_bookings").select(`
      id,
      student_id,
      audition_slot_id,
      created_at,
      students(id, first_name, last_name, grade),
      audition_slots(id, audition_date, start_time, end_time)
    `).order("created_at",{ascending:!0});return{data:t||[],error:a}}async function E(){const{data:t,error:a}=await n.from("vocal_bookings").select("audition_slot_id");if(a)return{data:null,error:a};const o={};return(t||[]).forEach(e=>{o[e.audition_slot_id]=(o[e.audition_slot_id]||0)+1}),{data:o,error:null}}export{g as V,y as a,E as b,k as c,O as d,T as e,C as f,w as g,B as h,v as i,V as j,$ as k,A as l,L as r};
