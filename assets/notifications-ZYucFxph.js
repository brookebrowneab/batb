import{d as i}from"./index-CvLlIQq8.js";async function l(){const{data:n}=await i.auth.getSession();let t=(n==null?void 0:n.session)||null;if(!t)return null;const s=t.expires_at?Number(t.expires_at):null,a=Math.floor(Date.now()/1e3);if(Number.isFinite(s)&&s-a<120){const{data:o,error:e}=await i.auth.refreshSession();if(e||!(o!=null&&o.session))return null;t=o.session}return t.access_token||null}async function d(n){if(!n)return null;const t=n.context;if(!t||typeof t.text!="function")return n;let s="";try{s=await t.text()}catch{return n}let a=s;try{const e=JSON.parse(s);a=(e==null?void 0:e.error)||(e==null?void 0:e.message)||s}catch{}const r=typeof t.status=="number"?t.status:null,o=r?` (status ${r})`:"";return new Error(`${a||n.message}${o}`)}async function h({to:n,subject:t,text:s,html:a=null}){const r=await l(),o=r?{Authorization:`Bearer ${r}`}:void 0,{data:e,error:c}=await i.functions.invoke("send-notification-email",{body:{to:n,subject:t,text:s,html:a},headers:o}),u=await d(c);return{data:e,error:u}}async function m(n){var c,u;const{data:t}=await i.auth.getSession(),s=((u=(c=t==null?void 0:t.session)==null?void 0:c.user)==null?void 0:u.id)||null,a=await l(),{data:r,error:o}=await i.functions.invoke("send-registration-schedule-email",{body:{studentId:n,userId:s,accessToken:a}}),e=await d(o);return{data:r,error:e}}export{h as a,m as s};
