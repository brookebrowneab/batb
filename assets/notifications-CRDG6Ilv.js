import{d as i}from"./index-oEHi0LwW.js";async function d(){const{data:n}=await i.auth.getSession();let t=(n==null?void 0:n.session)||null;if(!t)return null;const s=t.expires_at?Number(t.expires_at):null,a=Math.floor(Date.now()/1e3);if(Number.isFinite(s)&&s-a<120){const{data:o,error:e}=await i.auth.refreshSession();if(e||!(o!=null&&o.session))return null;t=o.session}return t.access_token||null}async function f(n){if(!n)return null;const t=n.context;if(!t||typeof t.text!="function")return n;let s="";try{s=await t.text()}catch{return n}let a=s;try{const e=JSON.parse(s);a=(e==null?void 0:e.error)||(e==null?void 0:e.message)||s}catch{}const r=typeof t.status=="number"?t.status:null,o=r?` (status ${r})`:"";return new Error(`${a||n.message}${o}`)}async function m({to:n,subject:t,text:s,html:a=null}){const r=await d(),o=r?{Authorization:`Bearer ${r}`}:void 0,{data:e,error:u}=await i.functions.invoke("send-notification-email",{body:{to:n,subject:t,text:s,html:a},headers:o}),c=await f(u);return{data:e,error:c}}async function w(n){var c,l;const{data:t}=await i.auth.getSession(),s=((l=(c=t==null?void 0:t.session)==null?void 0:c.user)==null?void 0:l.id)||null,a=await d(),r=a?{Authorization:`Bearer ${a}`}:void 0,{data:o,error:e}=await i.functions.invoke("send-registration-schedule-email",{body:{studentId:n,userId:s},headers:r}),u=await f(e);return{data:o,error:u}}export{m as a,w as s};
